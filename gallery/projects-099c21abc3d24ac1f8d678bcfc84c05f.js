var API={httpMethod:{put:"PUT",del:"DELETE",get:"GET",post:"POST"},mailtoEmails:{info:"mailto:info@grabcad.com"},requestUrl:{workbenchProjectCreate:"/workbench/projects",workbenchMyProjects:"/workbench/myprojects",accountPreferences:"/account/preferences"},dataType:{json:"json"}},SWFUpload;void 0==SWFUpload&&(SWFUpload=function(e){this.initSWFUpload(e)}),SWFUpload.prototype.initSWFUpload=function(e){try{this.customSettings={},this.settings=e,this.eventQueue=[],this.movieName="SWFUpload_"+SWFUpload.movieCount++,this.movieElement=null,SWFUpload.instances[this.movieName]=this,this.initSettings(),this.loadFlash(),this.displayDebugInfo()}catch(t){throw delete SWFUpload.instances[this.movieName],t}},SWFUpload.instances={},SWFUpload.movieCount=0,SWFUpload.version="2.2.0 2009-03-25",SWFUpload.QUEUE_ERROR={QUEUE_LIMIT_EXCEEDED:-100,FILE_EXCEEDS_SIZE_LIMIT:-110,ZERO_BYTE_FILE:-120,INVALID_FILETYPE:-130},SWFUpload.UPLOAD_ERROR={HTTP_ERROR:-200,MISSING_UPLOAD_URL:-210,IO_ERROR:-220,SECURITY_ERROR:-230,UPLOAD_LIMIT_EXCEEDED:-240,UPLOAD_FAILED:-250,SPECIFIED_FILE_ID_NOT_FOUND:-260,FILE_VALIDATION_FAILED:-270,FILE_CANCELLED:-280,UPLOAD_STOPPED:-290},SWFUpload.FILE_STATUS={QUEUED:-1,IN_PROGRESS:-2,ERROR:-3,COMPLETE:-4,CANCELLED:-5},SWFUpload.BUTTON_ACTION={SELECT_FILE:-100,SELECT_FILES:-110,START_UPLOAD:-120},SWFUpload.CURSOR={ARROW:-1,HAND:-2},SWFUpload.WINDOW_MODE={WINDOW:"window",TRANSPARENT:"transparent",OPAQUE:"opaque"},SWFUpload.completeURL=function(e){if("string"!=typeof e||e.match(/^https?:\/\//i)||e.match(/^\//))return e;window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"");var t=window.location.pathname.lastIndexOf("/");return path=0>=t?"/":window.location.pathname.substr(0,t)+"/",path+e},SWFUpload.prototype.initSettings=function(){this.ensureDefault=function(e,t){this.settings[e]=void 0==this.settings[e]?t:this.settings[e]},this.ensureDefault("upload_url",""),this.ensureDefault("preserve_relative_urls",!1),this.ensureDefault("file_post_name","Filedata"),this.ensureDefault("post_params",{}),this.ensureDefault("use_query_string",!1),this.ensureDefault("requeue_on_error",!1),this.ensureDefault("http_success",[]),this.ensureDefault("assume_success_timeout",0),this.ensureDefault("file_types","*.*"),this.ensureDefault("file_types_description","All Files"),this.ensureDefault("file_size_limit",0),this.ensureDefault("file_upload_limit",0),this.ensureDefault("file_queue_limit",0),this.ensureDefault("flash_url","swfupload.swf"),this.ensureDefault("prevent_swf_caching",!0),this.ensureDefault("button_image_url",""),this.ensureDefault("button_width",1),this.ensureDefault("button_height",1),this.ensureDefault("button_text",""),this.ensureDefault("button_text_style","color: #000000; font-size: 16pt;"),this.ensureDefault("button_text_top_padding",0),this.ensureDefault("button_text_left_padding",0),this.ensureDefault("button_action",SWFUpload.BUTTON_ACTION.SELECT_FILES),this.ensureDefault("button_disabled",!1),this.ensureDefault("button_placeholder_id",""),this.ensureDefault("button_placeholder",null),this.ensureDefault("button_cursor",SWFUpload.CURSOR.ARROW),this.ensureDefault("button_window_mode",SWFUpload.WINDOW_MODE.WINDOW),this.ensureDefault("debug",!1),this.settings.debug_enabled=this.settings.debug,this.settings.return_upload_start_handler=this.returnUploadStart,this.ensureDefault("swfupload_loaded_handler",null),this.ensureDefault("file_dialog_start_handler",null),this.ensureDefault("file_queued_handler",null),this.ensureDefault("file_queue_error_handler",null),this.ensureDefault("file_dialog_complete_handler",null),this.ensureDefault("upload_start_handler",null),this.ensureDefault("upload_progress_handler",null),this.ensureDefault("upload_error_handler",null),this.ensureDefault("upload_success_handler",null),this.ensureDefault("upload_complete_handler",null),this.ensureDefault("debug_handler",this.debugMessage),this.ensureDefault("custom_settings",{}),this.customSettings=this.settings.custom_settings,this.settings.prevent_swf_caching&&(this.settings.flash_url=this.settings.flash_url+(0>this.settings.flash_url.indexOf("?")?"?":"&")+"preventswfcaching="+(new Date).getTime()),this.settings.preserve_relative_urls||(this.settings.upload_url=SWFUpload.completeURL(this.settings.upload_url),this.settings.button_image_url=SWFUpload.completeURL(this.settings.button_image_url)),delete this.ensureDefault},SWFUpload.prototype.loadFlash=function(){var e,t;if(null!==document.getElementById(this.movieName))throw"ID "+this.movieName+" is already in use. The Flash Object could not be added";if(e=document.getElementById(this.settings.button_placeholder_id)||this.settings.button_placeholder,void 0==e)throw"Could not find the placeholder element: "+this.settings.button_placeholder_id;t=document.createElement("div"),t.innerHTML=this.getFlashHTML(),e.parentNode.replaceChild(t.firstChild,e),void 0==window[this.movieName]&&(window[this.movieName]=this.getMovieElement())},SWFUpload.prototype.getFlashHTML=function(){var e=['<object id="',this.movieName,'" type="application/x-shockwave-flash" data="',this.settings.flash_url,'" width="',this.settings.button_width,'" height="',this.settings.button_height,'" class="swfupload">'].join(""),t=['<param name="wmode" value="',this.settings.button_window_mode,'" />','<param name="movie" value="',this.settings.flash_url,'" />','<param name="quality" value="high" />','<param name="menu" value="false" />','<param name="allowScriptAccess" value="always" />','<param name="flashvars" value="',this.getFlashVars(),'" />'].join("");return navigator.userAgent.search(/MSIE/)>-1&&(e=['<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" id="',this.movieName,'" width="',this.settings.button_width,'" height="',this.settings.button_height,'" class="swfupload">'].join(""),t+='<param name="src" value="'+this.settings.flash_url+'" />'),[e,t,"</object>"].join("")},SWFUpload.prototype.getFlashVars=function(){var e=this.buildParamString(),t=this.settings.http_success.join(",");return["movieName=",encodeURIComponent(this.movieName),"&amp;uploadURL=",encodeURIComponent(this.settings.upload_url),"&amp;useQueryString=",encodeURIComponent(this.settings.use_query_string),"&amp;requeueOnError=",encodeURIComponent(this.settings.requeue_on_error),"&amp;httpSuccess=",encodeURIComponent(t),"&amp;assumeSuccessTimeout=",encodeURIComponent(this.settings.assume_success_timeout),"&amp;params=",encodeURIComponent(e),"&amp;filePostName=",encodeURIComponent(this.settings.file_post_name),"&amp;fileTypes=",encodeURIComponent(this.settings.file_types),"&amp;fileTypesDescription=",encodeURIComponent(this.settings.file_types_description),"&amp;fileSizeLimit=",encodeURIComponent(this.settings.file_size_limit),"&amp;fileUploadLimit=",encodeURIComponent(this.settings.file_upload_limit),"&amp;fileQueueLimit=",encodeURIComponent(this.settings.file_queue_limit),"&amp;debugEnabled=",encodeURIComponent(this.settings.debug_enabled),"&amp;buttonImageURL=",encodeURIComponent(this.settings.button_image_url),"&amp;buttonWidth=",encodeURIComponent(this.settings.button_width),"&amp;buttonHeight=",encodeURIComponent(this.settings.button_height),"&amp;buttonText=",encodeURIComponent(this.settings.button_text),"&amp;buttonTextTopPadding=",encodeURIComponent(this.settings.button_text_top_padding),"&amp;buttonTextLeftPadding=",encodeURIComponent(this.settings.button_text_left_padding),"&amp;buttonTextStyle=",encodeURIComponent(this.settings.button_text_style),"&amp;buttonAction=",encodeURIComponent(this.settings.button_action),"&amp;buttonDisabled=",encodeURIComponent(this.settings.button_disabled),"&amp;buttonCursor=",encodeURIComponent(this.settings.button_cursor)].join("")},SWFUpload.prototype.getMovieElement=function(){if(void 0==this.movieElement&&(this.movieElement=document.getElementById(this.movieName)),null===this.movieElement)throw"Could not find Flash element";return this.movieElement},SWFUpload.prototype.buildParamString=function(){var e=this.settings.post_params,t=[];if("object"==typeof e)for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n.toString())+"="+encodeURIComponent(e[n].toString()));return t.join("&amp;")},SWFUpload.prototype.destroy=function(){try{this.cancelUpload(null,!1);var e=null;if(e=this.getMovieElement(),e&&"unknown"==typeof e.CallFunction){for(var t in e)try{"function"==typeof e[t]&&(e[t]=null)}catch(n){}try{e.parentNode.removeChild(e)}catch(i){}}return window[this.movieName]=null,SWFUpload.instances[this.movieName]=null,delete SWFUpload.instances[this.movieName],this.movieElement=null,this.settings=null,this.customSettings=null,this.eventQueue=null,this.movieName=null,!0}catch(r){return!1}},SWFUpload.prototype.displayDebugInfo=function(){this.debug(["---SWFUpload Instance Info---\n","Version: ",SWFUpload.version,"\n","Movie Name: ",this.movieName,"\n","Settings:\n","	","upload_url:               ",this.settings.upload_url,"\n","	","flash_url:                ",this.settings.flash_url,"\n","	","use_query_string:         ",this.settings.use_query_string.toString(),"\n","	","requeue_on_error:         ",this.settings.requeue_on_error.toString(),"\n","	","http_success:             ",this.settings.http_success.join(", "),"\n","	","assume_success_timeout:   ",this.settings.assume_success_timeout,"\n","	","file_post_name:           ",this.settings.file_post_name,"\n","	","post_params:              ",this.settings.post_params.toString(),"\n","	","file_types:               ",this.settings.file_types,"\n","	","file_types_description:   ",this.settings.file_types_description,"\n","	","file_size_limit:          ",this.settings.file_size_limit,"\n","	","file_upload_limit:        ",this.settings.file_upload_limit,"\n","	","file_queue_limit:         ",this.settings.file_queue_limit,"\n","	","debug:                    ",this.settings.debug.toString(),"\n","	","prevent_swf_caching:      ",this.settings.prevent_swf_caching.toString(),"\n","	","button_placeholder_id:    ",this.settings.button_placeholder_id.toString(),"\n","	","button_placeholder:       ",this.settings.button_placeholder?"Set":"Not Set","\n","	","button_image_url:         ",this.settings.button_image_url.toString(),"\n","	","button_width:             ",this.settings.button_width.toString(),"\n","	","button_height:            ",this.settings.button_height.toString(),"\n","	","button_text:              ",this.settings.button_text.toString(),"\n","	","button_text_style:        ",this.settings.button_text_style.toString(),"\n","	","button_text_top_padding:  ",this.settings.button_text_top_padding.toString(),"\n","	","button_text_left_padding: ",this.settings.button_text_left_padding.toString(),"\n","	","button_action:            ",this.settings.button_action.toString(),"\n","	","button_disabled:          ",this.settings.button_disabled.toString(),"\n","	","custom_settings:          ",this.settings.custom_settings.toString(),"\n","Event Handlers:\n","	","swfupload_loaded_handler assigned:  ",("function"==typeof this.settings.swfupload_loaded_handler).toString(),"\n","	","file_dialog_start_handler assigned: ",("function"==typeof this.settings.file_dialog_start_handler).toString(),"\n","	","file_queued_handler assigned:       ",("function"==typeof this.settings.file_queued_handler).toString(),"\n","	","file_queue_error_handler assigned:  ",("function"==typeof this.settings.file_queue_error_handler).toString(),"\n","	","upload_start_handler assigned:      ",("function"==typeof this.settings.upload_start_handler).toString(),"\n","	","upload_progress_handler assigned:   ",("function"==typeof this.settings.upload_progress_handler).toString(),"\n","	","upload_error_handler assigned:      ",("function"==typeof this.settings.upload_error_handler).toString(),"\n","	","upload_success_handler assigned:    ",("function"==typeof this.settings.upload_success_handler).toString(),"\n","	","upload_complete_handler assigned:   ",("function"==typeof this.settings.upload_complete_handler).toString(),"\n","	","debug_handler assigned:             ",("function"==typeof this.settings.debug_handler).toString(),"\n"].join(""))},SWFUpload.prototype.addSetting=function(e,t,n){return this.settings[e]=void 0==t?n:t},SWFUpload.prototype.getSetting=function(e){return void 0!=this.settings[e]?this.settings[e]:""},SWFUpload.prototype.callFlash=function(functionName,argumentArray){argumentArray=argumentArray||[];var movieElement=this.getMovieElement(),returnValue,returnString;try{returnString=movieElement.CallFunction('<invoke name="'+functionName+'" returntype="javascript">'+__flash__argumentsToXML(argumentArray,0)+"</invoke>"),returnValue=eval(returnString)}catch(ex){throw"Call to "+functionName+" failed"}return void 0!=returnValue&&"object"==typeof returnValue.post&&(returnValue=this.unescapeFilePostParams(returnValue)),returnValue},SWFUpload.prototype.selectFile=function(){this.callFlash("SelectFile")},SWFUpload.prototype.selectFiles=function(){this.callFlash("SelectFiles")},SWFUpload.prototype.startUpload=function(e){this.callFlash("StartUpload",[e])},SWFUpload.prototype.cancelUpload=function(e,t){t!==!1&&(t=!0),this.callFlash("CancelUpload",[e,t])},SWFUpload.prototype.stopUpload=function(){this.callFlash("StopUpload")},SWFUpload.prototype.stopUpload=function(e){return this.callFlash("RequeueUpload",[e])},SWFUpload.prototype.getStats=function(){return this.callFlash("GetStats")},SWFUpload.prototype.setStats=function(e){this.callFlash("SetStats",[e])},SWFUpload.prototype.getFile=function(e){return"number"==typeof e?this.callFlash("GetFileByIndex",[e]):this.callFlash("GetFile",[e])},SWFUpload.prototype.addFileParam=function(e,t,n){return this.callFlash("AddFileParam",[e,t,n])},SWFUpload.prototype.removeFileParam=function(e,t){this.callFlash("RemoveFileParam",[e,t])},SWFUpload.prototype.setUploadURL=function(e){this.settings.upload_url=e.toString(),this.callFlash("SetUploadURL",[e])},SWFUpload.prototype.setPostParams=function(e){this.settings.post_params=e,this.callFlash("SetPostParams",[e])},SWFUpload.prototype.addPostParam=function(e,t){this.settings.post_params[e]=t,this.callFlash("SetPostParams",[this.settings.post_params])},SWFUpload.prototype.removePostParam=function(e){delete this.settings.post_params[e],this.callFlash("SetPostParams",[this.settings.post_params])},SWFUpload.prototype.setFileTypes=function(e,t){this.settings.file_types=e,this.settings.file_types_description=t,this.callFlash("SetFileTypes",[e,t])},SWFUpload.prototype.setFileSizeLimit=function(e){this.settings.file_size_limit=e,this.callFlash("SetFileSizeLimit",[e])},SWFUpload.prototype.setFileUploadLimit=function(e){this.settings.file_upload_limit=e,this.callFlash("SetFileUploadLimit",[e])},SWFUpload.prototype.setFileQueueLimit=function(e){this.settings.file_queue_limit=e,this.callFlash("SetFileQueueLimit",[e])},SWFUpload.prototype.setFilePostName=function(e){this.settings.file_post_name=e,this.callFlash("SetFilePostName",[e])},SWFUpload.prototype.setUseQueryString=function(e){this.settings.use_query_string=e,this.callFlash("SetUseQueryString",[e])},SWFUpload.prototype.setRequeueOnError=function(e){this.settings.requeue_on_error=e,this.callFlash("SetRequeueOnError",[e])},SWFUpload.prototype.setHTTPSuccess=function(e){"string"==typeof e&&(e=e.replace(" ","").split(",")),this.settings.http_success=e,this.callFlash("SetHTTPSuccess",[e])},SWFUpload.prototype.setAssumeSuccessTimeout=function(e){this.settings.assume_success_timeout=e,this.callFlash("SetAssumeSuccessTimeout",[e])},SWFUpload.prototype.setDebugEnabled=function(e){this.settings.debug_enabled=e,this.callFlash("SetDebugEnabled",[e])},SWFUpload.prototype.setButtonImageURL=function(e){void 0==e&&(e=""),this.settings.button_image_url=e,this.callFlash("SetButtonImageURL",[e])},SWFUpload.prototype.setButtonDimensions=function(e,t){this.settings.button_width=e,this.settings.button_height=t;var n=this.getMovieElement();void 0!=n&&(n.style.width=e+"px",n.style.height=t+"px"),this.callFlash("SetButtonDimensions",[e,t])},SWFUpload.prototype.setButtonText=function(e){this.settings.button_text=e,this.callFlash("SetButtonText",[e])},SWFUpload.prototype.setButtonTextPadding=function(e,t){this.settings.button_text_top_padding=t,this.settings.button_text_left_padding=e,this.callFlash("SetButtonTextPadding",[e,t])},SWFUpload.prototype.setButtonTextStyle=function(e){this.settings.button_text_style=e,this.callFlash("SetButtonTextStyle",[e])},SWFUpload.prototype.setButtonDisabled=function(e){this.settings.button_disabled=e,this.callFlash("SetButtonDisabled",[e])},SWFUpload.prototype.setButtonAction=function(e){this.settings.button_action=e,this.callFlash("SetButtonAction",[e])},SWFUpload.prototype.setButtonCursor=function(e){this.settings.button_cursor=e,this.callFlash("SetButtonCursor",[e])},SWFUpload.prototype.queueEvent=function(e,t){void 0==t?t=[]:t instanceof Array||(t=[t]);var n=this;if("function"==typeof this.settings[e])this.eventQueue.push(function(){this.settings[e].apply(this,t)}),setTimeout(function(){n.executeNextEvent()},0);else if(null!==this.settings[e])throw"Event handler "+e+" is unknown or is not a function"},SWFUpload.prototype.executeNextEvent=function(){var e=this.eventQueue?this.eventQueue.shift():null;"function"==typeof e&&e.apply(this)},SWFUpload.prototype.unescapeFilePostParams=function(e){var t,n=/[$]([0-9a-f]{4})/i,i={};if(void 0!=e){for(var r in e.post)if(e.post.hasOwnProperty(r)){t=r;for(var o;null!==(o=n.exec(t));)t=t.replace(o[0],String.fromCharCode(parseInt("0x"+o[1],16)));i[t]=e.post[r]}e.post=i}return e},SWFUpload.prototype.testExternalInterface=function(){try{return this.callFlash("TestExternalInterface")}catch(e){return!1}},SWFUpload.prototype.flashReady=function(){var e=this.getMovieElement();return e?(this.cleanUp(e),this.queueEvent("swfupload_loaded_handler"),void 0):(this.debug("Flash called back ready but the flash movie can't be found."),void 0)},SWFUpload.prototype.cleanUp=function(e){try{if(this.movieElement&&"unknown"==typeof e.CallFunction){this.debug("Removing Flash functions hooks (this should only run in IE and should prevent memory leaks)");for(var t in e)try{"function"==typeof e[t]&&(e[t]=null)}catch(n){}}}catch(i){}window.__flash__removeCallback=function(e,t){try{e&&(e[t]=null)}catch(n){}}},SWFUpload.prototype.fileDialogStart=function(){this.queueEvent("file_dialog_start_handler")},SWFUpload.prototype.fileQueued=function(e){e=this.unescapeFilePostParams(e),this.queueEvent("file_queued_handler",e)},SWFUpload.prototype.fileQueueError=function(e,t,n){e=this.unescapeFilePostParams(e),this.queueEvent("file_queue_error_handler",[e,t,n])},SWFUpload.prototype.fileDialogComplete=function(e,t,n){this.queueEvent("file_dialog_complete_handler",[e,t,n])},SWFUpload.prototype.uploadStart=function(e){e=this.unescapeFilePostParams(e),this.queueEvent("return_upload_start_handler",e)},SWFUpload.prototype.returnUploadStart=function(e){var t;if("function"==typeof this.settings.upload_start_handler)e=this.unescapeFilePostParams(e),t=this.settings.upload_start_handler.call(this,e);else if(void 0!=this.settings.upload_start_handler)throw"upload_start_handler must be a function";void 0===t&&(t=!0),t=!!t,this.callFlash("ReturnUploadStart",[t])},SWFUpload.prototype.uploadProgress=function(e,t,n){e=this.unescapeFilePostParams(e),this.queueEvent("upload_progress_handler",[e,t,n])},SWFUpload.prototype.uploadError=function(e,t,n){e=this.unescapeFilePostParams(e),this.queueEvent("upload_error_handler",[e,t,n])},SWFUpload.prototype.uploadSuccess=function(e,t,n){e=this.unescapeFilePostParams(e),this.queueEvent("upload_success_handler",[e,t,n])},SWFUpload.prototype.uploadComplete=function(e){e=this.unescapeFilePostParams(e),this.queueEvent("upload_complete_handler",e)},SWFUpload.prototype.debug=function(e){this.queueEvent("debug_handler",e)},SWFUpload.prototype.debugMessage=function(e){if(this.settings.debug){var t,n=[];if("object"==typeof e&&"string"==typeof e.name&&"string"==typeof e.message){for(var i in e)e.hasOwnProperty(i)&&n.push(i+": "+e[i]);t=n.join("\n")||"",n=t.split("\n"),t="EXCEPTION: "+n.join("\nEXCEPTION: "),SWFUpload.Console.writeLine(t)}else SWFUpload.Console.writeLine(e)}},SWFUpload.Console={},SWFUpload.Console.writeLine=function(e){var t,n;try{t=document.getElementById("SWFUpload_Console"),t||(n=document.createElement("form"),document.getElementsByTagName("body")[0].appendChild(n),t=document.createElement("textarea"),t.id="SWFUpload_Console",t.style.fontFamily="monospace",t.setAttribute("wrap","off"),t.wrap="off",t.style.overflow="auto",t.style.width="700px",t.style.height="350px",t.style.margin="5px",n.appendChild(t)),t.value+=e+"\n",t.scrollTop=t.scrollHeight-t.clientHeight}catch(i){alert("Exception: "+i.name+" Message: "+i.message)}},/*
Uploadify v3.0.0
Copyright (c) 2010 Ronnie Garcia

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
*/
jQuery&&function(e){e.extend(e.fn,{uploadify:function(t,n){e(this).each(function(){function i(t,n,i){m.getStats(),m.queue.filesErrored=t-n,m.queue.filesSelected=t,m.queue.filesQueued=n-m.queue.filesCancelled,m.queue.queueLength=i,0>e.inArray("onDialogClose",m.settings.skipDefault)&&m.queue.filesErrored>0&&alert(m.queue.errorMsg),m.settings.onDialogClose&&m.settings.onDialogClose(m.queue),m.settings.auto&&e("#"+m.settings.id).uploadifyUpload("*")}function r(){m.queue.errorMsg="Some files were not added to the queue:",m.queue.filesReplaced=0,m.queue.filesCancelled=0,m.settings.onDialogOpen&&m.settings.onDialogOpen()}function o(t){if(0>e.inArray("onSelect",m.settings.skipDefault)){var n={};for(var i in m.queue.files)if(n=m.queue.files[i],n.name==t.name){var r=confirm('The file named "'+t.name+'" is already in the queue.\nDo you want to replace the existing item in the queue?');if(!r)return m.cancelUpload(t.id),m.queue.filesCancelled++,!1;e("#"+n.id).remove(),m.cancelUpload(n.id),m.queue.filesReplaced++}var o=Math.round(t.size/1024),a="KB";o>1e3&&(o=Math.round(o/1e3),a="MB");var s=o.toString().split(".");o=s[0],s.length>1&&(o+="."+s[1].substr(0,2)),o+=a;var l=t.name;l.length>25&&(l=l.substr(0,25)+"..."),e("#"+m.settings.queueID).append('<div id="'+t.id+'" class="uploadifyQueueItem">								<div class="cancel">									<a href="javascript:jQuery(\'#'+m.settings.id+"').uploadifyCancel('"+t.id+'\')"><img src="'+m.settings.cancelImage+'" border="0" /></a>								</div>								<span class="fileName">'+l+" ("+o+')</span><span class="data"></span>								<div class="uploadifyProgress">									<div class="uploadifyProgressBar"><!--Progress Bar--></div>								</div>							</div>'),m.queue.queueSize+=t.size}m.queue.files[t.id]=t,m.settings.onSelect&&m.settings.onSelect(t)}function a(t,n,i){if(0>e.inArray("onSelectError",m.settings.skipDefault))switch(n){case SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED:m.queue.errorMsg+=m.settings.queueSizeLimit>i?"\nThe number of files selected exceeds the remaining upload limit ("+i+").":"\nThe number of files selected exceeds the queue size limit ("+m.settings.queueSizeLimit+").";break;case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:m.queue.errorMsg+='\nThe file "'+t.name+'" exceeds the size limit ('+m.settings.fileSizeLimit+").";break;case SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE:m.queue.errorMsg+='\nThe file "'+t.name+'" is empty.';break;case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:m.queue.errorMsg+='\nThe file "'+t.name+'" is not an accepted file type ('+m.settings.fileTypeDesc+")."}n!=SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED&&delete m.queue.files[t.id],m.settings.onSelectError&&m.settings.onSelectError(t,n,i)}function s(t){var n=m.getStats();if(m.queue.queueLength=n.files_queued,"*"==m.queue.uploadQueue[0]?m.queue.queueLength>0?m.startUpload():(m.queue.uploadQueue=[],m.settings.onQueueComplete&&m.settings.onQueueComplete(n)):m.queue.uploadQueue.length>0?m.startUpload(m.queue.uploadQueue.shift()):(m.queue.uploadQueue=[],m.settings.onQueueComplete&&setting.onQueueComplete(n)),0>e.inArray("onUploadComplete",m.settings.skipDefault)&&m.settings.removeCompleted)switch(t.filestatus){case SWFUpload.FILE_STATUS.COMPLETE:setTimeout(function(){e("#"+t.id)&&(m.queue.queueSize-=t.size,delete m.queue.files[t.id],e("#"+t.id).fadeOut(500,function(){e(this).remove()}))},1e3*m.settings.removeTimeout);break;case SWFUpload.FILE_STATUS.ERROR:m.settings.requeueErrors||setTimeout(function(){e("#"+t.id)&&(m.queue.queueSize-=t.size,delete m.queue.files[t.id],e("#"+t.id).fadeOut(500,function(){e(this).remove()}))},1e3*m.settings.removeTimeout)}m.settings.onUploadComplete&&m.settings.onUploadComplete(t,m.queue)}function l(t,n,i){var r="Error";switch(n!=SWFUpload.UPLOAD_ERROR.FILE_CANCELLED&&n!=SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED&&e("#"+t.id).addClass("uploadifyError"),e("#"+t.id).find(".uploadifyProgressBar").css("width","1px"),n){case SWFUpload.UPLOAD_ERROR.HTTP_ERROR:r="HTTP Error ("+i+")";break;case SWFUpload.UPLOAD_ERROR.MISSING_UPLOAD_URL:r="Missing Upload URL";break;case SWFUpload.UPLOAD_ERROR.IO_ERROR:r="IO Error";break;case SWFUpload.UPLOAD_ERROR.SECURITY_ERROR:r="Security Error";break;case SWFUpload.UPLOAD_ERROR.UPLOAD_LIMIT_EXCEEDED:alert("The upload limit has been reached ("+i+")."),r="Exceeds Upload Limit";break;case SWFUpload.UPLOAD_ERROR.UPLOAD_FAILED:r="Failed";break;case SWFUpload.UPLOAD_ERROR.SPECIFIED_FILE_ID_NOT_FOUND:break;case SWFUpload.UPLOAD_ERROR.FILE_VALIDATION_FAILED:r="Validation Error";break;case SWFUpload.UPLOAD_ERROR.FILE_CANCELLED:r="Cancelled",m.queue.queueSize-=t.size,(t.status==SWFUpload.FILE_STATUS.IN_PROGRESS||e.inArray(t.id,m.queue.uploadQueue)>=0)&&(m.queue.uploadSize-=t.size),delete m.queue.files[t.id];break;case SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED:r="Stopped"}n!=SWFUpload.UPLOAD_ERROR.SPECIFIED_FILE_ID_NOT_FOUND&&t.status!=SWFUpload.FILE_STATUS.COMPLETE&&e("#"+t.id).find(".data").html(" - "+r),m.settings.onUploadError&&m.settings.onUploadError(t,n,i,r,m.queue)}function u(t,n,i){var r=new Date,o=r.getTime(),a=o-m.timer;m.timer=o;var s=n-m.bytesLoaded;m.bytesLoaded=n;var l=m.queue.queueBytesUploaded+n,u=Math.round(100*(n/i)),c=0,d=s/1024/(a/1e3);d=Math.floor(10*d)/10,m.queue.averageSpeed=m.queue.averageSpeed>0?(m.queue.averageSpeed+d)/2:d,d>1e3&&(c=.001*d,m.queue.averageSpeed=c);var f="KB/s";c>0&&(f="MB/s"),0>e.inArray("onUploadProgress",m.settings.skipDefault)&&("percentage"==m.settings.progressData?e("#"+t.id).find(".data").html(" - "+u+"%"):"speed"==m.settings.progressData&&e("#"+t.id).find(".data").html(" - "+u+f),e("#"+t.id).find(".uploadifyProgressBar").css("width",u+"%")),m.settings.onUploadProgress&&m.settings.onUploadProgress(t,n,i,l,m.queue.uploadSize)}function c(t){var n=new Date;m.timer=n.getTime(),m.bytesLoaded=0,0==m.queue.uploadQueue.length&&(m.queue.uploadSize=t.size),m.settings.checkExisting!==!1&&e.ajax({type:"POST",async:!1,url:m.settings.checkExisting,data:{filename:t.name},success:function(n){if(1==n){var i=confirm('A file with the name "'+t.name+'" already exists on the server.\nWould you like to replace the existing file?');i||(m.cancelUpload(t.id),e("#"+t.id).remove(),m.queue.uploadQueue.length>0&&m.queue.queueLength>0&&("*"==m.queue.uploadQueue[0]?m.startUpload():m.startUpload(m.queue.uploadQueue.shift())))}}}),m.settings.onUploadStart&&m.settings.onUploadStart(t)}function d(t,n,i){m.queue.queueBytesUploaded+=t.size,e("#"+t.id).find(".data").html(" - Complete"),m.settings.onUploadSuccess&&m.settings.onUploadSuccess(t,n,i)}var f=e(this).clone(),p=e.extend({id:e(this).attr("id"),swf:"uploadify.swf",uploader:"uploadify.php",auto:!1,buttonClass:"",buttonCursor:"hand",buttonImage:!1,buttonText:"SELECT FILES",cancelImage:"uploadify-cancel.png",checkExisting:"uploadify-check-existing.php",debug:!1,fileObjName:"Filedata",fileSizeLimit:0,fileTypeDesc:"All Files (*.*)",fileTypeExts:"*.*",height:30,method:"post",multi:!1,queueID:!1,queueSizeLimit:999,removeCompleted:!0,removeTimeout:3,requeueErrors:!0,postData:{},preventCaching:!0,progressData:"percentage",successTimeout:30,transparent:!0,uploadLimit:999,uploaderType:"html5",width:120,skipDefault:[],onClearQueue:function(){},onDialogOpen:function(){},onDialogClose:function(){},onInit:function(){},onQueueComplete:function(){},onSelectError:function(){},onSelect:function(){},onSWFReady:function(){},onUploadCancel:function(){},onUploadComplete:function(){},onUploadError:function(){},onUploadProgress:function(){},onUploadStart:function(){}},t),h={assume_success_timeout:p.successTimeout,button_placeholder_id:p.id,button_image_url:p.buttonImage,button_width:p.width,button_height:p.height,button_text:null,button_text_style:null,button_text_top_padding:0,button_text_left_padding:0,button_action:p.multi?SWFUpload.BUTTON_ACTION.SELECT_FILES:SWFUpload.BUTTON_ACTION.SELECT_FILE,button_disabled:!1,button_cursor:"arrow"==p.buttonCursor?SWFUpload.CURSOR.ARROW:SWFUpload.CURSOR.HAND,button_window_mode:SWFUpload.WINDOW_MODE.TRANSPARENT,debug:p.debug,requeue_on_error:p.requeueErrors,file_post_name:p.fileObjName,file_size_limit:p.fileSizeLimit,file_types:p.fileTypeExts,file_types_description:p.fileTypeDesc,file_queue_limit:p.queueSizeLimit,file_upload_limit:p.uploadLimit,flash_url:p.swf,prevent_swf_caching:p.preventCaching,post_params:p.postData,upload_url:p.uploader,use_query_string:"get"==p.method,file_dialog_complete_handler:i,file_dialog_start_handler:r,file_queued_handler:o,file_queue_error_handler:a,flash_ready_handler:p.onSWFReady,upload_complete_handler:s,upload_error_handler:l,upload_progress_handler:u,upload_start_handler:c,upload_success_handler:d};n&&(h=e.extend(h,n)),h=e.extend(h,p),window["uploadify_"+p.id]=new SWFUpload(h);var m=window["uploadify_"+p.id];m.original=f;var g=e("<div />",{id:p.id,"class":"uploadify",css:{height:p.height+"px",position:"relative",width:p.width+"px"}});if(e("#"+m.movieName).wrap(g),!p.queueID){var v=e("<div />",{id:p.id+"_queue","class":"uploadifyQueue"});e("#"+p.id).after(v),m.settings.queueID=p.queueID=p.id+"_queue"}if(m.queue={files:{},filesSelected:0,filesQueued:0,filesReplaced:0,filesCancelled:0,filesErrored:0,averageSpeed:0,queueLength:0,queueSize:0,uploadSize:0,queueBytesUploaded:0,uploadQueue:[],errorMsg:"Some files were not added to the queue:"},p.buttonImage){var y=e("<a />",{id:p.id+"_button","class":"uploadifyButton "+p.buttonClass,html:'<span class="uploadifyButtonText">'+p.buttonText+"</span>"});e("#"+p.id).append(y),e("#"+m.movieName).css({position:"absolute",left:0,"z-index":10})}var b="undefined"!=typeof swfobject&&0!==swfobject.getFlashPlayerVersion().major?!0:!1;b||$(".flashMessage").html("<p class='error'><span></span>In order to upload you have to install Flash. You can install it by clicking the following link <a target='_blank' href='http://get.adobe.com/flashplayer/'> http://get.adobe.com/flashplayer/</a></p>").show(),$("#uploader").show()})},uploadifyCancel:function(){var t=e(this).selector.replace("#",""),n=window["uploadify_"+t],i=-1;if(arguments[0])if("*"==arguments[0])e("#"+n.settings.queueID).find(".uploadifyQueueItem").each(function(){i++,n.cancelUpload(e(this).attr("id")),e(this).delay(100*i).fadeOut(500,function(){e(this).remove()})}),n.queue.queueSize=0;else for(var r=0;arguments.length>r;r++)n.cancelUpload(arguments[r]),e("#"+arguments[r]).delay(100*r).fadeOut(500,function(){e(this).remove()});else e("#"+n.settings.queueID).find(".uploadifyQueueItem").get(0).fadeOut(500,function(){e(this).remove(),n.cancelUpload(e(this).attr("id"))})},uploadifyDestroy:function(){var t=e(this).selector.replace("#",""),n=window["uploadify_"+t];n.destroy(),e("#"+t+"_queue").remove(),e("#"+t).replaceWith(n.original),delete window["uploadify_"+t]},uploadifyDisable:function(t){var n=e(this).selector.replace("#",""),i=window["uploadify_"+n];i.setButtonDisabled(t)},uploadifySettings:function(t,n,i){function r(t,i,r){switch(t){case"uploader":a.setUploadURL(i);break;case"postData":r||(n=e.extend(a.settings.postData,i)),a.setPostParams(i);break;case"method":"get"==i?a.setUseQueryString(!0):a.setUseQueryString(!1);break;case"fileObjName":a.setFilePostName(i);break;case"fileTypeExts":a.setFileTypes(i,a.settings.fileTypeDesc);break;case"fileTypeDesc":a.setFileTypes(a.settings.fileTypeExts,i);break;case"fileSizeLimit":a.setFileSizeLimit(i);break;case"uploadLimit":a.setFileUploadLimit(i);break;case"queueSizeLimit":a.setFileQueueLimit(i);break;case"buttonImage":e("#"+a.settings.id+"_button").remove(),a.setButtonImageURL(i);break;case"buttonCursor":"arrow"==i?a.setButtonCursor(SWFUpload.CURSOR.ARROW):a.setButtonCursor(SWFUpload.CURSOR.HAND);break;case"buttonText":e("#"+a.settings.id+"_button").find(".uploadifyButtonText").html(i);break;case"width":a.setButtonDimensions(i,a.settings.height);break;case"height":a.setButtonDimensions(a.settings.width,i);break;case"multi":i?a.setButtonAction(SWFUpload.BUTTON_ACTION.SELECT_FILES):a.setButtonAction(SWFUpload.BUTTON_ACTION.SELECT_FILE)}a.settings[t]=n}var o=e(this).selector.replace("#",""),a=window["uploadify_"+o];if("object"==typeof arguments[0])for(var s in n)r(s,n[s]);return 1==arguments.length?a.settings[t]:(r(t,n,i),void 0)},uploadifyStop:function(){var t=e(this).selector.replace("#",""),n=window["uploadify_"+t];n.stopUpload()},uploadifyUpload:function(){var t=e(this).selector.replace("#",""),n=window["uploadify_"+t];if(n.queue.averageSpeed=0,n.queue.uploadSize=0,n.queue.bytesUploaded=0,n.queue.uploadQueue=[],arguments[0])if("*"==arguments[0])n.queue.uploadSize=n.queue.queueSize,n.queue.uploadQueue.push("*"),n.startUpload();else{for(var i=0;arguments.length>i;i++)n.queue.uploadSize+=n.queue.files[arguments[i]].size,n.queue.uploadQueue.push(arguments[i]);n.startUpload(n.queue.uploadQueue.shift())}else n.startUpload()}})}(jQuery);var swfobject=function(){function e(){if(!G){try{var e=M.getElementsByTagName("body")[0].appendChild(g("span"));e.parentNode.removeChild(e)}catch(t){return}G=!0;for(var n=I.length,i=0;n>i;i++)I[i]()}}function t(e){G?e():I[I.length]=e}function n(e){if(typeof O.addEventListener!=E)O.addEventListener("load",e,!1);else if(typeof M.addEventListener!=E)M.addEventListener("load",e,!1);else if(typeof O.attachEvent!=E)v(O,"onload",e);else if("function"==typeof O.onload){var t=O.onload;O.onload=function(){t(),e()}}else O.onload=e}function i(){U?r():o()}function r(){var e=M.getElementsByTagName("body")[0],t=g(A);t.setAttribute("type",N);var n=e.appendChild(t);if(n){var i=0;(function(){if(typeof n.GetVariable!=E){var r=n.GetVariable("$version");r&&(r=r.split(" ")[1].split(","),z.pv=[parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10)])}else if(10>i)return i++,setTimeout(arguments.callee,10),void 0;e.removeChild(t),n=null,o()})()}else o()}function o(){var e=B.length;if(e>0)for(var t=0;e>t;t++){var n=B[t].id,i=B[t].callbackFn,r={success:!1,id:n};if(z.pv[0]>0){var o=m(n);if(o)if(!y(B[t].swfVersion)||z.wk&&312>z.wk)if(B[t].expressInstall&&s()){var c={};c.data=B[t].expressInstall,c.width=o.getAttribute("width")||"0",c.height=o.getAttribute("height")||"0",o.getAttribute("class")&&(c.styleclass=o.getAttribute("class")),o.getAttribute("align")&&(c.align=o.getAttribute("align"));for(var d={},f=o.getElementsByTagName("param"),p=f.length,h=0;p>h;h++)"movie"!=f[h].getAttribute("name").toLowerCase()&&(d[f[h].getAttribute("name")]=f[h].getAttribute("value"));l(c,d,n,i)}else u(o),i&&i(r);else $(n,!0),i&&(r.success=!0,r.ref=a(n),i(r))}else if($(n,!0),i){var g=a(n);g&&typeof g.SetVariable!=E&&(r.success=!0,r.ref=g),i(r)}}}function a(e){var t=null,n=m(e);if(n&&"OBJECT"==n.nodeName)if(typeof n.SetVariable!=E)t=n;else{var i=n.getElementsByTagName(A)[0];i&&(t=i)}return t}function s(){return!H&&y("6.0.65")&&(z.win||z.mac)&&!(z.wk&&312>z.wk)}function l(e,t,n,i){H=!0,T=i||null,_={success:!1,id:n};var r=m(n);if(r){"OBJECT"==r.nodeName?(x=c(r),C=null):(x=r,C=n),e.id=j,(typeof e.width==E||!/%$/.test(e.width)&&310>parseInt(e.width,10))&&(e.width="310"),(typeof e.height==E||!/%$/.test(e.height)&&137>parseInt(e.height,10))&&(e.height="137"),M.title=M.title.slice(0,47)+" - Flash Player Installation";var o=z.ie&&z.win?"ActiveX":"PlugIn",a="MMredirectURL="+O.location.toString().replace(/&/g,"%26")+"&MMplayerType="+o+"&MMdoctitle="+M.title;if(typeof t.flashvars!=E?t.flashvars+="&"+a:t.flashvars=a,z.ie&&z.win&&4!=r.readyState){var s=g("div");n+="SWFObjectNew",s.setAttribute("id",n),r.parentNode.insertBefore(s,r),r.style.display="none",function(){4==r.readyState?r.parentNode.removeChild(r):setTimeout(arguments.callee,10)}()}d(e,t,n)}}function u(e){if(z.ie&&z.win&&4!=e.readyState){var t=g("div");e.parentNode.insertBefore(t,e),t.parentNode.replaceChild(c(e),t),e.style.display="none",function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}()}else e.parentNode.replaceChild(c(e),e)}function c(e){var t=g("div");if(z.win&&z.ie)t.innerHTML=e.innerHTML;else{var n=e.getElementsByTagName(A)[0];if(n){var i=n.childNodes;if(i)for(var r=i.length,o=0;r>o;o++)1==i[o].nodeType&&"PARAM"==i[o].nodeName||8==i[o].nodeType||t.appendChild(i[o].cloneNode(!0))}}return t}function d(e,t,n){var i,r=m(n);if(z.wk&&312>z.wk)return i;if(r)if(typeof e.id==E&&(e.id=n),z.ie&&z.win){var o="";for(var a in e)e[a]!=Object.prototype[a]&&("data"==a.toLowerCase()?t.movie=e[a]:"styleclass"==a.toLowerCase()?o+=' class="'+e[a]+'"':"classid"!=a.toLowerCase()&&(o+=" "+a+'="'+e[a]+'"'));var s="";for(var l in t)t[l]!=Object.prototype[l]&&(s+='<param name="'+l+'" value="'+t[l]+'" />');r.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+o+">"+s+"</object>",R[R.length]=e.id,i=m(e.id)}else{var u=g(A);u.setAttribute("type",N);for(var c in e)e[c]!=Object.prototype[c]&&("styleclass"==c.toLowerCase()?u.setAttribute("class",e[c]):"classid"!=c.toLowerCase()&&u.setAttribute(c,e[c]));for(var d in t)t[d]!=Object.prototype[d]&&"movie"!=d.toLowerCase()&&f(u,d,t[d]);r.parentNode.replaceChild(u,r),i=u}return i}function f(e,t,n){var i=g("param");i.setAttribute("name",t),i.setAttribute("value",n),e.appendChild(i)}function p(e){var t=m(e);t&&"OBJECT"==t.nodeName&&(z.ie&&z.win?(t.style.display="none",function(){4==t.readyState?h(e):setTimeout(arguments.callee,10)}()):t.parentNode.removeChild(t))}function h(e){var t=m(e);if(t){for(var n in t)"function"==typeof t[n]&&(t[n]=null);t.parentNode.removeChild(t)}}function m(e){var t=null;try{t=M.getElementById(e)}catch(n){}return t}function g(e){return M.createElement(e)}function v(e,t,n){e.attachEvent(t,n),q[q.length]=[e,t,n]}function y(e){var t=z.pv,n=e.split(".");return n[0]=parseInt(n[0],10),n[1]=parseInt(n[1],10)||0,n[2]=parseInt(n[2],10)||0,t[0]>n[0]||t[0]==n[0]&&t[1]>n[1]||t[0]==n[0]&&t[1]==n[1]&&t[2]>=n[2]?!0:!1}function b(e,t,n,i){if(!z.ie||!z.mac){var r=M.getElementsByTagName("head")[0];if(r){var o=n&&"string"==typeof n?n:"screen";if(i&&(S=null,k=null),!S||k!=o){var a=g("style");a.setAttribute("type","text/css"),a.setAttribute("media",o),S=r.appendChild(a),z.ie&&z.win&&typeof M.styleSheets!=E&&M.styleSheets.length>0&&(S=M.styleSheets[M.styleSheets.length-1]),k=o}z.ie&&z.win?S&&typeof S.addRule==A&&S.addRule(e,t):S&&typeof M.createTextNode!=E&&S.appendChild(M.createTextNode(e+" {"+t+"}"))}}}function $(e,t){if(W){var n=t?"visible":"hidden";G&&m(e)?m(e).style.visibility=n:b("#"+e,"visibility:"+n)}}function w(e){var t=/[\\\"<>\.;]/,n=null!=t.exec(e);return n&&typeof encodeURIComponent!=E?encodeURIComponent(e):e}var x,C,T,_,S,k,E="undefined",A="object",D="Shockwave Flash",F="ShockwaveFlash.ShockwaveFlash",N="application/x-shockwave-flash",j="SWFObjectExprInst",L="onreadystatechange",O=window,M=document,P=navigator,U=!1,I=[i],B=[],R=[],q=[],G=!1,H=!1,W=!0,z=function(){var e=typeof M.getElementById!=E&&typeof M.getElementsByTagName!=E&&typeof M.createElement!=E,t=P.userAgent.toLowerCase(),n=P.platform.toLowerCase(),i=n?/win/.test(n):/win/.test(t),r=n?/mac/.test(n):/mac/.test(t),o=/webkit/.test(t)?parseFloat(t.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,a=!1,s=[0,0,0],l=null;if(typeof P.plugins!=E&&typeof P.plugins[D]==A)l=P.plugins[D].description,!l||typeof P.mimeTypes!=E&&P.mimeTypes[N]&&!P.mimeTypes[N].enabledPlugin||(U=!0,a=!1,l=l.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),s[0]=parseInt(l.replace(/^(.*)\..*$/,"$1"),10),s[1]=parseInt(l.replace(/^.*\.(.*)\s.*$/,"$1"),10),s[2]=/[a-zA-Z]/.test(l)?parseInt(l.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof O.ActiveXObject!=E)try{var u=new ActiveXObject(F);u&&(l=u.GetVariable("$version"),l&&(a=!0,l=l.split(" ")[1].split(","),s=[parseInt(l[0],10),parseInt(l[1],10),parseInt(l[2],10)]))}catch(c){}return{w3:e,pv:s,wk:o,ie:a,win:i,mac:r}}();return function(){z.w3&&((typeof M.readyState!=E&&"complete"==M.readyState||typeof M.readyState==E&&(M.getElementsByTagName("body")[0]||M.body))&&e(),G||(typeof M.addEventListener!=E&&M.addEventListener("DOMContentLoaded",e,!1),z.ie&&z.win&&(M.attachEvent(L,function(){"complete"==M.readyState&&(M.detachEvent(L,arguments.callee),e())}),O==top&&function(){if(!G){try{M.documentElement.doScroll("left")}catch(t){return setTimeout(arguments.callee,0),void 0}e()}}()),z.wk&&function(){return G?void 0:/loaded|complete/.test(M.readyState)?(e(),void 0):(setTimeout(arguments.callee,0),void 0)}(),n(e)))}(),function(){z.ie&&z.win&&window.attachEvent("onunload",function(){for(var e=q.length,t=0;e>t;t++)q[t][0].detachEvent(q[t][1],q[t][2]);for(var n=R.length,i=0;n>i;i++)p(R[i]);for(var r in z)z[r]=null;z=null;for(var o in swfobject)swfobject[o]=null;swfobject=null})}(),{registerObject:function(e,t,n,i){if(z.w3&&e&&t){var r={};r.id=e,r.swfVersion=t,r.expressInstall=n,r.callbackFn=i,B[B.length]=r,$(e,!1)}else i&&i({success:!1,id:e})},getObjectById:function(e){return z.w3?a(e):void 0},embedSWF:function(e,n,i,r,o,a,u,c,f,p){var h={success:!1,id:n};z.w3&&!(z.wk&&312>z.wk)&&e&&n&&i&&r&&o?($(n,!1),t(function(){i+="",r+="";var t={};if(f&&typeof f===A)for(var m in f)t[m]=f[m];t.data=e,t.width=i,t.height=r;var g={};if(c&&typeof c===A)for(var v in c)g[v]=c[v];if(u&&typeof u===A)for(var b in u)typeof g.flashvars!=E?g.flashvars+="&"+b+"="+u[b]:g.flashvars=b+"="+u[b];if(y(o)){var w=d(t,g,n);t.id==n&&$(n,!0),h.success=!0,h.ref=w}else{if(a&&s())return t.data=a,l(t,g,n,p),void 0;$(n,!0)}p&&p(h)})):p&&p(h)},switchOffAutoHideShow:function(){W=!1},ua:z,getFlashPlayerVersion:function(){return{major:z.pv[0],minor:z.pv[1],release:z.pv[2]}},hasFlashPlayerVersion:y,createSWF:function(e,t,n){return z.w3?d(e,t,n):void 0},showExpressInstall:function(e,t,n,i){z.w3&&s()&&l(e,t,n,i)},removeSWF:function(e){z.w3&&p(e)},createCSS:function(e,t,n,i){z.w3&&b(e,t,n,i)},addDomLoadEvent:t,addLoadEvent:n,getQueryParamValue:function(e){var t=M.location.search||M.location.hash;if(t){if(/\?/.test(t)&&(t=t.split("?")[1]),null==e)return w(t);for(var n=t.split("&"),i=0;n.length>i;i++)if(n[i].substring(0,n[i].indexOf("="))==e)return w(n[i].substring(n[i].indexOf("=")+1))}return""},expressInstallCallback:function(){if(H){var e=m(j);e&&x&&(e.parentNode.replaceChild(x,e),C&&($(C,!0),z.ie&&z.win&&(x.style.display="block")),T&&T(_)),H=!1}}}}();window.twttr=function(e,t,n){var i,r,o=e.getElementsByTagName(t)[0];if(!e.getElementById(n))return r=e.createElement(t),r.id=n,r.src="//platform.twitter.com/widgets.js",o.parentNode.insertBefore(r,o),window.twttr||(i={_e:[],ready:function(e){i._e.push(e)}})}(document,"script","twitter-wjs"),twttr.ready(function(){_ga.trackTwitter()}),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://apis.google.com/js/plusone.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();// Copyright 2012 Google Inc. All Rights Reserved.
var _ga=_ga||{},_gaq=_gaq||[];_ga.getSocialActionTrackers_=function(e,t,n,i){return function(){for(var r,o=_gat._getTrackers(),a=0;r=o[a];a++)r._trackSocial(e,t,n,i)}},_ga.trackFacebook=function(e){try{FB&&FB.Event&&FB.Event.subscribe&&(FB.Event.subscribe("edge.create",function(t){_gaq.push(_ga.getSocialActionTrackers_("facebook","like",t,e))}),FB.Event.subscribe("edge.remove",function(t){_gaq.push(_ga.getSocialActionTrackers_("facebook","unlike",t,e))}),FB.Event.subscribe("message.send",function(t){_gaq.push(_ga.getSocialActionTrackers_("facebook","send",t,e))}))}catch(t){}},_ga.trackTwitterHandler_=function(e,t){var n;if(e&&"tweet"==e.type||"click"==e.type){"IFRAME"==e.target.nodeName&&(n=_ga.extractParamFromUri_(e.target.src,"url"));var i=e.type+("click"==e.type?"-"+e.region:"");_gaq.push(_ga.getSocialActionTrackers_("twitter",i,n,t))}},_ga.trackTwitter=function(e){intent_handler=function(t){_ga.trackTwitterHandler_(t,e)},twttr.events.bind("click",intent_handler),twttr.events.bind("tweet",intent_handler)},_ga.extractParamFromUri_=function(e,t){if(e){var n=new RegExp("[\\?&#]"+t+"=([^&#]*)"),i=n.exec(e);return null!=i?unescape(i[1]):void 0}},GC.WindowController=function(){return{init:function(){GC.log("Starting WindowController init","info"),GC.log("Adding opening of modal dialogs from class “openModalDialog”","info"),$("a.openModalDialog").live("click",function(e){e.preventDefault();var t=$(this);if(t.attr("data-local")){GC.log("Taking markup from a preloaded source","info");var n="";return $(t.data().local).each(function(){n+=$(this).html()}),GC.WindowController.modalDialog(n,t.data().size,!1,!1,!1),void 0}""!=t.attr("href")&&(GC.log("Loading markup from ajax","info"),$.ajax({type:"get",url:t.attr("href"),dataType:"html",success:function(e,n){e&&"success"==n&&GC.WindowController.modalDialog(e,t.data().size,!1,!1,!1,!1)},error:function(){GC.log("There was an error receiving the modal dialog markup.","error")}}))}),GC.log("Adding default close/cancel to all .close elements inside the modal","info"),$(".modalDialog .close").live("click",function(e){var t=$(this),n=$(".modalDialog:visible");(!t.attr("href")||2>t.attr("href").length||"#"!=t.attr("href").substring(0,1))&&e.preventDefault(),"submit"==t.attr("type")&&t.closest("form").submit(),$("*",n).unbind(),n.remove(),0==$(".modalDialog:visible").length&&$("#dimmer").hide()});var e=function(e){var t=e.data().method||"post",n=e.data().payload||{};"checkbox"==e.attr("type")&&(n[e.attr("name")]=e.prop("checked")),"SELECT"==e.get(0).tagName&&(n[e.attr("name")]=e.val()),$.ajax({type:t,url:e.data().posturl,data:n})};GC.log("Adding listener to .doPost links","info"),$("a.doPost, button.doPost, input.doPost").live("click",function(){e($(this))}),GC.log("Adding listener to .doPost selects","info"),$("select.doPost").live("change",function(){e($(this))}),GC.log("Adding listeners to non-default form submitters","info"),$("a.submitter").live("click",function(e){e.preventDefault(),$(this).closest("form").submit()}),$("select.submitter").live("change",function(){$(this).closest("form").submit()}),$('input[type="text"].submitter').live("blur",function(){$(this).closest("form").submit()}),$("input.enterSubmitter").live("keypress",function(e){13==e.keyCode&&$(this).closest("form").submit()}),GC.log("Adding listener to disable/replace actions with a spinner if has dynamic actions","info"),$(".action").live("click",function(){var e=$(this);if("disabled"!=e.attr("disabled")){var t=e.width(),n=e.outerHeight();e.offset().top,e.offset().left;var i=$("body > .replacer").clone();e.hasClass("button")&&(i.addClass("buttonify"),e.hasClass("text")||(t-=2,n-=2)),i.removeClass("hidden").css({top:0,left:0,width:t,height:n,position:"static"==e.css("position")?"relative":e.css("position"),display:e.css("display"),"vertical-align":e.css("vertical-align"),"margin-top":e.css("margin-top"),"margin-right":e.css("margin-right"),"margin-bottom":e.css("margin-bottom"),"margin-left":e.css("margin-left"),"padding-top":e.css("padding-top"),"padding-right":e.css("padding-right"),"padding-bottom":e.css("padding-bottom"),"padding-left":e.css("padding-left"),"text-align":e.css("text-align")}),("absolute"==e.css("position")||"fixed"==e.css("position"))&&i.css({top:e.css("top"),left:e.css("left"),bottom:e.css("bottom"),right:e.css("right")}),setTimeout(function(){e.replaceWith(i)},50)}}),GC.log("Adding opening of popwindows","info"),$(".popupWindow").live("click",function(e){return e.preventDefault(),p=window.open($(this).attr("href"),"","height=400,width=600"),window.focus&&p.focus(),!1}),$(".toggler").each(function(){var e=$(this),t=e.closest(".toggle").find(".body");t.data("defaultheight",t.css("height"))}),$(".toggler").live("click",function(e){e.preventDefault();var t=$(this),n=t.closest(".toggle").find(".body"),i=n.data().defaultheight||0;n.hasClass("closed")?n.animate({height:n.get(0).scrollHeight},250,function(){n.removeClass("closed"),t.html(t.data().strings.close)}):n.animate({height:i},250,function(){n.addClass("closed"),t.html(t.data().strings.open)})}),GC.WindowController.forms($("body")),$("form").live("ajax:aborted:required",function(){return!1}),GC.log("Find any fields on the page that should be preselected","info"),$(".preSelect:first").focus(),GC.log("Adding click listener to body to close unneccesary layers etc","info"),$("body").live("click",function(e){0==$(e.target).closest(".tooltip").length&&$("#visibleTooltip").remove()}),GC.log("Adding cloner","info"),$(".cloner").each(function(){if($(this).closest(".cloneGroup").length>0)var e=$(this).closest(".cloneGroup");else var e=$(this).closest("form");$(this).click(function(t){t.preventDefault(),$(this);var n=$(".sample",e).clone();$(".sample",e).attr("data-counter")&&(n.find(":input").each(function(){$(this).attr("name",$(this).attr("name").replace("%replacecounter%",$(".sample",e).attr("data-counter")))}),$(".sample",e).attr("data-counter",parseInt($(".sample",e).attr("data-counter"))+1)),n.removeClass("sample").removeClass("hidden").find("*").removeAttr("disabled"),$(".sample",e).before(n)})}),GC.WindowController.initAutoDownload(),GC.log("WindowController init done","info")},forms:function(e){GC.log("Adding form controling function","info"),$(".remoteForm").length>0&&$(".remoteForm",e).ajaxForm({dataType:"script"})},modalDialog:function(e,t,n,i,r,o){if("undefined"==typeof t&&(t=540),!n||""==n){var a=new GC.Identifier;n=a.randomId()}$("#"+n).remove(),$("#dimmer").show(),$("body").append('<div class="modalDialog" id="'+n+'"><div class="content">'+e+"</div></div>");var s=$("#"+n);s.css({width:t}),GC.WindowController.reposition(s,!1),i&&s.find('a.submit, button[type="submit"], input[type="submit"]').click(function(e){e.preventDefault(),i()}),r&&s.find(".close").click(function(){r()}),o&&o(),GC.WindowController.forms(s)},removeModal:function(e){e?(GC.log("Removing modals with ID: “"+e+"”","info"),$("#"+e).remove()):(GC.log("Removing "+$(".modalDialog").length+" dialogs","info"),$(".modalDialog").remove()),0==$(".modalDialog:visible").length&&$("#dimmer").hide()},reposition:function(e,t){e||(e=$(".modalDialog")),e.each(function(){$p=$(this);var n=$p.outerHeight()/2;if(0>$(window).height()/2-n&&(n=$(window).height()/2-10),$(".modalDialog .loadingContent").length>0&&(n+=100),"postDownloadLoveModal"==e.attr("id")){var i;i="number"==typeof window.innerHeight?window.innerHeight:document.documentElement.clientHeight,$("#postDownloadLoveModal .content").height(i)}t?$p.animate({marginTop:"-"+n+"px",marginLeft:"-"+$p.outerWidth()/2+"px"},250):$p.css({marginTop:"-"+n+"px",marginLeft:"-"+$p.outerWidth()/2+"px"}),$p.css({visibility:"visible"})})},initAutoDownload:function(){GC.log("Starting init for autodownloading files","info"),$(".autodownload").each(function(){var e=$(this);"undefined"!=typeof e.attr("href")&&""!=e.attr("href")&&(document.location.href=e.attr("href"))}),$(".firstDownload").live("click",function(){var e=$(this);document.location.href=e.attr("href")})}}}(),function(){function t(){return function(){}}function E(){return"x"+ ++aa+ +new Date}function G(){return+new Date}function ka(e,t){var n=e.join(da),i=[];return t?(M(t,function(e,t){i.push(e+"="+N(t))}),n+="?"+i.join(ea)):n}function la(e,t){function n(){r+t>G()?(clearTimeout(i),i=setTimeout(n,t)):(r=G(),e())}var i,r=0;return n}function ma(e,t){var n=[];return M(e||[],function(e){t(e)&&n.push(e)}),n}function na(e,t){return e.replace(ha,function(e,n){return t[n]||e})}function ja(e){var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=0|16*Math.random();return("x"==e?t:8|3&t).toString(16)});return e&&e(t),t}function M(e,t){if(e&&t)if("undefined"!=typeof e[0])for(var n=0,i=e.length;i>n;)t.call(e[n],e[n],n++);else for(n in e)e.hasOwnProperty&&e.hasOwnProperty(n)&&t.call(e[n],n,e[n])}function P(e,t){var n=[];return M(e||[],function(e,i){n.push(t(e,i))}),n}function N(e){return P(encodeURIComponent(e).split(""),function(e){return 0>"-_.!~*'()".indexOf(e)?e:"%"+e.charCodeAt(0).toString(16).toUpperCase()}).join("")}function oa(e){var t=[];return M(e,function(e,n){n.j&&t.push(e)}),t.sort()}function pa(){setTimeout(function(){v||(v=1,M(ba,function(e){e()}))},z)}var n=null,r=!1;window.JSON&&window.JSON.stringify||function(){function a(){try{return this.valueOf()}catch(e){return n}}function c(e){return d.lastIndex=0,d.test(e)?'"'+e.replace(d,function(e){var t=q[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function b(t,n){var i,r,o,l,u,d=e,f=n[t];switch(f&&"object"==typeof f&&(f=a.call(f)),"function"==typeof k&&(f=k.call(n,t,f)),typeof f){case"string":return c(f);case"number":return isFinite(f)?String(f):"null";case"boolean":case"null":return String(f);case"object":if(!f)return"null";if(e+=s,u=[],"[object Array]"===Object.prototype.toString.apply(f)){for(l=f.length,i=0;l>i;i+=1)u[i]=b(i,f)||"null";return o=0===u.length?"[]":e?"[\n"+e+u.join(",\n"+e)+"\n"+d+"]":"["+u.join(",")+"]",e=d,o}if(k&&"object"==typeof k)for(l=k.length,i=0;l>i;i+=1)r=k[i],"string"==typeof r&&(o=b(r,f))&&u.push(c(r)+(e?": ":":")+o);else for(r in f)Object.hasOwnProperty.call(f,r)&&(o=b(r,f))&&u.push(c(r)+(e?": ":":")+o);return o=0===u.length?"{}":e?"{\n"+e+u.join(",\n"+e)+"\n"+d+"}":"{"+u.join(",")+"}",e=d,o}}window.JSON||(window.JSON={});var d=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,e,s,q={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},k;"function"!=typeof JSON.stringify&&(JSON.stringify=function(t,n,i){var r;if(s=e="","number"==typeof i)for(r=0;i>r;r+=1)s+=" ";else"string"==typeof i&&(s=i);if((k=n)&&"function"!=typeof n&&("object"!=typeof n||"number"!=typeof n.length))throw Error("JSON.stringify");return b("",{"":t})}),"function"!=typeof JSON.parse&&(JSON.parse=function(a){return eval("("+a+")")})}();var aa=1,v=r,ba=[],w="-pnpres",z=1e3,da="/",ea="&",ha=/{([\w\-]+)}/g,I,ia=Math.floor(20*Math.random());if(I=function(e,t){return e.indexOf("pubsub.")>0&&e.replace("pubsub","ps"+(t?ja().split("-")[0]:20>++ia?ia:ia=1))||e},!window.PUBNUB){var Q=function(e){return document.getElementById(e)},qa=function(e){console.error(e)},ra=function(e,t){var n=[];return M(e.split(/\s+/),function(e){M((t||document).getElementsByTagName(e),function(e){n.push(e)})}),n},R=function(e,t,n){M(e.split(","),function(e){function i(e){e||(e=window.event),n(e)||(e.cancelBubble=!0,e.returnValue=r,e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation())}t.addEventListener?t.addEventListener(e,i,r):t.attachEvent?t.attachEvent("on"+e,i):t["on"+e]=i})},sa=function(){return ra("head")[0]},S=function(e,t,n){return n?(e.setAttribute(t,n),void 0):e&&e.getAttribute&&e.getAttribute(t)},ua=function(e,t){for(var n in t)if(t.hasOwnProperty(n))try{e.style[n]=t[n]+("|width|height|top|left|".indexOf(n)>0&&"number"==typeof t[n]?"px":"")}catch(i){}},va=function(e){return document.createElement(e)},wa=function(){return T||U()?0:E()},ya=function(e){function i(e,t){$||($=1,y.onerror=n,clearTimeout(w),e||!t||C(t),setTimeout(function(){e&&x();var t=Q(b),n=t&&t.parentNode;n&&n.removeChild(t)},z))}if(T||U()){e:{var r,o,a=function(){if(!l){l=1,clearTimeout(c);try{o=JSON.parse(r.responseText)}catch(e){return m(1)}s=1,p(o)}},s=0,l=0,u=e.timeout||1e4,c=setTimeout(function(){m(1)},u),d=e.b||t(),f=e.data||{},p=e.c||t(),h="undefined"==typeof e.g,m=function(e){s||(s=1,clearTimeout(c),r&&(r.onerror=r.onload=n,r.abort&&r.abort(),r=n),e&&d())};try{r=U()||window.XDomainRequest&&new XDomainRequest||new XMLHttpRequest,r.onerror=r.onabort=function(){m(1)},r.onload=r.onloadend=a,h&&(r.timeout=u),f.pnsdk=xa;var g=ka(e.url,f);r.open("GET",g,h),r.send()}catch(v){m(0),T=0,e=ya(e);break e}e=m}return e}var y=va("script"),a=e.a,b=E(),$=0,w=setTimeout(function(){i(1)},e.timeout||1e4),x=e.b||t(),u=e.data||{},C=e.c||t();return window[a]=function(e){i(0,e)},e.g||(y[za]=za),y.onerror=function(){i(1)},u.pnsdk=xa,y.src=ka(e.url,u),S(y,"id",b),sa().appendChild(y),i},Aa=function(){return"onLine"in navigator?navigator.onLine:1},U=function(){if(!Ba||!Ba.get)return 0;var e={id:U.id++,send:t(),abort:function(){e.id={}},open:function(t,n){U[e.id]=e,Ba.get(e.id,n)}};return e},za="async",xa="PubNub-JS-Web/3.5.3",T=-1==navigator.userAgent.indexOf("MSIE 6");window.console||(window.console=window.console||{}),console.log||(console.log=console.error=(window.opera||{}).postError||t());var Ca,V=window.localStorage;Ca={get:function(e){try{return V?V.getItem(e):-1==document.cookie.indexOf(e)?n:((document.cookie||"").match(RegExp(e+"=([^;]+)"))||[])[1]||n}catch(t){}},set:function(e,t){try{if(V)return V.setItem(e,t)&&0;document.cookie=e+"="+t+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(n){}}};var W={list:{},unbind:function(e){W.list[e]=[]},bind:function(e,t){(W.list[e]=W.list[e]||[]).push(t)},fire:function(e,t){M(W.list[e]||[],function(e){e(t)})}},Z=Q("pubnub")||0,Da=function(e){function i(){}function r(e){A&&A(e),A=n}function o(){V.time(function(e){e||r(1),setTimeout(o,p)})}function a(){U()||r(1),setTimeout(a,z)}function s(e){var n=0;return M(oa(j),function(i){(i=j[i])&&(n++,(e||t())(i))}),n}function l(e){e&&(C.h=0),!C.h&&C.length&&(C.h=1,L(C.shift()))}e.jsonp&&(T=0);var u=e.subscribe_key||"";e.uuid||Ca.get(u+"uuid"),e.xdr=ya,e.db=Ca,e.error=qa,e._is_online=Aa,e.jsonp_cb=wa;var c,d=+e.windowing||10,f=(+e.timeout||310)*z,p=(+e.keepalive||60)*z,h=e.publish_key||"",m=e.subscribe_key||"",g=e.auth_key||"",y=e.ssl?"s":"",b="http"+y+"://"+(e.origin||"pubsub.pubnub.com"),$=I(b),x=I(b),C=[],_=0,k=0,A=0,D=0,F=0,j={},L=e.xdr,O=e.error||t(),U=e._is_online||function(){return 1},B=e.jsonp_cb||function(){return 0},q=e.db||{get:t(),set:t()},H=e.uuid||q&&q.get(m+"uuid")||"",V={LEAVE:function(e,t){var n={uuid:H,auth:g},i=I(b),r=B();e.indexOf(w)>0||("0"!=r&&(n.callback=r),L({g:t||y,timeout:2e3,a:r,data:n,url:[i,"v2","presence","sub_key",m,"channel",N(e),"leave"]}))},history:function(e,n){var n=e.callback||n,i=e.count||e.limit||100,r=e.reverse||"false",o=e.error||t(),a=e.channel,s=e.start,l=e.end,u={},c=B();return a?n?m?(u.stringtoken="true",u.count=i,u.reverse=r,u.auth=g,c&&(u.callback=c),s&&(u.start=s),l&&(u.end=l),L({a:c,data:u,c:function(e){n(e)},b:o,url:[$,"v2","history","sub-key",m,"channel",N(a)]}),void 0):O("Missing Subscribe Key"):O("Missing Callback"):O("Missing Channel")},replay:function(e){var n=n||e.callback||t(),i=e.source,r=e.destination,o=e.stop,a=e.start,s=e.end,l=e.reverse,e=e.limit,u=B(),c={};return i?r?h?m?("0"!=u&&(c.callback=u),o&&(c.stop="all"),l&&(c.reverse="true"),a&&(c.start=a),s&&(c.end=s),e&&(c.count=e),c.auth=g,L({a:u,c:function(e){n(e)},b:function(){n([0,"Disconnected"])},url:[$,"v1","replay",h,m,i,r],data:c}),void 0):O("Missing Subscribe Key"):O("Missing Publish Key"):O("Missing Destination Channel"):O("Missing Source Channel")},auth:function(e){g=e,i()},time:function(e){var t=B();L({a:t,data:{uuid:H,auth:g},timeout:5*z,url:[$,"time",t],c:function(t){e(t[0])},b:function(){e(0)}})},publish:function(e,n){var n=n||e.callback||t(),i=e.message,r=e.channel,o=B();return i?r?h?m?(i=JSON.stringify(i),r=[$,"publish",h,m,0,N(r),o,N(i)],C.push({a:o,timeout:5*z,url:r,data:{uuid:H,auth:g},c:function(e){n(e),l(1)},b:function(){n([0,"Failed",i]),l(1)}}),l(),void 0):O("Missing Subscribe Key"):O("Missing Publish Key"):O("Missing Channel"):O("Missing Message")},unsubscribe:function(e){e=e.channel,F=0,D=1,e=P((e.join?e.join(","):""+e).split(","),function(e){return e+","+e+w}).join(","),M(e.split(","),function(e){v&&V.LEAVE(e,0),j[e]=0}),i()},subscribe:function(e,o){function a(e){e?setTimeout(i,z):($=I(b,1),x=I(b,1),setTimeout(function(){V.time(a)},z)),s(function(t){return e&&t.d?(t.d=0,t.m(t.name)):(!e&&!t.d&&(t.d=1,t.l(t.name)),void 0)})}function l(){var e=B(),t=oa(j).join(",");t&&(r(),A=L({timeout:U,a:e,b:function(){A=n,V.time(a)},data:{uuid:H,auth:g},url:[x,"subscribe",m,N(t),e,F],c:function(e){if(A=n,!e||"object"==typeof e&&"error"in e&&!e.error)return y(e),setTimeout(i,R);F=!F&&D&&q.get(m)||e[1],s(function(e){e.f||(e.f=1,e.k(e.name))}),S&&(F=1e4,S=0),q.set(m,e[1]);var t,r=(e.length>2?e[2]:P(j,function(t){return P(Array(e[0].length).join(",").split(","),function(){return t})}).join(",")).split(",");t=function(){var e=r.shift()||k;return[(j[e]||{}).a||_,e.split(w)[0]]},M(e[0],function(n){var i=t();i[0](n,e,i[1])}),setTimeout(l,R)}}))}var u=e.channel,o=(o=o||e.callback)||e.message,c=e.connect||t(),p=e.reconnect||t(),h=e.disconnect||t(),y=e.error||t(),C=e.presence||0,T=e.noheresync||0,S=e.backfill||0,E=e.timetoken||0,U=e.timeout||f,R=e.windowing||d;return D=e.restore,F=E,u?o?m?(M((u.join?u.join(","):""+u).split(","),function(e){var t=j[e]||{};j[k=e]={name:e,f:t.f,d:t.d,j:1,a:_=o,k:c,l:h,m:p},C&&(V.subscribe({channel:e+w,callback:C}),!t.j&&!T&&V.here_now({channel:e,callback:function(t){M("uuids"in t?t.uuids:[],function(n){C({action:"join",uuid:n,timestamp:G(),occupancy:t.occupancy||1},t,e)})}}))}),i=function(){r(),setTimeout(l,R)},v?(i(),void 0):ba.push(i)):O("Missing Subscribe Key"):O("Missing Callback"):O("Missing Channel")},here_now:function(e,n){var n=e.callback||n,i=e.error||t(),r=e.channel,o=B(),a={uuid:H,auth:g};return r?n?m?("0"!=o&&(a.callback=o),L({a:o,data:a,c:function(e){n(e,r)},b:i,url:[$,"v2","presence","sub_key",m,"channel",N(r)]}),void 0):O("Missing Subscribe Key"):O("Missing Callback"):O("Missing Channel")},xdr:L,ready:pa,db:q,uuid:ja,map:P,each:M,"each-channel":s,grep:ma,offline:function(){r(1)},supplant:na,now:G,unique:E,updater:la};return H||(H=V.uuid()),q.set(m+"uuid",H),setTimeout(a,z),setTimeout(o,p),V.time(t()),c=V,c.css=ua,c.$=Q,c.create=va,c.bind=R,c.head=sa,c.search=ra,c.attr=S,c.events=W,c.init=Da,R("beforeunload",window,function(){return c["each-channel"](function(e){c.LEAVE(e.name,0)}),!0}),e.notest?c:(R("offline",window,c.offline),R("offline",document,c.offline),c)};R("load",window,function(){setTimeout(pa,0)});var $=Z||{};PUBNUB=Da({notest:1,publish_key:S($,"pub-key"),subscribe_key:S($,"sub-key"),ssl:!document.location.href.indexOf("https")||"on"==S($,"ssl"),origin:S($,"origin"),uuid:S($,"uuid")}),window.jQuery&&(window.jQuery.PUBNUB=PUBNUB),"undefined"!=typeof module&&(module.exports=PUBNUB)&&pa();var Ba=Q("pubnubs")||0;Z&&(ua(Z,{position:"absolute",top:-z}),("opera"in window||S(Z,"flash"))&&(Z.innerHTML="<object id=pubnubs data=https://pubnub.a.ssl.fastly.net/pubnub.swf><param name=movie value=https://pubnub.a.ssl.fastly.net/pubnub.swf><param name=allowscriptaccess value=always></object>"),PUBNUB.rdx=function(e,t){return t?(U[e].responseText=unescape(t),U[e].onload(),void 0):U[e].onerror()},U.id=z)}var Ea=PUBNUB.ws=function(e,n){if(!(this instanceof Ea))return new Ea(e,n);var i=this,e=i.url=e||"";i.protocol=n||"Sec-WebSocket-Protocol";var o=e.split("/"),o={ssl:"wss:"===o[0],origin:o[2],publish_key:o[3],subscribe_key:o[4],channel:o[5]};return i.CONNECTING=0,i.OPEN=1,i.CLOSING=2,i.CLOSED=3,i.CLOSE_NORMAL=1e3,i.CLOSE_GOING_AWAY=1001,i.CLOSE_PROTOCOL_ERROR=1002,i.CLOSE_UNSUPPORTED=1003,i.CLOSE_TOO_LARGE=1004,i.CLOSE_NO_STATUS=1005,i.CLOSE_ABNORMAL=1006,i.onclose=i.onerror=i.onmessage=i.onopen=i.onsend=t(),i.binaryType="",i.extensions="",i.bufferedAmount=0,i.trasnmitting=r,i.buffer=[],i.readyState=i.CONNECTING,e?(i.e=PUBNUB.init(o),i.e.i=o,i.i=o,i.e.subscribe({restore:r,channel:o.channel,disconnect:i.onerror,reconnect:i.onopen,error:function(){i.onclose({code:i.CLOSE_ABNORMAL,reason:"Missing URL",wasClean:r})},callback:function(e){i.onmessage({data:e})},connect:function(){i.readyState=i.OPEN,i.onopen()}}),void 0):(i.readyState=i.CLOSED,i.onclose({code:i.CLOSE_ABNORMAL,reason:"Missing URL",wasClean:!0}),i)};Ea.prototype.send=function(e){var t=this;t.e.publish({channel:t.e.i.channel,message:e,callback:function(e){t.onsend({data:e})}})}}(),GC.Uploader=function(){return{init:function(){function e(e){var t=null;if(Grabcad.configuration.pubnub_state&&(t=Grabcad.configuration.pubnub_state.bindings),t){var n=e.event_type,i=e.payload;if(void 0!==t[n])for(var r=0;t[n].length>r;++r)t[n][r]&&t[n][r](i)}}GC.Temporary.uploadCounter=0,GC.Temporary.uploadQueue=[],GC.Temporary.Inflight=0,GC.Temporary.id=0,GC.Temporary.LiveFiles={},GC.Temporary.CommitFiles={},GC.Temporary.InPost={},GC.Temporary.StartTime=0,GC.Temporary.PreviousTimeRemaing=0,GC.Temporary.TotalSize=0,GC.Temporary.TotalUploaded=0,GC.Temporary.AvgRenderCommitTime=0,GC.Temporary.AvgCadCommitTime=0,GC.Temporary.CommitTimer=null,GC.Temporary.StartCommit=0,GC.Temporary.BytesPerMs=0,GC.Temporary.NRender=0,GC.Temporary.NCad=0,GC.Temporary.CheckExistsQueue=[],GC.Temporary.CheckExistsCount=0,GC.Temporary.RenderProcessingQueue=[],GC.Temporary.RenderProcessedCount=0,GC.Temporary.RenderTimer=null,GC.Temporary.RenderTimedOut=!1,GC.Temporary.RenderIDMap={},void 0===Grabcad.configuration.pubnub_state&&void 0!==Grabcad.configuration.pubnub_options&&Grabcad.configuration.pubnub_options.enabled&&(Grabcad.configuration.configure({pubnub_init_params:{subscribe_key:Grabcad.configuration.pubnub_options.subscribe_key,ssl:Grabcad.configuration.pubnub_options.use_ssl}}),_pubnub=PUBNUB.init(Grabcad.configuration.pubnub_init_params),Grabcad.configuration.configure({pubnub_state:{connection:_pubnub}})),Grabcad.configuration.pubnub_state&&(_pubnub=Grabcad.configuration.pubnub_state.connection,_pubnub.subscribe({channel:Grabcad.configuration.pubnub_options.channel_name,message:e,connect:function(){}}),Grabcad.configuration.pubnub_state.bindings={},_bindings=Grabcad.configuration.pubnub_state.bindings,_bindings.process_rendering=[],_bindings.process_rendering.push(function(e){GC.Uploader.pubnubEventReceived(!0,e)}),_bindings.process_rendering_failed=[],_bindings.process_rendering_failed.push(function(e){GC.Uploader.pubnubEventReceived(!1,e)}))},pubnubAvailable:function(){return void 0!==Grabcad.configuration.pubnub_state},DragDropFilesFolders:!1,DragDropFiles:!1,uploadify:function(e,t){GC.Uploader.isHtml5Upload()||$("#"+e).uploadify({auto:!1,requeueErrors:!1,multi:void 0==t.multi?!0:t.multi,queueSizeLimit:void 0==t.queueSizeLimit?999:t.queueSizeLimit,uploadLimit:999,fileObjName:"file",swf:void 0==t.swf?"/flash/uploadify.swf":t.swf,buttonText:void 0==t.buttonText?"Browse":t.buttonText,buttonImage:void 0==t.buttonImage?"/images/uploadify/dummy.png":t.buttonImage,buttonClass:"button b48 red",cancelImage:"/images/uploadify/dummy.png",width:void 0==t.width?"166":t.width,height:"50",queueID:"uploadify_queue",hideButton:!0,transparent:!0,fileSizeLimit:t.fileSizeLimit+"B",fileTypeDesc:void 0==t.fileTypeDesc?"All files":t.fileTypeDesc,fileTypeExts:void 0==t.fileTypeExts?"*.*":t.fileTypeExts,checkExisting:!1,skipDefault:["onSelect","onUploadProgress","onDialogClose","onSelectError"],onSelect:void 0==t.onSelect?!1:t.onSelect,onSelectError:GC.Uploader.errorHandler,onUploadStart:!1,onUploadProgress:GC.Uploader.uploadProgress,onUploadSuccess:void 0==t.onUploadSuccess?!1:t.onUploadSuccess,onUploadComplete:!1,onUploadError:GC.Uploader.errorHandler,onQueueComplete:!1,postData:t.postData,uploader:t.uploader,debug:!1,successTimeout:0},{http_success:["201"]})},cancelUpload:function(e){GC.Uploader.trackUpload(GC.Uploader.UploadBatchCanceled),$(".popupWin").is(":visible")?($(".popupFooter .submit").removeAttr("onclick"),$(".popupFooter .cancel").unbind("click"),$("#popupCancel").spin("small")):($("#doneButtonSpan").removeAttr("onclick"),$("#cancelButtonSpan").removeAttr("onclick"),$("#cancelButton").spin("small"));var t="/library/cancel_upload_files?batch_id="+batch_id+"&folder_id="+window.folderId;GC.Uploader.closeBulkUploadWindow(),$.ajax({type:"post",url:t,datatype:"json",data:{format:"js"},success:function(){"string"==typeof e&&window.location.replace(e)}})},attachToModel:function(e,t){$(".popupWin").is(":visible")?($(".popupFooter .submit").removeAttr("onclick"),$(".popupFooter .submit").spin("small"),$("#popupCancel").addClass("hidden")):($("#doneButtonSpan").removeAttr("onclick"),$("#cancelButtonSpan").removeAttr("onclick"),$("#doneButton").spin("small")),GC.Uploader.closeBulkUploadWindow();var n=e;$.ajax({type:"post",url:n,datatype:"json",data:{format:"js",batch_id:batch_id,no_async:!0,description:$("#snapshot_description").val()},success:function(){GC.Uploader.trackUpload(GC.Uploader.UploadBatchConfirmed),$(".popupWin").is(":visible")?$(".popupFooter .submit").spin(!1):"undefined"!=typeof t&&window.location.replace(t)}})},cadUploadedToS3ByFlash:function(e,t,n,i){return $(".popupWin").is(":visible")&&$(".popupFooter .submit").removeClass("gray inactive").addClass("red"),""!=t&&0>t.indexOf("<Location>")?(GC.Uploader.errorHandler(e,0,"S3 response data invalid",t),void 0):(GC.Uploader.startUpload(),GC.Temporary.uploadCounter--,GC.Uploader.cadUploadedToS3(e,t,n,i),void 0)},getContainer:function(e){var t=GC.Uploader.isPicture(e);return t?$('li[data-file_id="'+e.id+'"]'):$("#cadfile_container_"+e.id)},cadUploadedToS3:function(e,t,n,i){var r=GC.Uploader.isPicture(e),o=GC.Uploader.getContainer(e);o.addClass("uploadInfo");var a=o.data("secure_id");GC.Uploader.trackUpload(GC.Uploader.UploadFileCompleted),$.ajax({type:"post",url:i,datatype:"json",data:{format:"js",file_id:e.id,file_file_name:e.name,file_content_type:e.type,folder_id:$("#folder").data("id"),batch_id:batch_id,relative_path:e.relative_path,system_id:r?18:o.find(".systemSystem").val(),secure_id:a,s3_data:t,s3_response:n,async:!0,show_contentfile_form:showContentfileForm},success:function(){GC.Uploader.isHtml5Upload()&&(GC.Temporary.Inflight--,GC.Uploader.processCommitFiles()),r?GC.Uploader.pubnubAvailable()&&GC.Uploader.addToRenderingQueue(e.id,a):GC.Uploader.updateRenderingStatusMessage()},error:function(t,n,i){GC.Uploader.errorHandler(e,t.status,t.responseText,i),GC.Uploader.updateRenderingStatusMessage(),GC.Uploader.isHtml5Upload()&&(GC.Temporary.Inflight--,GC.Uploader.processCommitFiles())}})},prettyTime:function(e,t,n){var i=n/e,r=(t-n)/i/1e3,o=Math.floor(r%60);r/=60;var a=Math.floor(r%60);r/=60;var s=Math.floor(r%24),l=function(e){if(0==e)return"00";var t=(10>e?"0":"")+e.toFixed(0);return isNaN(t)?"00":t};return l(s)+":"+l(a)+":"+l(o)},updateUploadProgress:function(e,t,n){parseInt(100*t/n)+"%",100!=n&&t!=n?(GC.Temporary.TotalUploaded+=t-e.incrementalBytes,e.incrementalBytes=t):(GC.Temporary.TotalUploaded+=e.size+e.headerOverhead-e.incrementalBytes,e.incrementalBytes=e.size+e.headerOverhead),GC.Uploader.totalUploadProgress()},commitTime:function(){var e=0,t=0;for(var n in GC.Temporary.LiveFiles)if(GC.Temporary.LiveFiles.hasOwnProperty(n)&&null!=GC.Temporary.LiveFiles[n]){var i=GC.Temporary.LiveFiles[n];GC.Uploader.isPicture(i)?t++:e++}if(0==GC.Temporary.StartCommit)return.2*e+6*t;var r=((new Date).getTime()-GC.Temporary.StartCommit)/1e3;if(0==GC.Temporary.AvgCadCommitTime&&0==GC.Temporary.AvgRenderCommitTime)return.2*e+t*(r>6?r:6);var o=e*(0==GC.Temporary.AvgCadCommitTime?.2:GC.Temporary.AvgCadCommitTime)+t*(0==GC.Temporary.AvgRenderCommitTime?6:GC.Temporary.AvgRenderCommitTime);return r>o?1==e+t?2:o:o-r},totalUploadProgress:function(){if(0!=GC.Temporary.StartTime){var e=$("#totalProgress_wrapper"),t=parseInt(100*GC.Temporary.TotalUploaded/GC.Temporary.TotalSize)+"%";$(e).removeClass("hidden");var n=(new Date).getTime()-GC.Temporary.StartTime,i=GC.Temporary.TotalUploaded/n;i>GC.Temporary.BytesPerMs&&(GC.Temporary.BytesPerMs=i);var r=GC.Uploader.commitTime(),o=GC.Temporary.TotalSize+1e3*r*i,a=(GC.Temporary.TotalSize-GC.Temporary.TotalUploaded)/i/1e3+r,t=parseInt(100*GC.Temporary.TotalUploaded/o)+"%";(0==GC.Temporary.PreviousTimeRemaing||GC.Temporary.PreviousTimeRemaing>a||a-GC.Temporary.PreviousTimeRemaing>3)&&($(".totalTimeRemaining",e).html(GC.Uploader.prettyTime((new Date).getTime()-GC.Temporary.StartTime+r,o,GC.Temporary.TotalUploaded)),$(".totalProgress .bar",e).css({width:t}),GC.Temporary.PreviousTimeRemaing=a),"100%"==t?$(".totalProgress",e).addClass("done"):$(".totalProgress",e).removeClass("done")}},cadUploadProgress:function(e,t,n,i){$(".submission").hasClass("hidden")&&$(".submission").removeClass("hidden"),$(".submissionArea").hasClass("hidden")&&$(".submissionArea").removeClass("hidden");var r=$("#"+i),o=parseInt(100*t/n)+"%";t==n&&$(".progress",r).addClass("done"),$(".progress .bar",r).css({width:o}),$(".percentage",r).html(o),GC.Uploader.isHtml5Upload()&&$(".timeRemaining",r).html(GC.Uploader.prettyTime((new Date).getTime()-e.startTime,n,t))},resizePopup:function(){$(".uploadPopup").is(":visible")&&($(".introText").hide(),$(".bodyContent").trigger($.Event("resize")),$(".popupFooter .cancelButton").html("Cancel"))},uploadSelect:function(e,t,n){var i=function(){$.ajax({type:"post",url:"/uploads/contentfile",dataType:"json",data:{format:"js",file_id:e.id,file_name:e.name,upload_method:"flash",acl:$("#uploadAcl").data("acl")},success:function(t){e.system_id=t.system_id,e.secure_id=t.secure_id,GC.Uploader.addFileMetadata(e),window.uploadify_uploader.addFileParam(e.id,"acl",t.acl),window.uploadify_uploader.addFileParam(e.id,"key",t.key),window.uploadify_uploader.addFileParam(e.id,"policy",t.policy),window.uploadify_uploader.addFileParam(e.id,"signature",t.signature),GC.Uploader.startUpload(e.id),GC.Uploader.trackUpload(GC.Uploader.UploadFileStartedFlash)}}),GC.Temporary.uploadCounter++,GC.Uploader.addFileContainer(e)};e&&e.name&&(n?GC.Uploader.checkFileExists(e.name,null,t,n,i):i())},checkFileExists:function(e,t,n,i,r,o){GC.Temporary.CheckExistsCount++;var a=function(){$(".modalDialog").hide().fadeIn(),$("#dimmer").show()},s=function(e){e.remove(),0==$(".modalDialog").length&&($("#dimmer").hide(),$("#overlayIframe").hide())},l=function(){$(".fileExistsModal").css("left",($(window).width()-$(".fileExistsModal").width())/2+"px")};$.ajax({url:"/library/"+n+"/check_file_existance.json",data:{file_name:e,folder_id:i,relative_path:t?t:""},type:"get",success:function(e){GC.Temporary.CheckExistsCount--;var t=e[0];if(1==t.exists){var n='<div class="modalDialog" id="contentfile_'+t.id+'"><div class="fileExistsModal modalWrapper"><div class="fileExistsMessage"><h3>A file or folder with this name already exists in this folder:</h3><div class="fileNames"></div><div class="errorMessage"></div></div><div class="buttonsSection"></div></div></div>';$("body").append($(n));var i="";t.name&&$("#contentfile_"+t.id+".modalDialog .fileNames").html(t.name+"<br />"),i=1==t.can_overwrite?"<a href='#' class='button b32 red uploadButton'>Yes, upload new version!</a><a href='#' class='button b32 gray closeButton'>No, I'll rename it!</a>":"<a href='#' class='button b32 gray closeButton'>Close</a>",$("#contentfile_"+t.id+".modalDialog .errorMessage").text(t.message),$("#contentfile_"+t.id+".modalDialog .buttonsSection").html(i),$("#dimmer").show(),$("#overlayIframe").show(),$(window).bind("resize",l),l(),$("#contentfile_"+t.id+".modalDialog .buttonsSection").delegate(".uploadButton","click",function(){r(),a(),s($(this).parent().parent().parent())}),$("#contentfile_"+t.id+".modalDialog .buttonsSection").delegate(".closeButton","click",function(){"undefined"!=typeof o&&o(),a(),s($(this).parent().parent().parent())})}else r()},error:function(){GC.Temporary.CheckExistsCount--}})},isPicture:function(e){return $.inArray(GC.Uploader.getFileType(e.name).toLowerCase(),["jpg","jpeg","png","gif","bmp"])>-1},screenshotUploadProgress:function(e,t,n){var i=t/n,r=parseInt(50*i)+"px";$('li[data-file_id="'+e.id+'"] img.progress').css({height:r})},uploadProgress:function(e,t,n){GC.Uploader.isPicture(e)?GC.Uploader.screenshotUploadProgress(e,t,n):GC.Uploader.cadUploadProgress(e,t,n,"cadfile_container_"+e.id),GC.Uploader.updateUploadProgress(e,t,n)},updateScreenshots:function(e){var t=$("ul.screenshots"),n=t.closest(".uploadContainer").find(".uploadify").attr("id"),i=$("#"+n);t.html(e),i.removeClass("invisible").closest("fieldset").removeClass("invisible").css("height","auto"),0==$(".screenshots li").length&&($(".uploadContainer").hide(),0==$("#cads_wrapper .uploadElementWrapper").length&&$("#cads_wrapper").hide())
},screenShotsToS3:function(e){GC.Uploader.removeLiveFile(e)},replaceScreenshot:function(e){var t=e.parent();return t.append($("<img />",{src:e.attr("src"),"class":"thumbnailImage",height:"50px",width:"50px",alt:e.attr("file_name")})),e.remove(),t.children()[0]},replaceContentfile:function(e,t){$("#cadfile_container_"+e).replaceWith(t),$("#cadUploaded"+GC.Temporary.LiveFiles[e].secure_id).addClass("narrow"),GC.Uploader.removeLiveFile(e)},isHtml5Upload:function(){return $("#cadfile_file_input").hasClass("hidden")},errorHandler:function(e,t,n,i){$.get("/uploads/error",{filestatus:e.filestatus,fileId:e.id,fileIndex:e.index,fileName:e.name,errorCode:t,errorMsg:n,errorString:i},function(e){t==SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT?GC.Uploader.stillUploading(n):t!=SWFUpload.UPLOAD_ERROR.FILE_CANCELLED&&GC.Uploader.stillUploading(e)}),GC.Uploader.isPicture(e)?$('.screenshots li[data-file_id="'+e.id+'"]').remove():$("#cadfile_container_"+e.id).remove(),GC.Uploader.isHtml5Upload()?(null!=GC.Temporary.InPost[e.id]&&(GC.Temporary.TotalSize-=e.totalSize-e.postedSoFar,GC.Temporary.InPost[e.id]=null),GC.Uploader.removeLiveFile(e.id)):GC.Uploader.startUpload()},stillUploading:function(e){$("#stillUploading").remove(),$("body").append('<div id="stillUploading"><div class="body">'+e+"</div></div>"),setTimeout(function(){$("#stillUploading").animate({opacity:0,height:0},500,function(){$("#stillUploading").remove()})},6e3)},removeUpload:function(e){var t=$(e).closest("[data-file_id]"),n=t.attr("data-file_id"),i=$('li[data-file_id="'+n+'"]').data("secure_id");if(!GC.Uploader.isHtml5Upload()){var r=$("#uploader");r.uploadifyCancel(n),GC.Uploader.startUpload(),GC.Temporary.uploadCounter--;var o=GC.Temporary.uploadQueue.indexOf(n);o>=0&&GC.Temporary.uploadQueue.splice(o,1)}t.remove(),0==$("#cads_wrapper .uploadElementWrapper").length&&0==$(".screenshots li").length&&$(".borderWide").hide(),0==$(".screenshots li").length&&$(".uploadContainer").hide(),i&&GC.Uploader.removeFromRenderingQueue(i),GC.Uploader.deleteLiveFile(n)},startUpload:function(e){var t=$("#uploader"),n=window.uploadify_uploader,i=n.getStats();if("undefined"!=typeof e)i.in_progress?GC.Temporary.uploadQueue.push(e):(t.uploadifyUpload(e),GC.Uploader.hideDoneButton());else if(GC.Temporary.uploadQueue.length>0){if(!i.in_progress){var e=GC.Temporary.uploadQueue.shift();t.uploadifyUpload(e)}}else GC.Uploader.showDoneButton()},hideDoneButton:function(){$(".doneButton").fadeOut(400),$("#submitForm").fadeOut(400),$(".popupWin").is(":visible")&&$(".popupFooter .submit").addClass("gray inactive").removeClass("red")},showDoneButton:function(){$(".doneButton").fadeIn(400),$("#submitForm").fadeIn(400),$(".popupWin").is(":visible")&&$(".popupFooter .submit").removeClass("gray inactive").addClass("red")},addLiveFile:function(e){GC.Temporary.LiveFiles[e.id]=e,GC.Uploader.updateButtons(),GC.Uploader.updateRenderingStatusMessage()},processCommitFiles:function(){if(0==GC.Temporary.uploadQueue.length&&GC.Uploader.haveCommitFiles())for(var e in GC.Temporary.CommitFiles)if(GC.Temporary.CommitFiles.hasOwnProperty(e)&&null!=GC.Temporary.CommitFiles[e]&&1>GC.Temporary.Inflight){var t=GC.Temporary.CommitFiles[e],n=GC.Temporary.LiveFiles[e];GC.Temporary.StartCommit=(new Date).getTime(),n.StartCommitTime=(new Date).getTime(),GC.Temporary.CommitFiles[e]=null,t()}},removeLiveFile:function(e){var t=GC.Temporary.LiveFiles[e];if(null!=t&&"undefined"!=typeof t.StartCommitTime){var n=(new Date).getTime()-t.StartCommitTime;GC.Uploader.isPicture(t)?(GC.Temporary.AvgRenderCommitTime=GC.Temporary.AvgRenderCommitTime*GC.Temporary.NRender+n/1e3,GC.Temporary.NRender++,GC.Temporary.AvgRenderCommitTime=GC.Temporary.AvgRenderCommitTime/GC.Temporary.NRender):(GC.Temporary.AvgCadCommitTime=GC.Temporary.AvgCadCommitTime*GC.Temporary.NCad+n/1e3,GC.Temporary.NCad++,GC.Temporary.AvgCadCommitTime=GC.Temporary.AvgCadCommitTime/GC.Temporary.NCad)}GC.Temporary.LiveFiles[e]=null;var i=0,r=0;for(var o in GC.Temporary.LiveFiles)if(GC.Temporary.LiveFiles.hasOwnProperty(o)&&null!=GC.Temporary.LiveFiles[o]){var t=GC.Temporary.LiveFiles[o];GC.Uploader.isPicture(t)?r++:i++}GC.Uploader.updateButtons(),GC.Uploader.processCommitFiles()},deleteLiveFile:function(e){null!=GC.Temporary.LiveFiles[e]&&null==GC.Temporary.InPost[e]&&null==GC.Temporary.CommitFiles[e]&&(GC.Temporary.TotalSize-=GC.Temporary.LiveFiles[e].size,GC.Uploader.totalUploadProgress()),GC.Temporary.LiveFiles[e]=null,GC.Temporary.CommitFiles[e]=null,GC.Uploader.updateButtons(),GC.Uploader.updateRenderingStatusMessage()},haveLive:function(){for(var e in GC.Temporary.LiveFiles)if(GC.Temporary.LiveFiles.hasOwnProperty(e)&&null!=GC.Temporary.LiveFiles[e])return 1;return null!=GC.Temporary.CommitTimer&&(clearInterval(GC.Temporary.CommitTimer),GC.Uploader.totalUploadProgress()),0},haveCommitFiles:function(){for(var e in GC.Temporary.CommitFiles)if(GC.Temporary.CommitFiles.hasOwnProperty(e)&&null!=GC.Temporary.CommitFiles[e])return 1;return 0},updateButtons:function(){GC.Uploader.haveLive()||GC.Uploader.haveCommitFiles()?GC.Uploader.hideDoneButton():(GC.Uploader.showDoneButton(),GC.Temporary.TotalSize=100,GC.Temporary.TotalUploaded=100,GC.Uploader.totalUploadProgress(),0==GC.Temporary.uploadQueue&&(GC.Temporary.StartTime=0,GC.Temporary.TotalSize=0,GC.Temporary.TotalUploaded=0))},openBulkUploadWindow:function(e){return bulkUploadWindow=window.open(e,"bulk_upload","height=420,menubar=no,resizable=yes,scrollbars=yes,toolbar=no,width=630"),Grabcad.metrics.track("click_advanced_uploader_link"),!1},closeBulkUploadWindow:function(){"undefined"==typeof bulkUploadWindow||bulkUploadWindow.closed||bulkUploadWindow.close()},getFileType:function(e){var t=function(e){var t=/^\d+$/;return t.test(e)},n=e.split("."),i="";if(2==n.length){var r=n[n.length-1];i=r}else if(n.length>2){var o=n[n.length-1];i=t(o)?n[n.length-2]:n[n.length-1]}return i},getUploadData:function(e){var t=GC.Uploader.getFileType(e),n=null;return $.ajax({type:"POST",url:"/uploads/contentfile",data:{format:"js",file_type:t,file_name:e,upload_method:"applet",acl:$("#uploadAcl").data("acl")},success:function(e){n=e,GC.Uploader.trackUpload(GC.Uploader.UploadFileStartedApplet)},dataType:"json",async:!1}),n},fileUploaded:function(e,t){e.id=e.secure_id,window.opener.GC.Uploader.addFile(e,t)},fileNameWithPath:function(e,t){var n=e;return t&&""!=t&&(n="/"==t[t.length-1]?t+e:t+"/"+e),n},addFileContainer:function(e){var t=GC.Uploader.isPicture(e),n=GC.Uploader.fileNameWithPath(e.name,e.relative_path),i=null;if(!t)for(var r=$("span.filename"),o=0;r.length>o;o++){var a=$(r[o]);if(a.html()==n){i=a.closest(".cadElement");break}}GC.Uploader.shrinkUploadDropzone();var s=$("#uploader");if($(".submission").removeClass("hidden"),$(".submissionArea").removeClass("hidden"),$("#cadfileForm").slideDown(500),$("#cads_wrapper, .formHeader, .borderWide").show(),GC.Uploader.isPicture(e)){$("#cads_wrapper, .uploadContainer").show();var l=$(".uploadContainer"),u=$("ul.screenshots",l);u.append('<li class="thumbnail" data-file_id="'+e.id+'">'+'<img src="'+Grabcad.configuration.imagePath+'/uploadify/dummy.png" class="imageThumbnail progress" data-source="'+e.id+'" >'+'<a href="#" class="delete" onclick="GC.Uploader.removeUpload(this); return false;"></a>'+"</li>"),s.removeClass("invisible").closest("fieldset").removeClass("invisible").css("height","auto")}else{$("#cads_wrapper").show();var c=$("#cads_wrapper"),d=$("#cadfile_container").clone(!0);d.removeClass("hidden").attr("id","cadfile_container_"+e.id),d.attr("data-file_id",e.id),d.find(".filename").text(n),null==i?c.append(d):i.replaceWith(d),$(".uploadedImageWrapper",d).addClass("hidden")}GC.Uploader.isHtml5Upload()||(s.uploadifySettings("buttonText","Upload more"),$(".uploadifyButtonText").css({padding:"0 20px"}),setTimeout(function(){s.uploadifySettings("width",$("#uploader_button").outerWidth())},500)),GC.Uploader.resizePopup(),GC.Uploader.addLiveFile(e)},addFile:function(e,t){GC.Uploader.addFileContainer(e),GC.Uploader.addFileMetadata(e),$("#cadfile_container_"+e.id+" .uploadStatus").show(),GC.Uploader.cadUploadedToS3(e,t,null,temporaryContentfilesPath)},addFileMetadata:function(e){var t=GC.Uploader.isPicture(e);t?$('li[data-file_id="'+e.id+'"]').data("secure_id",e.secure_id):($("#cadfile_container_"+e.id+" .systemSystem").val(e.system_id),$("#cadfile_container_"+e.id).data("secure_id",e.secure_id))},filesUploaded:function(){window.opener.GC.Uploader.startUpload()},InitDropSupport:function(){var e=/.*(Chrome)\/(\d+).*/,t=/.*(Firefox|Safari)\/(\d+).*/,n=/Macintosh/,i=/Windows/,r=navigator.userAgent,o=r.match(e),a=r.match(t),s=r.match(n),l=r.match(i);GC.Uploader.DragDropFilesFolders=!1,GC.Uploader.DragDropFiles=!1,GC.Uploader.IsMac=!1,GC.Uploader.IsWindows=!1,null!=o&&o[2]>=21?GC.Uploader.DragDropFilesFolders=!0:null!=a&&a[2]>=17&&(GC.Uploader.DragDropFiles=!0),null!=s?GC.Uploader.IsMac=!0:null!=l&&(GC.Uploader.IsWindows=!0)},InitDragDrop:function(){var e=document.getElementById("dropbox"),t=document.getElementById("uploadBtn");$("#uploadBtn").addClass("dropborder");var n=function(e){e.stopPropagation(),e.preventDefault(),$("#uploadBtn").addClass("dropHint"),$("#dropbox").removeClass("hidden")};e.addEventListener("dragenter",n,!1),t.addEventListener("dragenter",n,!1);var i=function(e){e.stopPropagation(),e.preventDefault(),$("#uploadBtn").removeClass("dropHint"),$("#dropbox").addClass("hidden")};e.addEventListener("dragleave",i,!1);var r=function(e){e.stopPropagation(),e.preventDefault()};e.addEventListener("dragexit",r,!1),e.addEventListener("dragover",r,!1);var o=function(e){e.stopPropagation(),e.preventDefault();var t=[],n=0;GC.Uploader.DragDropFilesFolders?(t=e.dataTransfer.items,n=t.length):GC.Uploader.DragDropFiles&&(t=e.dataTransfer.files,n=t.length),n>0&&GC.Uploader.handleFiles(t),$("#uploadBtn").removeClass("dropHint"),$("#dropbox").addClass("hidden")};e.addEventListener("drop",o,!1),$(".browseButtons .browse .browseText").mouseover(function(){$(this).addClass("active")}),$(".browseButtons .browse .browseText").mouseout(function(){$(this).removeClass("active")});var a=function(e){for(var t=0;e.target.files.length>t;t++)e.target.files[t].relative_path=GC.Uploader.DragDropFilesFolders?e.target.files[t].webkitRelativePath.replace(/^\//,"").replace(/(.*\/).*/,"$1"):"",GC.Uploader.addToQueue(e.target.files[t])};$("#hiddenBrowse").change(a),$("#hiddenFolderBrowse").change(a)},createThumb:function(e,t,n){if(null!=GC.Temporary.LiveFiles[t.id]){var i=GC.Uploader.getFileType(t.name).toLowerCase(),r=new Image;r.onload=function(){var n=document.createElement("canvas"),o=n.getContext("2d");n.width=e.width,n.height=e.height;var a=r.width/r.height,s=e.width/e.height;if($(r).css("image-rendering: optimizeQuality"),a>s){var l=r.height,u=l*s;o.drawImage(r,(r.width-u)/2,0,u,l,0,0,n.width,n.height)}else{var u=r.width,l=u/s;o.drawImage(r,0,(r.height-l)/2,u,l,0,0,n.width,n.height)}var c=n.toDataURL("image/"+i),d=$(".uploadContainer").find('li[data-file_id="'+t.id+'"] img');d.attr("src",c),GC.Uploader.replaceScreenshot(d),GC.Uploader.addCommit(t,""),GC.Uploader.processQueue()},r.src=n.result}},thumbs:[{name:"tiny",width:50,height:50}],addThumbToQueue:function(e,t,n){GC.Temporary.uploadQueue.unshift(function(){GC.Uploader.createThumb(e,t,n)}),GC.Uploader.processQueue()},updateThumbs:function(e){if(null!=GC.Temporary.LiveFiles[e.id]){var t=new FileReader;t.onloadend=function(){e.thumbs=GC.Uploader.thumbs.length;for(var n=0;GC.Uploader.thumbs.length>n;n++)GC.Uploader.addThumbToQueue(GC.Uploader.thumbs[n],e,t)}}t.readAsDataURL(e)},addCommit:function(e,t){null!=GC.Temporary.LiveFiles[e.id]&&(GC.Temporary.CommitFiles[e.id]=function(){GC.Temporary.Inflight++,null==GC.Temporary.CommitTimer&&(GC.Temporary.CommitTimer=setInterval(GC.Uploader.totalUploadProgress,500)),GC.Uploader.cadUploadedToS3(e,t,!0,"/temporary_contentfiles")})},uploadFile:function(e){var t=GC.Uploader.getContainer(e);t.data("secure_id",e.secure_id);var n=new XMLHttpRequest;n.upload.addEventListener("progress",function(t){t.lengthComputable&&(0==e.incrementalBytes&&(t.total<e.size?e.possiblyDeleted=1:(e.headerOverhead=t.total-e.size,GC.Temporary.TotalSize+=e.headerOverhead,e.totalSize=e.size+e.headerOverhead)),e.possiblyDeleted||(e.postedSoFar=t.loaded,GC.Uploader.uploadProgress(e,t.loaded,t.total)))},!1),n.addEventListener("load",function(){GC.Uploader.uploadProgress(e,100,100)},!1),n.onreadystatechange=function(){4==n.readyState?(201==n.status?e.possiblyDeleted?GC.Uploader.errorHandler(e,n.status,n.responseText,"File deleted, toUpload < fileSize"):GC.Uploader.isPicture(e)?GC.Uploader.updateThumbs(e):GC.Uploader.addCommit(e,n.responseText):GC.Uploader.errorHandler(e,n.status,n.responseText,null),GC.Temporary.InPost[e.id]=null,GC.Uploader.updateRenderingStatusMessage(),GC.Uploader.processQueue()):1==n.readyState&&(e.startTime=(new Date).getTime(),e.incrementalBytes=0)};var i=new FormData;if(i.append("Filename",e.name),i.append("Policy",e.policy),i.append("AWSAccessKeyId",GC.Uploader.PostData.AWSAccessKeyId),i.append("signature",e.signature),i.append("success_action_status",201),i.append("key",e.key),i.append("acl",e.acl),GC.Uploader.isPicture(e)){var r=GC.Uploader.getFileType(e.name).toLowerCase();"jpg"==r&&(r="jpeg"),i.append("Content-Type","image/"+r)}else i.append("Content-Type","application/octet-stream");i.append("Content-Disposition",'attachment; filename="'+e.name+'"'),i.append("file",e),n.open("POST",GC.Uploader.UploadURL,!0),n.send(i)},sendFile:function(e){null!=GC.Temporary.LiveFiles[e.id]&&$.ajax({type:"post",url:"/uploads/contentfile",dataType:"json",data:{format:"js",file_type:GC.Uploader.getFileType(e.name),relative_path:e.relative_path,file_id:e.id,file_name:e.name,upload_method:"html",acl:$("#uploadAcl").data("acl")},beforeSend:function(){GC.Temporary.Inflight++,GC.Temporary.InPost[e.id]=e},success:function(t){e.key=t.key,e.policy=t.policy,e.system_id=t.system_id,e.secure_id=t.secure_id,e.signature=t.signature,e.acl=t.acl,GC.Uploader.addFileMetadata(e),GC.Temporary.Inflight--,GC.Temporary.uploadQueue.unshift(function(){GC.Uploader.uploadFile(e)}),GC.Uploader.processQueue(),GC.Uploader.trackUpload(GC.Uploader.UploadFileStartedHTML5)},error:function(t,n,i){GC.Temporary.Inflight--,GC.Uploader.errorHandler(e,t.status,t.responseText,i)}})},processQueue:function(){for(;2>GC.Temporary.CheckExistsCount&&GC.Temporary.CheckExistsQueue.length>0;)GC.Temporary.CheckExistsQueue.shift()();for(;2>GC.Temporary.Inflight&&GC.Temporary.uploadQueue.length>0;)0==GC.Temporary.StartTime&&(GC.Temporary.StartTime=(new Date).getTime()),GC.Temporary.uploadQueue.shift()();GC.Uploader.processCommitFiles()},getEntries:function(e){var t=e.createReader(),n=e.fullPath.replace(/^\//,"").replace(/(.+?)\/?$/,"$1/"),i=function(){t.readEntries(function(e){if(e.length>0){for(var t=0;e.length>t;t++){var r=e[t];GC.Uploader.processEntry(r,n)}i()}GC.Uploader.processQueue()},function(e){GC.log("FileSystem API error code: "+e.code)})};i()},addToQueue:function(e){"."!=e.name.charAt(0)&&e.size<GC.Uploader.fileSizeLimit&&(GC.Temporary.CheckExistsQueue.push(function(){var t=function(){e.id="HTML_Upload_"+GC.Temporary.id++,GC.Uploader.addFileContainer(e),GC.Temporary.TotalSize+=e.size,$("#cadfile_container_"+e.id+" .uploadStatus").show(),GC.Temporary.uploadQueue.push(function(){var t=e;GC.Uploader.sendFile(t)}),GC.Uploader.processQueue()};null!=window.folderId?GC.Uploader.checkFileExists(e.name,e.relative_path,window.cadfileId,window.folderId,t,function(){}):t()}),GC.Uploader.processQueue())},processEntry:function(e,t){e.isDirectory?GC.Uploader.getEntries(e):e.isFile&&("function"==typeof e.file?e.file(function(e){e.relative_path=t,GC.Uploader.addToQueue(e)},function(e){GC.log("FileSystem API error code: "+e.code)}):e instanceof File&&(e.relative_path=t,GC.Uploader.addToQueue(e)))},handleFiles:function(e){var t=function(e){e.isDirectory=!1,e.isFile=!0,GC.Uploader.processEntry(e,"")};if(GC.Uploader.DragDropFilesFolders)for(var n=0;e.length>n;n++){var i,r=e[n];r&&r.webkitGetAsEntry&&(i=r.webkitGetAsEntry())&&(i.isFile?t(r.getAsFile()):i.isDirectory&&GC.Uploader.processEntry(i,""))}else if(GC.Uploader.DragDropFiles)for(var n=0;e.length>n;n++){var r=e[n];null!=r&&t(r)}},updateThumbnailS3Image:function(e,t,n){var i=GC.Temporary.RenderIDMap[e],r=$(".uploadContainer").find('li[data-file_id="'+i+'"] img'),o=n?n:"/images/_/illustration-missing-competition.png";r.hasClass("imageThumbnail")?(r.attr("src",o),r.removeClass("imageThumbnail"),r.removeClass("progress"),GC.Uploader.replaceScreenshot(r)):r.hasClass("thumbnailImage")&&!t&&(r.attr("src",o),GC.Uploader.replaceScreenshot(r))},doNothing:function(e){e.preventDefault(),e.stopImmediatePropagation()},enableDoneButton:function(){$("#submitForm").length>0&&$("#submitForm").hasClass("disabled")&&($("#submitForm").unbind("click",GC.Uploader.doNothing),$("#submitForm").removeClass("disabled")),$("#doneButton").length>0&&$("#doneButton").hasClass("disabled")&&($("#doneButtonSpan").attr("onclick",$("#doneButtonSpan").attr("onclick_disabled")).removeAttr("onclick_disabled"),$("#doneButton").removeClass("disabled"))},disableDoneButton:function(){$("#submitForm").length>0&&!$("#submitForm").hasClass("disabled")&&($("#submitForm").click(GC.Uploader.doNothing),$("#submitForm").addClass("disabled")),$("#doneButton").length>0&&!$("#doneButton").hasClass("disabled")&&($("#doneButtonSpan").attr("onclick_disabled",$("#doneButtonSpan").attr("onclick")).removeAttr("onclick"),$("#doneButton").addClass("disabled"))},shrinkUploadDropzone:function(){$(".cadfileUploadSet h1, .uploadSet").slideUp(500),GC.Uploader.isHtml5Upload()?($(".uploadBtn").animate({height:"150px"}),$(".dropbox").animate({height:"150px"})):($(".uploadBtn").animate({height:"100px"}),$(".dropbox").animate({height:"100px"})),$(".dropzoneLeft").animate({width:"100px"}),$(".dropimage").animate({height:"70px","margin-top":"35px"}),$(".dropzoneRight").css({"vertical-align":"top"}),$(".dropzoneRight").css({width:"50%","margin-top":"40px"}),$().animate()},addToRenderingQueue:function(e,t){GC.Uploader.resetRenderingTimer(),GC.Temporary.RenderProcessingQueue.push(t),GC.Temporary.RenderIDMap[t]=e,GC.Uploader.showRenderingAsProcessing(e),GC.Uploader.updateRenderingStatusMessage()},showRenderingAsProcessing:function(e){var t=$('li[data-file_id="'+e+'"]');t.spin({width:2,shadow:!1,color:"#CCC",length:5,radius:7}),t.css({"background-image":"none"})},uploadsInProgress:function(){var e=GC.Temporary.uploadQueue.length;for(var t in GC.Temporary.LiveFiles)GC.Temporary.LiveFiles[t]&&e++;return e},updateRenderingStatusMessage:function(){var e=GC.Uploader.uploadsInProgress();e>0?$(".statusBar").text(""):GC.Uploader.hasMoreRenders()?GC.Temporary.RenderTimedOut?($(".statusBar").text("Processing your renderings is taking a while - they will appear in your project when ready."),$(".statusBar").css({color:"black"}),GC.Uploader.enableDoneButton()):($(".statusBar").text("Processing your renderings, please wait..."),$(".statusBar").css({color:"red"}),GC.Uploader.disableDoneButton()):($(".statusBar").text("Ready to publish!"),$(".statusBar").css({color:"green"}),GC.Uploader.enableDoneButton())},pubnubEventReceived:function(e,t){var n=t.secure_id;GC.Uploader.removeFromRenderingQueue(n),GC.Uploader.updateThumbnailS3Image(n,e,t.url)},hasMoreRenders:function(){return GC.Temporary.RenderProcessingQueue.length>0},removeFromRenderingQueue:function(e){var t=$.inArray(e,GC.Temporary.RenderProcessingQueue);$('li[data-file_id="'+GC.Temporary.RenderIDMap[e]+'"]').spin(!1),t>=0&&(GC.Temporary.RenderProcessingQueue.splice(t,1),GC.Temporary.RenderProcessedCount++,GC.Uploader.updateRenderingStatusMessage())},resetRenderingTimer:function(){GC.Temporary.RenderTimedOut=!1,GC.Temporary.RenderTimer&&clearTimeout(GC.Temporary.RenderTimer),GC.Temporary.RenderTimer=setTimeout(GC.Uploader.renderingTimeoutFired,GC.Uploader.RenderingTimeout)},renderingTimeoutFired:function(){GC.Temporary.RenderTimedOut=!0,GC.Temporary.RenderTimer=null,GC.Uploader.updateRenderingStatusMessage()},RenderingTimeout:18e4,UploadEventType:"UploadLibrary",UploadFileStartedFlash:"fileStartedFlash",UploadFileStartedHTML5:"fileStartedHTML5",UploadFileStartedApplet:"fileStartedApplet",UploadBatchCanceled:"batchCanceled",UploadBatchConfirmed:"batchConfirmed",UploadFileCompleted:"fileCompleted",trackUpload:function(e){Analytical&&Analytical.custom_event&&Analytical.custom_event(GC.Uploader.UploadEventType,e,batch_id)},reattachCancelPopup:function(){$(".confirmCancelPopup").popup({escCloses:!1,clickCloses:!1,showClose:!1,size:"small",buttonAction:"cancel",confirmAction:!0})}}}(),GC.Tags=function(){var e=["yes","no","and","the","th","teh","a","an","to","in","from","of","img","what","who","where","why","is","this","that","i","you","we","them"];return{init:function(){if(GC.log("Tags init started","info"),0==$("#cadfileForm").length)return GC.log("No upload form, returning","info"),void 0;var t=function(t){GC.log("Leaving only the good stuff from “"+t+"”","info"),t=t.replace(/[~!?,."'‘’“”’*_=\^\/+\\<>(){}\[\]\d]/gi,"").toLowerCase();var n=t.split(" "),r=[];if(n.length>0)for(i in n)0>$.inArray(n[i],e)&&n[i].length>1&&r.push(n[i]);return r=r.unique()};$("#fileUploadName").live("keyup",function(){$(this),GC.Tags.nameTags=t($(this).val())}),$("#fileUploadDescription").live("keyup",function(){$(this),GC.Tags.descriptionTags=t($(this).val())}),$("#fileUploadTags").live("focus",function(){GC.log("Left name or description field","info");var e=$("#fileUploadTags");GC.Tags.nameTags=t($("#fileUploadName").val()),GC.Tags.descriptionTags=t($("#fileUploadDescription").val());var n=t($("#fileUploadTags").val()),i=[];$(".linkToFile").each(function(){var e=$(this).text(),n=e.split(".");n.length>0&&(e=n[0],e=e.replace(/[_-]/gi," "),filenameParts=t(e),i=i.concat(filenameParts))}),GC.log("Merging different word arrays together","info");var r=GC.Tags.nameTags.concat(GC.Tags.descriptionTags,n,i);0==$("#tagSuggestions").length&&$("#fileUploadTags").after('<span id="tagSuggestions"></span>'),r=r.unique(),GC.Tags.keywords=r,GC.Tags.runningSuggestion&&"function"==typeof GC.Tags.runningSuggestion.abort&&(GC.Tags.runningSuggestion.abort(),GC.log("Aborted an already running Ajax call for tags","info")),GC.Tags.keywords&&GC.Tags.keywords.length>0?($("#tagSuggestions").html('<span class="title">'+e.attr("data-loadingstring")+"</span>"),GC.log("Will try to get suggestions for: “"+GC.Tags.keywords.join(" ")+"”","info"),GC.Tags.runningSuggestion=$.ajax({url:e.attr("data-tagurl"),data:{keywords:GC.Tags.keywords.join(" ")},type:"get",cache:!1,dataType:"json",success:function(e,t){if(GC.log("Got succes back from tags Ajax call","info"),$("#tagSuggestions").html(""),e&&"success"==t)if("undefined"!=typeof e.tags&&e.tags.length>0){var n=GC.Tags.keywords.concat(e.tags);n=n.unique(),GC.Tags.suggest(n.sort(),e.title)}else $("#tagSuggestions").html("")},error:function(){GC.log("There was an error in tags suggestion ajax call","error"),$("#tagSuggestions").html("")}})):$("#tagSuggestions").html("")}),$(".addTag").live("click",function(e){e.preventDefault();var t=$(this);GC.log("Clicked on “addTag” link with tag “"+t.text()+"”","info"),$("#fileUploadTags").val($("#fileUploadTags").val()+" "+t.text()),t.remove(),0==$(".addTag").length&&$("#tagSuggestions").html("")})},suggest:function(e,t){GC.log("Suggesting the following tags “"+e.join(" ")+"”","info"),0==$("#tagSuggestions").length&&$("#fileUploadTags").after('<span id="tagSuggestions"></span>');for(var n=$("#fileUploadTags").val().split(" "),i=[],r=0;e.length>r;r++)0>$.inArray(e[r],n)&&i.push(e[r]);$("#tagSuggestions").html("");var o='<span class="title">'+t+"</span>";if(0!=i.length){for(var r=0;i.length>r;r++)o+='<a href="" class="addTag">'+i[r]+"</a>";$("#tagSuggestions").append(o)}},nameTags:[],descriptionTags:[],keywords:[],runningSuggestion:!1}}(),function(e){var t=function(t,n){var i=n,r=function(){e(".searchArea").animate({height:140},100,function(){e(".advancedSearchLink").hide(),e(".searchItem.advanced",e(this)).fadeIn(400)})},o=function(){a(),s(),l()},a=function(){e(".searchItem.query input").val("")},s=function(){e(".searchItem.selection .input a").text(""),e(".searchItem.selection input[type=hidden]").val(""),e(".searchItem.selection .reset").hide(),e(".searchItem.selection.disableable .input").addClass("disabled"),e(".searchItem.selection.disableable .arrow").hide()},l=function(){e(".searchItem.choice input[type=checkbox]").attr("checked",!1)},u=function(){var t=!1;e(".searchItem.advanced.selection .input").each(function(){var n=e(this);""!=e.trim(n.text())&&(t=!0)}),e(".searchItem.advanced.choice input[type=checkbox]").each(function(){var n=e(this);n.attr("checked")&&(t=!0)}),(t||i.showAdvanced)&&r()},c=function(){e(".advancedSearchLink").click(function(){r()}),e(".searchItem.advanced.reset").click(function(){o()}),e(".searchItem.choice .label").click(function(){var t=e(this).siblings("input[type=checkbox]");t.attr("checked",!t.attr("checked"))})};this.initialize=function(){u(),c()}};e.fn.search=function(n){var i=e.extend({},e.fn.search.defaults,n);return this.each(function(){var n=e(this);new t(n,i).initialize()})},e.fn.search.defaults={showAdvanced:!1}}(jQuery),function(e){var t=function(n,i){var r,o=e(n),a=i,s=this,l=[],u=!1,c=function(e){var t=a.scrollable?"scrollable":"";return'<div class="selection layout"><span class="arrow"></span><div class="content '+t+'">'+e+"</div></div>"},d=function(){return o.data("items-target")},f=function(){u||(r.css("min-width",o.width()),r.css({left:o.offset().left,marginLeft:(o.outerWidth()-r.outerWidth())/2,top:o.offset().top+o.outerHeight()}))},p=function(){var t=e(d()).html();r=e(c(t)),r.hide(),e("body").append(r)},h=function(){o.after('<span class="reset"></span><span class="arrow down"></span>'),""!=e.trim(o.text())&&o.siblings(".reset").show()},m=function(){var n=e(o.data("nested-target"));n.each(function(n,i){var r=new t(e(i),a);r.initialize(),l.push(r)})},g=function(){e.each(l,function(e,t){t.reset()})},v=function(t){var n=e(t);e.each(l,function(t,i){i.setItems(n),n.length>0&&e.trim(n.text()).length>0?i.enable():i.disable()})};this.hideAll=function(){e(".arrow").removeClass("up").addClass("down"),e(".selection.layout").hide()},this.getSelectedItem=function(){return s.findItem(s.getValue())},this.getNestedItems=function(){return s.getSelectedItem().siblings(".nested")},this.findItem=function(e){return r.find("a[data-value="+e+"]")},this.setItems=function(t){e(".content",r).html(e(t).html())},this.getValue=function(){return e(o.data("value-target")).val()},this.setValue=function(t){e(o.data("value-target")).val(t)},this.getText=function(){return o.text()},this.setText=function(e){o.text(e)},this.isDisabled=function(){return o.parent().hasClass("disabled")},this.disable=function(){o.parent().addClass("disabled"),o.siblings(".arrow").hide(),s.hide()},this.enable=function(){o.parent().removeClass("disabled"),o.siblings(".arrow").show()},this.reset=function(){s.setText(""),s.setValue(null),o.siblings(".reset").hide(),v("")},this.show=function(){s.hideAll(),o.siblings(".arrow").removeClass("down").addClass("up"),r.show()},this.hide=function(){o.siblings(".arrow").removeClass("up").addClass("down"),r.hide()},this.itemSelected=function(t){var n=e(t);a.itemSelected(n),v(n.siblings(".nested")),g(),s.setValue(a.itemValue(n)),s.setText(a.itemName(n)),s.hide(),o.siblings(".reset").show()};var y=function(){o.click(function(e){e.stopPropagation(),e.preventDefault(),s.isDisabled()||(f(),r.is(":visible")?s.hide():s.show())}),o.siblings(".reset").click(function(){s.reset()}),r.click(function(e){e.stopPropagation()}),r.on("click","a",function(e){e.preventDefault(),s.itemSelected(this)}),e(document).click(s.hide),e(window).resize(function(){f()})};this.initialize=function(){p(),h(),m(),y(),v(s.getNestedItems())}};e.fn.selection=function(n){var i=e.extend({},e.fn.selection.defaults,n);return this.each(function(){var n=e(this);new t(n,i).initialize()})},e.fn.selection.defaults={itemSelected:function(){},itemValue:function(t){return e(t).data("value")},itemName:function(t){return e(t).text()},scrollable:!1}}(jQuery);var SearchBootstrapper=function(){this.boot=function(){$(".searchArea").search()}};bootstrapper.register(new SearchBootstrapper);var SelectionBootstrapper=function(){this.boot=function(){$(".searchArea .selection:not(.scrollable) a:not(.nested)").selection(),$(".searchArea .selection.scrollable a").selection({scrollable:!0})}};bootstrapper.register(new SelectionBootstrapper),$(function(){GC.WindowController.init(),GC.Uploader.init()});