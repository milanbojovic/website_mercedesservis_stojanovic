function RGBColor(e){this.ok=!1,"#"==e.charAt(0)&&(e=e.substr(1,6)),e=e.replace(/ /g,""),e=e.toLowerCase();var t={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(var n in t)e==n&&(e=t[n]);for(var i=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(e){return[parseInt(e[1]),parseInt(e[2]),parseInt(e[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}}],r=0;i.length>r;r++){var o=i[r].re,a=i[r].process,s=o.exec(e);s&&(channels=a(s),this.r=channels[0],this.g=channels[1],this.b=channels[2],this.ok=!0)}this.r=0>this.r||isNaN(this.r)?0:this.r>255?255:this.r,this.g=0>this.g||isNaN(this.g)?0:this.g>255?255:this.g,this.b=0>this.b||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var e=this.r.toString(16),t=this.g.toString(16),n=this.b.toString(16);return 1==e.length&&(e="0"+e),1==t.length&&(t="0"+t),1==n.length&&(n="0"+n),"#"+e+t+n},this.getHelpXML=function(){for(var e=new Array,n=0;i.length>n;n++)for(var r=i[n].example,o=0;r.length>o;o++)e[e.length]=r[o];for(var a in t)e[e.length]=a;var s=document.createElement("ul");s.setAttribute("id","rgbcolor-examples");for(var n=0;e.length>n;n++)try{var l=document.createElement("li"),c=new RGBColor(e[n]),u=document.createElement("div");u.style.cssText="margin: 3px; border: 1px solid black; background:"+c.toHex()+"; "+"color:"+c.toHex(),u.appendChild(document.createTextNode("test"));var d=document.createTextNode(" "+e[n]+" -> "+c.toRGB()+" -> "+c.toHex());l.appendChild(u),l.appendChild(d),s.appendChild(l)}catch(h){}return s}}function SceneJS_webgl_ensureImageSizePowerOfTwo(e){if(!SceneJS_webgl_isPowerOfTwo(e.width)||!SceneJS_webgl_isPowerOfTwo(e.height)){var t=document.createElement("canvas");t.width=SceneJS_webgl_nextHighestPowerOfTwo(e.width),t.height=SceneJS_webgl_nextHighestPowerOfTwo(e.height);var n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height),e=t}return e}function SceneJS_webgl_isPowerOfTwo(e){return 0==(e&e-1)}function SceneJS_webgl_nextHighestPowerOfTwo(e){--e;for(var t=1;32>t;t<<=1)e|=e>>t;return e+1}function dtmlXMLLoaderObject(e,t,n,i){return this.xmlDoc="",this.async="undefined"!=typeof n?n:!0,this.onloadAction=e||null,this.mainObject=t||null,this.waitCall=null,this.rSeed=i||!1,this}function callerFunction(e,t){return this.handler=function(n){return n||(n=window.event),e(n,t),!0}}function getAbsoluteLeft(e){return getOffset(e).left}function getAbsoluteTop(e){return getOffset(e).top}function getOffsetSum(e){for(var t=0,n=0;e;)t+=parseInt(e.offsetTop),n+=parseInt(e.offsetLeft),e=e.offsetParent;return{top:t,left:n}}function getOffsetRect(e){var t=e.getBoundingClientRect(),n=document.body,i=document.documentElement,r=window.pageYOffset||i.scrollTop||n.scrollTop,o=window.pageXOffset||i.scrollLeft||n.scrollLeft,a=i.clientTop||n.clientTop||0,s=i.clientLeft||n.clientLeft||0,l=t.top+r-a,c=t.left+o-s;return{top:Math.round(l),left:Math.round(c)}}function getOffset(e){return e.getBoundingClientRect?getOffsetRect(e):getOffsetSum(e)}function convertStringToBoolean(e){switch("string"==typeof e&&(e=e.toLowerCase()),e){case"1":case"true":case"yes":case"y":case 1:case!0:return!0;default:return!1}}function getUrlSymbol(e){return-1!=e.indexOf("?")?"&":"?"}function dhtmlDragAndDropObject(){return window.dhtmlDragAndDrop?window.dhtmlDragAndDrop:(this.dragStartObject=this.dragStartNode=this.dragNode=this.lastLanding=0,this.tempDOMM=this.tempDOMU=null,this.waitDrag=0,window.dhtmlDragAndDrop=this,this)}function j(){return this.catches||(this.catches=[]),this}function dhtmlXHeir(e,t){for(var n in t)"function"==typeof t[n]&&(e[n]=t[n]);return e}function dhtmlxEvent(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)}/*
Copyright DHTMLX LTD. http://www.dhtmlx.com
dhtmlxSlider is distributed under Free license
*/
function dhtmlxSlider(e,t,n,i,r,o,a,s){if(_isIE)try{document.execCommand("BackgroundImageCache",!1,!0)}catch(l){}var c;if(e&&"object"==typeof e&&!e.nodeName&&(c=e.parent,n=e.skin,r=e.min,o=e.max,s=e.step,i=e.vertical,a=e.value,t=e.size),e)c="object"!=typeof e?document.getElementById(e):e;else{var u="slider_div_"+(new Date).valueOf()+Math.random(1e3);c=document.createElement("div"),c.setAttribute("id",u);for(var d=document.body.lastChild;d.lastChild&&1==d.lastChild.nodeType;)d=d.lastChild;d.parentNode.insertBefore(c,d)}return"object"==typeof t&&(n=t.skin,r=t.min,o=t.max,s=t.step,i=t.vertical,a=t.value,t=t.size),this.size=t,this.vMode=i||!1,this.skin=dhtmlx.skin||n||"default",this.parent=c,this.disabled=this.isInit=!1,this.value="undefined"==a?r||0:a,this.inputPriority=!0,this.stepping=!1,this.imgURL=window.dhx_globalImgPath||dhtmlx.image_path||"",this._skinsImgs={"default":{ls:1,lz:1,rz:1,rs:1},ball:{ls:1,lz:1,rz:1,rs:1},zipper:{bg:1,lz:1,rz:1},arrow:{bg:1,ls:1,rs:1},arrowgreen:{bg:1,ls:1,rs:1},simplesilver:{lz:1,ls:1,rs:1,rz:1},simplegray:{lz:1,ls:1,rs:1,rz:1},bar:{bg:1,ls:1,rs:1},dhx_skyblue:{bg:1}},this._def=[r-0||0,o-0||100,s-0||1,a-0||0,t-0],dhtmlxEventable(this),this}function computeBoundingBox(e,t,n){t.set(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),n.set(-Number.POSITIVE_INFINITY,-Number.POSITIVE_INFINITY,-Number.POSITIVE_INFINITY);for(var i=0;e.length>i;i+=3)e[i]<t.x?t.x=e[i]:e[i]>n.x&&(n.x=e[i]),e[i+1]<t.y?t.y=e[i+1]:e[i+1]>n.y&&(n.y=e[i+1]),e[i+2]<t.z?t.z=e[i+2]:e[i+2]>n.z&&(n.z=e[i+2])}function generatePointsOnCircle(e,t,n,i,r){var o=0,a=2*Math.PI/i;for(o=0;i>o;o++)e[o]=new AnnotatorHoopsPoint(0,n*Math.cos(a*o),n*Math.sin(a*o));e[i]=new AnnotatorHoopsPoint(0,0,0),e[i].setFromHoopsPoint(e[0]);var s=new AnnotatorHoopsPoint(0,0,0),l=new AnnotatorHoopsPoint(0,0,0);r.oneVectorCross(s),computeCrossProduct(s,r,l),s.normalize(),l.normalize();var c=new Array(4);for(c[0]=new Array(4),c[1]=new Array(4),c[2]=new Array(4),c[3]=new Array(4),c[0][3]=c[1][3]=c[2][3]=0,c[0][0]=r.x,c[0][1]=r.y,c[0][2]=r.z,c[1][0]=s.x,c[1][1]=s.y,c[1][2]=s.z,c[2][0]=l.x,c[2][1]=l.y,c[2][2]=l.z,c[3][0]=0,c[3][1]=0,c[3][2]=0,c[3][3]=1,applyAlternativeTransformationToPoints(e,c),o=0;i>=o;o++)e[o].set(e[o].x+t.x,e[o].y+t.y,e[o].z+t.z)}function computeDistanceBetweenPolygons(e,t,n,i){var r,o,a,s,l,c,u,d,h,p=1e6,f=new AnnotatorHoopsPoint(0,0,0),m=new AnnotatorHoopsPoint(0,0,0);for(r=0;3>r;r++){if(2>r?(o=r,a=r+1):(o=r,a=0),computeIntersectionOfPlanePointsAndLine(e[o],e[a],t[0],t[1],t[2],f)&&(u=new AnnotatorHoopsPoint(f.x,f.y,f.z),u.sub(e[o]),d=new AnnotatorHoopsPoint(f.x,f.y,f.z),d.sub(e[a]),0>=u.dot(d)&&isPointInPolygon(f,t)))return p=0,n.setFromHoopsPoint(f),i.setFromHoopsPoint(f),p;for(s=0;3>s;s++)2>s?(l=s,c=s+1):(l=s,c=0),m=new AnnotatorHoopsPoint(0,0,0),h=computeDistanceBetweenFourLines(e[o],e[a],t[l],t[c],f,m),p>h&&(p=h,n.setFromHoopsPoint(f),i.setFromHoopsPoint(m))}for(s=0;3>s;s++)if(2>s?(l=s,c=s+1):(l=s,c=0),computeIntersectionOfPlanePointsAndLine(t[l],t[c],e[0],e[1],e[2],f)&&(u=new AnnotatorHoopsPoint(f.x,f.y,f.z),u.sub(t[l]),d=new AnnotatorHoopsPoint(f.x,f.y,f.z),d.sub(t[c]),0>=u.dot(d)&&isPointInPolygon(f,e)))return p=0,n.setFromHoopsPoint(f),i.setFromHoopsPoint(f),p;for(r=0;3>r;r++)h=computeDistanceBetweenPointsAndPolygon(e[r],t,f),Number.POSITIVE_INFINITY>h&&p>h&&(p=h,i.setFromHoopsPoint(f),n.setFromHoopsPoint(e[r]));for(r=0;3>r;r++)h=computeDistanceBetweenPointsAndPolygon(t[r],e,f),Number.POSITIVE_INFINITY>h&&p>h&&(p=h,n.setFromHoopsPoint(f),i.setFromHoopsPoint(t[r]));return p}function computeDistanceBetweenPointsAndPolygon(e,t,n){n.set(0,0,0);var i=Number.POSITIVE_INFINITY;if(isPointInPolygon(e,t)){var r=new AnnotatorPlaneClass;r.calculateFromTriangleArray(t),i=Math.abs((r.n.x*e.x+r.n.y*e.y+r.n.z*e.z+r.d)/Math.sqrt(r.n.x*r.n.x+r.n.y*r.n.y+r.n.z*r.n.z));var o=new AnnotatorHoopsPoint(e.x+r.n.x,e.y+r.n.y,e.z+r.n.z);r.computeIntersectionWithLine(e,o,n)}return i}function isPointInPolygon(e,t){var n,i,r,o=new AnnotatorPlaneClass;for(o.calculateFromTriangleArray(t),n=0;3>n;n++){2>n?(i=n,r=n+1):(i=n,r=0);var a=new AnnotatorPlaneClass,s=new Array(3);s[0]=new AnnotatorHoopsPoint(t[i].x,t[i].y,t[i].z),s[1]=new AnnotatorHoopsPoint(t[r].x,t[r].y,t[r].z),s[2]=new AnnotatorHoopsPoint(t[i].x+o.n.x,t[i].y+o.n.y,t[i].z+o.n.z),a.calculateFromTriangleArray(s);var l=(a.n.x*e.x+a.n.y*e.y+a.n.z*e.z+a.d)/Math.sqrt(a.n.x*a.n.x+a.n.y*a.n.y+a.n.z*a.n.z);if(l>0)return!1}return!0}function computeDistanceBetweenPointAndLine(e,t,n,i){var r=new AnnotatorHoopsPoint(0,0,0);r.subtract(n,t);var o=r.length(),a=((e.x-t.x)*(n.x-t.x)+(e.y-t.y)*(n.y-t.y)+(e.z-t.z)*(n.z-t.z))/(o*o);r.set(r.x*a,r.y*a,r.z*a),i.set(t.x+r.x,t.y+r.y,t.z+r.z);var s=new AnnotatorHoopsPoint(0,0,0);return s.subtract(e,i),s.length()}function computeAngleBetweenVectors(e,t){var n=new AnnotatorHoopsPoint(0,0,0),i=new AnnotatorHoopsPoint(e.x,e.y,e.z),r=new AnnotatorHoopsPoint(t.x,t.y,t.z);i.normalize(),r.normalize(),computeCrossProduct(i,r,n),computeCrossProduct(i,r,n);var o=computeDotProduct(i,r),a=n.length(),s=Math.atan2(a,o);return s*=180/Math.PI}function computeIntersectionOfPlanes(e,t,n,i){var r=new AnnotatorHoopsPoint(0,0,0);computeCrossProduct(e.n,t.n,r);var o=r.x>=0?r.x:-r.x,a=r.y>=0?r.y:-r.y,s=r.z>=0?r.z:-r.z;if(1e-7>o+a+s){var l=new AnnotatorHoopsPoint(0,0,0);return l.subtract(t.V0,e.V0),0==computeDotProduct(e.n,l)?1:0}var c;c=o>a?o>s?1:3:a>s?2:3;var u,d,h=new AnnotatorHoopsPoint(0,0,0);switch(u=-computeDotProduct(e.n,e.V0),d=-computeDotProduct(t.n,t.V0),c){case 1:h.x=0,h.y=(d*e.n.z-u*t.n.z)/r.x,h.z=(u*t.n.y-d*e.n.y)/r.x;break;case 2:h.x=(u*t.n.z-d*e.n.z)/r.y,h.y=0,h.z=(d*e.n.x-u*t.n.x)/r.y;break;case 3:h.x=(d*e.n.y-u*t.n.y)/r.z,h.y=(u*t.n.x-d*e.n.x)/r.z,h.z=0}return n.setFromHoopsPoint(h),i.set(h.x+r.x,h.y+r.y,h.z+r.z),2}function computeIntersectionOfPlaneAndLine(e,t,n,i){var r=n.n.x*(t.x-e.x)+n.n.y*(t.y-e.y)+n.n.z*(t.z-e.z);if(1e-5>Math.abs(r))return!1;var o=-(n.d+n.n.x*e.x+n.n.y*e.y+n.n.z*e.z)/r;return i.x=e.x+o*(t.x-e.x),i.y=e.y+o*(t.y-e.y),i.z=e.z+o*(t.z-e.z),0>o||o>1?!1:!0}function computeIntersectionOfPlanePointsAndLine(e,t,n,i,r,o){var a=new AnnotatorPlaneClass;return a.n.x=(i.y-n.y)*(r.z-n.z)-(i.z-n.z)*(r.y-n.y),a.n.y=(i.z-n.z)*(r.x-n.x)-(i.x-n.x)*(r.z-n.z),a.n.z=(i.x-n.x)*(r.y-n.y)-(i.y-n.y)*(r.x-n.x),a.n.normalize(),a.d=-a.n.x*n.x-a.n.y*n.y-a.n.z*n.z,computeIntersectionOfPlaneAndLine(e,t,a,o)}function computeDistanceBetweenFourLines(e,t,n,i,r,o){var a=0,s=0,l=new AnnotatorHoopsPoint(0,0,0);l.subtract(t,e);var c=new AnnotatorHoopsPoint(0,0,0);c.subtract(i,n);var u,d,h,p,f,m,g,v,y,b=computeDotProduct(l,e),_=computeDotProduct(l,c),w=computeDotProduct(l,l),S=computeDotProduct(l,n),x=computeDotProduct(c,c),C=computeDotProduct(c,n),$=computeDotProduct(c,e),E=computeDotProduct(l,i),T=computeDotProduct(c,t);u=w*x-_*_,0==u?(0!=w?(m=(S-b)/w,0>m?m=0:m>1&&(m=1),v=(E-b)/w,0>v?v=0:v>1&&(v=1)):(m=0,v=0),0!=x?(g=($-C)/x,0>g?g=0:g>1&&(g=1),y=(T-C)/x,0>y?y=0:y>1&&(y=1)):(g=0,y=0),a=(m+v)/2,s=(g+y)/2):(d=_*$-_*C-x*b+x*S,h=w*$-w*C+_*S-_*b,p=d/u,f=h/u,m=(S-b)/w,g=($-C)/x,v=(E-b)/w,y=(T-C)/x,p>=0&&1>=p&&f>=0&&1>=f?(a=p,s=f):0>p&&f>=0&&1>=f?(a=p,s=g):p>1&&f>=0&&1>=f?(a=p,s=y):p>=0&&1>=p&&0>f?(a=m,s=f):p>=0&&1>=p&&f>1?(a=v,s=f):0>p&&0>f?(a=m,s=g):0>p&&f>1?(a=v,s=g):p>1&&0>f?(a=m,s=y):p>1&&f>1&&(a=v,s=y),0>a?a=0:a>1&&(a=1),0>s?s=0:s>1&&(s=1)),r.x=a*l.x+e.x,r.y=a*l.y+e.y,r.z=a*l.z+e.z,o.x=s*c.x+n.x,o.y=s*c.y+n.y,o.z=s*c.z+n.z;var k=new AnnotatorHoopsPoint(0,0,0);k.subtract(o,r);var A=k.length();return A}function setSimpleColumnBasis(e,t,n,i){e[0][0]=t.x,e[1][0]=t.y,e[2][0]=t.z,e[3][0]=0,e[0][1]=n.x,e[1][1]=n.y,e[2][1]=n.z,e[3][1]=0,e[0][2]=i.x,e[1][2]=i.y,e[2][2]=i.z,e[3][2]=0,e[0][3]=0,e[1][3]=0,e[2][3]=0,e[3][3]=1}function setColumnBasis(e,t,n,i,r){e[0][0]=t.x,e[1][0]=t.y,e[2][0]=t.z,e[3][0]=r.x,e[0][1]=n.x,e[1][1]=n.y,e[2][1]=n.z,e[3][1]=r.y,e[0][2]=i.x,e[1][2]=i.y,e[2][2]=i.z,e[3][2]=r.z,e[0][3]=0,e[1][3]=0,e[2][3]=0,e[3][3]=1}function setMatrixScale(e,t,n,i){e[0][0]=t,e[0][1]=0,e[0][2]=0,e[0][3]=0,e[1][0]=0,e[1][1]=n,e[1][2]=0,e[1][3]=0,e[2][0]=0,e[2][1]=0,e[2][2]=i,e[2][3]=0,e[3][0]=0,e[3][1]=0,e[3][2]=0,e[3][3]=1}function applyTransformationToPoints(e,t){for(var n=new AnnotatorHoopsPoint(0,0,0),i=0;e.length/3>i;i++)n.x=e[3*i]*t[0][0]+e[3*i+1]*t[1][0]+e[3*i+2]*t[2][0]+t[3][0],n.y=e[3*i]*t[0][1]+e[3*i+1]*t[1][1]+e[3*i+2]*t[2][1]+t[3][1],n.z=e[3*i]*t[0][2]+e[3*i+1]*t[1][2]+e[3*i+2]*t[2][2]+t[3][2],e[3*i]=n.x,e[3*i+1]=n.y,e[3*i+2]=n.z}function applyAlternativeTransformationToPoints(e,t){for(var n=new AnnotatorHoopsPoint(0,0,0),i=0;e.length>i;i++)n.x=e[i].x*t[0][0]+e[i].y*t[1][0]+e[i].z*t[2][0]+t[3][0],n.y=e[i].x*t[0][1]+e[i].y*t[1][1]+e[i].z*t[2][1]+t[3][1],n.z=e[i].x*t[0][2]+e[i].y*t[1][2]+e[i].z*t[2][2]+t[3][2],e[i].x=n.x,e[i].y=n.y,e[i].z=n.z}function computeTransformedPoint(e,t,n){var i=e.x*t[0][0]+e.y*t[1][0]+e.z*t[2][0]+t[3][0],r=e.x*t[0][1]+e.y*t[1][1]+e.z*t[2][1]+t[3][1],o=e.x*t[0][2]+e.y*t[1][2]+e.z*t[2][2]+t[3][2];n.set(i,r,o)}function computeAlternativelyTransformedPoint(e,t,n,i){return i.x=e.x*n[0][0]+e.y*n[1][0]+e.z*n[2][0]+n[3][0]*t,i.y=e.x*n[0][1]+e.y*n[1][1]+e.z*n[2][1]+n[3][1]*t,i.z=e.x*n[0][2]+e.y*n[1][2]+e.z*n[2][2]+n[3][2]*t,e.x*n[0][3]+e.y*n[1][3]+e.z*n[2][3]+n[3][3]*t}function convertDegreesToRadians(e){return e*(Math.PI/180)}function computeOffAxisRotation(e,t,n){var i,r,t=convertDegreesToRadians(t);r=Math.cos(t),i=Math.sin(t);var e=new AnnotatorHoopsPoint(e.x,e.y,e.z);e.normalize();var o=1-r,a=o*e.x*e.y,s=o*e.x*e.z,l=o*e.y*e.z;n[0][0]=o*e.x*e.x+r,n[0][1]=i*e.z+a,n[0][2]=s-i*e.y,n[0][3]=0,n[1][0]=a-i*e.z,n[1][1]=o*e.y*e.y+r,n[1][2]=i*e.x+l,n[1][3]=0,n[2][0]=i*e.y+s,n[2][1]=l-i*e.x,n[2][2]=o*e.z*e.z+r,n[2][3]=0,n[3][0]=0,n[3][1]=0,n[3][2]=0,n[3][3]=1}function setMatrixFromArray(e,t){t[0][0]=e[0],t[0][1]=e[1],t[0][2]=e[2],t[0][3]=e[3],t[1][0]=e[4],t[1][1]=e[5],t[1][2]=e[6],t[1][3]=e[7],t[2][0]=e[8],t[2][1]=e[9],t[2][2]=e[10],t[2][3]=e[11],t[3][0]=e[12],t[3][1]=e[13],t[3][2]=e[14],t[3][3]=e[15]}function multiplyMatrices(e,t,n){var i=[[],[],[],[]];i[0][0]=e[0][0]*t[0][0]+e[0][1]*t[1][0]+e[0][2]*t[2][0]+e[0][3]*t[3][0],i[0][1]=e[0][0]*t[0][1]+e[0][1]*t[1][1]+e[0][2]*t[2][1]+e[0][3]*t[3][1],i[0][2]=e[0][0]*t[0][2]+e[0][1]*t[1][2]+e[0][2]*t[2][2]+e[0][3]*t[3][2],i[0][3]=e[0][0]*t[0][3]+e[0][1]*t[1][3]+e[0][2]*t[2][3]+e[0][3]*t[3][3],i[1][0]=e[1][0]*t[0][0]+e[1][1]*t[1][0]+e[1][2]*t[2][0]+e[1][3]*t[3][0],i[1][1]=e[1][0]*t[0][1]+e[1][1]*t[1][1]+e[1][2]*t[2][1]+e[1][3]*t[3][1],i[1][2]=e[1][0]*t[0][2]+e[1][1]*t[1][2]+e[1][2]*t[2][2]+e[1][3]*t[3][2],i[1][3]=e[1][0]*t[0][3]+e[1][1]*t[1][3]+e[1][2]*t[2][3]+e[1][3]*t[3][3],i[2][0]=e[2][0]*t[0][0]+e[2][1]*t[1][0]+e[2][2]*t[2][0]+e[2][3]*t[3][0],i[2][1]=e[2][0]*t[0][1]+e[2][1]*t[1][1]+e[2][2]*t[2][1]+e[2][3]*t[3][1],i[2][2]=e[2][0]*t[0][2]+e[2][1]*t[1][2]+e[2][2]*t[2][2]+e[2][3]*t[3][2],i[2][3]=e[2][0]*t[0][3]+e[2][1]*t[1][3]+e[2][2]*t[2][3]+e[2][3]*t[3][3],i[3][0]=e[3][0]*t[0][0]+e[3][1]*t[1][0]+e[3][2]*t[2][0]+e[3][3]*t[3][0],i[3][1]=e[3][0]*t[0][1]+e[3][1]*t[1][1]+e[3][2]*t[2][1]+e[3][3]*t[3][1],i[3][2]=e[3][0]*t[0][2]+e[3][1]*t[1][2]+e[3][2]*t[2][2]+e[3][3]*t[3][2],i[3][3]=e[3][0]*t[0][3]+e[3][1]*t[1][3]+e[3][2]*t[2][3]+e[3][3]*t[3][3];for(var r=0;4>r;r++)for(var o=0;4>o;o++)n[r][o]=i[r][o]}function alternativelyMultiplyMatrices(e,t,n){var i=new Array(16);i[0]=e[0]*t[0]+e[1]*t[4]+e[2]*t[8]+e[3]*t[12],i[1]=e[0]*t[1]+e[1]*t[5]+e[2]*t[9]+e[3]*t[13],i[2]=e[0]*t[2]+e[1]*t[6]+e[2]*t[10]+e[3]*t[14],i[3]=e[0]*t[3]+e[1]*t[7]+e[2]*t[11]+e[3]*t[15],i[4]=e[4]*t[0]+e[5]*t[4]+e[6]*t[8]+e[7]*t[12],i[5]=e[4]*t[1]+e[5]*t[5]+e[6]*t[9]+e[7]*t[13],i[6]=e[4]*t[2]+e[5]*t[6]+e[6]*t[10]+e[7]*t[14],i[7]=e[4]*t[3]+e[5]*t[7]+e[6]*t[11]+e[7]*t[15],i[8]=e[8]*t[0]+e[9]*t[4]+e[10]*t[8]+e[11]*t[12],i[9]=e[8]*t[1]+e[9]*t[5]+e[10]*t[9]+e[11]*t[13],i[10]=e[8]*t[2]+e[9]*t[6]+e[10]*t[10]+e[11]*t[14],i[11]=e[8]*t[3]+e[9]*t[7]+e[10]*t[11]+e[11]*t[15],i[12]=e[12]*t[0]+e[13]*t[4]+e[14]*t[8]+e[15]*t[12],i[13]=e[12]*t[1]+e[13]*t[5]+e[14]*t[9]+e[15]*t[13],i[14]=e[12]*t[2]+e[13]*t[6]+e[14]*t[10]+e[15]*t[14],i[15]=e[12]*t[3]+e[13]*t[7]+e[14]*t[11]+e[15]*t[15];for(var r=0;16>r;r++)n[r]=i[r]}function orthogonalizeMatrix(e){var t=e[0][0]*e[0][0]+e[1][0]*e[1][0]+e[2][0]*e[2][0],n=e[0][1]*e[0][1]+e[1][1]*e[1][1]+e[2][1]*e[2][1];if(n!=t?t=0:(n=e[0][2]*e[0][2]+e[1][2]*e[1][2]+e[2][2]*e[2][2],n!=t&&(t=0)),0==t)return!1;var i=e[0][0]*e[0][0]+e[0][1]*e[0][1]+e[0][2]*e[0][2];1!=i&&(i=t/Math.sqrt(i),e[0][0]*=i,e[0][1]*=i,e[0][2]*=i),i=e[1][0]*e[1][0]+e[1][1]*e[1][1]+e[1][2]*e[1][2],1!=i&&(i=t/Math.sqrt(i),e[1][0]*=i,e[1][1]*=i,e[1][2]*=i),i=e[2][0]*e[2][0]+e[2][1]*e[2][1]+e[2][2]*e[2][2],1!=i&&(i=t/Math.sqrt(i),e[2][0]*=i,e[2][1]*=i,e[2][2]*=i)}function setIdentity(e){e[0][0]=1,e[0][1]=0,e[0][2]=0,e[0][3]=0,e[1][0]=0,e[1][1]=1,e[1][2]=0,e[1][3]=0,e[2][0]=0,e[2][1]=0,e[2][2]=1,e[2][3]=0,e[3][0]=0,e[3][1]=0,e[3][2]=0,e[3][3]=1}function computeInverseMatrix(e,t){var n=e[1][0]*e[2][1]-e[1][1]*e[2][0],i=e[1][0]*e[2][2]-e[1][2]*e[2][0],r=e[1][0]*e[2][3]-e[1][3]*e[2][0],o=e[1][0]*e[3][1]-e[1][1]*e[3][0],a=e[1][0]*e[3][2]-e[1][2]*e[3][0],s=e[1][0]*e[3][3]-e[1][3]*e[3][0],l=e[1][1]*e[2][2]-e[1][2]*e[2][1],c=e[1][1]*e[2][3]-e[1][3]*e[2][1],u=e[1][1]*e[3][2]-e[1][2]*e[3][1],d=e[1][1]*e[3][3]-e[1][3]*e[3][1],h=e[1][2]*e[2][3]-e[1][3]*e[2][2],p=e[1][2]*e[3][3]-e[1][3]*e[3][2],f=e[2][0]*e[3][1]-e[2][1]*e[3][0],m=e[2][0]*e[3][2]-e[2][2]*e[3][0],g=e[2][0]*e[3][3]-e[2][3]*e[3][0],v=e[2][1]*e[3][2]-e[2][2]*e[3][1],y=e[2][1]*e[3][3]-e[2][3]*e[3][1],b=e[2][2]*e[3][3]-e[2][3]*e[3][2],_=[[],[],[],[]];_[0][0]=e[1][1]*b-e[1][2]*y+e[1][3]*v,_[0][1]=e[0][2]*y-e[0][3]*v-e[0][1]*b,_[0][2]=e[0][1]*p-e[0][2]*d+e[0][3]*u,_[0][3]=e[0][2]*c-e[0][3]*l-e[0][1]*h,_[1][0]=e[1][2]*g-e[1][3]*m-e[1][0]*b,_[1][1]=e[0][0]*b-e[0][2]*g+e[0][3]*m,_[1][2]=e[0][2]*s-e[0][3]*a-e[0][0]*p,_[1][3]=e[0][0]*h-e[0][2]*r+e[0][3]*i,_[2][0]=e[1][0]*y-e[1][1]*g+e[1][3]*f,_[2][1]=e[0][1]*g-e[0][3]*f-e[0][0]*y,_[2][2]=e[0][0]*d-e[0][1]*s+e[0][3]*o,_[2][3]=e[0][1]*r-e[0][3]*n-e[0][0]*c,_[3][0]=e[1][1]*m-e[1][2]*f-e[1][0]*v,_[3][1]=e[0][0]*v-e[0][1]*m+e[0][2]*f,_[3][2]=e[0][1]*a-e[0][2]*o-e[0][0]*u,_[3][3]=e[0][0]*l-e[0][1]*i+e[0][2]*n;var w=e[0][0]*_[0][0]+e[0][1]*_[1][0]+e[0][2]*_[2][0]+e[0][3]*_[3][0];if(!(1e-12>=w&&w>=-1e-12)){var S=1/w;t[0][0]=_[0][0]*S,t[0][1]=_[0][1]*S,t[0][2]=_[0][2]*S,t[0][3]=_[0][3]*S,t[1][0]=_[1][0]*S,t[1][1]=_[1][1]*S,t[1][2]=_[1][2]*S,t[1][3]=_[1][3]*S,t[2][0]=_[2][0]*S,t[2][1]=_[2][1]*S,t[2][2]=_[2][2]*S,t[2][3]=_[2][3]*S,t[3][0]=_[3][0]*S,t[3][1]=_[3][1]*S,t[3][2]=_[3][2]*S,t[3][3]=_[3][3]*S}}function calculateTriangleNormal(e,t){var n=new AnnotatorHoopsPoint(e[1].x-e[0].x,e[1].y-e[0].y,e[1].z-e[0].z),i=new AnnotatorHoopsPoint(e[2].x-e[0].x,e[2].y-e[0].y,e[2].z-e[0].z);t.set(n.y*i.z-n.z*i.y,n.z*i.x-n.x*i.z,n.x*i.y-n.y*i.x)}function computeArbitaryRotatedPoint(e,t,n,i){convertDegreesToRadians(n);var r=Math.sin(n),o=Math.cos(n),a=1-o,s=a*e.x*e.y,l=a*e.x*e.z,c=a*e.y*e.z,u=r*t.z*e.y-r*t.y*e.z+a*t.x*e.x*e.x+l*t.z+s*t.y+o*t.x,d=r*t.x*e.z+a*t.y*e.y*e.y-r*t.z*e.x+c*t.z+o*t.y+s*t.x;i.z=a*t.z*e.z*e.z-r*t.x*e.y+r*t.y*e.x+o*t.z+c*t.y+l*t.x,i.y=d,i.x=u}function computeCrossProduct(e,t,n){var i=new AnnotatorHoopsPoint(0,0,0);i.x=e.y*t.z-e.z*t.y,i.y=e.z*t.x-e.x*t.z,i.z=e.x*t.y-e.y*t.x,n.x=i.x,n.y=i.y,n.z=i.z}function computeDotProduct(e,t){return e.x*t.x+e.y*t.y+e.z*t.z}function toFloat(e){var t=2*(e>>31)+1,n=255&e>>>23,i=8388607&e;return 255==n?i?0/0:1/0*t:(n?(n-=127,i|=8388608):n=-126,t*i*Math.pow(2,n-23))}function arcCosine(e){return-1>e?Math.PI:e>1?0:Math.acos(e)}function convertPolarNormalsToCartesianNormals(e,t,n){for(var i=0;e>i;i++){var r=t[2*i],o=t[2*i+1];n[3*i]=Math.sin(o)*Math.cos(r),n[3*i+1]=Math.cos(o),n[3*i+2]=Math.sin(o)*Math.sin(r)}}function calculateDimensionsCount(e){var t=0;return X_2D(e)||t++,Y_2D(e)||t++,Z_2D(e)||t++,t}function calculateFloatsCount(e,t,n){var i=0;switch(e&TKPP_X_2D_MASK){case TKPP_ZERO_X:break;case TKPP_SAME_X:i+=1;break;case TKPP_PER_PRIMITIVE_X:i+=t;break;case 0:i+=n}switch(e&TKPP_Y_2D_MASK){case TKPP_ZERO_Y:break;case TKPP_SAME_Y:i+=1;break;case TKPP_PER_PRIMITIVE_Y:i+=t;break;case 0:i+=n}switch(e&TKPP_Z_2D_MASK){case TKPP_ZERO_Z:break;case TKPP_SAME_Z:i+=1;break;case TKPP_PER_PRIMITIVE_Z:i+=t;break;case 0:i+=n}return i}function invertFloatsMangling(e,t,n,i,r,o){for(var a=0,s=0;e>s;s++)X_2D(r)||(o[3*s+0]=t[a++]),Y_2D(r)||(o[3*s+1]=t[a++]),Z_2D(r)||(o[3*s+2]=t[a++]);var l=0;if(X_2D(r))if(l=0,PER_PRIMITIVE_X(r))for(var s=0;n>s;s++){for(var c=0;i[s]>c;c++)o[l]=t[a],l+=3;a++}else if(SAME_X(r)){for(var s=0;e>s;s++)o[l]=t[a],l+=3;a++}else if(ZERO_X(r))for(var s=0;e>s;s++)o[l]=0,l+=3;if(Y_2D(r))if(l=1,PER_PRIMITIVE_Y(r))for(var s=0;n>s;s++){for(var c=0;i[s]>c;c++)o[l]=t[a],l+=3;a++}else if(SAME_Y(r)){for(var s=0;e>s;s++)o[l]=t[a],l+=3;a++}else if(ZERO_Y(r))for(var s=0;e>s;s++)o[l]=0,l+=3;if(Z_2D(r))if(l=2,PER_PRIMITIVE_Z(r))for(var s=0;n>s;s++){for(var c=0;i[s]>c;c++)o[l]=t[a],l+=3;a++}else if(SAME_Z(r)){for(var s=0;e>s;s++)o[l]=t[a],l+=3;a++}else if(ZERO_Z(r))for(var s=0;e>s;s++)o[l]=0,l+=3}function createSVG(e,t){var n=document.createElementNS("http://www.w3.org/2000/svg",e);for(var i in t)n.setAttribute(i,t[i]);return n}function createSVGWithNodeText(e,t,n){var i=document.createElementNS("http://www.w3.org/2000/svg",e);for(var r in t)i.setAttribute(r,t[r]);return i.appendChild(document.createTextNode(n)),i}function getTheLength(e){return e.length}function zipWith(){for(var e=Array.prototype,t=e.shift.call(arguments),n=Math.min.apply(null,e.map.call(arguments,getTheLength)),i=[],r=0;n>r;++r){var o=e.map.call(arguments,function(e){return e[r]});i[r]=t.apply(null,o)}return i}function convertMatrix(e,t){for(var n=0,i=0;4>i;i++)for(var r=0;4>r;r++)t[i][r]=e[n++]}function computeIntersectionOfRayAndTriangle(e,t,n,i,r,o){var a,s,l,c,u=new AnnotatorHoopsPoint(0,0,0),d=new AnnotatorHoopsPoint(0,0,0),h=new AnnotatorHoopsPoint(0,0,0),p=new AnnotatorHoopsPoint(i.x-n.x,i.y-n.y,i.z-n.z),f=new AnnotatorHoopsPoint(r.x-n.x,r.y-n.y,r.z-n.z);if(computeCrossProduct(f,t,u),a=computeDotProduct(p,u),a>-1e-5&&1e-5>a)return!1;if(s=1/a,d.set(e.x-n.x,e.y-n.y,e.z-n.z),l=s*computeDotProduct(d,u),0>l||l>1)return!1;if(computeCrossProduct(p,d,h),c=s*computeDotProduct(t,h),0>c||l+c>1)return!1;var m=s*computeDotProduct(f,h);return m>1e-5?(o.set(e.x+m*t.x,e.y+m*t.y,e.z+m*t.z),!0):!1}function shaderProgram(e,t,n){var i=e.createProgram(),r=function(t,n){var r=e.createShader("vertex"==t?e.VERTEX_SHADER:e.FRAGMENT_SHADER);if(e.shaderSource(r,n),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw"Could not compile "+t+" shader:\n\n"+e.getShaderInfoLog(r);e.attachShader(i,r)};if(r("vertex",t),r("fragment",n),e.linkProgram(i),!e.getProgramParameter(i,e.LINK_STATUS))throw"Could not link the shader program!";return i}function convertHexToRGB(e){if("#"==e[0]&&(e=e.substr(1)),e.length>6)e=e.substr(0,6);else if(6>e.length)for(;6>e.length;)e="0"+e;if(3==e.length){var t=e;e="",t=/^([a-f0-9])([a-f0-9])([a-f0-9])$/i.exec(t).slice(1);for(var n=0;3>n;n++)e+=t[n]+t[n]}var i=/^([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})$/i.exec(e).slice(1);return{r:parseInt(i[0],16),g:parseInt(i[1],16),b:parseInt(i[2],16)}}function constructMeasurementResultString(e,t,n){if(!e)return"";switch(t){case MILLIMETERS:return n+e.toFixed(2)+t;case CENTIMETERS:return n+(e*ONE_MM_IN_CENTIMETERS).toFixed(2)+t;case METERS:return n+(e*ONE_MM_IN_METERS).toFixed(2)+t;case INCHES:return n+(e*ONE_MM_IN_INCHES).toFixed(2)+t;case FEET:return n+(e*ONE_MM_IN_FEET).toFixed(2)+t;case FEET_INCHES:var i=e*ONE_MM_IN_FEET,r=(e*ONE_MM_IN_INCHES.toFixed(2)%12).toFixed(2);return n+Math.floor(i)+"'-"+r+"''"}}function X_2D(e){return e&TKPP_X_2D_MASK}function Y_2D(e){return e&TKPP_Y_2D_MASK}function Z_2D(e){return e&TKPP_Z_2D_MASK}function PER_PRIMITIVE_X(e){return(e&TKPP_X_2D_MASK)==TKPP_PER_PRIMITIVE_X}function ZERO_X(e){return(e&TKPP_X_2D_MASK)==TKPP_ZERO_X}function SAME_X(e){return(e&TKPP_X_2D_MASK)==TKPP_SAME_X}function PER_PRIMITIVE_Y(e){return(e&TKPP_Y_2D_MASK)==TKPP_PER_PRIMITIVE_Y}function ZERO_Y(e){return(e&TKPP_Y_2D_MASK)==TKPP_ZERO_Y}function SAME_Y(e){return(e&TKPP_Y_2D_MASK)==TKPP_SAME_Y}function PER_PRIMITIVE_Z(e){return(e&TKPP_Z_2D_MASK)==TKPP_PER_PRIMITIVE_Z}function ZERO_Z(e){return(e&TKPP_Z_2D_MASK)==TKPP_ZERO_Z}function SAME_Z(e){return(e&TKPP_Z_2D_MASK)==TKPP_SAME_Z}function canUseFeature(e){var t=angular.element($("#projectContainer")).scope();return t.project.acl[e]}function displayUpgradeToProPopup(){var e=angular.element($("#projectContainer")).scope();e.upgradeToPro()}BinaryReader=function(e){this._buffer=e,this._pos=0},BinaryReader.prototype={readInt8:function(){return this._decodeInt(8,!0)},readUInt8:function(){return this._decodeInt(8,!1)},readInt16:function(){return this._decodeInt(16,!0)},readUInt16:function(){return this._decodeInt(16,!1)},readInt32:function(){return this._decodeInt(32,!0)},readUInt32:function(){return this._decodeInt(32,!1)},readFloat:function(){return this._decodeFloat(23,8)},readDouble:function(){return this._decodeFloat(52,11)},readChar:function(){return this.readString(1)},readString:function(e){this._checkSize(8*e);var t=this._buffer.substr(this._pos,e);return this._pos+=e,t},seek:function(e){this._pos=e,this._checkSize(0)},getPosition:function(){return this._pos},getSize:function(){return this._buffer.length},_decodeFloat:function(e,t){var n=e+t+1,i=n>>3;this._checkSize(n);var r=Math.pow(2,t-1)-1,o=this._readBits(e+t,1,i),a=this._readBits(e,t,i),s=0,l=2,c=0;do for(var u=this._readByte(++c,i),d=e%8||8,h=1<<d;h>>=1;)u&h&&(s+=1/l),l*=2;while(e-=d);return this._pos+=i,a==(r<<1)+1?s?0/0:o?-1/0:+1/0:(1+-2*o)*(a||s?a?Math.pow(2,a-r)*(1+s):Math.pow(2,-r+1)*s:0)},_decodeInt:function(e,t){var n=this._readBits(0,e,e/8),i=Math.pow(2,e),r=t&&n>=i/2?n-i:n;return this._pos+=e/8,r},_shl:function(e,t){for(++t;--t;e=1073741824==(1073741824&(e%=2147483648))?2*e:2*(e-1073741824)+2147483647+1);return e},_readByte:function(e,t){return 255&this._buffer.charCodeAt(this._pos+t-e-1)},_readBits:function(e,t,n){var i=(e+t)%8,r=e%8,o=n-(e>>3)-1,a=n+(-(e+t)>>3),s=o-a,l=this._readByte(o,n)>>r&(1<<(s?8-r:t))-1;for(s&&i&&(l+=(this._readByte(a++,n)&(1<<i)-1)<<(s--<<3)-r);s;)l+=this._shl(this._readByte(a++,n),(s--<<3)-r);return l},_checkSize:function(e){if(!(this._pos+Math.ceil(e/8)<this._buffer.length))throw new Error("Index out of bound")}};var JSON;JSON||(JSON={}),function(){"use strict";function f(e){return 10>e?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,i,r,o,a,s=gap,l=t[e];switch(l&&"object"==typeof l&&"function"==typeof l.toJSON&&(l=l.toJSON(e)),"function"==typeof rep&&(l=rep.call(t,e,l)),typeof l){case"string":return quote(l);case"number":return isFinite(l)?String(l):"null";case"boolean":case"null":return String(l);case"object":if(!l)return"null";if(gap+=indent,a=[],"[object Array]"===Object.prototype.toString.apply(l)){for(o=l.length,n=0;o>n;n+=1)a[n]=str(n,l)||"null";return r=0===a.length?"[]":gap?"[\n"+gap+a.join(",\n"+gap)+"\n"+s+"]":"["+a.join(",")+"]",gap=s,r}if(rep&&"object"==typeof rep)for(o=rep.length,n=0;o>n;n+=1)"string"==typeof rep[n]&&(i=rep[n],r=str(i,l),r&&a.push(quote(i)+(gap?": ":":")+r));else for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(r=str(i,l),r&&a.push(quote(i)+(gap?": ":":")+r));return r=0===a.length?"{}":gap?"{\n"+gap+a.join(",\n"+gap)+"\n"+s+"}":"{"+a.join(",")+"}",gap=s,r}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,n){var i;if(gap="",indent="","number"==typeof n)for(i=0;n>i;i+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var n,i,r=e[t];if(r&&"object"==typeof r)for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(i=walk(r,n),void 0!==i?r[n]=i:delete r[n]);return reviver.call(e,t,r)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),// │ Copyright © 2008-2012 Dmitry Baranovskiy (http://raphaeljs.com)    │ \\
// │ Copyright © 2008-2012 Sencha Labs (http://sencha.com)              │ \\
function(e){var t,n,i="0.3.4",r="hasOwnProperty",o=/[\.\/]/,a="*",s=function(){},l=function(e,t){return e-t},c={n:{}},u=function(e,i){var r,o=n,a=Array.prototype.slice.call(arguments,2),s=u.listeners(e),c=0,d=[],h={},p=[],f=t;t=e,n=0;for(var m=0,g=s.length;g>m;m++)"zIndex"in s[m]&&(d.push(s[m].zIndex),0>s[m].zIndex&&(h[s[m].zIndex]=s[m]));for(d.sort(l);0>d[c];)if(r=h[d[c++]],p.push(r.apply(i,a)),n)return n=o,p;for(m=0;g>m;m++)if(r=s[m],"zIndex"in r)if(r.zIndex==d[c]){if(p.push(r.apply(i,a)),n)break;do if(c++,r=h[d[c]],r&&p.push(r.apply(i,a)),n)break;while(r)}else h[r.zIndex]=r;else if(p.push(r.apply(i,a)),n)break;return n=o,t=f,p.length?p:null};u.listeners=function(e){var t,n,i,r,s,l,u,d,h=e.split(o),p=c,f=[p],m=[];for(r=0,s=h.length;s>r;r++){for(d=[],l=0,u=f.length;u>l;l++)for(p=f[l].n,n=[p[h[r]],p[a]],i=2;i--;)t=n[i],t&&(d.push(t),m=m.concat(t.f||[]));f=d}return m},u.on=function(e,t){for(var n=e.split(o),i=c,r=0,a=n.length;a>r;r++)i=i.n,!i[n[r]]&&(i[n[r]]={n:{}}),i=i[n[r]];for(i.f=i.f||[],r=0,a=i.f.length;a>r;r++)if(i.f[r]==t)return s;return i.f.push(t),function(e){+e==+e&&(t.zIndex=+e)}},u.stop=function(){n=1},u.nt=function(e){return e?new RegExp("(?:\\.|\\/|^)"+e+"(?:\\.|\\/|$)").test(t):t},u.off=u.unbind=function(e,t){var n,i,s,l,u,d,h,p=e.split(o),f=[c];for(l=0,u=p.length;u>l;l++)for(d=0;f.length>d;d+=s.length-2){if(s=[d,1],n=f[d].n,p[l]!=a)n[p[l]]&&s.push(n[p[l]]);else for(i in n)n[r](i)&&s.push(n[i]);f.splice.apply(f,s)}for(l=0,u=f.length;u>l;l++)for(n=f[l];n.n;){if(t){if(n.f){for(d=0,h=n.f.length;h>d;d++)if(n.f[d]==t){n.f.splice(d,1);break}!n.f.length&&delete n.f}for(i in n.n)if(n.n[r](i)&&n.n[i].f){var m=n.n[i].f;for(d=0,h=m.length;h>d;d++)if(m[d]==t){m.splice(d,1);break}!m.length&&delete n.n[i].f}}else{delete n.f;for(i in n.n)n.n[r](i)&&n.n[i].f&&delete n.n[i].f}n=n.n}},u.once=function(e,t){var n=function(){var i=t.apply(this,arguments);return u.unbind(e,n),i};return u.on(e,n)},u.version=i,u.toString=function(){return"You are running Eve "+i},"undefined"!=typeof module&&module.exports?module.exports=u:"undefined"!=typeof define?define("eve",[],function(){return u}):e.eve=u}(this),function(){function e(e){for(var t=0;an.length>t;t++)an[t].el.paper==e&&an.splice(t--,1)}function t(e,t,n,r,a,s){n=Y(n);var l,c,u,d,h,p,f=e.ms,m={},g={},y={};if(r)for(w=0,S=an.length;S>w;w++){var b=an[w];if(b.el.id==t.id&&b.anim==e){b.percent!=n?(an.splice(w,1),u=1):c=b,t.attr(b.totalOrigin);break}}else r=+g;for(var w=0,S=e.percents.length;S>w;w++){if(e.percents[w]==n||e.percents[w]>r*e.top){n=e.percents[w],h=e.percents[w-1]||0,f=f/e.top*(n-h),d=e.percents[w+1],l=e.anim[n];break}r&&t.attr(e.anim[e.percents[w]])}if(l){if(c)c.initstatus=r,c.start=new Date-c.ms*r;else{for(var C in l)if(l[x](C)&&(tt[x](C)||t.paper.customAttributes[x](C)))switch(m[C]=t.attr(C),null==m[C]&&(m[C]=et[C]),g[C]=l[C],tt[C]){case z:y[C]=(g[C]-m[C])/f;break;case"colour":m[C]=v.getRGB(m[C]);var $=v.getRGB(g[C]);y[C]={r:($.r-m[C].r)/f,g:($.g-m[C].g)/f,b:($.b-m[C].b)/f};break;case"path":var E=It(m[C],g[C]),T=E[1];for(m[C]=E[0],y[C]=[],w=0,S=m[C].length;S>w;w++){y[C][w]=[0];for(var A=1,N=m[C][w].length;N>A;A++)y[C][w][A]=(T[w][A]-m[C][w][A])/f}break;case"transform":var M=t._,I=Ut(M[C],g[C]);if(I)for(m[C]=I.from,g[C]=I.to,y[C]=[],y[C].real=!0,w=0,S=m[C].length;S>w;w++)for(y[C][w]=[m[C][w][0]],A=1,N=m[C][w].length;N>A;A++)y[C][w][A]=(g[C][w][A]-m[C][w][A])/f;else{var F=t.matrix||new o,L={_:{transform:M.transform},getBBox:function(){return t.getBBox(1)}};m[C]=[F.a,F.b,F.c,F.d,F.e,F.f],Ot(L,g[C]),g[C]=L._.transform,y[C]=[(L.matrix.a-F.a)/f,(L.matrix.b-F.b)/f,(L.matrix.c-F.c)/f,(L.matrix.d-F.d)/f,(L.matrix.e-F.e)/f,(L.matrix.f-F.f)/f]}break;case"csv":var O=D(l[C])[P](_),R=D(m[C])[P](_);if("clip-rect"==C)for(m[C]=R,y[C]=[],w=R.length;w--;)y[C][w]=(O[w]-m[C][w])/f;g[C]=O;break;default:for(O=[][k](l[C]),R=[][k](m[C]),y[C]=[],w=t.paper.customAttributes[C].length;w--;)y[C][w]=((O[w]||0)-(R[w]||0))/f}var U=l.easing,B=v.easing_formulas[U];if(!B)if(B=D(U).match(X),B&&5==B.length){var j=B;B=function(e){return i(e,+j[1],+j[2],+j[3],+j[4],f)}}else B=dt;if(p=l.start||e.start||+new Date,b={anim:e,percent:n,timestamp:p,start:p+(e.del||0),status:0,initstatus:r||0,stop:!1,ms:f,easing:B,from:m,diff:y,to:g,el:t,callback:l.callback,prev:h,next:d,repeat:s||e.times,origin:t.attr(),totalOrigin:a},an.push(b),r&&!c&&!u&&(b.stop=!0,b.start=new Date-f*r,1==an.length))return ln();u&&(b.start=new Date-b.ms*r),1==an.length&&sn(ln)}eve("raphael.anim.start."+t.id,t,e)}}function n(e,t){var n=[],i={};if(this.ms=t,this.times=1,e){for(var r in e)e[x](r)&&(i[Y(r)]=e[r],n.push(Y(r)));n.sort(ct)}this.anim=i,this.top=n[n.length-1],this.percents=n}function i(e,t,n,i,r,o){function a(e,t){var n,i,r,o,a,s;for(r=e,s=0;8>s;s++){if(o=l(r)-e,t>B(o))return r;if(a=(3*d*r+2*u)*r+c,1e-6>B(a))break;r-=o/a}if(n=0,i=1,r=e,n>r)return n;if(r>i)return i;for(;i>n;){if(o=l(r),t>B(o-e))return r;e>o?n=r:i=r,r=(i-n)/2+n}return r}function s(e,t){var n=a(e,t);return((f*n+p)*n+h)*n}function l(e){return((d*e+u)*e+c)*e}var c=3*t,u=3*(i-t)-c,d=1-c-u,h=3*n,p=3*(r-n)-h,f=1-h-p;return s(e,1/(200*o))}function r(){return this.x+M+this.y+M+this.width+" × "+this.height}function o(e,t,n,i,r,o){null!=e?(this.a=+e,this.b=+t,this.c=+n,this.d=+i,this.e=+r,this.f=+o):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0)}function a(e,t,n){e=v._path2curve(e),t=v._path2curve(t);for(var i,r,o,a,l,c,u,d,h,p,f=n?0:[],m=0,g=e.length;g>m;m++){var y=e[m];if("M"==y[0])i=l=y[1],r=c=y[2];else{"C"==y[0]?(h=[i,r].concat(y.slice(1)),i=h[6],r=h[7]):(h=[i,r,i,r,l,c,l,c],i=l,r=c);for(var b=0,_=t.length;_>b;b++){var w=t[b];if("M"==w[0])o=u=w[1],a=d=w[2];else{"C"==w[0]?(p=[o,a].concat(w.slice(1)),o=p[6],a=p[7]):(p=[o,a,o,a,u,d,u,d],o=u,a=d);var S=s(h,p,n);if(n)f+=S;else{for(var x=0,C=S.length;C>x;x++)S[x].segment1=m,S[x].segment2=b,S[x].bez1=h,S[x].bez2=p;f=f.concat(S)}}}}}return f}function s(e,t,n){var i=v.bezierBBox(e),r=v.bezierBBox(t);if(!v.isBBoxIntersect(i,r))return n?0:[];for(var o=u.apply(0,e),a=u.apply(0,t),s=~~(o/5),c=~~(a/5),d=[],h=[],p={},f=n?0:[],m=0;s+1>m;m++){var g=v.findDotsAtSegment.apply(v,e.concat(m/s));d.push({x:g.x,y:g.y,t:m/s})}for(m=0;c+1>m;m++)g=v.findDotsAtSegment.apply(v,t.concat(m/c)),h.push({x:g.x,y:g.y,t:m/c});for(m=0;s>m;m++)for(var y=0;c>y;y++){var b=d[m],_=d[m+1],w=h[y],S=h[y+1],x=.001>B(_.x-b.x)?"y":"x",C=.001>B(S.x-w.x)?"y":"x",$=l(b.x,b.y,_.x,_.y,w.x,w.y,S.x,S.y);if($){if(p[$.x.toFixed(4)]==$.y.toFixed(4))continue;p[$.x.toFixed(4)]=$.y.toFixed(4);var E=b.t+B(($[x]-b[x])/(_[x]-b[x]))*(_.t-b.t),T=w.t+B(($[C]-w[C])/(S[C]-w[C]))*(S.t-w.t);E>=0&&1>=E&&T>=0&&1>=T&&(n?f++:f.push({x:$.x,y:$.y,t1:E,t2:T}))}}return f}function l(e,t,n,i,r,o,a,s){if(!(R(e,n)<U(r,a)||U(e,n)>R(r,a)||R(t,i)<U(o,s)||U(t,i)>R(o,s))){var l=(e*i-t*n)*(r-a)-(e-n)*(r*s-o*a),c=(e*i-t*n)*(o-s)-(t-i)*(r*s-o*a),u=(e-n)*(o-s)-(t-i)*(r-a);if(!u)return;var d=l/u,h=c/u,p=+d.toFixed(2),f=+h.toFixed(2);if(+U(e,n).toFixed(2)>p||p>+R(e,n).toFixed(2)||+U(r,a).toFixed(2)>p||p>+R(r,a).toFixed(2)||+U(t,i).toFixed(2)>f||f>+R(t,i).toFixed(2)||+U(o,s).toFixed(2)>f||f>+R(o,s).toFixed(2))return;return{x:d,y:h}}}function c(e,t,n,i,r,o,a,s,l){if(!(0>l||l>u(e,t,n,i,r,o,a,s))){var c,d=1,h=d/2,p=d-h,f=.01;for(c=u(e,t,n,i,r,o,a,s,p);B(c-l)>f;)h/=2,p+=(l>c?1:-1)*h,c=u(e,t,n,i,r,o,a,s,p);return p}}function u(e,t,n,i,r,o,a,s,l){null==l&&(l=1),l=l>1?1:0>l?0:l;for(var c=l/2,u=12,h=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],p=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],f=0,m=0;u>m;m++){var g=c*h[m]+c,v=d(g,e,n,r,a),y=d(g,t,i,o,s),b=v*v+y*y;f+=p[m]*O.sqrt(b)}return c*f}function d(e,t,n,i,r){var o=-3*t+9*n-9*i+3*r,a=e*o+6*t-12*n+6*i;return e*a-3*t+3*n}function h(e,t){for(var n=[],i=0,r=e.length;r-2*!t>i;i+=2){var o=[{x:+e[i-2],y:+e[i-1]},{x:+e[i],y:+e[i+1]},{x:+e[i+2],y:+e[i+3]},{x:+e[i+4],y:+e[i+5]}];t?i?r-4==i?o[3]={x:+e[0],y:+e[1]}:r-2==i&&(o[2]={x:+e[0],y:+e[1]},o[3]={x:+e[2],y:+e[3]}):o[0]={x:+e[r-2],y:+e[r-1]}:r-4==i?o[3]=o[2]:i||(o[0]={x:+e[i],y:+e[i+1]}),n.push(["C",(-o[0].x+6*o[1].x+o[2].x)/6,(-o[0].y+6*o[1].y+o[2].y)/6,(o[1].x+6*o[2].x-o[3].x)/6,(o[1].y+6*o[2].y-o[3].y)/6,o[2].x,o[2].y])}return n}function p(){return this.hex}function f(e,t,n){function i(){var r=Array.prototype.slice.call(arguments,0),o=r.join("␀"),a=i.cache=i.cache||{},s=i.count=i.count||[];return a[x](o)?(m(s,o),n?n(a[o]):a[o]):(s.length>=1e3&&delete a[s.shift()],s.push(o),a[o]=e[T](t,r),n?n(a[o]):a[o])}return i}function m(e,t){for(var n=0,i=e.length;i>n;n++)if(e[n]===t)return e.push(e.splice(n,1)[0])}function g(e){if(Object(e)!==e)return e;var t=new e.constructor;for(var n in e)e[x](n)&&(t[n]=g(e[n]));return t}function v(e){if(v.is(e,"function"))return y?e():eve.on("raphael.DOMload",e);if(v.is(e,V))return v._engine.create[T](v,e.splice(0,3+v.is(e[0],z))).add(e);var t=Array.prototype.slice.call(arguments,0);if(v.is(t[t.length-1],"function")){var n=t.pop();return y?n.call(v._engine.create[T](v,t)):eve.on("raphael.DOMload",function(){n.call(v._engine.create[T](v,t))})}return v._engine.create[T](v,arguments)}v.version="2.1.0",v.eve=eve;var y,b,_=/[, ]+/,w={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},S=/\{(\d+)\}/g,x="hasOwnProperty",C={doc:document,win:window},$={was:Object.prototype[x].call(C.win,"Raphael"),is:C.win.Raphael},E=function(){this.ca=this.customAttributes={}},T="apply",k="concat",A="createTouch"in C.doc,N="",M=" ",D=String,P="split",I="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel"[P](M),F={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},L=D.prototype.toLowerCase,O=Math,R=O.max,U=O.min,B=O.abs,j=O.pow,G=O.PI,z="number",H="string",V="array",W=Object.prototype.toString,q=(v._ISURL=/^url\(['"]?([^\)]+?)['"]?\)$/i,/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i),J={NaN:1,Infinity:1,"-Infinity":1},X=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,Q=O.round,Y=parseFloat,K=parseInt,Z=D.prototype.toUpperCase,et=v._availableAttrs={"arrow-end":"none","arrow-start":"none",blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/","letter-spacing":0,opacity:1,path:"M0,0",r:0,rx:0,ry:0,src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",transform:"",width:0,x:0,y:0},tt=v._availableAnimAttrs={blur:z,"clip-rect":"csv",cx:z,cy:z,fill:"colour","fill-opacity":z,"font-size":z,height:z,opacity:z,path:"path",r:z,rx:z,ry:z,stroke:"colour","stroke-opacity":z,"stroke-width":z,transform:"transform",width:z,x:z,y:z},nt=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/,it={hs:1,rg:1},rt=/,?([achlmqrstvxz]),?/gi,ot=/([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,at=/([rstm])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,st=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/gi,lt=(v._radial_gradient=/^r(?:\(([^,]+?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*([^\)]+?)\))?/,{}),ct=function(e,t){return Y(e)-Y(t)},ut=function(){},dt=function(e){return e},ht=v._rectPath=function(e,t,n,i,r){return r?[["M",e+r,t],["l",n-2*r,0],["a",r,r,0,0,1,r,r],["l",0,i-2*r],["a",r,r,0,0,1,-r,r],["l",2*r-n,0],["a",r,r,0,0,1,-r,-r],["l",0,2*r-i],["a",r,r,0,0,1,r,-r],["z"]]:[["M",e,t],["l",n,0],["l",0,i],["l",-n,0],["z"]]},pt=function(e,t,n,i){return null==i&&(i=n),[["M",e,t],["m",0,-i],["a",n,i,0,1,1,0,2*i],["a",n,i,0,1,1,0,-2*i],["z"]]},ft=v._getPath={path:function(e){return e.attr("path")},circle:function(e){var t=e.attrs;return pt(t.cx,t.cy,t.r)},ellipse:function(e){var t=e.attrs;return pt(t.cx,t.cy,t.rx,t.ry)},rect:function(e){var t=e.attrs;return ht(t.x,t.y,t.width,t.height,t.r)},image:function(e){var t=e.attrs;return ht(t.x,t.y,t.width,t.height)},text:function(e){var t=e._getBBox();return ht(t.x,t.y,t.width,t.height)}},mt=v.mapPath=function(e,t){if(!t)return e;var n,i,r,o,a,s,l;for(e=It(e),r=0,a=e.length;a>r;r++)for(l=e[r],o=1,s=l.length;s>o;o+=2)n=t.x(l[o],l[o+1]),i=t.y(l[o],l[o+1]),l[o]=n,l[o+1]=i;return e};if(v._g=C,v.type=C.win.SVGAngle||C.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML","VML"==v.type){var gt,vt=C.doc.createElement("div");if(vt.innerHTML='<v:shape adj="1"/>',gt=vt.firstChild,gt.style.behavior="url(#default#VML)",!gt||"object"!=typeof gt.adj)return v.type=N;vt=null}v.svg=!(v.vml="VML"==v.type),v._Paper=E,v.fn=b=E.prototype=v.prototype,v._id=0,v._oid=0,v.is=function(e,t){return t=L.call(t),"finite"==t?!J[x](+e):"array"==t?e instanceof Array:"null"==t&&null===e||t==typeof e&&null!==e||"object"==t&&e===Object(e)||"array"==t&&Array.isArray&&Array.isArray(e)||W.call(e).slice(8,-1).toLowerCase()==t},v.angle=function(e,t,n,i,r,o){if(null==r){var a=e-n,s=t-i;return a||s?(180+180*O.atan2(-s,-a)/G+360)%360:0}return v.angle(e,t,r,o)-v.angle(n,i,r,o)},v.rad=function(e){return e%360*G/180},v.deg=function(e){return 180*e/G%360},v.snapTo=function(e,t,n){if(n=v.is(n,"finite")?n:10,v.is(e,V)){for(var i=e.length;i--;)if(n>=B(e[i]-t))return e[i]}else{e=+e;var r=t%e;if(n>r)return t-r;if(r>e-n)return t-r+e}return t},v.createUUID=function(e,t){return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(e,t).toUpperCase()}}(/[xy]/g,function(e){var t=0|16*O.random(),n="x"==e?t:8|3&t;return n.toString(16)}),v.setWindow=function(e){eve("raphael.setWindow",v,C.win,e),C.win=e,C.doc=C.win.document,v._engine.initWin&&v._engine.initWin(C.win)};var yt=function(e){if(v.vml){var t,n=/^\s+|\s+$/g;try{var i=new ActiveXObject("htmlfile");i.write("<body>"),i.close(),t=i.body}catch(r){t=createPopup().document.body}var o=t.createTextRange();yt=f(function(e){try{t.style.color=D(e).replace(n,N);var i=o.queryCommandValue("ForeColor");return i=(255&i)<<16|65280&i|(16711680&i)>>>16,"#"+("000000"+i.toString(16)).slice(-6)}catch(r){return"none"}})}else{var a=C.doc.createElement("i");a.title="Raphaël Colour Picker",a.style.display="none",C.doc.body.appendChild(a),yt=f(function(e){return a.style.color=e,C.doc.defaultView.getComputedStyle(a,N).getPropertyValue("color")})}return yt(e)},bt=function(){return"hsb("+[this.h,this.s,this.b]+")"},_t=function(){return"hsl("+[this.h,this.s,this.l]+")"},wt=function(){return this.hex},St=function(e,t,n){if(null==t&&v.is(e,"object")&&"r"in e&&"g"in e&&"b"in e&&(n=e.b,t=e.g,e=e.r),null==t&&v.is(e,H)){var i=v.getRGB(e);e=i.r,t=i.g,n=i.b}return(e>1||t>1||n>1)&&(e/=255,t/=255,n/=255),[e,t,n]},xt=function(e,t,n,i){e*=255,t*=255,n*=255;var r={r:e,g:t,b:n,hex:v.rgb(e,t,n),toString:wt};return v.is(i,"finite")&&(r.opacity=i),r};v.color=function(e){var t;return v.is(e,"object")&&"h"in e&&"s"in e&&"b"in e?(t=v.hsb2rgb(e),e.r=t.r,e.g=t.g,e.b=t.b,e.hex=t.hex):v.is(e,"object")&&"h"in e&&"s"in e&&"l"in e?(t=v.hsl2rgb(e),e.r=t.r,e.g=t.g,e.b=t.b,e.hex=t.hex):(v.is(e,"string")&&(e=v.getRGB(e)),v.is(e,"object")&&"r"in e&&"g"in e&&"b"in e?(t=v.rgb2hsl(e),e.h=t.h,e.s=t.s,e.l=t.l,t=v.rgb2hsb(e),e.v=t.b):(e={hex:"none"},e.r=e.g=e.b=e.h=e.s=e.v=e.l=-1)),e.toString=wt,e},v.hsb2rgb=function(e,t,n,i){this.is(e,"object")&&"h"in e&&"s"in e&&"b"in e&&(n=e.b,t=e.s,e=e.h,i=e.o),e*=360;var r,o,a,s,l;return e=e%360/60,l=n*t,s=l*(1-B(e%2-1)),r=o=a=n-l,e=~~e,r+=[l,s,0,0,s,l][e],o+=[s,l,l,s,0,0][e],a+=[0,0,s,l,l,s][e],xt(r,o,a,i)},v.hsl2rgb=function(e,t,n,i){this.is(e,"object")&&"h"in e&&"s"in e&&"l"in e&&(n=e.l,t=e.s,e=e.h),(e>1||t>1||n>1)&&(e/=360,t/=100,n/=100),e*=360;var r,o,a,s,l;return e=e%360/60,l=2*t*(.5>n?n:1-n),s=l*(1-B(e%2-1)),r=o=a=n-l/2,e=~~e,r+=[l,s,0,0,s,l][e],o+=[s,l,l,s,0,0][e],a+=[0,0,s,l,l,s][e],xt(r,o,a,i)},v.rgb2hsb=function(e,t,n){n=St(e,t,n),e=n[0],t=n[1],n=n[2];var i,r,o,a;return o=R(e,t,n),a=o-U(e,t,n),i=0==a?null:o==e?(t-n)/a:o==t?(n-e)/a+2:(e-t)/a+4,i=60*((i+360)%6)/360,r=0==a?0:a/o,{h:i,s:r,b:o,toString:bt}},v.rgb2hsl=function(e,t,n){n=St(e,t,n),e=n[0],t=n[1],n=n[2];var i,r,o,a,s,l;return a=R(e,t,n),s=U(e,t,n),l=a-s,i=0==l?null:a==e?(t-n)/l:a==t?(n-e)/l+2:(e-t)/l+4,i=60*((i+360)%6)/360,o=(a+s)/2,r=0==l?0:.5>o?l/(2*o):l/(2-2*o),{h:i,s:r,l:o,toString:_t}},v._path2string=function(){return this.join(",").replace(rt,"$1")},v._preload=function(e,t){var n=C.doc.createElement("img");n.style.cssText="position:absolute;left:-9999em;top:-9999em",n.onload=function(){t.call(this),this.onload=null,C.doc.body.removeChild(this)},n.onerror=function(){C.doc.body.removeChild(this)},C.doc.body.appendChild(n),n.src=e},v.getRGB=f(function(e){if(!e||(e=D(e)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:p};if("none"==e)return{r:-1,g:-1,b:-1,hex:"none",toString:p};!it[x](e.toLowerCase().substring(0,2))&&"#"!=e.charAt()&&(e=yt(e));var t,n,i,r,o,a,s=e.match(q);return s?(s[2]&&(i=K(s[2].substring(5),16),n=K(s[2].substring(3,5),16),t=K(s[2].substring(1,3),16)),s[3]&&(i=K((o=s[3].charAt(3))+o,16),n=K((o=s[3].charAt(2))+o,16),t=K((o=s[3].charAt(1))+o,16)),s[4]&&(a=s[4][P](nt),t=Y(a[0]),"%"==a[0].slice(-1)&&(t*=2.55),n=Y(a[1]),"%"==a[1].slice(-1)&&(n*=2.55),i=Y(a[2]),"%"==a[2].slice(-1)&&(i*=2.55),"rgba"==s[1].toLowerCase().slice(0,4)&&(r=Y(a[3])),a[3]&&"%"==a[3].slice(-1)&&(r/=100)),s[5]?(a=s[5][P](nt),t=Y(a[0]),"%"==a[0].slice(-1)&&(t*=2.55),n=Y(a[1]),"%"==a[1].slice(-1)&&(n*=2.55),i=Y(a[2]),"%"==a[2].slice(-1)&&(i*=2.55),("deg"==a[0].slice(-3)||"°"==a[0].slice(-1))&&(t/=360),"hsba"==s[1].toLowerCase().slice(0,4)&&(r=Y(a[3])),a[3]&&"%"==a[3].slice(-1)&&(r/=100),v.hsb2rgb(t,n,i,r)):s[6]?(a=s[6][P](nt),t=Y(a[0]),"%"==a[0].slice(-1)&&(t*=2.55),n=Y(a[1]),"%"==a[1].slice(-1)&&(n*=2.55),i=Y(a[2]),"%"==a[2].slice(-1)&&(i*=2.55),("deg"==a[0].slice(-3)||"°"==a[0].slice(-1))&&(t/=360),"hsla"==s[1].toLowerCase().slice(0,4)&&(r=Y(a[3])),a[3]&&"%"==a[3].slice(-1)&&(r/=100),v.hsl2rgb(t,n,i,r)):(s={r:t,g:n,b:i,toString:p},s.hex="#"+(16777216|i|n<<8|t<<16).toString(16).slice(1),v.is(r,"finite")&&(s.opacity=r),s)):{r:-1,g:-1,b:-1,hex:"none",error:1,toString:p}},v),v.hsb=f(function(e,t,n){return v.hsb2rgb(e,t,n).hex}),v.hsl=f(function(e,t,n){return v.hsl2rgb(e,t,n).hex}),v.rgb=f(function(e,t,n){return"#"+(16777216|n|t<<8|e<<16).toString(16).slice(1)}),v.getColor=function(e){var t=this.getColor.start=this.getColor.start||{h:0,s:1,b:e||.75},n=this.hsb2rgb(t.h,t.s,t.b);return t.h+=.075,t.h>1&&(t.h=0,t.s-=.2,0>=t.s&&(this.getColor.start={h:0,s:1,b:t.b})),n.hex},v.getColor.reset=function(){delete this.start},v.parsePathString=function(e){if(!e)return null;var t=Ct(e);if(t.arr)return Et(t.arr);var n={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},i=[];return v.is(e,V)&&v.is(e[0],V)&&(i=Et(e)),i.length||D(e).replace(ot,function(e,t,r){var o=[],a=t.toLowerCase();if(r.replace(st,function(e,t){t&&o.push(+t)}),"m"==a&&o.length>2&&(i.push([t][k](o.splice(0,2))),a="l",t="m"==t?"l":"L"),"r"==a)i.push([t][k](o));else for(;o.length>=n[a]&&(i.push([t][k](o.splice(0,n[a]))),n[a]););}),i.toString=v._path2string,t.arr=Et(i),i},v.parseTransformString=f(function(e){if(!e)return null;var t=[];return v.is(e,V)&&v.is(e[0],V)&&(t=Et(e)),t.length||D(e).replace(at,function(e,n,i){var r=[];L.call(n),i.replace(st,function(e,t){t&&r.push(+t)}),t.push([n][k](r))}),t.toString=v._path2string,t});var Ct=function(e){var t=Ct.ps=Ct.ps||{};return t[e]?t[e].sleep=100:t[e]={sleep:100},setTimeout(function(){for(var n in t)t[x](n)&&n!=e&&(t[n].sleep--,!t[n].sleep&&delete t[n])}),t[e]};v.findDotsAtSegment=function(e,t,n,i,r,o,a,s,l){var c=1-l,u=j(c,3),d=j(c,2),h=l*l,p=h*l,f=u*e+3*d*l*n+3*c*l*l*r+p*a,m=u*t+3*d*l*i+3*c*l*l*o+p*s,g=e+2*l*(n-e)+h*(r-2*n+e),v=t+2*l*(i-t)+h*(o-2*i+t),y=n+2*l*(r-n)+h*(a-2*r+n),b=i+2*l*(o-i)+h*(s-2*o+i),_=c*e+l*n,w=c*t+l*i,S=c*r+l*a,x=c*o+l*s,C=90-180*O.atan2(g-y,v-b)/G;return(g>y||b>v)&&(C+=180),{x:f,y:m,m:{x:g,y:v},n:{x:y,y:b},start:{x:_,y:w},end:{x:S,y:x},alpha:C}},v.bezierBBox=function(e,t,n,i,r,o,a,s){v.is(e,"array")||(e=[e,t,n,i,r,o,a,s]);var l=Pt.apply(null,e);return{x:l.min.x,y:l.min.y,x2:l.max.x,y2:l.max.y,width:l.max.x-l.min.x,height:l.max.y-l.min.y}},v.isPointInsideBBox=function(e,t,n){return t>=e.x&&e.x2>=t&&n>=e.y&&e.y2>=n},v.isBBoxIntersect=function(e,t){var n=v.isPointInsideBBox;return n(t,e.x,e.y)||n(t,e.x2,e.y)||n(t,e.x,e.y2)||n(t,e.x2,e.y2)||n(e,t.x,t.y)||n(e,t.x2,t.y)||n(e,t.x,t.y2)||n(e,t.x2,t.y2)||(e.x<t.x2&&e.x>t.x||t.x<e.x2&&t.x>e.x)&&(e.y<t.y2&&e.y>t.y||t.y<e.y2&&t.y>e.y)},v.pathIntersection=function(e,t){return a(e,t)},v.pathIntersectionNumber=function(e,t){return a(e,t,1)},v.isPointInsidePath=function(e,t,n){var i=v.pathBBox(e);return v.isPointInsideBBox(i,t,n)&&1==a(e,[["M",t,n],["H",i.x2+10]],1)%2},v._removedFactory=function(e){return function(){eve("raphael.log",null,"Raphaël: you are calling to method “"+e+"” of removed object",e)}};var $t=v.pathBBox=function(e){var t=Ct(e);if(t.bbox)return t.bbox;if(!e)return{x:0,y:0,width:0,height:0,x2:0,y2:0};e=It(e);for(var n,i=0,r=0,o=[],a=[],s=0,l=e.length;l>s;s++)if(n=e[s],"M"==n[0])i=n[1],r=n[2],o.push(i),a.push(r);else{var c=Pt(i,r,n[1],n[2],n[3],n[4],n[5],n[6]);o=o[k](c.min.x,c.max.x),a=a[k](c.min.y,c.max.y),i=n[5],r=n[6]}var u=U[T](0,o),d=U[T](0,a),h=R[T](0,o),p=R[T](0,a),f={x:u,y:d,x2:h,y2:p,width:h-u,height:p-d};return t.bbox=g(f),f},Et=function(e){var t=g(e);return t.toString=v._path2string,t},Tt=v._pathToRelative=function(e){var t=Ct(e);if(t.rel)return Et(t.rel);v.is(e,V)&&v.is(e&&e[0],V)||(e=v.parsePathString(e));var n=[],i=0,r=0,o=0,a=0,s=0;"M"==e[0][0]&&(i=e[0][1],r=e[0][2],o=i,a=r,s++,n.push(["M",i,r]));for(var l=s,c=e.length;c>l;l++){var u=n[l]=[],d=e[l];if(d[0]!=L.call(d[0]))switch(u[0]=L.call(d[0]),u[0]){case"a":u[1]=d[1],u[2]=d[2],u[3]=d[3],u[4]=d[4],u[5]=d[5],u[6]=+(d[6]-i).toFixed(3),u[7]=+(d[7]-r).toFixed(3);break;case"v":u[1]=+(d[1]-r).toFixed(3);break;case"m":o=d[1],a=d[2];default:for(var h=1,p=d.length;p>h;h++)u[h]=+(d[h]-(h%2?i:r)).toFixed(3)}else{u=n[l]=[],"m"==d[0]&&(o=d[1]+i,a=d[2]+r);for(var f=0,m=d.length;m>f;f++)n[l][f]=d[f]}var g=n[l].length;switch(n[l][0]){case"z":i=o,r=a;break;case"h":i+=+n[l][g-1];break;case"v":r+=+n[l][g-1];break;default:i+=+n[l][g-2],r+=+n[l][g-1]}}return n.toString=v._path2string,t.rel=Et(n),n},kt=v._pathToAbsolute=function(e){var t=Ct(e);if(t.abs)return Et(t.abs);if(v.is(e,V)&&v.is(e&&e[0],V)||(e=v.parsePathString(e)),!e||!e.length)return[["M",0,0]];var n=[],i=0,r=0,o=0,a=0,s=0;"M"==e[0][0]&&(i=+e[0][1],r=+e[0][2],o=i,a=r,s++,n[0]=["M",i,r]);for(var l,c,u=3==e.length&&"M"==e[0][0]&&"R"==e[1][0].toUpperCase()&&"Z"==e[2][0].toUpperCase(),d=s,p=e.length;p>d;d++){if(n.push(l=[]),c=e[d],c[0]!=Z.call(c[0]))switch(l[0]=Z.call(c[0]),l[0]){case"A":l[1]=c[1],l[2]=c[2],l[3]=c[3],l[4]=c[4],l[5]=c[5],l[6]=+(c[6]+i),l[7]=+(c[7]+r);break;case"V":l[1]=+c[1]+r;break;case"H":l[1]=+c[1]+i;break;case"R":for(var f=[i,r][k](c.slice(1)),m=2,g=f.length;g>m;m++)f[m]=+f[m]+i,f[++m]=+f[m]+r;n.pop(),n=n[k](h(f,u));break;case"M":o=+c[1]+i,a=+c[2]+r;default:for(m=1,g=c.length;g>m;m++)l[m]=+c[m]+(m%2?i:r)}else if("R"==c[0])f=[i,r][k](c.slice(1)),n.pop(),n=n[k](h(f,u)),l=["R"][k](c.slice(-2));else for(var y=0,b=c.length;b>y;y++)l[y]=c[y];switch(l[0]){case"Z":i=o,r=a;break;case"H":i=l[1];break;case"V":r=l[1];break;case"M":o=l[l.length-2],a=l[l.length-1];default:i=l[l.length-2],r=l[l.length-1]}}return n.toString=v._path2string,t.abs=Et(n),n},At=function(e,t,n,i){return[e,t,n,i,n,i]},Nt=function(e,t,n,i,r,o){var a=1/3,s=2/3;return[a*e+s*n,a*t+s*i,a*r+s*n,a*o+s*i,r,o]},Mt=function(e,t,n,i,r,o,a,s,l,c){var u,d=120*G/180,h=G/180*(+r||0),p=[],m=f(function(e,t,n){var i=e*O.cos(n)-t*O.sin(n),r=e*O.sin(n)+t*O.cos(n);return{x:i,y:r}});if(c)C=c[0],$=c[1],S=c[2],x=c[3];else{u=m(e,t,-h),e=u.x,t=u.y,u=m(s,l,-h),s=u.x,l=u.y;var g=(O.cos(G/180*r),O.sin(G/180*r),(e-s)/2),v=(t-l)/2,y=g*g/(n*n)+v*v/(i*i);y>1&&(y=O.sqrt(y),n=y*n,i=y*i);var b=n*n,_=i*i,w=(o==a?-1:1)*O.sqrt(B((b*_-b*v*v-_*g*g)/(b*v*v+_*g*g))),S=w*n*v/i+(e+s)/2,x=w*-i*g/n+(t+l)/2,C=O.asin(((t-x)/i).toFixed(9)),$=O.asin(((l-x)/i).toFixed(9));C=S>e?G-C:C,$=S>s?G-$:$,0>C&&(C=2*G+C),0>$&&($=2*G+$),a&&C>$&&(C-=2*G),!a&&$>C&&($-=2*G)}var E=$-C;if(B(E)>d){var T=$,A=s,N=l;$=C+d*(a&&$>C?1:-1),s=S+n*O.cos($),l=x+i*O.sin($),p=Mt(s,l,n,i,r,0,a,A,N,[$,T,S,x])}E=$-C;var M=O.cos(C),D=O.sin(C),I=O.cos($),F=O.sin($),L=O.tan(E/4),R=4/3*n*L,U=4/3*i*L,j=[e,t],z=[e+R*D,t-U*M],H=[s+R*F,l-U*I],V=[s,l];if(z[0]=2*j[0]-z[0],z[1]=2*j[1]-z[1],c)return[z,H,V][k](p);p=[z,H,V][k](p).join()[P](",");for(var W=[],q=0,J=p.length;J>q;q++)W[q]=q%2?m(p[q-1],p[q],h).y:m(p[q],p[q+1],h).x;return W},Dt=function(e,t,n,i,r,o,a,s,l){var c=1-l;return{x:j(c,3)*e+3*j(c,2)*l*n+3*c*l*l*r+j(l,3)*a,y:j(c,3)*t+3*j(c,2)*l*i+3*c*l*l*o+j(l,3)*s}},Pt=f(function(e,t,n,i,r,o,a,s){var l,c=r-2*n+e-(a-2*r+n),u=2*(n-e)-2*(r-n),d=e-n,h=(-u+O.sqrt(u*u-4*c*d))/2/c,p=(-u-O.sqrt(u*u-4*c*d))/2/c,f=[t,s],m=[e,a];return B(h)>"1e12"&&(h=.5),B(p)>"1e12"&&(p=.5),h>0&&1>h&&(l=Dt(e,t,n,i,r,o,a,s,h),m.push(l.x),f.push(l.y)),p>0&&1>p&&(l=Dt(e,t,n,i,r,o,a,s,p),m.push(l.x),f.push(l.y)),c=o-2*i+t-(s-2*o+i),u=2*(i-t)-2*(o-i),d=t-i,h=(-u+O.sqrt(u*u-4*c*d))/2/c,p=(-u-O.sqrt(u*u-4*c*d))/2/c,B(h)>"1e12"&&(h=.5),B(p)>"1e12"&&(p=.5),h>0&&1>h&&(l=Dt(e,t,n,i,r,o,a,s,h),m.push(l.x),f.push(l.y)),p>0&&1>p&&(l=Dt(e,t,n,i,r,o,a,s,p),m.push(l.x),f.push(l.y)),{min:{x:U[T](0,m),y:U[T](0,f)},max:{x:R[T](0,m),y:R[T](0,f)}}}),It=v._path2curve=f(function(e,t){var n=!t&&Ct(e);if(!t&&n.curve)return Et(n.curve);for(var i=kt(e),r=t&&kt(t),o={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},a={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},s=(function(e,t){var n,i;if(!e)return["C",t.x,t.y,t.x,t.y,t.x,t.y];switch(!(e[0]in{T:1,Q:1})&&(t.qx=t.qy=null),e[0]){case"M":t.X=e[1],t.Y=e[2];break;case"A":e=["C"][k](Mt[T](0,[t.x,t.y][k](e.slice(1))));break;case"S":n=t.x+(t.x-(t.bx||t.x)),i=t.y+(t.y-(t.by||t.y)),e=["C",n,i][k](e.slice(1));break;case"T":t.qx=t.x+(t.x-(t.qx||t.x)),t.qy=t.y+(t.y-(t.qy||t.y)),e=["C"][k](Nt(t.x,t.y,t.qx,t.qy,e[1],e[2]));break;case"Q":t.qx=e[1],t.qy=e[2],e=["C"][k](Nt(t.x,t.y,e[1],e[2],e[3],e[4]));break;case"L":e=["C"][k](At(t.x,t.y,e[1],e[2]));break;case"H":e=["C"][k](At(t.x,t.y,e[1],t.y));break;case"V":e=["C"][k](At(t.x,t.y,t.x,e[1]));break;case"Z":e=["C"][k](At(t.x,t.y,t.X,t.Y))}return e}),l=function(e,t){if(e[t].length>7){e[t].shift();for(var n=e[t];n.length;)e.splice(t++,0,["C"][k](n.splice(0,6)));e.splice(t,1),d=R(i.length,r&&r.length||0)}},c=function(e,t,n,o,a){e&&t&&"M"==e[a][0]&&"M"!=t[a][0]&&(t.splice(a,0,["M",o.x,o.y]),n.bx=0,n.by=0,n.x=e[a][1],n.y=e[a][2],d=R(i.length,r&&r.length||0))},u=0,d=R(i.length,r&&r.length||0);d>u;u++){i[u]=s(i[u],o),l(i,u),r&&(r[u]=s(r[u],a)),r&&l(r,u),c(i,r,o,a,u),c(r,i,a,o,u);var h=i[u],p=r&&r[u],f=h.length,m=r&&p.length;o.x=h[f-2],o.y=h[f-1],o.bx=Y(h[f-4])||o.x,o.by=Y(h[f-3])||o.y,a.bx=r&&(Y(p[m-4])||a.x),a.by=r&&(Y(p[m-3])||a.y),a.x=r&&p[m-2],a.y=r&&p[m-1]}return r||(n.curve=Et(i)),r?[i,r]:i},null,Et),Ft=(v._parseDots=f(function(e){for(var t=[],n=0,i=e.length;i>n;n++){var r={},o=e[n].match(/^([^:]*):?([\d\.]*)/);if(r.color=v.getRGB(o[1]),r.color.error)return null;r.color=r.color.hex,o[2]&&(r.offset=o[2]+"%"),t.push(r)}for(n=1,i=t.length-1;i>n;n++)if(!t[n].offset){for(var a=Y(t[n-1].offset||0),s=0,l=n+1;i>l;l++)if(t[l].offset){s=t[l].offset;break}s||(s=100,l=i),s=Y(s);for(var c=(s-a)/(l-n+1);l>n;n++)a+=c,t[n].offset=a+"%"}return t}),v._tear=function(e,t){e==t.top&&(t.top=e.prev),e==t.bottom&&(t.bottom=e.next),e.next&&(e.next.prev=e.prev),e.prev&&(e.prev.next=e.next)}),Lt=(v._tofront=function(e,t){t.top!==e&&(Ft(e,t),e.next=null,e.prev=t.top,t.top.next=e,t.top=e)},v._toback=function(e,t){t.bottom!==e&&(Ft(e,t),e.next=t.bottom,e.prev=null,t.bottom.prev=e,t.bottom=e)},v._insertafter=function(e,t,n){Ft(e,n),t==n.top&&(n.top=e),t.next&&(t.next.prev=e),e.next=t.next,e.prev=t,t.next=e},v._insertbefore=function(e,t,n){Ft(e,n),t==n.bottom&&(n.bottom=e),t.prev&&(t.prev.next=e),e.prev=t.prev,t.prev=e,e.next=t},v.toMatrix=function(e,t){var n=$t(e),i={_:{transform:N},getBBox:function(){return n}};return Ot(i,t),i.matrix}),Ot=(v.transformPath=function(e,t){return mt(e,Lt(e,t))},v._extractTransform=function(e,t){if(null==t)return e._.transform;t=D(t).replace(/\.{3}|\u2026/g,e._.transform||N);var n=v.parseTransformString(t),i=0,r=0,a=0,s=1,l=1,c=e._,u=new o;if(c.transform=n||[],n)for(var d=0,h=n.length;h>d;d++){var p,f,m,g,y,b=n[d],_=b.length,w=D(b[0]).toLowerCase(),S=b[0]!=w,x=S?u.invert():0;"t"==w&&3==_?S?(p=x.x(0,0),f=x.y(0,0),m=x.x(b[1],b[2]),g=x.y(b[1],b[2]),u.translate(m-p,g-f)):u.translate(b[1],b[2]):"r"==w?2==_?(y=y||e.getBBox(1),u.rotate(b[1],y.x+y.width/2,y.y+y.height/2),i+=b[1]):4==_&&(S?(m=x.x(b[2],b[3]),g=x.y(b[2],b[3]),u.rotate(b[1],m,g)):u.rotate(b[1],b[2],b[3]),i+=b[1]):"s"==w?2==_||3==_?(y=y||e.getBBox(1),u.scale(b[1],b[_-1],y.x+y.width/2,y.y+y.height/2),s*=b[1],l*=b[_-1]):5==_&&(S?(m=x.x(b[3],b[4]),g=x.y(b[3],b[4]),u.scale(b[1],b[2],m,g)):u.scale(b[1],b[2],b[3],b[4]),s*=b[1],l*=b[2]):"m"==w&&7==_&&u.add(b[1],b[2],b[3],b[4],b[5],b[6]),c.dirtyT=1,e.matrix=u}e.matrix=u,c.sx=s,c.sy=l,c.deg=i,c.dx=r=u.e,c.dy=a=u.f,1==s&&1==l&&!i&&c.bbox?(c.bbox.x+=+r,c.bbox.y+=+a):c.dirtyT=1}),Rt=function(e){var t=e[0];switch(t.toLowerCase()){case"t":return[t,0,0];case"m":return[t,1,0,0,1,0,0];case"r":return 4==e.length?[t,0,e[2],e[3]]:[t,0];case"s":return 5==e.length?[t,1,1,e[3],e[4]]:3==e.length?[t,1,1]:[t,1]}},Ut=v._equaliseTransform=function(e,t){t=D(t).replace(/\.{3}|\u2026/g,e),e=v.parseTransformString(e)||[],t=v.parseTransformString(t)||[];for(var n,i,r,o,a=R(e.length,t.length),s=[],l=[],c=0;a>c;c++){if(r=e[c]||Rt(t[c]),o=t[c]||Rt(r),r[0]!=o[0]||"r"==r[0].toLowerCase()&&(r[2]!=o[2]||r[3]!=o[3])||"s"==r[0].toLowerCase()&&(r[3]!=o[3]||r[4]!=o[4]))return;for(s[c]=[],l[c]=[],n=0,i=R(r.length,o.length);i>n;n++)n in r&&(s[c][n]=r[n]),n in o&&(l[c][n]=o[n])}return{from:s,to:l}};v._getContainer=function(e,t,n,i){var r;return r=null!=i||v.is(e,"object")?e:C.doc.getElementById(e),null!=r?r.tagName?null==t?{container:r,width:r.style.pixelWidth||r.offsetWidth,height:r.style.pixelHeight||r.offsetHeight}:{container:r,width:t,height:n}:{container:1,x:e,y:t,width:n,height:i}:void 0},v.pathToRelative=Tt,v._engine={},v.path2curve=It,v.matrix=function(e,t,n,i,r,a){return new o(e,t,n,i,r,a)},function(e){function t(e){var t=O.sqrt(n(e));e[0]&&(e[0]/=t),e[1]&&(e[1]/=t)}function n(e){return e[0]*e[0]+e[1]*e[1]}e.add=function(e,t,n,i,r,a){var s,l,c,u,d=[[],[],[]],h=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],p=[[e,n,r],[t,i,a],[0,0,1]];for(e&&e instanceof o&&(p=[[e.a,e.c,e.e],[e.b,e.d,e.f],[0,0,1]]),s=0;3>s;s++)for(l=0;3>l;l++){for(u=0,c=0;3>c;c++)u+=h[s][c]*p[c][l];d[s][l]=u}this.a=d[0][0],this.b=d[1][0],this.c=d[0][1],this.d=d[1][1],this.e=d[0][2],this.f=d[1][2]},e.invert=function(){var e=this,t=e.a*e.d-e.b*e.c;return new o(e.d/t,-e.b/t,-e.c/t,e.a/t,(e.c*e.f-e.d*e.e)/t,(e.b*e.e-e.a*e.f)/t)},e.clone=function(){return new o(this.a,this.b,this.c,this.d,this.e,this.f)},e.translate=function(e,t){this.add(1,0,0,1,e,t)},e.scale=function(e,t,n,i){null==t&&(t=e),(n||i)&&this.add(1,0,0,1,n,i),this.add(e,0,0,t,0,0),(n||i)&&this.add(1,0,0,1,-n,-i)},e.rotate=function(e,t,n){e=v.rad(e),t=t||0,n=n||0;
var i=+O.cos(e).toFixed(9),r=+O.sin(e).toFixed(9);this.add(i,r,-r,i,t,n),this.add(1,0,0,1,-t,-n)},e.x=function(e,t){return e*this.a+t*this.c+this.e},e.y=function(e,t){return e*this.b+t*this.d+this.f},e.get=function(e){return+this[D.fromCharCode(97+e)].toFixed(4)},e.toString=function(){return v.svg?"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")":[this.get(0),this.get(2),this.get(1),this.get(3),0,0].join()},e.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get(0)+", M12="+this.get(2)+", M21="+this.get(1)+", M22="+this.get(3)+", Dx="+this.get(4)+", Dy="+this.get(5)+", sizingmethod='auto expand')"},e.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]},e.split=function(){var e={};e.dx=this.e,e.dy=this.f;var i=[[this.a,this.c],[this.b,this.d]];e.scalex=O.sqrt(n(i[0])),t(i[0]),e.shear=i[0][0]*i[1][0]+i[0][1]*i[1][1],i[1]=[i[1][0]-i[0][0]*e.shear,i[1][1]-i[0][1]*e.shear],e.scaley=O.sqrt(n(i[1])),t(i[1]),e.shear/=e.scaley;var r=-i[0][1],o=i[1][1];return 0>o?(e.rotate=v.deg(O.acos(o)),0>r&&(e.rotate=360-e.rotate)):e.rotate=v.deg(O.asin(r)),e.isSimple=!(+e.shear.toFixed(9)||e.scalex.toFixed(9)!=e.scaley.toFixed(9)&&e.rotate),e.isSuperSimple=!+e.shear.toFixed(9)&&e.scalex.toFixed(9)==e.scaley.toFixed(9)&&!e.rotate,e.noRotation=!+e.shear.toFixed(9)&&!e.rotate,e},e.toTransformString=function(e){var t=e||this[P]();return t.isSimple?(t.scalex=+t.scalex.toFixed(4),t.scaley=+t.scaley.toFixed(4),t.rotate=+t.rotate.toFixed(4),(t.dx||t.dy?"t"+[t.dx,t.dy]:N)+(1!=t.scalex||1!=t.scaley?"s"+[t.scalex,t.scaley,0,0]:N)+(t.rotate?"r"+[t.rotate,0,0]:N)):"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]}}(o.prototype);var Bt=navigator.userAgent.match(/Version\/(.*?)\s/)||navigator.userAgent.match(/Chrome\/(\d+)/);b.safari="Apple Computer, Inc."==navigator.vendor&&(Bt&&4>Bt[1]||"iP"==navigator.platform.slice(0,2))||"Google Inc."==navigator.vendor&&Bt&&8>Bt[1]?function(){var e=this.rect(-99,-99,this.width+99,this.height+99).attr({stroke:"none"});setTimeout(function(){e.remove()})}:ut;for(var jt=function(){this.returnValue=!1},Gt=function(){return this.originalEvent.preventDefault()},zt=function(){this.cancelBubble=!0},Ht=function(){return this.originalEvent.stopPropagation()},Vt=function(){return C.doc.addEventListener?function(e,t,n,i){var r=A&&F[t]?F[t]:t,o=function(r){var o=C.doc.documentElement.scrollTop||C.doc.body.scrollTop,a=C.doc.documentElement.scrollLeft||C.doc.body.scrollLeft,s=r.clientX+a,l=r.clientY+o;if(A&&F[x](t))for(var c=0,u=r.targetTouches&&r.targetTouches.length;u>c;c++)if(r.targetTouches[c].target==e){var d=r;r=r.targetTouches[c],r.originalEvent=d,r.preventDefault=Gt,r.stopPropagation=Ht;break}return n.call(i,r,s,l)};return e.addEventListener(r,o,!1),function(){return e.removeEventListener(r,o,!1),!0}}:C.doc.attachEvent?function(e,t,n,i){var r=function(e){e=e||C.win.event;var t=C.doc.documentElement.scrollTop||C.doc.body.scrollTop,r=C.doc.documentElement.scrollLeft||C.doc.body.scrollLeft,o=e.clientX+r,a=e.clientY+t;return e.preventDefault=e.preventDefault||jt,e.stopPropagation=e.stopPropagation||zt,n.call(i,e,o,a)};e.attachEvent("on"+t,r);var o=function(){return e.detachEvent("on"+t,r),!0};return o}:void 0}(),Wt=[],qt=function(e){for(var t,n=e.clientX,i=e.clientY,r=C.doc.documentElement.scrollTop||C.doc.body.scrollTop,o=C.doc.documentElement.scrollLeft||C.doc.body.scrollLeft,a=Wt.length;a--;){if(t=Wt[a],A){for(var s,l=e.touches.length;l--;)if(s=e.touches[l],s.identifier==t.el._drag.id){n=s.clientX,i=s.clientY,(e.originalEvent?e.originalEvent:e).preventDefault();break}}else e.preventDefault();var c,u=t.el.node,d=u.nextSibling,h=u.parentNode,p=u.style.display;C.win.opera&&h.removeChild(u),u.style.display="none",c=t.el.paper.getElementByPoint(n,i),u.style.display=p,C.win.opera&&(d?h.insertBefore(u,d):h.appendChild(u)),c&&eve("raphael.drag.over."+t.el.id,t.el,c),n+=o,i+=r,eve("raphael.drag.move."+t.el.id,t.move_scope||t.el,n-t.el._drag.x,i-t.el._drag.y,n,i,e)}},Jt=function(e){v.unmousemove(qt).unmouseup(Jt);for(var t,n=Wt.length;n--;)t=Wt[n],t.el._drag={},eve("raphael.drag.end."+t.el.id,t.end_scope||t.start_scope||t.move_scope||t.el,e);Wt=[]},Xt=v.el={},Qt=I.length;Qt--;)(function(e){v[e]=Xt[e]=function(t,n){return v.is(t,"function")&&(this.events=this.events||[],this.events.push({name:e,f:t,unbind:Vt(this.shape||this.node||C.doc,e,t,n||this)})),this},v["un"+e]=Xt["un"+e]=function(t){for(var n=this.events||[],i=n.length;i--;)if(n[i].name==e&&n[i].f==t)return n[i].unbind(),n.splice(i,1),!n.length&&delete this.events,this;return this}})(I[Qt]);Xt.data=function(e,t){var n=lt[this.id]=lt[this.id]||{};if(1==arguments.length){if(v.is(e,"object")){for(var i in e)e[x](i)&&this.data(i,e[i]);return this}return eve("raphael.data.get."+this.id,this,n[e],e),n[e]}return n[e]=t,eve("raphael.data.set."+this.id,this,t,e),this},Xt.removeData=function(e){return null==e?lt[this.id]={}:lt[this.id]&&delete lt[this.id][e],this},Xt.hover=function(e,t,n,i){return this.mouseover(e,n).mouseout(t,i||n)},Xt.unhover=function(e,t){return this.unmouseover(e).unmouseout(t)};var Yt=[];Xt.drag=function(e,t,n,i,r,o){function a(a){(a.originalEvent||a).preventDefault();var s=C.doc.documentElement.scrollTop||C.doc.body.scrollTop,l=C.doc.documentElement.scrollLeft||C.doc.body.scrollLeft;this._drag.x=a.clientX+l,this._drag.y=a.clientY+s,this._drag.id=a.identifier,!Wt.length&&v.mousemove(qt).mouseup(Jt),Wt.push({el:this,move_scope:i,start_scope:r,end_scope:o}),t&&eve.on("raphael.drag.start."+this.id,t),e&&eve.on("raphael.drag.move."+this.id,e),n&&eve.on("raphael.drag.end."+this.id,n),eve("raphael.drag.start."+this.id,r||i||this,a.clientX+l,a.clientY+s,a)}return this._drag={},Yt.push({el:this,start:a}),this.mousedown(a),this},Xt.onDragOver=function(e){e?eve.on("raphael.drag.over."+this.id,e):eve.unbind("raphael.drag.over."+this.id)},Xt.undrag=function(){for(var e=Yt.length;e--;)Yt[e].el==this&&(this.unmousedown(Yt[e].start),Yt.splice(e,1),eve.unbind("raphael.drag.*."+this.id));!Yt.length&&v.unmousemove(qt).unmouseup(Jt)},b.circle=function(e,t,n){var i=v._engine.circle(this,e||0,t||0,n||0);return this.__set__&&this.__set__.push(i),i},b.rect=function(e,t,n,i,r){var o=v._engine.rect(this,e||0,t||0,n||0,i||0,r||0);return this.__set__&&this.__set__.push(o),o},b.ellipse=function(e,t,n,i){var r=v._engine.ellipse(this,e||0,t||0,n||0,i||0);return this.__set__&&this.__set__.push(r),r},b.path=function(e){e&&!v.is(e,H)&&!v.is(e[0],V)&&(e+=N);var t=v._engine.path(v.format[T](v,arguments),this);return this.__set__&&this.__set__.push(t),t},b.image=function(e,t,n,i,r){var o=v._engine.image(this,e||"about:blank",t||0,n||0,i||0,r||0);return this.__set__&&this.__set__.push(o),o},b.text=function(e,t,n){var i=v._engine.text(this,e||0,t||0,D(n));return this.__set__&&this.__set__.push(i),i},b.set=function(e){!v.is(e,"array")&&(e=Array.prototype.splice.call(arguments,0,arguments.length));var t=new un(e);return this.__set__&&this.__set__.push(t),t},b.setStart=function(e){this.__set__=e||this.set()},b.setFinish=function(){var e=this.__set__;return delete this.__set__,e},b.setSize=function(e,t){return v._engine.setSize.call(this,e,t)},b.setViewBox=function(e,t,n,i,r){return v._engine.setViewBox.call(this,e,t,n,i,r)},b.top=b.bottom=null,b.raphael=v;var Kt=function(e){var t=e.getBoundingClientRect(),n=e.ownerDocument,i=n.body,r=n.documentElement,o=r.clientTop||i.clientTop||0,a=r.clientLeft||i.clientLeft||0,s=t.top+(C.win.pageYOffset||r.scrollTop||i.scrollTop)-o,l=t.left+(C.win.pageXOffset||r.scrollLeft||i.scrollLeft)-a;return{y:s,x:l}};b.getElementByPoint=function(e,t){var n=this,i=n.canvas,r=C.doc.elementFromPoint(e,t);if(C.win.opera&&"svg"==r.tagName){var o=Kt(i),a=i.createSVGRect();a.x=e-o.x,a.y=t-o.y,a.width=a.height=1;var s=i.getIntersectionList(a,null);s.length&&(r=s[s.length-1])}if(!r)return null;for(;r.parentNode&&r!=i.parentNode&&!r.raphael;)r=r.parentNode;return r==n.canvas.parentNode&&(r=i),r=r&&r.raphael?n.getById(r.raphaelid):null},b.getById=function(e){for(var t=this.bottom;t;){if(t.id==e)return t;t=t.next}return null},b.forEach=function(e,t){for(var n=this.bottom;n;){if(e.call(t,n)===!1)return this;n=n.next}return this},b.getElementsByPoint=function(e,t){var n=this.set();return this.forEach(function(i){i.isPointInside(e,t)&&n.push(i)}),n},Xt.isPointInside=function(e,t){var n=this.realPath=this.realPath||ft[this.type](this);return v.isPointInsidePath(n,e,t)},Xt.getBBox=function(e){if(this.removed)return{};var t=this._;return e?((t.dirty||!t.bboxwt)&&(this.realPath=ft[this.type](this),t.bboxwt=$t(this.realPath),t.bboxwt.toString=r,t.dirty=0),t.bboxwt):((t.dirty||t.dirtyT||!t.bbox)&&((t.dirty||!this.realPath)&&(t.bboxwt=0,this.realPath=ft[this.type](this)),t.bbox=$t(mt(this.realPath,this.matrix)),t.bbox.toString=r,t.dirty=t.dirtyT=0),t.bbox)},Xt.clone=function(){if(this.removed)return null;var e=this.paper[this.type]().attr(this.attr());return this.__set__&&this.__set__.push(e),e},Xt.glow=function(e){if("text"==this.type)return null;e=e||{};var t={width:(e.width||10)+(+this.attr("stroke-width")||1),fill:e.fill||!1,opacity:e.opacity||.5,offsetx:e.offsetx||0,offsety:e.offsety||0,color:e.color||"#000"},n=t.width/2,i=this.paper,r=i.set(),o=this.realPath||ft[this.type](this);o=this.matrix?mt(o,this.matrix):o;for(var a=1;n+1>a;a++)r.push(i.path(o).attr({stroke:t.color,fill:t.fill?t.color:"none","stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(t.width/n*a).toFixed(3),opacity:+(t.opacity/n).toFixed(3)}));return r.insertBefore(this).translate(t.offsetx,t.offsety)};var Zt=function(e,t,n,i,r,o,a,s,l){return null==l?u(e,t,n,i,r,o,a,s):v.findDotsAtSegment(e,t,n,i,r,o,a,s,c(e,t,n,i,r,o,a,s,l))},en=function(e,t){return function(n,i,r){n=It(n);for(var o,a,s,l,c,u="",d={},h=0,p=0,f=n.length;f>p;p++){if(s=n[p],"M"==s[0])o=+s[1],a=+s[2];else{if(l=Zt(o,a,s[1],s[2],s[3],s[4],s[5],s[6]),h+l>i){if(t&&!d.start){if(c=Zt(o,a,s[1],s[2],s[3],s[4],s[5],s[6],i-h),u+=["C"+c.start.x,c.start.y,c.m.x,c.m.y,c.x,c.y],r)return u;d.start=u,u=["M"+c.x,c.y+"C"+c.n.x,c.n.y,c.end.x,c.end.y,s[5],s[6]].join(),h+=l,o=+s[5],a=+s[6];continue}if(!e&&!t)return c=Zt(o,a,s[1],s[2],s[3],s[4],s[5],s[6],i-h),{x:c.x,y:c.y,alpha:c.alpha}}h+=l,o=+s[5],a=+s[6]}u+=s.shift()+s}return d.end=u,c=e?h:t?d:v.findDotsAtSegment(o,a,s[0],s[1],s[2],s[3],s[4],s[5],1),c.alpha&&(c={x:c.x,y:c.y,alpha:c.alpha}),c}},tn=en(1),nn=en(),rn=en(0,1);v.getTotalLength=tn,v.getPointAtLength=nn,v.getSubpath=function(e,t,n){if(1e-6>this.getTotalLength(e)-n)return rn(e,t).end;var i=rn(e,n,1);return t?rn(i,t).end:i},Xt.getTotalLength=function(){return"path"==this.type?this.node.getTotalLength?this.node.getTotalLength():tn(this.attrs.path):void 0},Xt.getPointAtLength=function(e){return"path"==this.type?nn(this.attrs.path,e):void 0},Xt.getSubpath=function(e,t){return"path"==this.type?v.getSubpath(this.attrs.path,e,t):void 0};var on=v.easing_formulas={linear:function(e){return e},"<":function(e){return j(e,1.7)},">":function(e){return j(e,.48)},"<>":function(e){var t=.48-e/1.04,n=O.sqrt(.1734+t*t),i=n-t,r=j(B(i),1/3)*(0>i?-1:1),o=-n-t,a=j(B(o),1/3)*(0>o?-1:1),s=r+a+.5;return 3*(1-s)*s*s+s*s*s},backIn:function(e){var t=1.70158;return e*e*((t+1)*e-t)},backOut:function(e){e-=1;var t=1.70158;return e*e*((t+1)*e+t)+1},elastic:function(e){return e==!!e?e:j(2,-10*e)*O.sin(2*(e-.075)*G/.3)+1},bounce:function(e){var t,n=7.5625,i=2.75;return 1/i>e?t=n*e*e:2/i>e?(e-=1.5/i,t=n*e*e+.75):2.5/i>e?(e-=2.25/i,t=n*e*e+.9375):(e-=2.625/i,t=n*e*e+.984375),t}};on.easeIn=on["ease-in"]=on["<"],on.easeOut=on["ease-out"]=on[">"],on.easeInOut=on["ease-in-out"]=on["<>"],on["back-in"]=on.backIn,on["back-out"]=on.backOut;var an=[],sn=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,16)},ln=function(){for(var e=+new Date,n=0;an.length>n;n++){var i=an[n];if(!i.el.removed&&!i.paused){var r,o,a=e-i.start,s=i.ms,l=i.easing,c=i.from,u=i.diff,d=i.to,h=(i.t,i.el),p={},f={};if(i.initstatus?(a=(i.initstatus*i.anim.top-i.prev)/(i.percent-i.prev)*s,i.status=i.initstatus,delete i.initstatus,i.stop&&an.splice(n--,1)):i.status=(i.prev+(i.percent-i.prev)*(a/s))/i.anim.top,!(0>a))if(s>a){var m=l(a/s);for(var g in c)if(c[x](g)){switch(tt[g]){case z:r=+c[g]+m*s*u[g];break;case"colour":r="rgb("+[cn(Q(c[g].r+m*s*u[g].r)),cn(Q(c[g].g+m*s*u[g].g)),cn(Q(c[g].b+m*s*u[g].b))].join(",")+")";break;case"path":r=[];for(var y=0,b=c[g].length;b>y;y++){r[y]=[c[g][y][0]];for(var _=1,w=c[g][y].length;w>_;_++)r[y][_]=+c[g][y][_]+m*s*u[g][y][_];r[y]=r[y].join(M)}r=r.join(M);break;case"transform":if(u[g].real)for(r=[],y=0,b=c[g].length;b>y;y++)for(r[y]=[c[g][y][0]],_=1,w=c[g][y].length;w>_;_++)r[y][_]=c[g][y][_]+m*s*u[g][y][_];else{var S=function(e){return+c[g][e]+m*s*u[g][e]};r=[["m",S(0),S(1),S(2),S(3),S(4),S(5)]]}break;case"csv":if("clip-rect"==g)for(r=[],y=4;y--;)r[y]=+c[g][y]+m*s*u[g][y];break;default:var C=[][k](c[g]);for(r=[],y=h.paper.customAttributes[g].length;y--;)r[y]=+C[y]+m*s*u[g][y]}p[g]=r}h.attr(p),function(e,t,n){setTimeout(function(){eve("raphael.anim.frame."+e,t,n)})}(h.id,h,i.anim)}else{if(function(e,t,n){setTimeout(function(){eve("raphael.anim.frame."+t.id,t,n),eve("raphael.anim.finish."+t.id,t,n),v.is(e,"function")&&e.call(t)})}(i.callback,h,i.anim),h.attr(d),an.splice(n--,1),i.repeat>1&&!i.next){for(o in d)d[x](o)&&(f[o]=i.totalOrigin[o]);i.el.attr(f),t(i.anim,i.el,i.anim.percents[0],null,i.totalOrigin,i.repeat-1)}i.next&&!i.stop&&t(i.anim,i.el,i.next,null,i.totalOrigin,i.repeat)}}}v.svg&&h&&h.paper&&h.paper.safari(),an.length&&sn(ln)},cn=function(e){return e>255?255:0>e?0:e};Xt.animateWith=function(e,i,r,o,a,s){var l=this;if(l.removed)return s&&s.call(l),l;var c=r instanceof n?r:v.animation(r,o,a,s);t(c,l,c.percents[0],null,l.attr());for(var u=0,d=an.length;d>u;u++)if(an[u].anim==i&&an[u].el==e){an[d-1].start=an[u].start;break}return l},Xt.onAnimation=function(e){return e?eve.on("raphael.anim.frame."+this.id,e):eve.unbind("raphael.anim.frame."+this.id),this},n.prototype.delay=function(e){var t=new n(this.anim,this.ms);return t.times=this.times,t.del=+e||0,t},n.prototype.repeat=function(e){var t=new n(this.anim,this.ms);return t.del=this.del,t.times=O.floor(R(e,0))||1,t},v.animation=function(e,t,i,r){if(e instanceof n)return e;(v.is(i,"function")||!i)&&(r=r||i||null,i=null),e=Object(e),t=+t||0;var o,a,s={};for(a in e)e[x](a)&&Y(a)!=a&&Y(a)+"%"!=a&&(o=!0,s[a]=e[a]);return o?(i&&(s.easing=i),r&&(s.callback=r),new n({100:s},t)):new n(e,t)},Xt.animate=function(e,i,r,o){var a=this;if(a.removed)return o&&o.call(a),a;var s=e instanceof n?e:v.animation(e,i,r,o);return t(s,a,s.percents[0],null,a.attr()),a},Xt.setTime=function(e,t){return e&&null!=t&&this.status(e,U(t,e.ms)/e.ms),this},Xt.status=function(e,n){var i,r,o=[],a=0;if(null!=n)return t(e,this,-1,U(n,1)),this;for(i=an.length;i>a;a++)if(r=an[a],r.el.id==this.id&&(!e||r.anim==e)){if(e)return r.status;o.push({anim:r.anim,status:r.status})}return e?0:o},Xt.pause=function(e){for(var t=0;an.length>t;t++)an[t].el.id==this.id&&(!e||an[t].anim==e)&&eve("raphael.anim.pause."+this.id,this,an[t].anim)!==!1&&(an[t].paused=!0);return this},Xt.resume=function(e){for(var t=0;an.length>t;t++)if(an[t].el.id==this.id&&(!e||an[t].anim==e)){var n=an[t];eve("raphael.anim.resume."+this.id,this,n.anim)!==!1&&(delete n.paused,this.status(n.anim,n.status))}return this},Xt.stop=function(e){for(var t=0;an.length>t;t++)an[t].el.id==this.id&&(!e||an[t].anim==e)&&eve("raphael.anim.stop."+this.id,this,an[t].anim)!==!1&&an.splice(t--,1);return this},eve.on("raphael.remove",e),eve.on("raphael.clear",e),Xt.toString=function(){return"Raphaël’s object"};var un=function(e){if(this.items=[],this.length=0,this.type="set",e)for(var t=0,n=e.length;n>t;t++)e[t]&&(e[t].constructor==Xt.constructor||e[t].constructor==un)&&(this[this.items.length]=this.items[this.items.length]=e[t],this.length++)},dn=un.prototype;dn.push=function(){for(var e,t,n=0,i=arguments.length;i>n;n++)e=arguments[n],e&&(e.constructor==Xt.constructor||e.constructor==un)&&(t=this.items.length,this[t]=this.items[t]=e,this.length++);return this},dn.pop=function(){return this.length&&delete this[this.length--],this.items.pop()},dn.forEach=function(e,t){for(var n=0,i=this.items.length;i>n;n++)if(e.call(t,this.items[n],n)===!1)return this;return this};for(var hn in Xt)Xt[x](hn)&&(dn[hn]=function(e){return function(){var t=arguments;return this.forEach(function(n){n[e][T](n,t)})}}(hn));dn.attr=function(e,t){if(e&&v.is(e,V)&&v.is(e[0],"object"))for(var n=0,i=e.length;i>n;n++)this.items[n].attr(e[n]);else for(var r=0,o=this.items.length;o>r;r++)this.items[r].attr(e,t);return this},dn.clear=function(){for(;this.length;)this.pop()},dn.splice=function(e,t){e=0>e?R(this.length+e,0):e,t=R(0,U(this.length-e,t));var n,i=[],r=[],o=[];for(n=2;arguments.length>n;n++)o.push(arguments[n]);for(n=0;t>n;n++)r.push(this[e+n]);for(;this.length-e>n;n++)i.push(this[e+n]);var a=o.length;for(n=0;a+i.length>n;n++)this.items[e+n]=this[e+n]=a>n?o[n]:i[n-a];for(n=this.items.length=this.length-=t-a;this[n];)delete this[n++];return new un(r)},dn.exclude=function(e){for(var t=0,n=this.length;n>t;t++)if(this[t]==e)return this.splice(t,1),!0},dn.animate=function(e,t,n,i){(v.is(n,"function")||!n)&&(i=n||null);var r,o,a=this.items.length,s=a,l=this;if(!a)return this;i&&(o=function(){!--a&&i.call(l)}),n=v.is(n,H)?n:o;var c=v.animation(e,t,n,o);for(r=this.items[--s].animate(c);s--;)this.items[s]&&!this.items[s].removed&&this.items[s].animateWith(r,c,c);return this},dn.insertAfter=function(e){for(var t=this.items.length;t--;)this.items[t].insertAfter(e);return this},dn.getBBox=function(){for(var e=[],t=[],n=[],i=[],r=this.items.length;r--;)if(!this.items[r].removed){var o=this.items[r].getBBox();e.push(o.x),t.push(o.y),n.push(o.x+o.width),i.push(o.y+o.height)}return e=U[T](0,e),t=U[T](0,t),n=R[T](0,n),i=R[T](0,i),{x:e,y:t,x2:n,y2:i,width:n-e,height:i-t}},dn.clone=function(e){e=new un;for(var t=0,n=this.items.length;n>t;t++)e.push(this.items[t].clone());return e},dn.toString=function(){return"Raphaël‘s set"},v.registerFont=function(e){if(!e.face)return e;this.fonts=this.fonts||{};var t={w:e.w,face:{},glyphs:{}},n=e.face["font-family"];for(var i in e.face)e.face[x](i)&&(t.face[i]=e.face[i]);if(this.fonts[n]?this.fonts[n].push(t):this.fonts[n]=[t],!e.svg){t.face["units-per-em"]=K(e.face["units-per-em"],10);for(var r in e.glyphs)if(e.glyphs[x](r)){var o=e.glyphs[r];if(t.glyphs[r]={w:o.w,k:{},d:o.d&&"M"+o.d.replace(/[mlcxtrv]/g,function(e){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[e]||"M"})+"z"},o.k)for(var a in o.k)o[x](a)&&(t.glyphs[r].k[a]=o.k[a])}}return e},b.getFont=function(e,t,n,i){if(i=i||"normal",n=n||"normal",t=+t||{normal:400,bold:700,lighter:300,bolder:800}[t]||400,v.fonts){var r=v.fonts[e];if(!r){var o=new RegExp("(^|\\s)"+e.replace(/[^\w\d\s+!~.:_-]/g,N)+"(\\s|$)","i");for(var a in v.fonts)if(v.fonts[x](a)&&o.test(a)){r=v.fonts[a];break}}var s;if(r)for(var l=0,c=r.length;c>l&&(s=r[l],s.face["font-weight"]!=t||s.face["font-style"]!=n&&s.face["font-style"]||s.face["font-stretch"]!=i);l++);return s}},b.print=function(e,t,n,i,r,o,a){o=o||"middle",a=R(U(a||0,1),-1);var s,l=D(n)[P](N),c=0,u=0,d=N;if(v.is(i,n)&&(i=this.getFont(i)),i){s=(r||16)/i.face["units-per-em"];for(var h=i.face.bbox[P](_),p=+h[0],f=h[3]-h[1],m=0,g=+h[1]+("baseline"==o?f+ +i.face.descent:f/2),y=0,b=l.length;b>y;y++){if("\n"==l[y])c=0,S=0,u=0,m+=f;else{var w=u&&i.glyphs[l[y-1]]||{},S=i.glyphs[l[y]];c+=u?(w.w||i.w)+(w.k&&w.k[l[y]]||0)+i.w*a:0,u=1}S&&S.d&&(d+=v.transformPath(S.d,["t",c*s,m*s,"s",s,s,p,g,"t",(e-p)/s,(t-g)/s]))}}return this.path(d).attr({fill:"#000",stroke:"none"})},b.add=function(e){if(v.is(e,"array"))for(var t,n=this.set(),i=0,r=e.length;r>i;i++)t=e[i]||{},w[x](t.type)&&n.push(this[t.type]().attr(t));return n},v.format=function(e,t){var n=v.is(t,V)?[0][k](t):arguments;return e&&v.is(e,H)&&n.length-1&&(e=e.replace(S,function(e,t){return null==n[++t]?N:n[t]})),e||N},v.fullfill=function(){var e=/\{([^\}]+)\}/g,t=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,n=function(e,n,i){var r=i;return n.replace(t,function(e,t,n,i,o){t=t||i,r&&(t in r&&(r=r[t]),"function"==typeof r&&o&&(r=r()))}),r=(null==r||r==i?e:r)+""};return function(t,i){return String(t).replace(e,function(e,t){return n(e,t,i)})}}(),v.ninja=function(){return $.was?C.win.Raphael=$.is:delete Raphael,v},v.st=dn,function(e,t,n){function i(){/in/.test(e.readyState)?setTimeout(i,9):v.eve("raphael.DOMload")}null==e.readyState&&e.addEventListener&&(e.addEventListener(t,n=function(){e.removeEventListener(t,n,!1),e.readyState="complete"},!1),e.readyState="loading"),i()}(document,"DOMContentLoaded"),$.was?C.win.Raphael=v:Raphael=v,eve.on("raphael.DOMload",function(){y=!0})}(),window.Raphael.svg&&function(e){var t="hasOwnProperty",n=String,i=parseFloat,r=parseInt,o=Math,a=o.max,s=o.abs,l=o.pow,c=/[, ]+/,u=e.eve,d="",h=" ",p="http://www.w3.org/1999/xlink",f={block:"M5,0 0,2.5 5,5z",classic:"M5,0 0,2.5 5,5 3.5,3 3.5,2z",diamond:"M2.5,0 5,2.5 2.5,5 0,2.5z",open:"M6,1 1,3.5 6,6",oval:"M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"},m={};e.toString=function(){return"Your browser supports SVG.\nYou are running Raphaël "+this.version};var g=function(i,r){if(r){"string"==typeof i&&(i=g(i));for(var o in r)r[t](o)&&("xlink:"==o.substring(0,6)?i.setAttributeNS(p,o.substring(6),n(r[o])):i.setAttribute(o,n(r[o])))}else i=e._g.doc.createElementNS("http://www.w3.org/2000/svg",i),i.style&&(i.style.webkitTapHighlightColor="rgba(0,0,0,0)");return i},v=function(t,r){var c="linear",u=t.id+r,h=.5,p=.5,f=t.node,m=t.paper,v=f.style,y=e._g.doc.getElementById(u);if(!y){if(r=n(r).replace(e._radial_gradient,function(e,t,n){if(c="radial",t&&n){h=i(t),p=i(n);var r=2*(p>.5)-1;l(h-.5,2)+l(p-.5,2)>.25&&(p=o.sqrt(.25-l(h-.5,2))*r+.5)&&.5!=p&&(p=p.toFixed(5)-1e-5*r)}return d}),r=r.split(/\s*\-\s*/),"linear"==c){var b=r.shift();if(b=-i(b),isNaN(b))return null;var _=[0,0,o.cos(e.rad(b)),o.sin(e.rad(b))],w=1/(a(s(_[2]),s(_[3]))||1);_[2]*=w,_[3]*=w,0>_[2]&&(_[0]=-_[2],_[2]=0),0>_[3]&&(_[1]=-_[3],_[3]=0)}var S=e._parseDots(r);if(!S)return null;if(u=u.replace(/[\(\)\s,\xb0#]/g,"_"),t.gradient&&u!=t.gradient.id&&(m.defs.removeChild(t.gradient),delete t.gradient),!t.gradient){y=g(c+"Gradient",{id:u}),t.gradient=y,g(y,"radial"==c?{fx:h,fy:p}:{x1:_[0],y1:_[1],x2:_[2],y2:_[3],gradientTransform:t.matrix.invert()}),m.defs.appendChild(y);for(var x=0,C=S.length;C>x;x++)y.appendChild(g("stop",{offset:S[x].offset?S[x].offset:x?"100%":"0%","stop-color":S[x].color||"#fff"}))}}return g(f,{fill:"url(#"+u+")",opacity:1,"fill-opacity":1}),v.fill=d,v.opacity=1,v.fillOpacity=1,1},y=function(e){var t=e.getBBox(1);g(e.pattern,{patternTransform:e.matrix.invert()+" translate("+t.x+","+t.y+")"})},b=function(i,r,o){if("path"==i.type){for(var a,s,l,c,u,h=n(r).toLowerCase().split("-"),p=i.paper,v=o?"end":"start",y=i.node,b=i.attrs,_=b["stroke-width"],w=h.length,S="classic",x=3,C=3,$=5;w--;)switch(h[w]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":S=h[w];break;case"wide":C=5;break;case"narrow":C=2;break;case"long":x=5;break;case"short":x=2}if("open"==S?(x+=2,C+=2,$+=2,l=1,c=o?4:1,u={fill:"none",stroke:b.stroke}):(c=l=x/2,u={fill:b.stroke,stroke:"none"}),i._.arrows?o?(i._.arrows.endPath&&m[i._.arrows.endPath]--,i._.arrows.endMarker&&m[i._.arrows.endMarker]--):(i._.arrows.startPath&&m[i._.arrows.startPath]--,i._.arrows.startMarker&&m[i._.arrows.startMarker]--):i._.arrows={},"none"!=S){var E="raphael-marker-"+S,T="raphael-marker-"+v+S+x+C;e._g.doc.getElementById(E)?m[E]++:(p.defs.appendChild(g(g("path"),{"stroke-linecap":"round",d:f[S],id:E})),m[E]=1);var k,A=e._g.doc.getElementById(T);A?(m[T]++,k=A.getElementsByTagName("use")[0]):(A=g(g("marker"),{id:T,markerHeight:C,markerWidth:x,orient:"auto",refX:c,refY:C/2}),k=g(g("use"),{"xlink:href":"#"+E,transform:(o?"rotate(180 "+x/2+" "+C/2+") ":d)+"scale("+x/$+","+C/$+")","stroke-width":(1/((x/$+C/$)/2)).toFixed(4)}),A.appendChild(k),p.defs.appendChild(A),m[T]=1),g(k,u);var N=l*("diamond"!=S&&"oval"!=S);o?(a=i._.arrows.startdx*_||0,s=e.getTotalLength(b.path)-N*_):(a=N*_,s=e.getTotalLength(b.path)-(i._.arrows.enddx*_||0)),u={},u["marker-"+v]="url(#"+T+")",(s||a)&&(u.d=Raphael.getSubpath(b.path,a,s)),g(y,u),i._.arrows[v+"Path"]=E,i._.arrows[v+"Marker"]=T,i._.arrows[v+"dx"]=N,i._.arrows[v+"Type"]=S,i._.arrows[v+"String"]=r}else o?(a=i._.arrows.startdx*_||0,s=e.getTotalLength(b.path)-a):(a=0,s=e.getTotalLength(b.path)-(i._.arrows.enddx*_||0)),i._.arrows[v+"Path"]&&g(y,{d:Raphael.getSubpath(b.path,a,s)}),delete i._.arrows[v+"Path"],delete i._.arrows[v+"Marker"],delete i._.arrows[v+"dx"],delete i._.arrows[v+"Type"],delete i._.arrows[v+"String"];for(u in m)if(m[t](u)&&!m[u]){var M=e._g.doc.getElementById(u);M&&M.parentNode.removeChild(M)}}},_={"":[0],none:[0],"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},w=function(e,t,i){if(t=_[n(t).toLowerCase()]){for(var r=e.attrs["stroke-width"]||"1",o={round:r,square:r,butt:0}[e.attrs["stroke-linecap"]||i["stroke-linecap"]]||0,a=[],s=t.length;s--;)a[s]=t[s]*r+(s%2?1:-1)*o;g(e.node,{"stroke-dasharray":a.join(",")})}},S=function(i,o){var l=i.node,u=i.attrs,h=l.style.visibility;l.style.visibility="hidden";for(var f in o)if(o[t](f)){if(!e._availableAttrs[t](f))continue;var m=o[f];switch(u[f]=m,f){case"blur":i.blur(m);break;case"href":case"title":case"target":var _=l.parentNode;if("a"!=_.tagName.toLowerCase()){var S=g("a");_.insertBefore(S,l),S.appendChild(l),_=S}"target"==f?_.setAttributeNS(p,"show","blank"==m?"new":m):_.setAttributeNS(p,f,m);break;case"cursor":l.style.cursor=m;break;case"transform":i.transform(m);break;case"arrow-start":b(i,m);break;case"arrow-end":b(i,m,1);break;case"clip-rect":var x=n(m).split(c);if(4==x.length){i.clip&&i.clip.parentNode.parentNode.removeChild(i.clip.parentNode);var $=g("clipPath"),E=g("rect");$.id=e.createUUID(),g(E,{x:x[0],y:x[1],width:x[2],height:x[3]}),$.appendChild(E),i.paper.defs.appendChild($),g(l,{"clip-path":"url(#"+$.id+")"}),i.clip=E}if(!m){var T=l.getAttribute("clip-path");if(T){var k=e._g.doc.getElementById(T.replace(/(^url\(#|\)$)/g,d));k&&k.parentNode.removeChild(k),g(l,{"clip-path":d}),delete i.clip}}break;case"path":"path"==i.type&&(g(l,{d:m?u.path=e._pathToAbsolute(m):"M0,0"}),i._.dirty=1,i._.arrows&&("startString"in i._.arrows&&b(i,i._.arrows.startString),"endString"in i._.arrows&&b(i,i._.arrows.endString,1)));break;case"width":if(l.setAttribute(f,m),i._.dirty=1,!u.fx)break;f="x",m=u.x;case"x":u.fx&&(m=-u.x-(u.width||0));case"rx":if("rx"==f&&"rect"==i.type)break;case"cx":l.setAttribute(f,m),i.pattern&&y(i),i._.dirty=1;break;case"height":if(l.setAttribute(f,m),i._.dirty=1,!u.fy)break;f="y",m=u.y;case"y":u.fy&&(m=-u.y-(u.height||0));case"ry":if("ry"==f&&"rect"==i.type)break;case"cy":l.setAttribute(f,m),i.pattern&&y(i),i._.dirty=1;break;case"r":"rect"==i.type?g(l,{rx:m,ry:m}):l.setAttribute(f,m),i._.dirty=1;break;case"src":"image"==i.type&&l.setAttributeNS(p,"href",m);break;case"stroke-width":(1!=i._.sx||1!=i._.sy)&&(m/=a(s(i._.sx),s(i._.sy))||1),i.paper._vbSize&&(m*=i.paper._vbSize),l.setAttribute(f,m),u["stroke-dasharray"]&&w(i,u["stroke-dasharray"],o),i._.arrows&&("startString"in i._.arrows&&b(i,i._.arrows.startString),"endString"in i._.arrows&&b(i,i._.arrows.endString,1));break;case"stroke-dasharray":w(i,m,o);break;case"fill":var A=n(m).match(e._ISURL);if(A){$=g("pattern");var N=g("image");$.id=e.createUUID(),g($,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1}),g(N,{x:0,y:0,"xlink:href":A[1]}),$.appendChild(N),function(t){e._preload(A[1],function(){var e=this.offsetWidth,n=this.offsetHeight;g(t,{width:e,height:n}),g(N,{width:e,height:n}),i.paper.safari()})}($),i.paper.defs.appendChild($),g(l,{fill:"url(#"+$.id+")"}),i.pattern=$,i.pattern&&y(i);break}var M=e.getRGB(m);if(M.error){if(("circle"==i.type||"ellipse"==i.type||"r"!=n(m).charAt())&&v(i,m)){if("opacity"in u||"fill-opacity"in u){var D=e._g.doc.getElementById(l.getAttribute("fill").replace(/^url\(#|\)$/g,d));if(D){var P=D.getElementsByTagName("stop");g(P[P.length-1],{"stop-opacity":("opacity"in u?u.opacity:1)*("fill-opacity"in u?u["fill-opacity"]:1)})}}u.gradient=m,u.fill="none";break}}else delete o.gradient,delete u.gradient,!e.is(u.opacity,"undefined")&&e.is(o.opacity,"undefined")&&g(l,{opacity:u.opacity}),!e.is(u["fill-opacity"],"undefined")&&e.is(o["fill-opacity"],"undefined")&&g(l,{"fill-opacity":u["fill-opacity"]});M[t]("opacity")&&g(l,{"fill-opacity":M.opacity>1?M.opacity/100:M.opacity});case"stroke":M=e.getRGB(m),l.setAttribute(f,M.hex),"stroke"==f&&M[t]("opacity")&&g(l,{"stroke-opacity":M.opacity>1?M.opacity/100:M.opacity}),"stroke"==f&&i._.arrows&&("startString"in i._.arrows&&b(i,i._.arrows.startString),"endString"in i._.arrows&&b(i,i._.arrows.endString,1));break;case"gradient":("circle"==i.type||"ellipse"==i.type||"r"!=n(m).charAt())&&v(i,m);break;case"opacity":u.gradient&&!u[t]("stroke-opacity")&&g(l,{"stroke-opacity":m>1?m/100:m});case"fill-opacity":if(u.gradient){D=e._g.doc.getElementById(l.getAttribute("fill").replace(/^url\(#|\)$/g,d)),D&&(P=D.getElementsByTagName("stop"),g(P[P.length-1],{"stop-opacity":m}));break}default:"font-size"==f&&(m=r(m,10)+"px");var I=f.replace(/(\-.)/g,function(e){return e.substring(1).toUpperCase()});l.style[I]=m,i._.dirty=1,l.setAttribute(f,m)}}C(i,o),l.style.visibility=h},x=1.2,C=function(i,o){if("text"==i.type&&(o[t]("text")||o[t]("font")||o[t]("font-size")||o[t]("x")||o[t]("y"))){var a=i.attrs,s=i.node,l=s.firstChild?r(e._g.doc.defaultView.getComputedStyle(s.firstChild,d).getPropertyValue("font-size"),10):10;if(o[t]("text")){for(a.text=o.text;s.firstChild;)s.removeChild(s.firstChild);for(var c,u=n(o.text).split("\n"),h=[],p=0,f=u.length;f>p;p++)c=g("tspan"),p&&g(c,{dy:l*x,x:a.x}),c.appendChild(e._g.doc.createTextNode(u[p])),s.appendChild(c),h[p]=c}else for(h=s.getElementsByTagName("tspan"),p=0,f=h.length;f>p;p++)p?g(h[p],{dy:l*x,x:a.x}):g(h[0],{dy:0});g(s,{x:a.x,y:a.y}),i._.dirty=1;var m=i._getBBox(),v=a.y-(m.y+m.height/2);v&&e.is(v,"finite")&&g(h[0],{dy:v})}},$=function(t,n){this[0]=this.node=t,t.raphael=!0,this.id=e._oid++,t.raphaelid=this.id,this.matrix=e.matrix(),this.realPath=null,this.paper=n,this.attrs=this.attrs||{},this._={transform:[],sx:1,sy:1,deg:0,dx:0,dy:0,dirty:1},!n.bottom&&(n.bottom=this),this.prev=n.top,n.top&&(n.top.next=this),n.top=this,this.next=null},E=e.el;$.prototype=E,E.constructor=$,e._engine.path=function(e,t){var n=g("path");t.canvas&&t.canvas.appendChild(n);var i=new $(n,t);return i.type="path",S(i,{fill:"none",stroke:"#000",path:e}),i},E.rotate=function(e,t,r){if(this.removed)return this;if(e=n(e).split(c),e.length-1&&(t=i(e[1]),r=i(e[2])),e=i(e[0]),null==r&&(t=r),null==t||null==r){var o=this.getBBox(1);t=o.x+o.width/2,r=o.y+o.height/2}return this.transform(this._.transform.concat([["r",e,t,r]])),this},E.scale=function(e,t,r,o){if(this.removed)return this;if(e=n(e).split(c),e.length-1&&(t=i(e[1]),r=i(e[2]),o=i(e[3])),e=i(e[0]),null==t&&(t=e),null==o&&(r=o),null==r||null==o)var a=this.getBBox(1);return r=null==r?a.x+a.width/2:r,o=null==o?a.y+a.height/2:o,this.transform(this._.transform.concat([["s",e,t,r,o]])),this},E.translate=function(e,t){return this.removed?this:(e=n(e).split(c),e.length-1&&(t=i(e[1])),e=i(e[0])||0,t=+t||0,this.transform(this._.transform.concat([["t",e,t]])),this)},E.transform=function(n){var i=this._;if(null==n)return i.transform;if(e._extractTransform(this,n),this.clip&&g(this.clip,{transform:this.matrix.invert()}),this.pattern&&y(this),this.node&&g(this.node,{transform:this.matrix}),1!=i.sx||1!=i.sy){var r=this.attrs[t]("stroke-width")?this.attrs["stroke-width"]:1;this.attr({"stroke-width":r})}return this},E.hide=function(){return!this.removed&&this.paper.safari(this.node.style.display="none"),this},E.show=function(){return!this.removed&&this.paper.safari(this.node.style.display=""),this},E.remove=function(){if(!this.removed&&this.node.parentNode){var t=this.paper;t.__set__&&t.__set__.exclude(this),u.unbind("raphael.*.*."+this.id),this.gradient&&t.defs.removeChild(this.gradient),e._tear(this,t),"a"==this.node.parentNode.tagName.toLowerCase()?this.node.parentNode.parentNode.removeChild(this.node.parentNode):this.node.parentNode.removeChild(this.node);for(var n in this)this[n]="function"==typeof this[n]?e._removedFactory(n):null;this.removed=!0}},E._getBBox=function(){if("none"==this.node.style.display){this.show();var e=!0}var t={};try{t=this.node.getBBox()}catch(n){}finally{t=t||{}}return e&&this.hide(),t},E.attr=function(n,i){if(this.removed)return this;if(null==n){var r={};for(var o in this.attrs)this.attrs[t](o)&&(r[o]=this.attrs[o]);return r.gradient&&"none"==r.fill&&(r.fill=r.gradient)&&delete r.gradient,r.transform=this._.transform,r
}if(null==i&&e.is(n,"string")){if("fill"==n&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;if("transform"==n)return this._.transform;for(var a=n.split(c),s={},l=0,d=a.length;d>l;l++)n=a[l],s[n]=n in this.attrs?this.attrs[n]:e.is(this.paper.customAttributes[n],"function")?this.paper.customAttributes[n].def:e._availableAttrs[n];return d-1?s:s[a[0]]}if(null==i&&e.is(n,"array")){for(s={},l=0,d=n.length;d>l;l++)s[n[l]]=this.attr(n[l]);return s}if(null!=i){var h={};h[n]=i}else null!=n&&e.is(n,"object")&&(h=n);for(var p in h)u("raphael.attr."+p+"."+this.id,this,h[p]);for(p in this.paper.customAttributes)if(this.paper.customAttributes[t](p)&&h[t](p)&&e.is(this.paper.customAttributes[p],"function")){var f=this.paper.customAttributes[p].apply(this,[].concat(h[p]));this.attrs[p]=h[p];for(var m in f)f[t](m)&&(h[m]=f[m])}return S(this,h),this},E.toFront=function(){if(this.removed)return this;"a"==this.node.parentNode.tagName.toLowerCase()?this.node.parentNode.parentNode.appendChild(this.node.parentNode):this.node.parentNode.appendChild(this.node);var t=this.paper;return t.top!=this&&e._tofront(this,t),this},E.toBack=function(){if(this.removed)return this;var t=this.node.parentNode;return"a"==t.tagName.toLowerCase()?t.parentNode.insertBefore(this.node.parentNode,this.node.parentNode.parentNode.firstChild):t.firstChild!=this.node&&t.insertBefore(this.node,this.node.parentNode.firstChild),e._toback(this,this.paper),this.paper,this},E.insertAfter=function(t){if(this.removed)return this;var n=t.node||t[t.length-1].node;return n.nextSibling?n.parentNode.insertBefore(this.node,n.nextSibling):n.parentNode.appendChild(this.node),e._insertafter(this,t,this.paper),this},E.insertBefore=function(t){if(this.removed)return this;var n=t.node||t[0].node;return n.parentNode.insertBefore(this.node,n),e._insertbefore(this,t,this.paper),this},E.blur=function(t){var n=this;if(0!==+t){var i=g("filter"),r=g("feGaussianBlur");n.attrs.blur=t,i.id=e.createUUID(),g(r,{stdDeviation:+t||1.5}),i.appendChild(r),n.paper.defs.appendChild(i),n._blur=i,g(n.node,{filter:"url(#"+i.id+")"})}else n._blur&&(n._blur.parentNode.removeChild(n._blur),delete n._blur,delete n.attrs.blur),n.node.removeAttribute("filter")},e._engine.circle=function(e,t,n,i){var r=g("circle");e.canvas&&e.canvas.appendChild(r);var o=new $(r,e);return o.attrs={cx:t,cy:n,r:i,fill:"none",stroke:"#000"},o.type="circle",g(r,o.attrs),o},e._engine.rect=function(e,t,n,i,r,o){var a=g("rect");e.canvas&&e.canvas.appendChild(a);var s=new $(a,e);return s.attrs={x:t,y:n,width:i,height:r,r:o||0,rx:o||0,ry:o||0,fill:"none",stroke:"#000"},s.type="rect",g(a,s.attrs),s},e._engine.ellipse=function(e,t,n,i,r){var o=g("ellipse");e.canvas&&e.canvas.appendChild(o);var a=new $(o,e);return a.attrs={cx:t,cy:n,rx:i,ry:r,fill:"none",stroke:"#000"},a.type="ellipse",g(o,a.attrs),a},e._engine.image=function(e,t,n,i,r,o){var a=g("image");g(a,{x:n,y:i,width:r,height:o,preserveAspectRatio:"none"}),a.setAttributeNS(p,"href",t),e.canvas&&e.canvas.appendChild(a);var s=new $(a,e);return s.attrs={x:n,y:i,width:r,height:o,src:t},s.type="image",s},e._engine.text=function(t,n,i,r){var o=g("text");t.canvas&&t.canvas.appendChild(o);var a=new $(o,t);return a.attrs={x:n,y:i,"text-anchor":"middle",text:r,font:e._availableAttrs.font,stroke:"none",fill:"#000"},a.type="text",S(a,a.attrs),a},e._engine.setSize=function(e,t){return this.width=e||this.width,this.height=t||this.height,this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height),this._viewBox&&this.setViewBox.apply(this,this._viewBox),this},e._engine.create=function(){var t=e._getContainer.apply(0,arguments),n=t&&t.container,i=t.x,r=t.y,o=t.width,a=t.height;if(!n)throw new Error("SVG container not found.");var s,l=g("svg"),c="overflow:hidden;";return i=i||0,r=r||0,o=o||512,a=a||342,g(l,{height:a,version:1.1,width:o,xmlns:"http://www.w3.org/2000/svg"}),1==n?(l.style.cssText=c+"position:absolute;left:"+i+"px;top:"+r+"px",e._g.doc.body.appendChild(l),s=1):(l.style.cssText=c+"position:relative",n.firstChild?n.insertBefore(l,n.firstChild):n.appendChild(l)),n=new e._Paper,n.width=o,n.height=a,n.canvas=l,n.clear(),n._left=n._top=0,s&&(n.renderfix=function(){}),n.renderfix(),n},e._engine.setViewBox=function(e,t,n,i,r){u("raphael.setViewBox",this,this._viewBox,[e,t,n,i,r]);var o,s,l=a(n/this.width,i/this.height),c=this.top,d=r?"meet":"xMinYMin";for(null==e?(this._vbSize&&(l=1),delete this._vbSize,o="0 0 "+this.width+h+this.height):(this._vbSize=l,o=e+h+t+h+n+h+i),g(this.canvas,{viewBox:o,preserveAspectRatio:d});l&&c;)s="stroke-width"in c.attrs?c.attrs["stroke-width"]:1,c.attr({"stroke-width":s}),c._.dirty=1,c._.dirtyT=1,c=c.prev;return this._viewBox=[e,t,n,i,!!r],this},e.prototype.renderfix=function(){var e,t=this.canvas,n=t.style;try{e=t.getScreenCTM()||t.createSVGMatrix()}catch(i){e=t.createSVGMatrix()}var r=-e.e%1,o=-e.f%1;(r||o)&&(r&&(this._left=(this._left+r)%1,n.left=this._left+"px"),o&&(this._top=(this._top+o)%1,n.top=this._top+"px"))},e.prototype.clear=function(){e.eve("raphael.clear",this);for(var t=this.canvas;t.firstChild;)t.removeChild(t.firstChild);this.bottom=this.top=null,(this.desc=g("desc")).appendChild(e._g.doc.createTextNode("Created with Raphaël "+e.version)),t.appendChild(this.desc),t.appendChild(this.defs=g("defs"))},e.prototype.remove=function(){u("raphael.remove",this),this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(var t in this)this[t]="function"==typeof this[t]?e._removedFactory(t):null};var T=e.st;for(var k in E)E[t](k)&&!T[t](k)&&(T[k]=function(e){return function(){var t=arguments;return this.forEach(function(n){n[e].apply(n,t)})}}(k))}(window.Raphael),window.Raphael.vml&&function(e){var t="hasOwnProperty",n=String,i=parseFloat,r=Math,o=r.round,a=r.max,s=r.min,l=r.abs,c="fill",u=/[, ]+/,d=e.eve,h=" progid:DXImageTransform.Microsoft",p=" ",f="",m={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},g=/([clmz]),?([^clmz]*)/gi,v=/ progid:\S+Blur\([^\)]+\)/g,y=/-?[^,\s-]+/g,b="position:absolute;left:0;top:0;width:1px;height:1px",_=21600,w={path:1,rect:1,image:1},S={circle:1,ellipse:1},x=function(t){var i=/[ahqstv]/gi,r=e._pathToAbsolute;if(n(t).match(i)&&(r=e._path2curve),i=/[clmz]/g,r==e._pathToAbsolute&&!n(t).match(i)){var a=n(t).replace(g,function(e,t,n){var i=[],r="m"==t.toLowerCase(),a=m[t];return n.replace(y,function(e){r&&2==i.length&&(a+=i+m["m"==t?"l":"L"],i=[]),i.push(o(e*_))}),a+i});return a}var s,l,c=r(t);a=[];for(var u=0,d=c.length;d>u;u++){s=c[u],l=c[u][0].toLowerCase(),"z"==l&&(l="x");for(var h=1,v=s.length;v>h;h++)l+=o(s[h]*_)+(h!=v-1?",":f);a.push(l)}return a.join(p)},C=function(t,n,i){var r=e.matrix();return r.rotate(-t,.5,.5),{dx:r.x(n,i),dy:r.y(n,i)}},$=function(e,t,n,i,r,o){var a=e._,s=e.matrix,u=a.fillpos,d=e.node,h=d.style,f=1,m="",g=_/t,v=_/n;if(h.visibility="hidden",t&&n){if(d.coordsize=l(g)+p+l(v),h.rotation=o*(0>t*n?-1:1),o){var y=C(o,i,r);i=y.dx,r=y.dy}if(0>t&&(m+="x"),0>n&&(m+=" y")&&(f=-1),h.flip=m,d.coordorigin=i*-g+p+r*-v,u||a.fillsize){var b=d.getElementsByTagName(c);b=b&&b[0],d.removeChild(b),u&&(y=C(o,s.x(u[0],u[1]),s.y(u[0],u[1])),b.position=y.dx*f+p+y.dy*f),a.fillsize&&(b.size=a.fillsize[0]*l(t)+p+a.fillsize[1]*l(n)),d.appendChild(b)}h.visibility="visible"}};e.toString=function(){return"Your browser doesn’t support SVG. Falling down to VML.\nYou are running Raphaël "+this.version};var E=function(e,t,i){for(var r=n(t).toLowerCase().split("-"),o=i?"end":"start",a=r.length,s="classic",l="medium",c="medium";a--;)switch(r[a]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":s=r[a];break;case"wide":case"narrow":c=r[a];break;case"long":case"short":l=r[a]}var u=e.node.getElementsByTagName("stroke")[0];u[o+"arrow"]=s,u[o+"arrowlength"]=l,u[o+"arrowwidth"]=c},T=function(r,l){r.attrs=r.attrs||{};var d=r.node,h=r.attrs,m=d.style,g=w[r.type]&&(l.x!=h.x||l.y!=h.y||l.width!=h.width||l.height!=h.height||l.cx!=h.cx||l.cy!=h.cy||l.rx!=h.rx||l.ry!=h.ry||l.r!=h.r),v=S[r.type]&&(h.cx!=l.cx||h.cy!=l.cy||h.r!=l.r||h.rx!=l.rx||h.ry!=l.ry),y=r;for(var b in l)l[t](b)&&(h[b]=l[b]);if(g&&(h.path=e._getPath[r.type](r),r._.dirty=1),l.href&&(d.href=l.href),l.title&&(d.title=l.title),l.target&&(d.target=l.target),l.cursor&&(m.cursor=l.cursor),"blur"in l&&r.blur(l.blur),(l.path&&"path"==r.type||g)&&(d.path=x(~n(h.path).toLowerCase().indexOf("r")?e._pathToAbsolute(h.path):h.path),"image"==r.type&&(r._.fillpos=[h.x,h.y],r._.fillsize=[h.width,h.height],$(r,1,1,0,0,0))),"transform"in l&&r.transform(l.transform),v){var C=+h.cx,T=+h.cy,A=+h.rx||+h.r||0,N=+h.ry||+h.r||0;d.path=e.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x",o((C-A)*_),o((T-N)*_),o((C+A)*_),o((T+N)*_),o(C*_))}if("clip-rect"in l){var D=n(l["clip-rect"]).split(u);if(4==D.length){D[2]=+D[2]+ +D[0],D[3]=+D[3]+ +D[1];var P=d.clipRect||e._g.doc.createElement("div"),I=P.style;I.clip=e.format("rect({1}px {2}px {3}px {0}px)",D),d.clipRect||(I.position="absolute",I.top=0,I.left=0,I.width=r.paper.width+"px",I.height=r.paper.height+"px",d.parentNode.insertBefore(P,d),P.appendChild(d),d.clipRect=P)}l["clip-rect"]||d.clipRect&&(d.clipRect.style.clip="auto")}if(r.textpath){var F=r.textpath.style;l.font&&(F.font=l.font),l["font-family"]&&(F.fontFamily='"'+l["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g,f)+'"'),l["font-size"]&&(F.fontSize=l["font-size"]),l["font-weight"]&&(F.fontWeight=l["font-weight"]),l["font-style"]&&(F.fontStyle=l["font-style"])}if("arrow-start"in l&&E(y,l["arrow-start"]),"arrow-end"in l&&E(y,l["arrow-end"],1),null!=l.opacity||null!=l["stroke-width"]||null!=l.fill||null!=l.src||null!=l.stroke||null!=l["stroke-width"]||null!=l["stroke-opacity"]||null!=l["fill-opacity"]||null!=l["stroke-dasharray"]||null!=l["stroke-miterlimit"]||null!=l["stroke-linejoin"]||null!=l["stroke-linecap"]){var L=d.getElementsByTagName(c),O=!1;if(L=L&&L[0],!L&&(O=L=M(c)),"image"==r.type&&l.src&&(L.src=l.src),l.fill&&(L.on=!0),(null==L.on||"none"==l.fill||null===l.fill)&&(L.on=!1),L.on&&l.fill){var R=n(l.fill).match(e._ISURL);if(R){L.parentNode==d&&d.removeChild(L),L.rotate=!0,L.src=R[1],L.type="tile";var U=r.getBBox(1);L.position=U.x+p+U.y,r._.fillpos=[U.x,U.y],e._preload(R[1],function(){r._.fillsize=[this.offsetWidth,this.offsetHeight]})}else L.color=e.getRGB(l.fill).hex,L.src=f,L.type="solid",e.getRGB(l.fill).error&&(y.type in{circle:1,ellipse:1}||"r"!=n(l.fill).charAt())&&k(y,l.fill,L)&&(h.fill="none",h.gradient=l.fill,L.rotate=!1)}if("fill-opacity"in l||"opacity"in l){var B=((+h["fill-opacity"]+1||2)-1)*((+h.opacity+1||2)-1)*((+e.getRGB(l.fill).o+1||2)-1);B=s(a(B,0),1),L.opacity=B,L.src&&(L.color="none")}d.appendChild(L);var j=d.getElementsByTagName("stroke")&&d.getElementsByTagName("stroke")[0],G=!1;!j&&(G=j=M("stroke")),(l.stroke&&"none"!=l.stroke||l["stroke-width"]||null!=l["stroke-opacity"]||l["stroke-dasharray"]||l["stroke-miterlimit"]||l["stroke-linejoin"]||l["stroke-linecap"])&&(j.on=!0),("none"==l.stroke||null===l.stroke||null==j.on||0==l.stroke||0==l["stroke-width"])&&(j.on=!1);var z=e.getRGB(l.stroke);j.on&&l.stroke&&(j.color=z.hex),B=((+h["stroke-opacity"]+1||2)-1)*((+h.opacity+1||2)-1)*((+z.o+1||2)-1);var H=.75*(i(l["stroke-width"])||1);if(B=s(a(B,0),1),null==l["stroke-width"]&&(H=h["stroke-width"]),l["stroke-width"]&&(j.weight=H),H&&1>H&&(B*=H)&&(j.weight=1),j.opacity=B,l["stroke-linejoin"]&&(j.joinstyle=l["stroke-linejoin"]||"miter"),j.miterlimit=l["stroke-miterlimit"]||8,l["stroke-linecap"]&&(j.endcap="butt"==l["stroke-linecap"]?"flat":"square"==l["stroke-linecap"]?"square":"round"),l["stroke-dasharray"]){var V={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"};j.dashstyle=V[t](l["stroke-dasharray"])?V[l["stroke-dasharray"]]:f}G&&d.appendChild(j)}if("text"==y.type){y.paper.canvas.style.display=f;var W=y.paper.span,q=100,J=h.font&&h.font.match(/\d+(?:\.\d*)?(?=px)/);m=W.style,h.font&&(m.font=h.font),h["font-family"]&&(m.fontFamily=h["font-family"]),h["font-weight"]&&(m.fontWeight=h["font-weight"]),h["font-style"]&&(m.fontStyle=h["font-style"]),J=i(h["font-size"]||J&&J[0])||10,m.fontSize=J*q+"px",y.textpath.string&&(W.innerHTML=n(y.textpath.string).replace(/</g,"&#60;").replace(/&/g,"&#38;").replace(/\n/g,"<br>"));var X=W.getBoundingClientRect();y.W=h.w=(X.right-X.left)/q,y.H=h.h=(X.bottom-X.top)/q,y.X=h.x,y.Y=h.y+y.H/2,("x"in l||"y"in l)&&(y.path.v=e.format("m{0},{1}l{2},{1}",o(h.x*_),o(h.y*_),o(h.x*_)+1));for(var Q=["x","y","text","font","font-family","font-weight","font-style","font-size"],Y=0,K=Q.length;K>Y;Y++)if(Q[Y]in l){y._.dirty=1;break}switch(h["text-anchor"]){case"start":y.textpath.style["v-text-align"]="left",y.bbx=y.W/2;break;case"end":y.textpath.style["v-text-align"]="right",y.bbx=-y.W/2;break;default:y.textpath.style["v-text-align"]="center",y.bbx=0}y.textpath.style["v-text-kern"]=!0}},k=function(t,o,a){t.attrs=t.attrs||{};var s=(t.attrs,Math.pow),l="linear",c=".5 .5";if(t.attrs.gradient=o,o=n(o).replace(e._radial_gradient,function(e,t,n){return l="radial",t&&n&&(t=i(t),n=i(n),s(t-.5,2)+s(n-.5,2)>.25&&(n=r.sqrt(.25-s(t-.5,2))*(2*(n>.5)-1)+.5),c=t+p+n),f}),o=o.split(/\s*\-\s*/),"linear"==l){var u=o.shift();if(u=-i(u),isNaN(u))return null}var d=e._parseDots(o);if(!d)return null;if(t=t.shape||t.node,d.length){t.removeChild(a),a.on=!0,a.method="none",a.color=d[0].color,a.color2=d[d.length-1].color;for(var h=[],m=0,g=d.length;g>m;m++)d[m].offset&&h.push(d[m].offset+p+d[m].color);a.colors=h.length?h.join():"0% "+a.color,"radial"==l?(a.type="gradientTitle",a.focus="100%",a.focussize="0 0",a.focusposition=c,a.angle=0):(a.type="gradient",a.angle=(270-u)%360),t.appendChild(a)}return 1},A=function(t,n){this[0]=this.node=t,t.raphael=!0,this.id=e._oid++,t.raphaelid=this.id,this.X=0,this.Y=0,this.attrs={},this.paper=n,this.matrix=e.matrix(),this._={transform:[],sx:1,sy:1,dx:0,dy:0,deg:0,dirty:1,dirtyT:1},!n.bottom&&(n.bottom=this),this.prev=n.top,n.top&&(n.top.next=this),n.top=this,this.next=null},N=e.el;A.prototype=N,N.constructor=A,N.transform=function(t){if(null==t)return this._.transform;var i,r=this.paper._viewBoxShift,o=r?"s"+[r.scale,r.scale]+"-1-1t"+[r.dx,r.dy]:f;r&&(i=t=n(t).replace(/\.{3}|\u2026/g,this._.transform||f)),e._extractTransform(this,o+t);var a,s=this.matrix.clone(),l=this.skew,c=this.node,u=~n(this.attrs.fill).indexOf("-"),d=!n(this.attrs.fill).indexOf("url(");if(s.translate(-.5,-.5),d||u||"image"==this.type)if(l.matrix="1 0 0 1",l.offset="0 0",a=s.split(),u&&a.noRotation||!a.isSimple){c.style.filter=s.toFilter();var h=this.getBBox(),m=this.getBBox(1),g=h.x-m.x,v=h.y-m.y;c.coordorigin=g*-_+p+v*-_,$(this,1,1,g,v,0)}else c.style.filter=f,$(this,a.scalex,a.scaley,a.dx,a.dy,a.rotate);else c.style.filter=f,l.matrix=n(s),l.offset=s.offset();return i&&(this._.transform=i),this},N.rotate=function(e,t,r){if(this.removed)return this;if(null!=e){if(e=n(e).split(u),e.length-1&&(t=i(e[1]),r=i(e[2])),e=i(e[0]),null==r&&(t=r),null==t||null==r){var o=this.getBBox(1);t=o.x+o.width/2,r=o.y+o.height/2}return this._.dirtyT=1,this.transform(this._.transform.concat([["r",e,t,r]])),this}},N.translate=function(e,t){return this.removed?this:(e=n(e).split(u),e.length-1&&(t=i(e[1])),e=i(e[0])||0,t=+t||0,this._.bbox&&(this._.bbox.x+=e,this._.bbox.y+=t),this.transform(this._.transform.concat([["t",e,t]])),this)},N.scale=function(e,t,r,o){if(this.removed)return this;if(e=n(e).split(u),e.length-1&&(t=i(e[1]),r=i(e[2]),o=i(e[3]),isNaN(r)&&(r=null),isNaN(o)&&(o=null)),e=i(e[0]),null==t&&(t=e),null==o&&(r=o),null==r||null==o)var a=this.getBBox(1);return r=null==r?a.x+a.width/2:r,o=null==o?a.y+a.height/2:o,this.transform(this._.transform.concat([["s",e,t,r,o]])),this._.dirtyT=1,this},N.hide=function(){return!this.removed&&(this.node.style.display="none"),this},N.show=function(){return!this.removed&&(this.node.style.display=f),this},N._getBBox=function(){return this.removed?{}:{x:this.X+(this.bbx||0)-this.W/2,y:this.Y-this.H,width:this.W,height:this.H}},N.remove=function(){if(!this.removed&&this.node.parentNode){this.paper.__set__&&this.paper.__set__.exclude(this),e.eve.unbind("raphael.*.*."+this.id),e._tear(this,this.paper),this.node.parentNode.removeChild(this.node),this.shape&&this.shape.parentNode.removeChild(this.shape);for(var t in this)this[t]="function"==typeof this[t]?e._removedFactory(t):null;this.removed=!0}},N.attr=function(n,i){if(this.removed)return this;if(null==n){var r={};for(var o in this.attrs)this.attrs[t](o)&&(r[o]=this.attrs[o]);return r.gradient&&"none"==r.fill&&(r.fill=r.gradient)&&delete r.gradient,r.transform=this._.transform,r}if(null==i&&e.is(n,"string")){if(n==c&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;for(var a=n.split(u),s={},l=0,h=a.length;h>l;l++)n=a[l],s[n]=n in this.attrs?this.attrs[n]:e.is(this.paper.customAttributes[n],"function")?this.paper.customAttributes[n].def:e._availableAttrs[n];return h-1?s:s[a[0]]}if(this.attrs&&null==i&&e.is(n,"array")){for(s={},l=0,h=n.length;h>l;l++)s[n[l]]=this.attr(n[l]);return s}var p;null!=i&&(p={},p[n]=i),null==i&&e.is(n,"object")&&(p=n);for(var f in p)d("raphael.attr."+f+"."+this.id,this,p[f]);if(p){for(f in this.paper.customAttributes)if(this.paper.customAttributes[t](f)&&p[t](f)&&e.is(this.paper.customAttributes[f],"function")){var m=this.paper.customAttributes[f].apply(this,[].concat(p[f]));this.attrs[f]=p[f];for(var g in m)m[t](g)&&(p[g]=m[g])}p.text&&"text"==this.type&&(this.textpath.string=p.text),T(this,p)}return this},N.toFront=function(){return!this.removed&&this.node.parentNode.appendChild(this.node),this.paper&&this.paper.top!=this&&e._tofront(this,this.paper),this},N.toBack=function(){return this.removed?this:(this.node.parentNode.firstChild!=this.node&&(this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild),e._toback(this,this.paper)),this)},N.insertAfter=function(t){return this.removed?this:(t.constructor==e.st.constructor&&(t=t[t.length-1]),t.node.nextSibling?t.node.parentNode.insertBefore(this.node,t.node.nextSibling):t.node.parentNode.appendChild(this.node),e._insertafter(this,t,this.paper),this)},N.insertBefore=function(t){return this.removed?this:(t.constructor==e.st.constructor&&(t=t[0]),t.node.parentNode.insertBefore(this.node,t.node),e._insertbefore(this,t,this.paper),this)},N.blur=function(t){var n=this.node.runtimeStyle,i=n.filter;i=i.replace(v,f),0!==+t?(this.attrs.blur=t,n.filter=i+p+h+".Blur(pixelradius="+(+t||1.5)+")",n.margin=e.format("-{0}px 0 0 -{0}px",o(+t||1.5))):(n.filter=i,n.margin=0,delete this.attrs.blur)},e._engine.path=function(e,t){var n=M("shape");n.style.cssText=b,n.coordsize=_+p+_,n.coordorigin=t.coordorigin;var i=new A(n,t),r={fill:"none",stroke:"#000"};e&&(r.path=e),i.type="path",i.path=[],i.Path=f,T(i,r),t.canvas.appendChild(n);var o=M("skew");return o.on=!0,n.appendChild(o),i.skew=o,i.transform(f),i},e._engine.rect=function(t,n,i,r,o,a){var s=e._rectPath(n,i,r,o,a),l=t.path(s),c=l.attrs;return l.X=c.x=n,l.Y=c.y=i,l.W=c.width=r,l.H=c.height=o,c.r=a,c.path=s,l.type="rect",l},e._engine.ellipse=function(e,t,n,i,r){var o=e.path();return o.attrs,o.X=t-i,o.Y=n-r,o.W=2*i,o.H=2*r,o.type="ellipse",T(o,{cx:t,cy:n,rx:i,ry:r}),o},e._engine.circle=function(e,t,n,i){var r=e.path();return r.attrs,r.X=t-i,r.Y=n-i,r.W=r.H=2*i,r.type="circle",T(r,{cx:t,cy:n,r:i}),r},e._engine.image=function(t,n,i,r,o,a){var s=e._rectPath(i,r,o,a),l=t.path(s).attr({stroke:"none"}),u=l.attrs,d=l.node,h=d.getElementsByTagName(c)[0];return u.src=n,l.X=u.x=i,l.Y=u.y=r,l.W=u.width=o,l.H=u.height=a,u.path=s,l.type="image",h.parentNode==d&&d.removeChild(h),h.rotate=!0,h.src=n,h.type="tile",l._.fillpos=[i,r],l._.fillsize=[o,a],d.appendChild(h),$(l,1,1,0,0,0),l},e._engine.text=function(t,i,r,a){var s=M("shape"),l=M("path"),c=M("textpath");i=i||0,r=r||0,a=a||"",l.v=e.format("m{0},{1}l{2},{1}",o(i*_),o(r*_),o(i*_)+1),l.textpathok=!0,c.string=n(a),c.on=!0,s.style.cssText=b,s.coordsize=_+p+_,s.coordorigin="0 0";var u=new A(s,t),d={fill:"#000",stroke:"none",font:e._availableAttrs.font,text:a};u.shape=s,u.path=l,u.textpath=c,u.type="text",u.attrs.text=n(a),u.attrs.x=i,u.attrs.y=r,u.attrs.w=1,u.attrs.h=1,T(u,d),s.appendChild(c),s.appendChild(l),t.canvas.appendChild(s);var h=M("skew");return h.on=!0,s.appendChild(h),u.skew=h,u.transform(f),u},e._engine.setSize=function(t,n){var i=this.canvas.style;return this.width=t,this.height=n,t==+t&&(t+="px"),n==+n&&(n+="px"),i.width=t,i.height=n,i.clip="rect(0 "+t+" "+n+" 0)",this._viewBox&&e._engine.setViewBox.apply(this,this._viewBox),this},e._engine.setViewBox=function(t,n,i,r,o){e.eve("raphael.setViewBox",this,this._viewBox,[t,n,i,r,o]);var s,l,c=this.width,u=this.height,d=1/a(i/c,r/u);return o&&(s=u/r,l=c/i,c>i*s&&(t-=(c-i*s)/2/s),u>r*l&&(n-=(u-r*l)/2/l)),this._viewBox=[t,n,i,r,!!o],this._viewBoxShift={dx:-t,dy:-n,scale:d},this.forEach(function(e){e.transform("...")}),this};var M;e._engine.initWin=function(e){var t=e.document;t.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{!t.namespaces.rvml&&t.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),M=function(e){return t.createElement("<rvml:"+e+' class="rvml">')}}catch(n){M=function(e){return t.createElement("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}},e._engine.initWin(e._g.win),e._engine.create=function(){var t=e._getContainer.apply(0,arguments),n=t.container,i=t.height,r=t.width,o=t.x,a=t.y;if(!n)throw new Error("VML container not found.");var s=new e._Paper,l=s.canvas=e._g.doc.createElement("div"),c=l.style;return o=o||0,a=a||0,r=r||512,i=i||342,s.width=r,s.height=i,r==+r&&(r+="px"),i==+i&&(i+="px"),s.coordsize=1e3*_+p+1e3*_,s.coordorigin="0 0",s.span=e._g.doc.createElement("span"),s.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;",l.appendChild(s.span),c.cssText=e.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",r,i),1==n?(e._g.doc.body.appendChild(l),c.left=o+"px",c.top=a+"px",c.position="absolute"):n.firstChild?n.insertBefore(l,n.firstChild):n.appendChild(l),s.renderfix=function(){},s},e.prototype.clear=function(){e.eve("raphael.clear",this),this.canvas.innerHTML=f,this.span=e._g.doc.createElement("span"),this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;",this.canvas.appendChild(this.span),this.bottom=this.top=null},e.prototype.remove=function(){e.eve("raphael.remove",this),this.canvas.parentNode.removeChild(this.canvas);for(var t in this)this[t]="function"==typeof this[t]?e._removedFactory(t):null;return!0};var D=e.st;for(var P in N)N[t](P)&&!D[t](P)&&(D[P]=function(e){return function(){var t=arguments;return this.forEach(function(n){n[e].apply(n,t)})}}(P))}(window.Raphael),function(e){function t(e){if("number"==typeof e)return e.toString();var t={"&":"amp","<":"lt",">":"gt",'"':"quot","'":"apos"};for(var n in t)e=e.replace(new RegExp(n,"g"),"&"+t[n]+";");return e}function n(e,t){var n=new Array;for(var i in e)if(e.hasOwnProperty(i)){var r=t.call(this,e[i],i);null!==r&&n.push(r)}return n}function r(e,t,n){for(var i in e)e.hasOwnProperty(i)&&(n=t.call(this,n,e[i],i));return n}function o(e,i,r,o){return("undefined"==typeof o||null===o)&&(o=""),"object"==typeof i&&(i=n(i,function(e,n){return"transform"!==n?n+'="'+t(e)+'"':void 0}).join(" ")),"<"+e+(r?' transform="matrix('+r.toString().replace(/^matrix\(|\)$/g,"")+')" ':" ")+i+">"+o+"</"+e+">"}function a(e){return{font:{family:e.attrs.font.replace(/^.*?"(\w+)".*$/,"$1"),size:"undefined"==typeof e.attrs["font-size"]?null:e.attrs["font-size"]}}}function s(e){return"font: normal normal normal 10px/normal "+e.font.family+(null===e.font.size?"":"; font-size: "+e.font.size+"px")}function l(e,t,n){return null===e&&(e=10),3.5*4.5*e/13*(t-.2-n/2)}var c={text:function(e){style=a(e);var i=new Array;return n(e.attrs.text.split("\n"),function(n,a,c){c=c||0,i.push(o("text",r(e.attrs,function(e,n,i){return"text"!==i&&"w"!==i&&"h"!==i&&("font-size"===i&&(n+="px"),e[i]=t(n.toString())),e},{style:"text-anchor: middle; "+s(style)+";"}),e.matrix,o("tspan",{dy:l(style.font.size,c+1,e.attrs.text.split("\n").length)},null,n)))}),i},path:function(e){return 1===e.matrix.a&&1===e.matrix.d?{}:{transform:e.matrix.toString()},o("path",r(e.attrs,function(e,t,n){return"path"===n&&(n="d"),e[n]=t.toString(),e},{}),e.matrix)}};e.fn.toSVG=function(){var n=this,r={svg:e.svg,vml:e.vml},o='<svg style="overflow: hidden; position: relative;" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="'+n.width+'" version="1.1" height="'+n.height+'">';e.svg=!0,e.vml=!1;for(var a=n.bottom;null!=a;a=a.next)if("none"!==a.node.style.display){var s="";if("function"!=typeof c[a.type]){switch(a.type){case"image":s+=' preserveAspectRatio="none"'}for(i in a.attrs){var l=i;switch(i){case"src":l="xlink:href";break;case"transform":l=""}l&&(s+=" "+l+'="'+t(a.attrs[i].toString())+'"')}o+="<"+a.type+' transform="matrix('+a.matrix.toString().replace(/^matrix\(|\)$/g,"")+')"'+s+"></"+a.type+">"}else o+=c[a.type](a)}return o+="</svg>",e.svg=r.svg,e.vml=r.vml,o}}(window.Raphael),function(){Raphael.fn.toJSON=function(e){for(var t,n=new Array,i=this,r=i.bottom;null!=r;r=r.next)t=e?e(r,new Object):new Object,t&&n.push({data:t,type:r.type,attrs:r.attrs,transform:r.matrix.toTransformString()});return JSON.stringify(n)},Raphael.fn.fromJSON=function(e,t){var n,i=this;"string"==typeof e&&(e=JSON.parse(e));for(var r in e)e.hasOwnProperty(r)&&(n=i[e[r].type]().attr(e[r].attrs).transform(e[r].transform),t&&(n=t(n,e[r].data)),n&&i.set().push(n))}}(),function(){function e(){var e={};return e.FRAMERATE=30,e.MAX_VIRTUAL_PIXELS=3e4,e.init=function(t){e.Definitions={},e.Styles={},e.Animations=[],e.Images=[],e.ctx=t,e.ViewPort=new function(){this.viewPorts=[],this.Clear=function(){this.viewPorts=[]},this.SetCurrent=function(e,t){this.viewPorts.push({width:e,height:t})},this.RemoveCurrent=function(){this.viewPorts.pop()},this.Current=function(){return this.viewPorts[this.viewPorts.length-1]},this.width=function(){return this.Current().width},this.height=function(){return this.Current().height},this.ComputeSize=function(e){return null!=e&&"number"==typeof e?e:"x"==e?this.width():"y"==e?this.height():Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2)}}},e.init(),e.ImagesLoaded=function(){for(var t=0;e.Images.length>t;t++)if(!e.Images[t].loaded)return!1;return!0},e.trim=function(e){return e.replace(/^\s+|\s+$/g,"")},e.compressSpaces=function(e){return e.replace(/[\s\r\t\n]+/gm," ")},e.ajax=function(e){var t;return t=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),t?(t.open("GET",e,!1),t.send(null),t.responseText):null},e.parseXml=function(e){if(window.DOMParser){var t=new DOMParser;return t.parseFromString(e,"text/xml")}e=e.replace(/<!DOCTYPE svg[^>]*>/,"");var n=new ActiveXObject("Microsoft.XMLDOM");return n.async="false",n.loadXML(e),n},e.Property=function(e,t){this.name=e,this.value=t},e.Property.prototype.getValue=function(){return this.value},e.Property.prototype.hasValue=function(){return null!=this.value&&""!==this.value},e.Property.prototype.numValue=function(){if(!this.hasValue())return 0;var e=parseFloat(this.value);return(this.value+"").match(/%$/)&&(e/=100),e},e.Property.prototype.valueOrDefault=function(e){return this.hasValue()?this.value:e},e.Property.prototype.numValueOrDefault=function(e){return this.hasValue()?this.numValue():e},e.Property.prototype.addOpacity=function(t){var n=this.value;if(null!=t&&""!=t&&"string"==typeof this.value){var i=new RGBColor(this.value);i.ok&&(n="rgba("+i.r+", "+i.g+", "+i.b+", "+t+")")}return new e.Property(this.name,n)},e.Property.prototype.getDefinition=function(){var t=this.value.replace(/^(url\()?#([^\)]+)\)?$/,"$2");return e.Definitions[t]},e.Property.prototype.isUrlDefinition=function(){return 0==this.value.indexOf("url(")},e.Property.prototype.getFillStyleDefinition=function(t){var n=this.getDefinition();return null!=n&&n.createGradient?n.createGradient(e.ctx,t):null!=n&&n.createPattern?n.createPattern(e.ctx,t):null},e.Property.prototype.getDPI=function(){return 96},e.Property.prototype.getEM=function(t){var n=12,i=new e.Property("fontSize",e.Font.Parse(e.ctx.font).fontSize);return i.hasValue()&&(n=i.toPixels(t)),n},e.Property.prototype.getUnits=function(){var e=this.value+"";return e.replace(/[0-9\.\-]/g,"")},e.Property.prototype.toPixels=function(t){if(!this.hasValue())return 0;var n=this.value+"";return n.match(/em$/)?this.numValue()*this.getEM(t):n.match(/ex$/)?this.numValue()*this.getEM(t)/2:n.match(/px$/)?this.numValue():n.match(/pt$/)?this.numValue()*this.getDPI(t)*(1/72):n.match(/pc$/)?15*this.numValue():n.match(/cm$/)?this.numValue()*this.getDPI(t)/2.54:n.match(/mm$/)?this.numValue()*this.getDPI(t)/25.4:n.match(/in$/)?this.numValue()*this.getDPI(t):n.match(/%$/)?this.numValue()*e.ViewPort.ComputeSize(t):this.numValue()},e.Property.prototype.toMilliseconds=function(){if(!this.hasValue())return 0;var e=this.value+"";return e.match(/s$/)?1e3*this.numValue():e.match(/ms$/)?this.numValue():this.numValue()},e.Property.prototype.toRadians=function(){if(!this.hasValue())return 0;var e=this.value+"";return e.match(/deg$/)?this.numValue()*(Math.PI/180):e.match(/grad$/)?this.numValue()*(Math.PI/200):e.match(/rad$/)?this.numValue():this.numValue()*(Math.PI/180)},e.Font=new function(){this.Styles="normal|italic|oblique|inherit",this.Variants="normal|small-caps|inherit",this.Weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit",this.CreateFont=function(t,n,i,r,o,a){var s=null!=a?this.Parse(a):this.CreateFont("","","","","",e.ctx.font);return{fontFamily:o||s.fontFamily,fontSize:r||s.fontSize,fontStyle:t||s.fontStyle,fontWeight:i||s.fontWeight,fontVariant:n||s.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(" ")}}};var t=this;this.Parse=function(n){for(var i={},r=e.trim(e.compressSpaces(n||"")).split(" "),o={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1},a="",s=0;r.length>s;s++)o.fontStyle||-1==t.Styles.indexOf(r[s])?o.fontVariant||-1==t.Variants.indexOf(r[s])?o.fontWeight||-1==t.Weights.indexOf(r[s])?o.fontSize?"inherit"!=r[s]&&(a+=r[s]):("inherit"!=r[s]&&(i.fontSize=r[s].split("/")[0]),o.fontStyle=o.fontVariant=o.fontWeight=o.fontSize=!0):("inherit"!=r[s]&&(i.fontWeight=r[s]),o.fontStyle=o.fontVariant=o.fontWeight=!0):("inherit"!=r[s]&&(i.fontVariant=r[s]),o.fontStyle=o.fontVariant=!0):("inherit"!=r[s]&&(i.fontStyle=r[s]),o.fontStyle=!0);return""!=a&&(i.fontFamily=a),i}},e.ToNumberArray=function(t){for(var n=e.trim(e.compressSpaces((t||"").replace(/,/g," "))).split(" "),i=0;n.length>i;i++)n[i]=parseFloat(n[i]);return n},e.Point=function(e,t){this.x=e,this.y=t},e.Point.prototype.angleTo=function(e){return Math.atan2(e.y-this.y,e.x-this.x)},e.Point.prototype.applyTransform=function(e){var t=this.x*e[0]+this.y*e[2]+e[4],n=this.x*e[1]+this.y*e[3]+e[5];this.x=t,this.y=n},e.CreatePoint=function(t){var n=e.ToNumberArray(t);return new e.Point(n[0],n[1])},e.CreatePath=function(t){for(var n=e.ToNumberArray(t),i=[],r=0;n.length>r;r+=2)i.push(new e.Point(n[r],n[r+1]));return i},e.BoundingBox=function(e,t,n,r){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN,this.x=function(){return this.x1},this.y=function(){return this.y1},this.width=function(){return this.x2-this.x1},this.height=function(){return this.y2-this.y1},this.addPoint=function(e,t){null!=e&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=e,this.x2=e),this.x1>e&&(this.x1=e),e>this.x2&&(this.x2=e)),null!=t&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=t,this.y2=t),this.y1>t&&(this.y1=t),t>this.y2&&(this.y2=t))},this.addX=function(e){this.addPoint(e,null)},this.addY=function(e){this.addPoint(null,e)},this.addBoundingBox=function(e){this.addPoint(e.x1,e.y1),this.addPoint(e.x2,e.y2)},this.addQuadraticCurve=function(e,t,n,i,r,o){var a=e+2/3*(n-e),s=t+2/3*(i-t),l=a+1/3*(r-e),c=s+1/3*(o-t);this.addBezierCurve(e,t,a,l,s,c,r,o)},this.addBezierCurve=function(e,t,n,r,o,a,s,l){var c=[e,t],u=[n,r],d=[o,a],h=[s,l];for(this.addPoint(c[0],c[1]),this.addPoint(h[0],h[1]),i=0;1>=i;i++){var p=function(e){return Math.pow(1-e,3)*c[i]+3*Math.pow(1-e,2)*e*u[i]+3*(1-e)*Math.pow(e,2)*d[i]+Math.pow(e,3)*h[i]},f=6*c[i]-12*u[i]+6*d[i],m=-3*c[i]+9*u[i]-9*d[i]+3*h[i],g=3*u[i]-3*c[i];if(0!=m){var v=Math.pow(f,2)-4*g*m;if(!(0>v)){var y=(-f+Math.sqrt(v))/(2*m);y>0&&1>y&&(0==i&&this.addX(p(y)),1==i&&this.addY(p(y)));var b=(-f-Math.sqrt(v))/(2*m);b>0&&1>b&&(0==i&&this.addX(p(b)),1==i&&this.addY(p(b)))}}else{if(0==f)continue;var _=-g/f;_>0&&1>_&&(0==i&&this.addX(p(_)),1==i&&this.addY(p(_)))}}},this.isPointInBox=function(e,t){return e>=this.x1&&this.x2>=e&&t>=this.y1&&this.y2>=t
},this.addPoint(e,t),this.addPoint(n,r)},e.Transform=function(t){var n=this;this.Type={},this.Type.translate=function(t){this.p=e.CreatePoint(t),this.apply=function(e){e.translate(this.p.x||0,this.p.y||0)},this.applyToPoint=function(e){e.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0])}},this.Type.rotate=function(t){var n=e.ToNumberArray(t);this.angle=new e.Property("angle",n[0]),this.cx=n[1]||0,this.cy=n[2]||0,this.apply=function(e){e.translate(this.cx,this.cy),e.rotate(this.angle.toRadians()),e.translate(-this.cx,-this.cy)},this.applyToPoint=function(e){var t=this.angle.toRadians();e.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]),e.applyTransform([Math.cos(t),Math.sin(t),-Math.sin(t),Math.cos(t),0,0]),e.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0])}},this.Type.scale=function(t){this.p=e.CreatePoint(t),this.apply=function(e){e.scale(this.p.x||1,this.p.y||this.p.x||1)},this.applyToPoint=function(e){e.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0])}},this.Type.matrix=function(t){this.m=e.ToNumberArray(t),this.apply=function(e){e.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])},this.applyToPoint=function(e){e.applyTransform(this.m)}},this.Type.SkewBase=function(t){this.base=n.Type.matrix,this.base(t),this.angle=new e.Property("angle",t)},this.Type.SkewBase.prototype=new this.Type.matrix,this.Type.skewX=function(e){this.base=n.Type.SkewBase,this.base(e),this.m=[1,0,Math.tan(this.angle.toRadians()),1,0,0]},this.Type.skewX.prototype=new this.Type.SkewBase,this.Type.skewY=function(e){this.base=n.Type.SkewBase,this.base(e),this.m=[1,Math.tan(this.angle.toRadians()),0,1,0,0]},this.Type.skewY.prototype=new this.Type.SkewBase,this.transforms=[],this.apply=function(e){for(var t=0;this.transforms.length>t;t++)this.transforms[t].apply(e)},this.applyToPoint=function(e){for(var t=0;this.transforms.length>t;t++)this.transforms[t].applyToPoint(e)};for(var i=e.trim(e.compressSpaces(t)).split(/\s(?=[a-z])/),r=0;i.length>r;r++){var o=i[r].split("(")[0],a=i[r].split("(")[1].replace(")",""),s=new this.Type[o](a);this.transforms.push(s)}},e.AspectRatio=function(t,n,i,r,o,a,s,l,c,u){n=e.compressSpaces(n),n=n.replace(/^defer\s/,"");var d=n.split(" ")[0]||"xMidYMid",h=n.split(" ")[1]||"meet",p=i/r,f=o/a,m=Math.min(p,f),g=Math.max(p,f);"meet"==h&&(r*=m,a*=m),"slice"==h&&(r*=g,a*=g),c=new e.Property("refX",c),u=new e.Property("refY",u),c.hasValue()&&u.hasValue()?t.translate(-m*c.toPixels("x"),-m*u.toPixels("y")):(d.match(/^xMid/)&&("meet"==h&&m==f||"slice"==h&&g==f)&&t.translate(i/2-r/2,0),d.match(/YMid$/)&&("meet"==h&&m==p||"slice"==h&&g==p)&&t.translate(0,o/2-a/2),d.match(/^xMax/)&&("meet"==h&&m==f||"slice"==h&&g==f)&&t.translate(i-r,0),d.match(/YMax$/)&&("meet"==h&&m==p||"slice"==h&&g==p)&&t.translate(0,o-a)),"none"==d?t.scale(p,f):"meet"==h?t.scale(m,m):"slice"==h&&t.scale(g,g),t.translate(null==s?0:-s,null==l?0:-l)},e.Element={},e.EmptyProperty=new e.Property("EMPTY",""),e.Element.ElementBase=function(t){if(this.attributes={},this.styles={},this.children=[],this.attribute=function(t,n){var i=this.attributes[t];return null!=i?i:(1==n&&(i=new e.Property(t,""),this.attributes[t]=i),i||e.EmptyProperty)},this.style=function(t,n){var i=this.styles[t];if(null!=i)return i;var r=this.attribute(t);if(null!=r&&r.hasValue())return this.styles[t]=r,r;var o=this.parent;if(null!=o){var a=o.style(t);if(null!=a&&a.hasValue())return a}return 1==n&&(i=new e.Property(t,""),this.styles[t]=i),i||e.EmptyProperty},this.render=function(e){if("none"!=this.style("display").value&&"hidden"!=this.attribute("visibility").value){if(e.save(),this.setContext(e),this.attribute("mask").hasValue()){var t=this.attribute("mask").getDefinition();null!=t&&t.apply(e,this)}else if(this.style("filter").hasValue()){var n=this.style("filter").getDefinition();null!=n&&n.apply(e,this)}else this.renderChildren(e);this.clearContext(e),e.restore()}},this.setContext=function(){},this.clearContext=function(){},this.renderChildren=function(e){for(var t=0;this.children.length>t;t++)this.children[t].render(e)},this.addChild=function(t,n){var i=t;n&&(i=e.CreateElement(t)),i.parent=this,this.children.push(i)},null!=t&&1==t.nodeType){for(var n=0;t.childNodes.length>n;n++){var i=t.childNodes[n];1==i.nodeType&&this.addChild(i,!0)}for(var n=0;t.attributes.length>n;n++){var r=t.attributes[n];this.attributes[r.nodeName]=new e.Property(r.nodeName,r.nodeValue)}var o=e.Styles[t.nodeName];if(null!=o)for(var a in o)this.styles[a]=o[a];if(this.attribute("class").hasValue())for(var s=e.compressSpaces(this.attribute("class").value).split(" "),l=0;s.length>l;l++){if(o=e.Styles["."+s[l]],null!=o)for(var a in o)this.styles[a]=o[a];if(o=e.Styles[t.nodeName+"."+s[l]],null!=o)for(var a in o)this.styles[a]=o[a]}if(this.attribute("id").hasValue()){var o=e.Styles["#"+this.attribute("id").value];if(null!=o)for(var a in o)this.styles[a]=o[a]}if(this.attribute("style").hasValue())for(var o=this.attribute("style").value.split(";"),n=0;o.length>n;n++)if(""!=e.trim(o[n])){var c=o[n].split(":"),a=e.trim(c[0]),u=e.trim(c[1]);this.styles[a]=new e.Property(a,u)}this.attribute("id").hasValue()&&null==e.Definitions[this.attribute("id").value]&&(e.Definitions[this.attribute("id").value]=this)}},e.Element.RenderedElementBase=function(t){this.base=e.Element.ElementBase,this.base(t),this.setContext=function(t){if(this.style("fill").isUrlDefinition()){var n=this.style("fill").getFillStyleDefinition(this);null!=n&&(t.fillStyle=n)}else if(this.style("fill").hasValue()){var i=this.style("fill");"currentColor"==i.value&&(i.value=this.style("color").value),t.fillStyle="none"==i.value?"rgba(0,0,0,0)":i.value}if(this.style("fill-opacity").hasValue()){var i=new e.Property("fill",t.fillStyle);i=i.addOpacity(this.style("fill-opacity").value),t.fillStyle=i.value}if(this.style("stroke").isUrlDefinition()){var n=this.style("stroke").getFillStyleDefinition(this);null!=n&&(t.strokeStyle=n)}else if(this.style("stroke").hasValue()){var r=this.style("stroke");"currentColor"==r.value&&(r.value=this.style("color").value),t.strokeStyle="none"==r.value?"rgba(0,0,0,0)":r.value}if(this.style("stroke-opacity").hasValue()){var r=new e.Property("stroke",t.strokeStyle);r=r.addOpacity(this.style("stroke-opacity").value),t.strokeStyle=r.value}if(this.style("stroke-width").hasValue()&&(t.lineWidth=this.style("stroke-width").toPixels()),this.style("stroke-linecap").hasValue()&&(t.lineCap=this.style("stroke-linecap").value),this.style("stroke-linejoin").hasValue()&&(t.lineJoin=this.style("stroke-linejoin").value),this.style("stroke-miterlimit").hasValue()&&(t.miterLimit=this.style("stroke-miterlimit").value),"undefined"!=typeof t.font&&(t.font=e.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").toPixels()+"px":"",this.style("font-family").value).toString()),this.attribute("transform").hasValue()){var o=new e.Transform(this.attribute("transform").value);o.apply(t)}if(this.attribute("clip-path").hasValue()){var a=this.attribute("clip-path").getDefinition();null!=a&&a.apply(t)}this.style("opacity").hasValue()&&(t.globalAlpha=this.style("opacity").numValue())}},e.Element.RenderedElementBase.prototype=new e.Element.ElementBase,e.Element.PathElementBase=function(t){this.base=e.Element.RenderedElementBase,this.base(t),this.path=function(t){return null!=t&&t.beginPath(),new e.BoundingBox},this.renderChildren=function(t){this.path(t),e.Mouse.checkPath(this,t),""!=t.fillStyle&&t.fill(),""!=t.strokeStyle&&t.stroke();var n=this.getMarkers();if(null!=n){if(this.style("marker-start").isUrlDefinition()){var i=this.style("marker-start").getDefinition();i.render(t,n[0][0],n[0][1])}if(this.style("marker-mid").isUrlDefinition())for(var i=this.style("marker-mid").getDefinition(),r=1;n.length-1>r;r++)i.render(t,n[r][0],n[r][1]);if(this.style("marker-end").isUrlDefinition()){var i=this.style("marker-end").getDefinition();i.render(t,n[n.length-1][0],n[n.length-1][1])}}},this.getBoundingBox=function(){return this.path()},this.getMarkers=function(){return null}},e.Element.PathElementBase.prototype=new e.Element.RenderedElementBase,e.Element.svg=function(t){this.base=e.Element.RenderedElementBase,this.base(t),this.baseClearContext=this.clearContext,this.clearContext=function(t){this.baseClearContext(t),e.ViewPort.RemoveCurrent()},this.baseSetContext=this.setContext,this.setContext=function(t){t.strokeStyle="rgba(0,0,0,0)",t.lineCap="butt",t.lineJoin="miter",t.miterLimit=4,this.baseSetContext(t),this.attribute("x").hasValue()||(this.attribute("x",!0).value=0),this.attribute("y").hasValue()||(this.attribute("y",!0).value=0),t.translate(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"));var n=e.ViewPort.width(),i=e.ViewPort.height();if(this.attribute("width").hasValue()||(this.attribute("width",!0).value="100%"),this.attribute("height").hasValue()||(this.attribute("height",!0).value="100%"),"undefined"==typeof this.root){n=this.attribute("width").toPixels("x"),i=this.attribute("height").toPixels("y");var r=0,o=0;this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()&&(r=-this.attribute("refX").toPixels("x"),o=-this.attribute("refY").toPixels("y")),t.beginPath(),t.moveTo(r,o),t.lineTo(n,o),t.lineTo(n,i),t.lineTo(r,i),t.closePath(),t.clip()}if(e.ViewPort.SetCurrent(n,i),this.attribute("viewBox").hasValue()){var a=e.ToNumberArray(this.attribute("viewBox").value),s=a[0],l=a[1];n=a[2],i=a[3],e.AspectRatio(t,this.attribute("preserveAspectRatio").value,e.ViewPort.width(),n,e.ViewPort.height(),i,s,l,this.attribute("refX").value,this.attribute("refY").value),e.ViewPort.RemoveCurrent(),e.ViewPort.SetCurrent(a[2],a[3])}}},e.Element.svg.prototype=new e.Element.RenderedElementBase,e.Element.rect=function(t){this.base=e.Element.PathElementBase,this.base(t),this.path=function(t){var n=this.attribute("x").toPixels("x"),i=this.attribute("y").toPixels("y"),r=this.attribute("width").toPixels("x"),o=this.attribute("height").toPixels("y"),a=this.attribute("rx").toPixels("x"),s=this.attribute("ry").toPixels("y");return this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue()&&(s=a),this.attribute("ry").hasValue()&&!this.attribute("rx").hasValue()&&(a=s),null!=t&&(t.beginPath(),t.moveTo(n+a,i),t.lineTo(n+r-a,i),t.quadraticCurveTo(n+r,i,n+r,i+s),t.lineTo(n+r,i+o-s),t.quadraticCurveTo(n+r,i+o,n+r-a,i+o),t.lineTo(n+a,i+o),t.quadraticCurveTo(n,i+o,n,i+o-s),t.lineTo(n,i+s),t.quadraticCurveTo(n,i,n+a,i),t.closePath()),new e.BoundingBox(n,i,n+r,i+o)}},e.Element.rect.prototype=new e.Element.PathElementBase,e.Element.circle=function(t){this.base=e.Element.PathElementBase,this.base(t),this.path=function(t){var n=this.attribute("cx").toPixels("x"),i=this.attribute("cy").toPixels("y"),r=this.attribute("r").toPixels();return null!=t&&(t.beginPath(),t.arc(n,i,r,0,2*Math.PI,!0),t.closePath()),new e.BoundingBox(n-r,i-r,n+r,i+r)}},e.Element.circle.prototype=new e.Element.PathElementBase,e.Element.ellipse=function(t){this.base=e.Element.PathElementBase,this.base(t),this.path=function(t){var n=4*((Math.sqrt(2)-1)/3),i=this.attribute("rx").toPixels("x"),r=this.attribute("ry").toPixels("y"),o=this.attribute("cx").toPixels("x"),a=this.attribute("cy").toPixels("y");return null!=t&&(t.beginPath(),t.moveTo(o,a-r),t.bezierCurveTo(o+n*i,a-r,o+i,a-n*r,o+i,a),t.bezierCurveTo(o+i,a+n*r,o+n*i,a+r,o,a+r),t.bezierCurveTo(o-n*i,a+r,o-i,a+n*r,o-i,a),t.bezierCurveTo(o-i,a-n*r,o-n*i,a-r,o,a-r),t.closePath()),new e.BoundingBox(o-i,a-r,o+i,a+r)}},e.Element.ellipse.prototype=new e.Element.PathElementBase,e.Element.line=function(t){this.base=e.Element.PathElementBase,this.base(t),this.getPoints=function(){return[new e.Point(this.attribute("x1").toPixels("x"),this.attribute("y1").toPixels("y")),new e.Point(this.attribute("x2").toPixels("x"),this.attribute("y2").toPixels("y"))]},this.path=function(t){var n=this.getPoints();return null!=t&&(t.beginPath(),t.moveTo(n[0].x,n[0].y),t.lineTo(n[1].x,n[1].y)),new e.BoundingBox(n[0].x,n[0].y,n[1].x,n[1].y)},this.getMarkers=function(){var e=this.getPoints(),t=e[0].angleTo(e[1]);return[[e[0],t],[e[1],t]]}},e.Element.line.prototype=new e.Element.PathElementBase,e.Element.polyline=function(t){this.base=e.Element.PathElementBase,this.base(t),this.points=e.CreatePath(this.attribute("points").value),this.path=function(t){var n=new e.BoundingBox(this.points[0].x,this.points[0].y);null!=t&&(t.beginPath(),t.moveTo(this.points[0].x,this.points[0].y));for(var i=1;this.points.length>i;i++)n.addPoint(this.points[i].x,this.points[i].y),null!=t&&t.lineTo(this.points[i].x,this.points[i].y);return n},this.getMarkers=function(){for(var e=[],t=0;this.points.length-1>t;t++)e.push([this.points[t],this.points[t].angleTo(this.points[t+1])]);return e.push([this.points[this.points.length-1],e[e.length-1][1]]),e}},e.Element.polyline.prototype=new e.Element.PathElementBase,e.Element.polygon=function(t){this.base=e.Element.polyline,this.base(t),this.basePath=this.path,this.path=function(e){var t=this.basePath(e);return null!=e&&(e.lineTo(this.points[0].x,this.points[0].y),e.closePath()),t}},e.Element.polygon.prototype=new e.Element.polyline,e.Element.path=function(t){this.base=e.Element.PathElementBase,this.base(t);var n=this.attribute("d").value;n=n.replace(/,/gm," "),n=n.replace(/([MmZzLlHhVvCcSsQqTtAa])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),n=n.replace(/([MmZzLlHhVvCcSsQqTtAa])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),n=n.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2"),n=n.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),n=n.replace(/([0-9])([+\-])/gm,"$1 $2"),n=n.replace(/(\.[0-9]*)(\.)/gm,"$1 $2"),n=n.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 "),n=e.compressSpaces(n),n=e.trim(n),this.PathParser=new function(t){this.tokens=t.split(" "),this.reset=function(){this.i=-1,this.command="",this.previousCommand="",this.start=new e.Point(0,0),this.control=new e.Point(0,0),this.current=new e.Point(0,0),this.points=[],this.angles=[]},this.isEnd=function(){return this.i>=this.tokens.length-1},this.isCommandOrEnd=function(){return this.isEnd()?!0:null!=this.tokens[this.i+1].match(/^[A-Za-z]$/)},this.isRelativeCommand=function(){switch(this.command){case"m":case"l":case"h":case"v":case"c":case"s":case"q":case"t":case"a":case"z":return!0}return!1},this.getToken=function(){return this.i++,this.tokens[this.i]},this.getScalar=function(){return parseFloat(this.getToken())},this.nextCommand=function(){this.previousCommand=this.command,this.command=this.getToken()},this.getPoint=function(){var t=new e.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(t)},this.getAsControlPoint=function(){var e=this.getPoint();return this.control=e,e},this.getAsCurrentPoint=function(){var e=this.getPoint();return this.current=e,e},this.getReflectedControlPoint=function(){if("c"!=this.previousCommand.toLowerCase()&&"s"!=this.previousCommand.toLowerCase())return this.current;var t=new e.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y);return t},this.makeAbsolute=function(e){return this.isRelativeCommand()&&(e.x+=this.current.x,e.y+=this.current.y),e},this.addMarker=function(e,t,n){null!=n&&this.angles.length>0&&null==this.angles[this.angles.length-1]&&(this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(n)),this.addMarkerAngle(e,null==t?null:t.angleTo(e))},this.addMarkerAngle=function(e,t){this.points.push(e),this.angles.push(t)},this.getMarkerPoints=function(){return this.points},this.getMarkerAngles=function(){for(var e=0;this.angles.length>e;e++)if(null==this.angles[e])for(var t=e+1;this.angles.length>t;t++)if(null!=this.angles[t]){this.angles[e]=this.angles[t];break}return this.angles}}(n),this.path=function(t){var n=this.PathParser;n.reset();var i=new e.BoundingBox;for(null!=t&&t.beginPath();!n.isEnd();)switch(n.nextCommand(),n.command){case"M":case"m":var r=n.getAsCurrentPoint();for(n.addMarker(r),i.addPoint(r.x,r.y),null!=t&&t.moveTo(r.x,r.y),n.start=n.current;!n.isCommandOrEnd();){var r=n.getAsCurrentPoint();n.addMarker(r,n.start),i.addPoint(r.x,r.y),null!=t&&t.lineTo(r.x,r.y)}break;case"L":case"l":for(;!n.isCommandOrEnd();){var o=n.current,r=n.getAsCurrentPoint();n.addMarker(r,o),i.addPoint(r.x,r.y),null!=t&&t.lineTo(r.x,r.y)}break;case"H":case"h":for(;!n.isCommandOrEnd();){var a=new e.Point((n.isRelativeCommand()?n.current.x:0)+n.getScalar(),n.current.y);n.addMarker(a,n.current),n.current=a,i.addPoint(n.current.x,n.current.y),null!=t&&t.lineTo(n.current.x,n.current.y)}break;case"V":case"v":for(;!n.isCommandOrEnd();){var a=new e.Point(n.current.x,(n.isRelativeCommand()?n.current.y:0)+n.getScalar());n.addMarker(a,n.current),n.current=a,i.addPoint(n.current.x,n.current.y),null!=t&&t.lineTo(n.current.x,n.current.y)}break;case"C":case"c":for(;!n.isCommandOrEnd();){var s=n.current,l=n.getPoint(),c=n.getAsControlPoint(),u=n.getAsCurrentPoint();n.addMarker(u,c,l),i.addBezierCurve(s.x,s.y,l.x,l.y,c.x,c.y,u.x,u.y),null!=t&&t.bezierCurveTo(l.x,l.y,c.x,c.y,u.x,u.y)}break;case"S":case"s":for(;!n.isCommandOrEnd();){var s=n.current,l=n.getReflectedControlPoint(),c=n.getAsControlPoint(),u=n.getAsCurrentPoint();n.addMarker(u,c,l),i.addBezierCurve(s.x,s.y,l.x,l.y,c.x,c.y,u.x,u.y),null!=t&&t.bezierCurveTo(l.x,l.y,c.x,c.y,u.x,u.y)}break;case"Q":case"q":for(;!n.isCommandOrEnd();){var s=n.current,c=n.getAsControlPoint(),u=n.getAsCurrentPoint();n.addMarker(u,c,c),i.addQuadraticCurve(s.x,s.y,c.x,c.y,u.x,u.y),null!=t&&t.quadraticCurveTo(c.x,c.y,u.x,u.y)}break;case"T":case"t":for(;!n.isCommandOrEnd();){var s=n.current,c=n.getReflectedControlPoint();n.control=c;var u=n.getAsCurrentPoint();n.addMarker(u,c,c),i.addQuadraticCurve(s.x,s.y,c.x,c.y,u.x,u.y),null!=t&&t.quadraticCurveTo(c.x,c.y,u.x,u.y)}break;case"A":case"a":for(;!n.isCommandOrEnd();){var s=n.current,d=n.getScalar(),h=n.getScalar(),p=n.getScalar()*(Math.PI/180),f=n.getScalar(),m=n.getScalar(),u=n.getAsCurrentPoint(),g=new e.Point(Math.cos(p)*(s.x-u.x)/2+Math.sin(p)*(s.y-u.y)/2,-Math.sin(p)*(s.x-u.x)/2+Math.cos(p)*(s.y-u.y)/2),v=Math.pow(g.x,2)/Math.pow(d,2)+Math.pow(g.y,2)/Math.pow(h,2);v>1&&(d*=Math.sqrt(v),h*=Math.sqrt(v));var y=(f==m?-1:1)*Math.sqrt((Math.pow(d,2)*Math.pow(h,2)-Math.pow(d,2)*Math.pow(g.y,2)-Math.pow(h,2)*Math.pow(g.x,2))/(Math.pow(d,2)*Math.pow(g.y,2)+Math.pow(h,2)*Math.pow(g.x,2)));isNaN(y)&&(y=0);var b=new e.Point(y*d*g.y/h,y*-h*g.x/d),_=new e.Point((s.x+u.x)/2+Math.cos(p)*b.x-Math.sin(p)*b.y,(s.y+u.y)/2+Math.sin(p)*b.x+Math.cos(p)*b.y),w=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2))},S=function(e,t){return(e[0]*t[0]+e[1]*t[1])/(w(e)*w(t))},x=function(e,t){return(e[0]*t[1]<e[1]*t[0]?-1:1)*Math.acos(S(e,t))},C=x([1,0],[(g.x-b.x)/d,(g.y-b.y)/h]),$=[(g.x-b.x)/d,(g.y-b.y)/h],E=[(-g.x-b.x)/d,(-g.y-b.y)/h],T=x($,E);-1>=S($,E)&&(T=Math.PI),S($,E)>=1&&(T=0),0==m&&T>0&&(T-=2*Math.PI),1==m&&0>T&&(T+=2*Math.PI);var k=new e.Point(_.x+d*Math.cos((C+(C+T))/2),_.y+h*Math.sin((C+(C+T))/2));if(n.addMarkerAngle(k,(C+(C+T))/2+(0==m?-1:1)*Math.PI/2),n.addMarkerAngle(u,C+T+(0==m?-1:1)*Math.PI/2),i.addPoint(u.x,u.y),null!=t){var S=d>h?d:h,A=d>h?1:d/h,N=d>h?h/d:1;t.translate(_.x,_.y),t.rotate(p),t.scale(A,N),t.arc(0,0,S,C,C+T,1-m),t.scale(1/A,1/N),t.rotate(-p),t.translate(-_.x,-_.y)}}break;case"Z":case"z":null!=t&&t.closePath(),n.current=n.start}return i},this.getMarkers=function(){for(var e=this.PathParser.getMarkerPoints(),t=this.PathParser.getMarkerAngles(),n=[],i=0;e.length>i;i++)n.push([e[i],t[i]]);return n}},e.Element.path.prototype=new e.Element.PathElementBase,e.Element.pattern=function(t){this.base=e.Element.ElementBase,this.base(t),this.createPattern=function(t){var n=new e.Element.svg;n.attributes.viewBox=new e.Property("viewBox",this.attribute("viewBox").value),n.attributes.x=new e.Property("x",this.attribute("x").value),n.attributes.y=new e.Property("y",this.attribute("y").value),n.attributes.width=new e.Property("width",this.attribute("width").value),n.attributes.height=new e.Property("height",this.attribute("height").value),n.children=this.children;var i=document.createElement("canvas");return document.body.appendChild(i),i.width=this.attribute("width").toPixels("x")+this.attribute("x").toPixels("x"),i.height=this.attribute("height").toPixels("y")+this.attribute("y").toPixels("y"),n.render(i.getContext("2d")),t.createPattern(i,"repeat")}},e.Element.pattern.prototype=new e.Element.ElementBase,e.Element.marker=function(t){this.base=e.Element.ElementBase,this.base(t),this.baseRender=this.render,this.render=function(t,n,i){t.translate(n.x,n.y),"auto"==this.attribute("orient").valueOrDefault("auto")&&t.rotate(i),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&t.scale(t.lineWidth,t.lineWidth),t.save();var r=new e.Element.svg;r.attributes.viewBox=new e.Property("viewBox",this.attribute("viewBox").value),r.attributes.refX=new e.Property("refX",this.attribute("refX").value),r.attributes.refY=new e.Property("refY",this.attribute("refY").value),r.attributes.width=new e.Property("width",this.attribute("markerWidth").value),r.attributes.height=new e.Property("height",this.attribute("markerHeight").value),r.attributes.fill=new e.Property("fill",this.attribute("fill").valueOrDefault("black")),r.attributes.stroke=new e.Property("stroke",this.attribute("stroke").valueOrDefault("none")),r.children=this.children,r.render(t),t.restore(),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&t.scale(1/t.lineWidth,1/t.lineWidth),"auto"==this.attribute("orient").valueOrDefault("auto")&&t.rotate(-i),t.translate(-n.x,-n.y)}},e.Element.marker.prototype=new e.Element.ElementBase,e.Element.defs=function(t){this.base=e.Element.ElementBase,this.base(t),this.render=function(){}},e.Element.defs.prototype=new e.Element.ElementBase,e.Element.GradientBase=function(t){this.base=e.Element.ElementBase,this.base(t),this.gradientUnits=this.attribute("gradientUnits").valueOrDefault("objectBoundingBox"),this.stops=[];for(var n=0;this.children.length>n;n++){var i=this.children[n];this.stops.push(i)}this.getGradient=function(){},this.createGradient=function(t,n){var i=this;this.attribute("xlink:href").hasValue()&&(i=this.attribute("xlink:href").getDefinition());var r=this.getGradient(t,n);if(null==r)return i.stops[i.stops.length-1].color;for(var o=0;i.stops.length>o;o++)r.addColorStop(i.stops[o].offset,i.stops[o].color);if(this.attribute("gradientTransform").hasValue()){var a=e.ViewPort.viewPorts[0],s=new e.Element.rect;s.attributes.x=new e.Property("x",-e.MAX_VIRTUAL_PIXELS/3),s.attributes.y=new e.Property("y",-e.MAX_VIRTUAL_PIXELS/3),s.attributes.width=new e.Property("width",e.MAX_VIRTUAL_PIXELS),s.attributes.height=new e.Property("height",e.MAX_VIRTUAL_PIXELS);var l=new e.Element.g;l.attributes.transform=new e.Property("transform",this.attribute("gradientTransform").value),l.children=[s];var c=new e.Element.svg;c.attributes.x=new e.Property("x",0),c.attributes.y=new e.Property("y",0),c.attributes.width=new e.Property("width",a.width),c.attributes.height=new e.Property("height",a.height),c.children=[l];var u=document.createElement("canvas");u.width=a.width,u.height=a.height;var d=u.getContext("2d");return d.fillStyle=r,c.render(d),d.createPattern(u,"no-repeat")}return r}},e.Element.GradientBase.prototype=new e.Element.ElementBase,e.Element.linearGradient=function(t){this.base=e.Element.GradientBase,this.base(t),this.getGradient=function(e,t){var n=t.getBoundingBox(),i="objectBoundingBox"==this.gradientUnits?n.x()+n.width()*this.attribute("x1").numValue():this.attribute("x1").toPixels("x"),r="objectBoundingBox"==this.gradientUnits?n.y()+n.height()*this.attribute("y1").numValue():this.attribute("y1").toPixels("y"),o="objectBoundingBox"==this.gradientUnits?n.x()+n.width()*this.attribute("x2").numValue():this.attribute("x2").toPixels("x"),a="objectBoundingBox"==this.gradientUnits?n.y()+n.height()*this.attribute("y2").numValue():this.attribute("y2").toPixels("y");return i==o&&r==a?null:e.createLinearGradient(i,r,o,a)}},e.Element.linearGradient.prototype=new e.Element.GradientBase,e.Element.radialGradient=function(t){this.base=e.Element.GradientBase,this.base(t),this.getGradient=function(e,t){var n=t.getBoundingBox();this.attribute("cx").hasValue()||(this.attribute("cx",!0).value="50%"),this.attribute("cy").hasValue()||(this.attribute("cy",!0).value="50%"),this.attribute("r").hasValue()||(this.attribute("r",!0).value="50%");var i="objectBoundingBox"==this.gradientUnits?n.x()+n.width()*this.attribute("cx").numValue():this.attribute("cx").toPixels("x"),r="objectBoundingBox"==this.gradientUnits?n.y()+n.height()*this.attribute("cy").numValue():this.attribute("cy").toPixels("y"),o=i,a=r;this.attribute("fx").hasValue()&&(o="objectBoundingBox"==this.gradientUnits?n.x()+n.width()*this.attribute("fx").numValue():this.attribute("fx").toPixels("x")),this.attribute("fy").hasValue()&&(a="objectBoundingBox"==this.gradientUnits?n.y()+n.height()*this.attribute("fy").numValue():this.attribute("fy").toPixels("y"));var s="objectBoundingBox"==this.gradientUnits?(n.width()+n.height())/2*this.attribute("r").numValue():this.attribute("r").toPixels();return e.createRadialGradient(o,a,0,i,r,s)}},e.Element.radialGradient.prototype=new e.Element.GradientBase,e.Element.stop=function(t){this.base=e.Element.ElementBase,this.base(t),this.offset=this.attribute("offset").numValue();var n=this.style("stop-color");this.style("stop-opacity").hasValue()&&(n=n.addOpacity(this.style("stop-opacity").value)),this.color=n.value},e.Element.stop.prototype=new e.Element.ElementBase,e.Element.AnimateBase=function(t){this.base=e.Element.ElementBase,this.base(t),e.Animations.push(this),this.duration=0,this.begin=this.attribute("begin").toMilliseconds(),this.maxDuration=this.begin+this.attribute("dur").toMilliseconds(),this.getProperty=function(){var e=this.attribute("attributeType").value,t=this.attribute("attributeName").value;return"CSS"==e?this.parent.style(t,!0):this.parent.attribute(t,!0)},this.initialValue=null,this.initialUnits="",this.removed=!1,this.calcValue=function(){return""},this.update=function(e){if(null==this.initialValue&&(this.initialValue=this.getProperty().value,this.initialUnits=this.getProperty().getUnits()),this.duration>this.maxDuration){if("indefinite"!=this.attribute("repeatCount").value)return"remove"!=this.attribute("fill").valueOrDefault("remove")||this.removed?!1:(this.removed=!0,this.getProperty().value=this.initialValue,!0);this.duration=0}this.duration=this.duration+e;var t=!1;if(this.begin<this.duration){var n=this.calcValue();if(this.attribute("type").hasValue()){var i=this.attribute("type").value;n=i+"("+n+")"}this.getProperty().value=n,t=!0}return t},this.from=this.attribute("from"),this.to=this.attribute("to"),this.values=this.attribute("values"),this.values.hasValue()&&(this.values.value=this.values.value.split(";")),this.progress=function(){var t={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(this.values.hasValue()){var n=t.progress*(this.values.value.length-1),i=Math.floor(n),r=Math.ceil(n);t.from=new e.Property("from",parseFloat(this.values.value[i])),t.to=new e.Property("to",parseFloat(this.values.value[r])),t.progress=(n-i)/(r-i)}else t.from=this.from,t.to=this.to;return t}},e.Element.AnimateBase.prototype=new e.Element.ElementBase,e.Element.animate=function(t){this.base=e.Element.AnimateBase,this.base(t),this.calcValue=function(){var e=this.progress(),t=e.from.numValue()+(e.to.numValue()-e.from.numValue())*e.progress;return t+this.initialUnits}},e.Element.animate.prototype=new e.Element.AnimateBase,e.Element.animateColor=function(t){this.base=e.Element.AnimateBase,this.base(t),this.calcValue=function(){var e=this.progress(),t=new RGBColor(e.from.value),n=new RGBColor(e.to.value);if(t.ok&&n.ok){var i=t.r+(n.r-t.r)*e.progress,r=t.g+(n.g-t.g)*e.progress,o=t.b+(n.b-t.b)*e.progress;return"rgb("+parseInt(i,10)+","+parseInt(r,10)+","+parseInt(o,10)+")"}return this.attribute("from").value}},e.Element.animateColor.prototype=new e.Element.AnimateBase,e.Element.animateTransform=function(t){this.base=e.Element.animate,this.base(t)},e.Element.animateTransform.prototype=new e.Element.animate,e.Element.font=function(t){this.base=e.Element.ElementBase,this.base(t),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.isRTL=!1,this.isArabic=!1,this.fontFace=null,this.missingGlyph=null,this.glyphs=[];for(var n=0;this.children.length>n;n++){var i=this.children[n];"font-face"==i.type?(this.fontFace=i,i.style("font-family").hasValue()&&(e.Definitions[i.style("font-family").value]=this)):"missing-glyph"==i.type?this.missingGlyph=i:"glyph"==i.type&&(""!=i.arabicForm?(this.isRTL=!0,this.isArabic=!0,"undefined"==typeof this.glyphs[i.unicode]&&(this.glyphs[i.unicode]=[]),this.glyphs[i.unicode][i.arabicForm]=i):this.glyphs[i.unicode]=i)}},e.Element.font.prototype=new e.Element.ElementBase,e.Element.fontface=function(t){this.base=e.Element.ElementBase,this.base(t),this.ascent=this.attribute("ascent").value,this.descent=this.attribute("descent").value,this.unitsPerEm=this.attribute("units-per-em").numValue()},e.Element.fontface.prototype=new e.Element.ElementBase,e.Element.missingglyph=function(t){this.base=e.Element.path,this.base(t),this.horizAdvX=0},e.Element.missingglyph.prototype=new e.Element.path,e.Element.glyph=function(t){this.base=e.Element.path,this.base(t),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.unicode=this.attribute("unicode").value,this.arabicForm=this.attribute("arabic-form").value},e.Element.glyph.prototype=new e.Element.path,e.Element.text=function(t){if(this.base=e.Element.RenderedElementBase,this.base(t),null!=t){this.children=[];for(var n=0;t.childNodes.length>n;n++){var i=t.childNodes[n];1==i.nodeType?this.addChild(i,!0):3==i.nodeType&&this.addChild(new e.Element.tspan(i),!1)}}this.baseSetContext=this.setContext,this.setContext=function(e){this.baseSetContext(e),this.style("dominant-baseline").hasValue()&&(e.textBaseline=this.style("dominant-baseline").value),this.style("alignment-baseline").hasValue()&&(e.textBaseline=this.style("alignment-baseline").value)},this.renderChildren=function(e){for(var t=this.style("text-anchor").valueOrDefault("start"),n=this.attribute("x").toPixels("x"),i=this.attribute("y").toPixels("y"),r=0;this.children.length>r;r++){var o=this.children[r];o.attribute("x").hasValue()?o.x=o.attribute("x").toPixels("x"):(this.attribute("dx").hasValue()&&(i+=this.attribute("dx").toPixels("x")),o.attribute("dx").hasValue()&&(n+=o.attribute("dx").toPixels("x")),o.x=n);var a=o.measureText(e);if("start"!=t&&(0==r||o.attribute("x").hasValue())){for(var s=a,l=r+1;this.children.length>l;l++){var c=this.children[l];if(c.attribute("x").hasValue())break;s+=c.measureText(e)}o.x-="end"==t?s:s/2}n=o.x+a,o.attribute("y").hasValue()?o.y=o.attribute("y").toPixels("y"):(this.attribute("dy").hasValue()&&(i+=this.attribute("dy").toPixels("y")),o.attribute("dy").hasValue()&&(i+=o.attribute("dy").toPixels("y")),o.y=i),i=o.y,o.render(e)}}},e.Element.text.prototype=new e.Element.RenderedElementBase,e.Element.TextElementBase=function(t){this.base=e.Element.RenderedElementBase,this.base(t),this.getGlyph=function(e,t,n){var i=t[n],r=null;if(e.isArabic){var o="isolated";(0==n||" "==t[n-1])&&t.length-2>n&&" "!=t[n+1]&&(o="terminal"),n>0&&" "!=t[n-1]&&t.length-2>n&&" "!=t[n+1]&&(o="medial"),n>0&&" "!=t[n-1]&&(n==t.length-1||" "==t[n+1])&&(o="initial"),"undefined"!=typeof e.glyphs[i]&&(r=e.glyphs[i][o],null==r&&"glyph"==e.glyphs[i].type&&(r=e.glyphs[i]))}else r=e.glyphs[i];return null==r&&(r=e.missingGlyph),r},this.renderChildren=function(t){var n=this.parent.style("font-family").getDefinition();if(null==n)""!=t.strokeStyle&&t.strokeText(e.compressSpaces(this.getText()),this.x,this.y),""!=t.fillStyle&&t.fillText(e.compressSpaces(this.getText()),this.x,this.y);else{var i=this.parent.style("font-size").numValueOrDefault(e.Font.Parse(e.ctx.font).fontSize),r=this.parent.style("font-style").valueOrDefault(e.Font.Parse(e.ctx.font).fontStyle),o=this.getText();n.isRTL&&(o=o.split("").reverse().join(""));for(var a=e.ToNumberArray(this.parent.attribute("dx").value),s=0;o.length>s;s++){var l=this.getGlyph(n,o,s),c=i/n.fontFace.unitsPerEm;t.translate(this.x,this.y),t.scale(c,-c);var u=t.lineWidth;t.lineWidth=t.lineWidth*n.fontFace.unitsPerEm/i,"italic"==r&&t.transform(1,0,.4,1,0,0),l.render(t),"italic"==r&&t.transform(1,0,-.4,1,0,0),t.lineWidth=u,t.scale(1/c,-1/c),t.translate(-this.x,-this.y),this.x+=i*(l.horizAdvX||n.horizAdvX)/n.fontFace.unitsPerEm,"undefined"==typeof a[s]||isNaN(a[s])||(this.x+=a[s])}}},this.getText=function(){},this.measureText=function(t){var n=this.parent.style("font-family").getDefinition();if(null!=n){var i=this.parent.style("font-size").numValueOrDefault(e.Font.Parse(e.ctx.font).fontSize),r=0,o=this.getText();
n.isRTL&&(o=o.split("").reverse().join(""));for(var a=e.ToNumberArray(this.parent.attribute("dx").value),s=0;o.length>s;s++){var l=this.getGlyph(n,o,s);r+=(l.horizAdvX||n.horizAdvX)*i/n.fontFace.unitsPerEm,"undefined"==typeof a[s]||isNaN(a[s])||(r+=a[s])}return r}var c=e.compressSpaces(this.getText());if(!t.measureText)return 10*c.length;t.save(),this.setContext(t);var u=t.measureText(c).width;return t.restore(),u}},e.Element.TextElementBase.prototype=new e.Element.RenderedElementBase,e.Element.tspan=function(t){this.base=e.Element.TextElementBase,this.base(t),this.text=3==t.nodeType?t.nodeValue:t.childNodes.length>0?t.childNodes[0].nodeValue:t.text,this.getText=function(){return this.text}},e.Element.tspan.prototype=new e.Element.TextElementBase,e.Element.tref=function(t){this.base=e.Element.TextElementBase,this.base(t),this.getText=function(){var e=this.attribute("xlink:href").getDefinition();return null!=e?e.children[0].getText():void 0}},e.Element.tref.prototype=new e.Element.TextElementBase,e.Element.a=function(t){this.base=e.Element.TextElementBase,this.base(t),this.hasText=!0;for(var n=0;t.childNodes.length>n;n++)3!=t.childNodes[n].nodeType&&(this.hasText=!1);this.text=this.hasText?t.childNodes[0].nodeValue:"",this.getText=function(){return this.text},this.baseRenderChildren=this.renderChildren,this.renderChildren=function(t){if(this.hasText){this.baseRenderChildren(t);var n=new e.Property("fontSize",e.Font.Parse(e.ctx.font).fontSize);e.Mouse.checkBoundingBox(this,new e.BoundingBox(this.x,this.y-n.toPixels("y"),this.x+this.measureText(t),this.y))}else{var i=new e.Element.g;i.children=this.children,i.parent=this,i.render(t)}},this.onclick=function(){window.open(this.attribute("xlink:href").value)},this.onmousemove=function(){e.ctx.canvas.style.cursor="pointer"}},e.Element.a.prototype=new e.Element.TextElementBase,e.Element.image=function(t){this.base=e.Element.RenderedElementBase,this.base(t);var n=this.attribute("xlink:href").value,i=n.match(/\.svg$/);if(e.Images.push(this),this.loaded=!1,i)this.img=e.ajax(n),this.loaded=!0;else{this.img=document.createElement("img");var r=this;this.img.onload=function(){r.loaded=!0},this.img.onerror=function(){console&&console.log('ERROR: image "'+n+'" not found'),r.loaded=!0},this.img.src=n}this.renderChildren=function(t){var n=this.attribute("x").toPixels("x"),r=this.attribute("y").toPixels("y"),o=this.attribute("width").toPixels("x"),a=this.attribute("height").toPixels("y");0!=o&&0!=a&&(t.save(),i?t.drawSvg(this.img,n,r,o,a):(t.translate(n,r),e.AspectRatio(t,this.attribute("preserveAspectRatio").value,o,this.img.width,a,this.img.height,0,0),t.drawImage(this.img,0,0)),t.restore())}},e.Element.image.prototype=new e.Element.RenderedElementBase,e.Element.g=function(t){this.base=e.Element.RenderedElementBase,this.base(t),this.getBoundingBox=function(){for(var t=new e.BoundingBox,n=0;this.children.length>n;n++)t.addBoundingBox(this.children[n].getBoundingBox());return t}},e.Element.g.prototype=new e.Element.RenderedElementBase,e.Element.symbol=function(t){this.base=e.Element.RenderedElementBase,this.base(t),this.baseSetContext=this.setContext,this.setContext=function(t){if(this.baseSetContext(t),this.attribute("viewBox").hasValue()){var n=e.ToNumberArray(this.attribute("viewBox").value),i=n[0],r=n[1];width=n[2],height=n[3],e.AspectRatio(t,this.attribute("preserveAspectRatio").value,this.attribute("width").toPixels("x"),width,this.attribute("height").toPixels("y"),height,i,r),e.ViewPort.SetCurrent(n[2],n[3])}}},e.Element.symbol.prototype=new e.Element.RenderedElementBase,e.Element.style=function(t){this.base=e.Element.ElementBase,this.base(t);var n=t.childNodes[0].nodeValue+(t.childNodes.length>1?t.childNodes[1].nodeValue:"");n=n.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,""),n=e.compressSpaces(n);for(var i=n.split("}"),r=0;i.length>r;r++)if(""!=e.trim(i[r]))for(var o=i[r].split("{"),a=o[0].split(","),s=o[1].split(";"),l=0;a.length>l;l++){var c=e.trim(a[l]);if(""!=c){for(var u={},d=0;s.length>d;d++){var h=s[d].indexOf(":"),p=s[d].substr(0,h),f=s[d].substr(h+1,s[d].length-h);null!=p&&null!=f&&(u[e.trim(p)]=new e.Property(e.trim(p),e.trim(f)))}if(e.Styles[c]=u,"@font-face"==c)for(var m=u["font-family"].value.replace(/"/g,""),g=u.src.value.split(","),v=0;g.length>v;v++)if(g[v].indexOf('format("svg")')>0)for(var y=g[v].indexOf("url"),b=g[v].indexOf(")",y),_=g[v].substr(y+5,b-y-6),w=e.parseXml(e.ajax(_)),S=w.getElementsByTagName("font"),x=0;S.length>x;x++){var C=e.CreateElement(S[x]);e.Definitions[m]=C}}}},e.Element.style.prototype=new e.Element.ElementBase,e.Element.use=function(t){this.base=e.Element.RenderedElementBase,this.base(t),this.baseSetContext=this.setContext,this.setContext=function(e){this.baseSetContext(e),this.attribute("x").hasValue()&&e.translate(this.attribute("x").toPixels("x"),0),this.attribute("y").hasValue()&&e.translate(0,this.attribute("y").toPixels("y"))},this.getDefinition=function(){var e=this.attribute("xlink:href").getDefinition();return this.attribute("width").hasValue()&&(e.attribute("width",!0).value=this.attribute("width").value),this.attribute("height").hasValue()&&(e.attribute("height",!0).value=this.attribute("height").value),e},this.path=function(e){var t=this.getDefinition();null!=t&&t.path(e)},this.renderChildren=function(e){var t=this.getDefinition();if(null!=t){var n=t.parent;t.parent=null,t.render(e),t.parent=n}}},e.Element.use.prototype=new e.Element.RenderedElementBase,e.Element.mask=function(t){this.base=e.Element.ElementBase,this.base(t),this.apply=function(e,t){var n=this.attribute("x").toPixels("x"),i=this.attribute("y").toPixels("y"),r=this.attribute("width").toPixels("x"),o=this.attribute("height").toPixels("y"),a=t.attribute("mask").value;t.attribute("mask").value="";var s=document.createElement("canvas");s.width=n+r,s.height=i+o;var l=s.getContext("2d");this.renderChildren(l);var c=document.createElement("canvas");c.width=n+r,c.height=i+o;var u=c.getContext("2d");t.render(u),u.globalCompositeOperation="destination-in",u.fillStyle=l.createPattern(s,"no-repeat"),u.fillRect(0,0,n+r,i+o),e.fillStyle=u.createPattern(c,"no-repeat"),e.fillRect(0,0,n+r,i+o),t.attribute("mask").value=a},this.render=function(){}},e.Element.mask.prototype=new e.Element.ElementBase,e.Element.clipPath=function(t){this.base=e.Element.ElementBase,this.base(t),this.apply=function(e){for(var t=0;this.children.length>t;t++)this.children[t].path&&(this.children[t].path(e),e.clip())},this.render=function(){}},e.Element.clipPath.prototype=new e.Element.ElementBase,e.Element.filter=function(t){this.base=e.Element.ElementBase,this.base(t),this.apply=function(e,t){var n=t.getBoundingBox(),i=this.attribute("x").toPixels("x"),r=this.attribute("y").toPixels("y");(0==i||0==r)&&(i=n.x1,r=n.y1);var o=this.attribute("width").toPixels("x"),a=this.attribute("height").toPixels("y");(0==o||0==a)&&(o=n.width(),a=n.height());var s=t.style("filter").value;t.style("filter").value="";var l=.2,c=l*o,u=l*a,d=document.createElement("canvas");d.width=o+2*c,d.height=a+2*u;var h=d.getContext("2d");h.translate(-i+c,-r+u),t.render(h);for(var p=0;this.children.length>p;p++)this.children[p].apply(h,0,0,o+2*c,a+2*u);e.drawImage(d,0,0,o+2*c,a+2*u,i-c,r-u,o+2*c,a+2*u),t.style("filter",!0).value=s},this.render=function(){}},e.Element.filter.prototype=new e.Element.ElementBase,e.Element.feGaussianBlur=function(t){function n(e){e=Math.max(e,.01);var t=Math.ceil(4*e)+1;mask=[];for(var n=0;t>n;n++)mask[n]=Math.exp(-.5*(n/e)*(n/e));return mask}function i(e){for(var t=0,n=1;e.length>n;n++)t+=Math.abs(e[n]);t=2*t+Math.abs(e[0]);for(var n=0;e.length>n;n++)e[n]/=t;return e}function r(e,t,n,i,r){for(var s=0;r>s;s++)for(var l=0;i>l;l++)for(var c=o(e,l,s,i,r,3)/255,u=0;4>u;u++){for(var d=n[0]*(0==c?255:o(e,l,s,i,r,u))*(0==c||3==u?1:c),h=1;n.length>h;h++){var p=o(e,Math.max(l-h,0),s,i,r,3)/255,f=o(e,Math.min(l+h,i-1),s,i,r,3)/255;d+=n[h]*((0==p?255:o(e,Math.max(l-h,0),s,i,r,u))*(0==p||3==u?1:p)+(0==f?255:o(e,Math.min(l+h,i-1),s,i,r,u))*(0==f||3==u?1:f))}a(t,s,l,r,i,u,d)}}function o(e,t,n,i,r,o){return e[4*n*i+4*t+o]}function a(e,t,n,i,r,o,a){e[4*n*i+4*t+o]=a}function s(e,t,o,a){var s=e.getImageData(0,0,t,o),l=n(a);l=i(l),tmp=[],r(s.data,tmp,l,t,o),r(tmp,s.data,l,o,t),e.clearRect(0,0,t,o),e.putImageData(s,0,0)}this.base=e.Element.ElementBase,this.base(t),this.apply=function(e,t,n,i,r){s(e,i,r,this.attribute("stdDeviation").numValue())}},e.Element.filter.prototype=new e.Element.feGaussianBlur,e.Element.title=function(){},e.Element.title.prototype=new e.Element.ElementBase,e.Element.desc=function(){},e.Element.desc.prototype=new e.Element.ElementBase,e.Element.MISSING=function(e){console&&console.log("ERROR: Element '"+e.nodeName+"' not yet implemented.")},e.Element.MISSING.prototype=new e.Element.ElementBase,e.CreateElement=function(t){var n=t.nodeName.replace(/^[^:]+:/,"");n=n.replace(/\-/g,"");var i=null;return i="undefined"!=typeof e.Element[n]?new e.Element[n](t):new e.Element.MISSING(t),i.type=t.nodeName,i},e.load=function(t,n){e.loadXml(t,e.ajax(n))},e.loadXml=function(t,n){e.loadXmlDoc(t,e.parseXml(n))},e.loadXmlDoc=function(t,n){e.init(t);var i=function(e){for(var n=t.canvas;n;)e.x-=n.offsetLeft,e.y-=n.offsetTop,n=n.offsetParent;return window.scrollX&&(e.x+=window.scrollX),window.scrollY&&(e.y+=window.scrollY),e};1!=e.opts.ignoreMouse&&(t.canvas.onclick=function(t){var n=i(new e.Point(null!=t?t.clientX:event.clientX,null!=t?t.clientY:event.clientY));e.Mouse.onclick(n.x,n.y)},t.canvas.onmousemove=function(t){var n=i(new e.Point(null!=t?t.clientX:event.clientX,null!=t?t.clientY:event.clientY));e.Mouse.onmousemove(n.x,n.y)});var r=e.CreateElement(n.documentElement);r.root=!0;var o=!0,a=function(){e.ViewPort.Clear(),t.canvas.parentNode&&e.ViewPort.SetCurrent(t.canvas.parentNode.clientWidth,t.canvas.parentNode.clientHeight),1!=e.opts.ignoreDimensions&&(r.style("width").hasValue()&&(t.canvas.width=r.style("width").toPixels("x"),t.canvas.style.width=t.canvas.width+"px"),r.style("height").hasValue()&&(t.canvas.height=r.style("height").toPixels("y"),t.canvas.style.height=t.canvas.height+"px"));var n=t.canvas.clientWidth||t.canvas.width,i=t.canvas.clientHeight||t.canvas.height;if(1==e.opts.ignoreDimensions&&r.style("width").hasValue()&&r.style("height").hasValue()&&(n=r.style("width").toPixels("x"),i=r.style("height").toPixels("y")),e.ViewPort.SetCurrent(n,i),null!=e.opts.offsetX&&(r.attribute("x",!0).value=e.opts.offsetX),null!=e.opts.offsetY&&(r.attribute("y",!0).value=e.opts.offsetY),null!=e.opts.scaleWidth&&null!=e.opts.scaleHeight){var a=1,s=1,l=e.ToNumberArray(r.attribute("viewBox").value);r.attribute("width").hasValue()?a=r.attribute("width").toPixels("x")/e.opts.scaleWidth:isNaN(l[2])||(a=l[2]/e.opts.scaleWidth),r.attribute("height").hasValue()?s=r.attribute("height").toPixels("y")/e.opts.scaleHeight:isNaN(l[3])||(s=l[3]/e.opts.scaleHeight),r.attribute("width",!0).value=e.opts.scaleWidth,r.attribute("height",!0).value=e.opts.scaleHeight,r.attribute("viewBox",!0).value="0 0 "+n*a+" "+i*s,r.attribute("preserveAspectRatio",!0).value="none"}1!=e.opts.ignoreClear&&t.clearRect(0,0,n,i),r.render(t),o&&(o=!1,"function"==typeof e.opts.renderCallback&&e.opts.renderCallback())},s=!0;e.ImagesLoaded()&&(s=!1,a()),e.intervalID=setInterval(function(){var t=!1;if(s&&e.ImagesLoaded()&&(s=!1,t=!0),1!=e.opts.ignoreMouse&&(t|=e.Mouse.hasEvents()),1!=e.opts.ignoreAnimation)for(var n=0;e.Animations.length>n;n++)t|=e.Animations[n].update(1e3/e.FRAMERATE);"function"==typeof e.opts.forceRedraw&&1==e.opts.forceRedraw()&&(t=!0),t&&(a(),e.Mouse.runEvents())},1e3/e.FRAMERATE)},e.stop=function(){e.intervalID&&clearInterval(e.intervalID)},e.Mouse=new function(){this.events=[],this.hasEvents=function(){return 0!=this.events.length},this.onclick=function(e,t){this.events.push({type:"onclick",x:e,y:t,run:function(e){e.onclick&&e.onclick()}})},this.onmousemove=function(e,t){this.events.push({type:"onmousemove",x:e,y:t,run:function(e){e.onmousemove&&e.onmousemove()}})},this.eventElements=[],this.checkPath=function(e,t){for(var n=0;this.events.length>n;n++){var i=this.events[n];t.isPointInPath&&t.isPointInPath(i.x,i.y)&&(this.eventElements[n]=e)}},this.checkBoundingBox=function(e,t){for(var n=0;this.events.length>n;n++){var i=this.events[n];t.isPointInBox(i.x,i.y)&&(this.eventElements[n]=e)}},this.runEvents=function(){e.ctx.canvas.style.cursor="";for(var t=0;this.events.length>t;t++)for(var n=this.events[t],i=this.eventElements[t];i;)n.run(i),i=i.parent;this.events=[],this.eventElements=[]}},e}this.canvg=function(t,n,i){if(null!=t||null!=n||null!=i){i=i||{},"string"==typeof t&&(t=document.getElementById(t)),null!=t.svg&&t.svg.stop(),t.svg=svg=e(),svg.opts=i;var r=t.getContext("2d");"undefined"!=typeof n.documentElement?svg.loadXmlDoc(r,n):"<"==n.substr(0,1)?svg.loadXml(r,n):svg.load(r,n)}else for(var o=document.getElementsByTagName("svg"),a=0;o.length>a;a++){var s=o[a],l=document.createElement("canvas");l.width=s.clientWidth,l.height=s.clientHeight,s.parentNode.insertBefore(l,s),s.parentNode.removeChild(s);var c=document.createElement("div");c.appendChild(s),canvg(l,c.innerHTML)}}}(),CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.drawSvg=function(e,t,n,i,r){canvg(this.canvas,e,{ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:t,offsetY:n,scaleWidth:i,scaleHeight:r})}),function(e,t){"object"==typeof exports?module.exports=t(global):"function"==typeof define&&define.amd?define([],function(){return t(e)}):t(e)}(this,function(e){function t(e){return r=e}function n(){return r="undefined"!=typeof Float32Array?Float32Array:Array}var i={};(function(){if("undefined"!=typeof Float32Array){var e=new Float32Array(1),t=new Int32Array(e.buffer);i.invsqrt=function(n){e[0]=n,t[0]=1597463007-(t[0]>>1);var i=e[0];return i*(1.5-.5*n*i*i)}}else i.invsqrt=function(e){return 1/Math.sqrt(e)}})();var r=null;n();var o={create:function(e){var t=new r(3);return e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):t[0]=t[1]=t[2]=0,t},createFrom:function(e,t,n){var i=new r(3);return i[0]=e,i[1]=t,i[2]=n,i},set:function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},equal:function(e,t){return e===t||1e-6>Math.abs(e[0]-t[0])&&1e-6>Math.abs(e[1]-t[1])&&1e-6>Math.abs(e[2]-t[2])},add:function(e,t,n){return n&&e!==n?(n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n):(e[0]+=t[0],e[1]+=t[1],e[2]+=t[2],e)},subtract:function(e,t,n){return n&&e!==n?(n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n):(e[0]-=t[0],e[1]-=t[1],e[2]-=t[2],e)},multiply:function(e,t,n){return n&&e!==n?(n[0]=e[0]*t[0],n[1]=e[1]*t[1],n[2]=e[2]*t[2],n):(e[0]*=t[0],e[1]*=t[1],e[2]*=t[2],e)},negate:function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},scale:function(e,t,n){return n&&e!==n?(n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n):(e[0]*=t,e[1]*=t,e[2]*=t,e)},normalize:function(e,t){t||(t=e);var n=e[0],i=e[1],r=e[2],o=Math.sqrt(n*n+i*i+r*r);return o?1===o?(t[0]=n,t[1]=i,t[2]=r,t):(o=1/o,t[0]=n*o,t[1]=i*o,t[2]=r*o,t):(t[0]=0,t[1]=0,t[2]=0,t)},cross:function(e,t,n){n||(n=e);var i=e[0],r=e[1],e=e[2],o=t[0],a=t[1],t=t[2];return n[0]=r*t-e*a,n[1]=e*o-i*t,n[2]=i*a-r*o,n},length:function(e){var t=e[0],n=e[1],e=e[2];return Math.sqrt(t*t+n*n+e*e)},squaredLength:function(e){var t=e[0],n=e[1],e=e[2];return t*t+n*n+e*e},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},direction:function(e,t,n){n||(n=e);var i=e[0]-t[0],r=e[1]-t[1],e=e[2]-t[2],t=Math.sqrt(i*i+r*r+e*e);return t?(t=1/t,n[0]=i*t,n[1]=r*t,n[2]=e*t,n):(n[0]=0,n[1]=0,n[2]=0,n)},lerp:function(e,t,n,i){return i||(i=e),i[0]=e[0]+n*(t[0]-e[0]),i[1]=e[1]+n*(t[1]-e[1]),i[2]=e[2]+n*(t[2]-e[2]),i},dist:function(e,t){var n=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2];return Math.sqrt(n*n+i*i+r*r)}},a=null,s=new r(4);o.unproject=function(e,t,n,i,r){r||(r=e),a||(a=p.create());var o=a;return s[0]=2*(e[0]-i[0])/i[2]-1,s[1]=2*(e[1]-i[1])/i[3]-1,s[2]=2*e[2]-1,s[3]=1,p.multiply(n,t,o),p.inverse(o)?(p.multiplyVec4(o,s),0===s[3]?null:(r[0]=s[0]/s[3],r[1]=s[1]/s[3],r[2]=s[2]/s[3],r)):null};var l=o.createFrom(1,0,0),c=o.createFrom(0,1,0),u=o.createFrom(0,0,1),d=o.create();o.rotationTo=function(e,t,n){n||(n=f.create());var i=o.dot(e,t);if(i>=1)f.set(m,n);else if(-.999999>i)o.cross(l,e,d),1e-6>o.length(d)&&o.cross(c,e,d),1e-6>o.length(d)&&o.cross(u,e,d),o.normalize(d),f.fromAngleAxis(Math.PI,d,n);else{var i=Math.sqrt(2*(1+i)),r=1/i;o.cross(e,t,d),n[0]=d[0]*r,n[1]=d[1]*r,n[2]=d[2]*r,n[3]=.5*i,f.normalize(n)}return n[3]>1?n[3]=1:-1>n[3]&&(n[3]=-1),n},o.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+"]"};var h={create:function(e){var t=new r(9);return e?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8]):t[0]=t[1]=t[2]=t[3]=t[4]=t[5]=t[6]=t[7]=t[8]=0,t},createFrom:function(e,t,n,i,o,a,s,l,c){var u=new r(9);return u[0]=e,u[1]=t,u[2]=n,u[3]=i,u[4]=o,u[5]=a,u[6]=s,u[7]=l,u[8]=c,u},determinant:function(e){var t=e[3],n=e[4],i=e[5],r=e[6],o=e[7],a=e[8];return e[0]*(a*n-i*o)+e[1]*(-a*t+i*r)+e[2]*(o*t-n*r)},inverse:function(e,t){var n=e[0],i=e[1],r=e[2],o=e[3],a=e[4],s=e[5],l=e[6],c=e[7],u=e[8],d=u*a-s*c,p=-u*o+s*l,f=c*o-a*l,m=n*d+i*p+r*f;return m?(m=1/m,t||(t=h.create()),t[0]=d*m,t[1]=(-u*i+r*c)*m,t[2]=(s*i-r*a)*m,t[3]=p*m,t[4]=(u*n-r*l)*m,t[5]=(-s*n+r*o)*m,t[6]=f*m,t[7]=(-c*n+i*l)*m,t[8]=(a*n-i*o)*m,t):null},multiply:function(e,t,n){n||(n=e);var i=e[0],r=e[1],o=e[2],a=e[3],s=e[4],l=e[5],c=e[6],u=e[7],e=e[8],d=t[0],h=t[1],p=t[2],f=t[3],m=t[4],g=t[5],v=t[6],y=t[7],t=t[8];return n[0]=d*i+h*a+p*c,n[1]=d*r+h*s+p*u,n[2]=d*o+h*l+p*e,n[3]=f*i+m*a+g*c,n[4]=f*r+m*s+g*u,n[5]=f*o+m*l+g*e,n[6]=v*i+y*a+t*c,n[7]=v*r+y*s+t*u,n[8]=v*o+y*l+t*e,n},multiplyVec2:function(e,t,n){n||(n=t);var i=t[0],t=t[1];return n[0]=i*e[0]+t*e[3]+e[6],n[1]=i*e[1]+t*e[4]+e[7],n},multiplyVec3:function(e,t,n){n||(n=t);var i=t[0],r=t[1],t=t[2];return n[0]=i*e[0]+r*e[3]+t*e[6],n[1]=i*e[1]+r*e[4]+t*e[7],n[2]=i*e[2]+r*e[5]+t*e[8],n},set:function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},equal:function(e,t){return e===t||1e-6>Math.abs(e[0]-t[0])&&1e-6>Math.abs(e[1]-t[1])&&1e-6>Math.abs(e[2]-t[2])&&1e-6>Math.abs(e[3]-t[3])&&1e-6>Math.abs(e[4]-t[4])&&1e-6>Math.abs(e[5]-t[5])&&1e-6>Math.abs(e[6]-t[6])&&1e-6>Math.abs(e[7]-t[7])&&1e-6>Math.abs(e[8]-t[8])},identity:function(e){return e||(e=h.create()),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},transpose:function(e,t){if(!t||e===t){var n=e[1],i=e[2],r=e[5];return e[1]=e[3],e[2]=e[6],e[3]=n,e[5]=e[7],e[6]=i,e[7]=r,e}return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],t},toMat4:function(e,t){return t||(t=p.create()),t[15]=1,t[14]=0,t[13]=0,t[12]=0,t[11]=0,t[10]=e[8],t[9]=e[7],t[8]=e[6],t[7]=0,t[6]=e[5],t[5]=e[4],t[4]=e[3],t[3]=0,t[2]=e[2],t[1]=e[1],t[0]=e[0],t},str:function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+"]"}},p={create:function(e){var t=new r(16);return e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t},createFrom:function(e,t,n,i,o,a,s,l,c,u,d,h,p,f,m,g){var v=new r(16);return v[0]=e,v[1]=t,v[2]=n,v[3]=i,v[4]=o,v[5]=a,v[6]=s,v[7]=l,v[8]=c,v[9]=u,v[10]=d,v[11]=h,v[12]=p,v[13]=f,v[14]=m,v[15]=g,v},set:function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},equal:function(e,t){return e===t||1e-6>Math.abs(e[0]-t[0])&&1e-6>Math.abs(e[1]-t[1])&&1e-6>Math.abs(e[2]-t[2])&&1e-6>Math.abs(e[3]-t[3])&&1e-6>Math.abs(e[4]-t[4])&&1e-6>Math.abs(e[5]-t[5])&&1e-6>Math.abs(e[6]-t[6])&&1e-6>Math.abs(e[7]-t[7])&&1e-6>Math.abs(e[8]-t[8])&&1e-6>Math.abs(e[9]-t[9])&&1e-6>Math.abs(e[10]-t[10])&&1e-6>Math.abs(e[11]-t[11])&&1e-6>Math.abs(e[12]-t[12])&&1e-6>Math.abs(e[13]-t[13])&&1e-6>Math.abs(e[14]-t[14])&&1e-6>Math.abs(e[15]-t[15])},identity:function(e){return e||(e=p.create()),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},transpose:function(e,t){if(!t||e===t){var n=e[1],i=e[2],r=e[3],o=e[6],a=e[7],s=e[11];return e[1]=e[4],e[2]=e[8],e[3]=e[12],e[4]=n,e[6]=e[9],e[7]=e[13],e[8]=i,e[9]=o,e[11]=e[14],e[12]=r,e[13]=a,e[14]=s,e}return t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t},determinant:function(e){var t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],a=e[5],s=e[6],l=e[7],c=e[8],u=e[9],d=e[10],h=e[11],p=e[12],f=e[13],m=e[14],e=e[15];return p*u*s*r-c*f*s*r-p*a*d*r+o*f*d*r+c*a*m*r-o*u*m*r-p*u*i*l+c*f*i*l+p*n*d*l-t*f*d*l-c*n*m*l+t*u*m*l+p*a*i*h-o*f*i*h-p*n*s*h+t*f*s*h+o*n*m*h-t*a*m*h-c*a*i*e+o*u*i*e+c*n*s*e-t*u*s*e-o*n*d*e+t*a*d*e},inverse:function(e,t){t||(t=e);var n=e[0],i=e[1],r=e[2],o=e[3],a=e[4],s=e[5],l=e[6],c=e[7],u=e[8],d=e[9],h=e[10],p=e[11],f=e[12],m=e[13],g=e[14],v=e[15],y=n*s-i*a,b=n*l-r*a,_=n*c-o*a,w=i*l-r*s,S=i*c-o*s,x=r*c-o*l,C=u*m-d*f,$=u*g-h*f,E=u*v-p*f,T=d*g-h*m,k=d*v-p*m,A=h*v-p*g,N=y*A-b*k+_*T+w*E-S*$+x*C;return N?(N=1/N,t[0]=(s*A-l*k+c*T)*N,t[1]=(-i*A+r*k-o*T)*N,t[2]=(m*x-g*S+v*w)*N,t[3]=(-d*x+h*S-p*w)*N,t[4]=(-a*A+l*E-c*$)*N,t[5]=(n*A-r*E+o*$)*N,t[6]=(-f*x+g*_-v*b)*N,t[7]=(u*x-h*_+p*b)*N,t[8]=(a*k-s*E+c*C)*N,t[9]=(-n*k+i*E-o*C)*N,t[10]=(f*S-m*_+v*y)*N,t[11]=(-u*S+d*_-p*y)*N,t[12]=(-a*T+s*$-l*C)*N,t[13]=(n*T-i*$+r*C)*N,t[14]=(-f*w+m*b-g*y)*N,t[15]=(u*w-d*b+h*y)*N,t):null},toRotationMat:function(e,t){return t||(t=p.create()),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},toMat3:function(e,t){return t||(t=h.create()),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},toInverseMat3:function(e,t){var n=e[0],i=e[1],r=e[2],o=e[4],a=e[5],s=e[6],l=e[8],c=e[9],u=e[10],d=u*a-s*c,p=-u*o+s*l,f=c*o-a*l,m=n*d+i*p+r*f;return m?(m=1/m,t||(t=h.create()),t[0]=d*m,t[1]=(-u*i+r*c)*m,t[2]=(s*i-r*a)*m,t[3]=p*m,t[4]=(u*n-r*l)*m,t[5]=(-s*n+r*o)*m,t[6]=f*m,t[7]=(-c*n+i*l)*m,t[8]=(a*n-i*o)*m,t):null},multiply:function(e,t,n){n||(n=e);var i=e[0],r=e[1],o=e[2],a=e[3],s=e[4],l=e[5],c=e[6],u=e[7],d=e[8],h=e[9],p=e[10],f=e[11],m=e[12],g=e[13],v=e[14],e=e[15],y=t[0],b=t[1],_=t[2],w=t[3];return n[0]=y*i+b*s+_*d+w*m,n[1]=y*r+b*l+_*h+w*g,n[2]=y*o+b*c+_*p+w*v,n[3]=y*a+b*u+_*f+w*e,y=t[4],b=t[5],_=t[6],w=t[7],n[4]=y*i+b*s+_*d+w*m,n[5]=y*r+b*l+_*h+w*g,n[6]=y*o+b*c+_*p+w*v,n[7]=y*a+b*u+_*f+w*e,y=t[8],b=t[9],_=t[10],w=t[11],n[8]=y*i+b*s+_*d+w*m,n[9]=y*r+b*l+_*h+w*g,n[10]=y*o+b*c+_*p+w*v,n[11]=y*a+b*u+_*f+w*e,y=t[12],b=t[13],_=t[14],w=t[15],n[12]=y*i+b*s+_*d+w*m,n[13]=y*r+b*l+_*h+w*g,n[14]=y*o+b*c+_*p+w*v,n[15]=y*a+b*u+_*f+w*e,n},multiplyVec3:function(e,t,n){n||(n=t);var i=t[0],r=t[1],t=t[2];return n[0]=e[0]*i+e[4]*r+e[8]*t+e[12],n[1]=e[1]*i+e[5]*r+e[9]*t+e[13],n[2]=e[2]*i+e[6]*r+e[10]*t+e[14],n},multiplyVec4:function(e,t,n){n||(n=t);var i=t[0],r=t[1],o=t[2],t=t[3];return n[0]=e[0]*i+e[4]*r+e[8]*o+e[12]*t,n[1]=e[1]*i+e[5]*r+e[9]*o+e[13]*t,n[2]=e[2]*i+e[6]*r+e[10]*o+e[14]*t,n[3]=e[3]*i+e[7]*r+e[11]*o+e[15]*t,n},translate:function(e,t,n){var i,r,o,a,s,l,c,u,d,h,p,f,m=t[0],g=t[1],t=t[2];return n&&e!==n?(i=e[0],r=e[1],o=e[2],a=e[3],s=e[4],l=e[5],c=e[6],u=e[7],d=e[8],h=e[9],p=e[10],f=e[11],n[0]=i,n[1]=r,n[2]=o,n[3]=a,n[4]=s,n[5]=l,n[6]=c,n[7]=u,n[8]=d,n[9]=h,n[10]=p,n[11]=f,n[12]=i*m+s*g+d*t+e[12],n[13]=r*m+l*g+h*t+e[13],n[14]=o*m+c*g+p*t+e[14],n[15]=a*m+u*g+f*t+e[15],n):(e[12]=e[0]*m+e[4]*g+e[8]*t+e[12],e[13]=e[1]*m+e[5]*g+e[9]*t+e[13],e[14]=e[2]*m+e[6]*g+e[10]*t+e[14],e[15]=e[3]*m+e[7]*g+e[11]*t+e[15],e)},scale:function(e,t,n){var i=t[0],r=t[1],t=t[2];return n&&e!==n?(n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n[4]=e[4]*r,n[5]=e[5]*r,n[6]=e[6]*r,n[7]=e[7]*r,n[8]=e[8]*t,n[9]=e[9]*t,n[10]=e[10]*t,n[11]=e[11]*t,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n):(e[0]*=i,e[1]*=i,e[2]*=i,e[3]*=i,e[4]*=r,e[5]*=r,e[6]*=r,e[7]*=r,e[8]*=t,e[9]*=t,e[10]*=t,e[11]*=t,e)},rotate:function(e,t,n,i){var r,o,a,s,l,c,u,d,h,p,f,m,g,v,y,b,_,w,S,x,C=n[0],$=n[1],n=n[2],E=Math.sqrt(C*C+$*$+n*n);return E?(1!==E&&(E=1/E,C*=E,$*=E,n*=E),r=Math.sin(t),o=Math.cos(t),a=1-o,t=e[0],E=e[1],s=e[2],l=e[3],c=e[4],u=e[5],d=e[6],h=e[7],p=e[8],f=e[9],m=e[10],g=e[11],v=C*C*a+o,y=$*C*a+n*r,b=n*C*a-$*r,_=C*$*a-n*r,w=$*$*a+o,S=n*$*a+C*r,x=C*n*a+$*r,C=$*n*a-C*r,$=n*n*a+o,i?e!==i&&(i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]):i=e,i[0]=t*v+c*y+p*b,i[1]=E*v+u*y+f*b,i[2]=s*v+d*y+m*b,i[3]=l*v+h*y+g*b,i[4]=t*_+c*w+p*S,i[5]=E*_+u*w+f*S,i[6]=s*_+d*w+m*S,i[7]=l*_+h*w+g*S,i[8]=t*x+c*C+p*$,i[9]=E*x+u*C+f*$,i[10]=s*x+d*C+m*$,i[11]=l*x+h*C+g*$,i):null},rotateX:function(e,t,n){var i=Math.sin(t),t=Math.cos(t),r=e[4],o=e[5],a=e[6],s=e[7],l=e[8],c=e[9],u=e[10],d=e[11];return n?e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]):n=e,n[4]=r*t+l*i,n[5]=o*t+c*i,n[6]=a*t+u*i,n[7]=s*t+d*i,n[8]=r*-i+l*t,n[9]=o*-i+c*t,n[10]=a*-i+u*t,n[11]=s*-i+d*t,n},rotateY:function(e,t,n){var i=Math.sin(t),t=Math.cos(t),r=e[0],o=e[1],a=e[2],s=e[3],l=e[8],c=e[9],u=e[10],d=e[11];return n?e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]):n=e,n[0]=r*t+l*-i,n[1]=o*t+c*-i,n[2]=a*t+u*-i,n[3]=s*t+d*-i,n[8]=r*i+l*t,n[9]=o*i+c*t,n[10]=a*i+u*t,n[11]=s*i+d*t,n},rotateZ:function(e,t,n){var i=Math.sin(t),t=Math.cos(t),r=e[0],o=e[1],a=e[2],s=e[3],l=e[4],c=e[5],u=e[6],d=e[7];return n?e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]):n=e,n[0]=r*t+l*i,n[1]=o*t+c*i,n[2]=a*t+u*i,n[3]=s*t+d*i,n[4]=r*-i+l*t,n[5]=o*-i+c*t,n[6]=a*-i+u*t,n[7]=s*-i+d*t,n},frustum:function(e,t,n,i,r,o,a){a||(a=p.create());var s=t-e,l=i-n,c=o-r;return a[0]=2*r/s,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*r/l,a[6]=0,a[7]=0,a[8]=(t+e)/s,a[9]=(i+n)/l,a[10]=-(o+r)/c,a[11]=-1,a[12]=0,a[13]=0,a[14]=-(2*o*r)/c,a[15]=0,a},perspective:function(e,t,n,i,r){return e=n*Math.tan(e*Math.PI/360),t*=e,p.frustum(-t,t,-e,e,n,i,r)},ortho:function(e,t,n,i,r,o,a){a||(a=p.create());var s=t-e,l=i-n,c=o-r;return a[0]=2/s,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2/l,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=-2/c,a[11]=0,a[12]=-(e+t)/s,a[13]=-(i+n)/l,a[14]=-(o+r)/c,a[15]=1,a},lookAt:function(e,t,n,i){i||(i=p.create());var r,o,a,s,l,c,u,d,h=e[0],f=e[1],e=e[2];return a=n[0],s=n[1],o=n[2],u=t[0],n=t[1],r=t[2],h===u&&f===n&&e===r?p.identity(i):(t=h-u,n=f-n,u=e-r,d=1/Math.sqrt(t*t+n*n+u*u),t*=d,n*=d,u*=d,r=s*u-o*n,o=o*t-a*u,a=a*n-s*t,(d=Math.sqrt(r*r+o*o+a*a))?(d=1/d,r*=d,o*=d,a*=d):a=o=r=0,s=n*a-u*o,l=u*r-t*a,c=t*o-n*r,(d=Math.sqrt(s*s+l*l+c*c))?(d=1/d,s*=d,l*=d,c*=d):c=l=s=0,i[0]=r,i[1]=s,i[2]=t,i[3]=0,i[4]=o,i[5]=l,i[6]=n,i[7]=0,i[8]=a,i[9]=c,i[10]=u,i[11]=0,i[12]=-(r*h+o*f+a*e),i[13]=-(s*h+l*f+c*e),i[14]=-(t*h+n*f+u*e),i[15]=1,i)},fromRotationTranslation:function(e,t,n){n||(n=p.create());var i=e[0],r=e[1],o=e[2],a=e[3],s=i+i,l=r+r,c=o+o,e=i*s,u=i*l,i=i*c,d=r*l,r=r*c,o=o*c,s=a*s,l=a*l,a=a*c;return n[0]=1-(d+o),n[1]=u+a,n[2]=i-l,n[3]=0,n[4]=u-a,n[5]=1-(e+o),n[6]=r+s,n[7]=0,n[8]=i+l,n[9]=r-s,n[10]=1-(e+d),n[11]=0,n[12]=t[0],n[13]=t[1],n[14]=t[2],n[15]=1,n},str:function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+"]"}},f={create:function(e){var t=new r(4);return e?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]):t[0]=t[1]=t[2]=t[3]=0,t},createFrom:function(e,t,n,i){var o=new r(4);return o[0]=e,o[1]=t,o[2]=n,o[3]=i,o},set:function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},equal:function(e,t){return e===t||1e-6>Math.abs(e[0]-t[0])&&1e-6>Math.abs(e[1]-t[1])&&1e-6>Math.abs(e[2]-t[2])&&1e-6>Math.abs(e[3]-t[3])},identity:function(e){return e||(e=f.create()),e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}},m=f.identity();f.calculateW=function(e,t){var n=e[0],i=e[1],r=e[2];return t&&e!==t?(t[0]=n,t[1]=i,t[2]=r,t[3]=-Math.sqrt(Math.abs(1-n*n-i*i-r*r)),t):(e[3]=-Math.sqrt(Math.abs(1-n*n-i*i-r*r)),e)},f.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},f.inverse=function(e,t){var n=e[0],i=e[1],r=e[2],o=e[3],n=(n=n*n+i*i+r*r+o*o)?1/n:0;return t&&e!==t?(t[0]=-e[0]*n,t[1]=-e[1]*n,t[2]=-e[2]*n,t[3]=e[3]*n,t):(e[0]*=-n,e[1]*=-n,e[2]*=-n,e[3]*=n,e)},f.conjugate=function(e,t){return t&&e!==t?(t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t):(e[0]*=-1,e[1]*=-1,e[2]*=-1,e)},f.length=function(e){var t=e[0],n=e[1],i=e[2],e=e[3];return Math.sqrt(t*t+n*n+i*i+e*e)},f.normalize=function(e,t){t||(t=e);var n=e[0],i=e[1],r=e[2],o=e[3],a=Math.sqrt(n*n+i*i+r*r+o*o);return 0===a?(t[0]=0,t[1]=0,t[2]=0,t[3]=0,t):(a=1/a,t[0]=n*a,t[1]=i*a,t[2]=r*a,t[3]=o*a,t)},f.add=function(e,t,n){return n&&e!==n?(n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n):(e[0]+=t[0],e[1]+=t[1],e[2]+=t[2],e[3]+=t[3],e)},f.multiply=function(e,t,n){n||(n=e);var i=e[0],r=e[1],o=e[2],e=e[3],a=t[0],s=t[1],l=t[2],t=t[3];return n[0]=i*t+e*a+r*l-o*s,n[1]=r*t+e*s+o*a-i*l,n[2]=o*t+e*l+i*s-r*a,n[3]=e*t-i*a-r*s-o*l,n},f.multiplyVec3=function(e,t,n){n||(n=t);var i=t[0],r=t[1],o=t[2],t=e[0],a=e[1],s=e[2],e=e[3],l=e*i+a*o-s*r,c=e*r+s*i-t*o,u=e*o+t*r-a*i,i=-t*i-a*r-s*o;return n[0]=l*e+i*-t+c*-s-u*-a,n[1]=c*e+i*-a+u*-t-l*-s,n[2]=u*e+i*-s+l*-a-c*-t,n},f.scale=function(e,t,n){return n&&e!==n?(n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n):(e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e)},f.toMat3=function(e,t){t||(t=h.create());var n=e[0],i=e[1],r=e[2],o=e[3],a=n+n,s=i+i,l=r+r,c=n*a,u=n*s,n=n*l,d=i*s,i=i*l,r=r*l,a=o*a,s=o*s,o=o*l;return t[0]=1-(d+r),t[1]=u+o,t[2]=n-s,t[3]=u-o,t[4]=1-(c+r),t[5]=i+a,t[6]=n+s,t[7]=i-a,t[8]=1-(c+d),t},f.toMat4=function(e,t){t||(t=p.create());var n=e[0],i=e[1],r=e[2],o=e[3],a=n+n,s=i+i,l=r+r,c=n*a,u=n*s,n=n*l,d=i*s,i=i*l,r=r*l,a=o*a,s=o*s,o=o*l;return t[0]=1-(d+r),t[1]=u+o,t[2]=n-s,t[3]=0,t[4]=u-o,t[5]=1-(c+r),t[6]=i+a,t[7]=0,t[8]=n+s,t[9]=i-a,t[10]=1-(c+d),t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},f.slerp=function(e,t,n,i){i||(i=e);var r,o,a=e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3];return Math.abs(a)>=1?(i!==e&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),i):(r=Math.acos(a),o=Math.sqrt(1-a*a),.001>Math.abs(o)?(i[0]=.5*e[0]+.5*t[0],i[1]=.5*e[1]+.5*t[1],i[2]=.5*e[2]+.5*t[2],i[3]=.5*e[3]+.5*t[3],i):(a=Math.sin((1-n)*r)/o,n=Math.sin(n*r)/o,i[0]=e[0]*a+t[0]*n,i[1]=e[1]*a+t[1]*n,i[2]=e[2]*a+t[2]*n,i[3]=e[3]*a+t[3]*n,i))},f.fromRotationMatrix=function(e,t){t||(t=f.create());var n,i=e[0]+e[4]+e[8];if(i>0)n=Math.sqrt(i+1),t[3]=.5*n,n=.5/n,t[0]=(e[7]-e[5])*n,t[1]=(e[2]-e[6])*n,t[2]=(e[3]-e[1])*n;else{n=f.fromRotationMatrix.s_iNext=f.fromRotationMatrix.s_iNext||[1,2,0],i=0,e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);var r=n[i],o=n[r];n=Math.sqrt(e[3*i+i]-e[3*r+r]-e[3*o+o]+1),t[i]=.5*n,n=.5/n,t[3]=(e[3*o+r]-e[3*r+o])*n,t[r]=(e[3*r+i]+e[3*i+r])*n,t[o]=(e[3*o+i]+e[3*i+o])*n}return t},h.toQuat4=f.fromRotationMatrix,function(){var e=h.create();f.fromAxes=function(t,n,i,r){return e[0]=n[0],e[3]=n[1],e[6]=n[2],e[1]=i[0],e[4]=i[1],e[7]=i[2],e[2]=t[0],e[5]=t[1],e[8]=t[2],f.fromRotationMatrix(e,r)}}(),f.identity=function(e){return e||(e=f.create()),e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},f.fromAngleAxis=function(e,t,n){n||(n=f.create());var e=.5*e,i=Math.sin(e);return n[3]=Math.cos(e),n[0]=i*t[0],n[1]=i*t[1],n[2]=i*t[2],n},f.toAngleAxis=function(e,t){t||(t=e);var n=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];return n>0?(t[3]=2*Math.acos(e[3]),n=i.invsqrt(n),t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n):(t[3]=0,t[0]=1,t[1]=0,t[2]=0),t},f.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+"]"};var g={create:function(e){var t=new r(2);return e?(t[0]=e[0],t[1]=e[1]):(t[0]=0,t[1]=0),t},createFrom:function(e,t){var n=new r(2);return n[0]=e,n[1]=t,n},add:function(e,t,n){return n||(n=t),n[0]=e[0]+t[0],n[1]=e[1]+t[1],n},subtract:function(e,t,n){return n||(n=t),n[0]=e[0]-t[0],n[1]=e[1]-t[1],n},multiply:function(e,t,n){return n||(n=t),n[0]=e[0]*t[0],n[1]=e[1]*t[1],n},divide:function(e,t,n){return n||(n=t),n[0]=e[0]/t[0],n[1]=e[1]/t[1],n},scale:function(e,t,n){return n||(n=e),n[0]=e[0]*t,n[1]=e[1]*t,n},dist:function(e,t){var n=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(n*n+i*i)},set:function(e,t){return t[0]=e[0],t[1]=e[1],t},equal:function(e,t){return e===t||1e-6>Math.abs(e[0]-t[0])&&1e-6>Math.abs(e[1]-t[1])},negate:function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t},normalize:function(e,t){t||(t=e);var n=e[0]*e[0]+e[1]*e[1];return n>0?(n=Math.sqrt(n),t[0]=e[0]/n,t[1]=e[1]/n):t[0]=t[1]=0,t},cross:function(e,t,n){return e=e[0]*t[1]-e[1]*t[0],n?(n[0]=n[1]=0,n[2]=e,n):e},length:function(e){var t=e[0],e=e[1];return Math.sqrt(t*t+e*e)},squaredLength:function(e){var t=e[0],e=e[1];return t*t+e*e},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]},direction:function(e,t,n){n||(n=e);var i=e[0]-t[0],e=e[1]-t[1],t=i*i+e*e;
return t?(t=1/Math.sqrt(t),n[0]=i*t,n[1]=e*t,n):(n[0]=0,n[1]=0,n[2]=0,n)},lerp:function(e,t,n,i){return i||(i=e),i[0]=e[0]+n*(t[0]-e[0]),i[1]=e[1]+n*(t[1]-e[1]),i},str:function(e){return"["+e[0]+", "+e[1]+"]"}},v={create:function(e){var t=new r(4);return e?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]):t[0]=t[1]=t[2]=t[3]=0,t},createFrom:function(e,t,n,i){var o=new r(4);return o[0]=e,o[1]=t,o[2]=n,o[3]=i,o},set:function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},equal:function(e,t){return e===t||1e-6>Math.abs(e[0]-t[0])&&1e-6>Math.abs(e[1]-t[1])&&1e-6>Math.abs(e[2]-t[2])&&1e-6>Math.abs(e[3]-t[3])},identity:function(e){return e||(e=v.create()),e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},transpose:function(e,t){if(!t||e===t){var n=e[1];return e[1]=e[2],e[2]=n,e}return t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3],t},determinant:function(e){return e[0]*e[3]-e[2]*e[1]},inverse:function(e,t){t||(t=e);var n=e[0],i=e[1],r=e[2],o=e[3],a=n*o-r*i;return a?(a=1/a,t[0]=o*a,t[1]=-i*a,t[2]=-r*a,t[3]=n*a,t):null},multiply:function(e,t,n){n||(n=e);var i=e[0],r=e[1],o=e[2],e=e[3];return n[0]=i*t[0]+r*t[2],n[1]=i*t[1]+r*t[3],n[2]=o*t[0]+e*t[2],n[3]=o*t[1]+e*t[3],n},rotate:function(e,t,n){n||(n=e);var i=e[0],r=e[1],o=e[2],e=e[3],a=Math.sin(t),t=Math.cos(t);return n[0]=i*t+r*a,n[1]=i*-a+r*t,n[2]=o*t+e*a,n[3]=o*-a+e*t,n},multiplyVec2:function(e,t,n){n||(n=t);var i=t[0],t=t[1];return n[0]=i*e[0]+t*e[1],n[1]=i*e[2]+t*e[3],n},scale:function(e,t,n){n||(n=e);var i=e[1],r=e[2],o=e[3],a=t[0],t=t[1];return n[0]=e[0]*a,n[1]=i*t,n[2]=r*a,n[3]=o*t,n},str:function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+"]"}},y={create:function(e){var t=new r(4);return e?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]):(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t},createFrom:function(e,t,n,i){var o=new r(4);return o[0]=e,o[1]=t,o[2]=n,o[3]=i,o},add:function(e,t,n){return n||(n=t),n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n},subtract:function(e,t,n){return n||(n=t),n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n[3]=e[3]-t[3],n},multiply:function(e,t,n){return n||(n=t),n[0]=e[0]*t[0],n[1]=e[1]*t[1],n[2]=e[2]*t[2],n[3]=e[3]*t[3],n},divide:function(e,t,n){return n||(n=t),n[0]=e[0]/t[0],n[1]=e[1]/t[1],n[2]=e[2]/t[2],n[3]=e[3]/t[3],n},scale:function(e,t,n){return n||(n=e),n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n},set:function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},equal:function(e,t){return e===t||1e-6>Math.abs(e[0]-t[0])&&1e-6>Math.abs(e[1]-t[1])&&1e-6>Math.abs(e[2]-t[2])&&1e-6>Math.abs(e[3]-t[3])},negate:function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},length:function(e){var t=e[0],n=e[1],i=e[2],e=e[3];return Math.sqrt(t*t+n*n+i*i+e*e)},squaredLength:function(e){var t=e[0],n=e[1],i=e[2],e=e[3];return t*t+n*n+i*i+e*e},lerp:function(e,t,n,i){return i||(i=e),i[0]=e[0]+n*(t[0]-e[0]),i[1]=e[1]+n*(t[1]-e[1]),i[2]=e[2]+n*(t[2]-e[2]),i[3]=e[3]+n*(t[3]-e[3]),i},str:function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+"]"}};return e&&(e.glMatrixArrayType=r,e.MatrixArray=r,e.setMatrixArrayType=t,e.determineMatrixArrayType=n,e.glMath=i,e.vec2=g,e.vec3=o,e.vec4=y,e.mat2=v,e.mat3=h,e.mat4=p,e.quat4=f),{glMatrixArrayType:r,MatrixArray:r,setMatrixArrayType:t,determineMatrixArrayType:n,glMath:i,vec2:g,vec3:o,vec4:y,mat2:v,mat3:h,mat4:p,quat4:f}});/*
 * SceneJS WebGL Scene Graph Library for JavaScript
 * http://scenejs.org/
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://scenejs.org/license
  * Copyright 2010, Lindsay Kay
 *
 * Includes WebGLTrace
 * Various functions for helping debug WebGL apps.
 * http://github.com/jackpal/webgltrace
 * Copyright (c) 2009 The Chromium Authors. All rights reserved.
 *
 * Includes WebGL-Debug
 * Various functions for helping debug WebGL apps.
 * http://khronos.org/webgl/wiki/Debugging
 * Copyright (c) 2009 The Chromium Authors. All rights reserved. 
 */
var GC_Hooks=function(){this.renderFrameHook=null,this.renderNodeHook=null,this.postRenderNodeHook=null,this.clearHook=null,this.compareMode=!1,this.hooker=null};GC_Hooks.prototype={reset:function GCH_reset(){this.renderFrameHook=null,this.renderNodeHook=null,this.postRenderNodeHook=null,this.clearHook=null,this.compareMode=!1,this.hooker=null}};var SceneJS_GC_Hooks=new GC_Hooks,SceneJS_Map=function(){this.items=[],this.lastUniqueId=0,this.addItem=function(){var e;if(2==arguments.length){var t=arguments[0];if(e=arguments[1],this.items[t])throw SceneJS_errorModule.fatalError(SceneJS.errors.ID_CLASH,"ID clash: '"+t+"'");return this.items[t]=e,t}for(;;){e=arguments[0];var n=this.lastUniqueId++;if(!this.items[n])return this.items[n]=e,n}},this.removeItem=function(e){this.items[e]=null}},SceneJS={VERSION:"2.0.0",SUPPORTED_WEBGL_CONTEXT_NAMES:["webgl","experimental-webgl","webkit-3d","moz-webgl","moz-glweb20"],_nodeTypes:{},_scenes:{},createNodeType:function(e,t){if(!e)throw SceneJS_errorModule.fatalError("createNodeType param 'type' is null or undefined");if("string"!=typeof e)throw SceneJS_errorModule.fatalError("createNodeType param 'type' should be a string");if(this._nodeTypes[e])throw SceneJS_errorModule.fatalError("createNodeType node of param 'type' already defined: '"+t+"'");var n=this._nodeTypes[t];n||(n=SceneJS._Node);var i=function(){n.apply(this,arguments),this.attr.type=e};return SceneJS._inherit(i,n),this._nodeTypes[e]=i,i},_registerNode:function(e,t){this._nodeTypes[e]=t},createScene:function(e){if(!e)throw SceneJS_errorModule.fatalError("createScene param 'json' is null or undefined");if(e.type="scene",!e.id)throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"createScene 'id' is mandatory for 'scene' node");if(this._scenes[e.id])throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"createScene - scene id '"+e.id+"' already taken by another scene");var t=this._parseNodeJSON(e,void 0);return this._scenes[e.id]=t,SceneJS_eventModule.fireEvent(SceneJS_eventModule.NODE_CREATED,{nodeId:t.attr.id,json:e}),SceneJS._selectNode(t)},sceneExists:function(e){return this._scenes[e]?!0:!1},scene:function(e){var t=this._scenes[e];if(!t)throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"withScene scene not found: '"+e+"'");return SceneJS._selectNode(t)},_parseNodeJSON:function(e,t){var n=this._createNode(e,t);if(t=t||n,n.scene=t,e.nodes)for(var i=e.nodes.length,r=0;i>r;r++)n.addNode(SceneJS._parseNodeJSON(e.nodes[r],t));return n},_createNode:function(e,t){e.type=e.type||"node";var n;if("node"==e.type)n=SceneJS._Node;else if(n=this._nodeTypes[e.type],!n)throw SceneJS_errorModule.fatalError("Scene node type not supported in SceneJS "+SceneJS.VERSION+": '"+e.type+"'");return new n(e,t)},_copyCfg:function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&"nodes"!=n&&(t[n]=e[n]);return t},_destroyedNodes:[],_actionNodeDestroys:function(){if(this._destroyedNodes.length>0){for(var e,t=this._destroyedNodes.length-1;t>=0;t--)e=this._destroyedNodes[t],e._doDestroy(),SceneJS_eventModule.fireEvent(SceneJS_eventModule.NODE_DESTROYED,{nodeId:e.attr.id});this._destroyedNodes=[]}},Message:new function(){this.sendMessage=function(e){if(!e)throw SceneJS_errorModule.fatalError("sendMessage param 'message' null or undefined");var t=e.command;if(!t)throw SceneJS_errorModule.fatalError("Message element expected: 'command'");var n=SceneJS.Services.getService(SceneJS.Services.COMMAND_SERVICE_ID),i=n.getCommand(t);if(!i)throw SceneJS_errorModule.fatalError("Message command not supported: '"+t+"' - perhaps this command needs to be added to the SceneJS Command Service?");var r={};i.execute(r,e)}},_inherit:function(e,t){e.prototype=new t,e.prototype.constructor=e},_namespace:function(){var a=arguments,o=null,i,j,d,rt;for(i=0;a.length>i;++i)for(d=a[i].split("."),rt=d[0],eval("if (typeof "+rt+' == "undefined"){'+rt+" = {};} o = "+rt+";"),j=1;d.length>j;++j)o[d[j]]=o[d[j]]||{},o=o[d[j]]},_last_unique_id:0,_createKeyForMap:function(e,t){for(;;){var n=t?t+SceneJS._last_unique_id++:SceneJS._last_unique_id++;if(!e[n])return n}},_createUUID:function(){for(var e=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],t=["8","9","A","B"],n=[],i=0;38>i;i++)switch(i){case 8:n.push("-");break;case 13:n.push("-");break;case 18:n.push("-");break;case 14:n.push("4");break;case 19:n.push(t[Math.round(3*Math.random())]);break;default:n.push(e[Math.round(15*Math.random())])}return n.join("")},_getBaseURL:function(e){var t=e.lastIndexOf("/");return 0==t||-1==t?"":e.substr(0,t+1)},_isArray:function(e){return e&&!e.propertyIsEnumerable("length")&&"object"==typeof e&&"number"==typeof e.length},_shallowClone:function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},_applyIf:function(e,t){for(var n in e)e.hasOwnProperty(n)&&(void 0==t[n]||null==t[n])&&(t[n]=e[n]);return t},_apply:function(e,t,n){var i;if(n)for(i in t)t.hasOwnProperty(i)&&delete t[i];for(i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},_compilationStates:new function(){var e={};this.setSupplier=function(t,n){e[t]=n},this.getState=function(t,n,i){var r=e[t];if(!r)throw SceneJS_errorModule.fatalError("Internal error - Compilation state supplier not found: '"+t+"'");return r.get(n,i)}}};SceneJS._Node=function(e,t){this.attr={},this.attr.type="node",this.attr.sid=null,this.attr.data={},e&&(this.attr.id=e.id,this.attr.type=e.type||"node",this.attr.data=e.data,this.attr.enabled=e.enabled===!1?!1:!0,this.attr.sid=e.sid,this.attr.info=e.info,this.scene=t||this),this.children=[],this.parent=null,this.listeners={},this.numListeners=0,this._compileMemoLevel=0,this.attr.id,this.scene&&this.scene.nodeMap&&(this.attr.id?this.scene.nodeMap.addItem(this.attr.id,this):this.attr.id=this.scene.nodeMap.addItem(this)),e&&(this._createCore(e.coreId||e.resource),this.setTags(e.tags||{}),this._init&&this._init(e))},SceneJS._Node.prototype.constructor=SceneJS._Node,SceneJS._Node.prototype._cores={},SceneJS._Node.prototype._createCore=function(e){var t=this.scene.attr.id,n=this._cores[t];n||(n=this._cores[t]={});var i=n[this.attr.type];return i||(i=n[this.attr.type]={}),e?(this.core=i[e],this.core&&this.core._nodeCount++):e=SceneJS._createUUID(),this.core||(this.core=i[e]={_coreId:e,_nodeCount:1}),this.core},SceneJS._Node.prototype.getCoreId=function(){return this.core._coreId},SceneJS._Node.prototype.getResource=SceneJS._Node.prototype.getCoreId,SceneJS._Node.prototype._tags={},SceneJS._Node.prototype.setTags=function(){},SceneJS._Node.prototype._resetCompilationMemos=function(){this._compileMemoLevel=0},SceneJS._Node.prototype._resetTreeCompilationMemos=function(){this._resetCompilationMemos();for(var e=0;this.children.length>e;e++)this.children[e]._resetTreeCompilationMemos()},SceneJS._Node.prototype._flagDirty=function(){this._compileMemoLevel=0},SceneJS._Node.prototype._compile=function(){this._compileNodes()},SceneJS._Node.prototype._compileNodes=function(){this.listeners.rendered&&SceneJS_nodeEventsModule.preVisitNode(this);var e,t,n=this.children,i=n.length;if(i>0)for(t=0;i>t;t++)e=n[t],SceneJS_compileModule.preVisitNode(e)&&e._compile(),SceneJS_compileModule.postVisitNode(e);this.listeners.rendered&&SceneJS_nodeEventsModule.postVisitNode(this)},SceneJS._Node.prototype.getID=function(){return this.attr.id},SceneJS._Node.prototype.getId=SceneJS._Node.prototype.getID,SceneJS._Node.prototype.getType=function(){return this.attr.type},SceneJS._Node.prototype.getData=function(){return this.attr.data},SceneJS._Node.prototype.setData=function(e){return this.attr.data=e,this},SceneJS._Node.prototype.getSID=function(){return this.attr.sid},SceneJS._Node.prototype.getScene=function(){return this.scene},SceneJS._Node.prototype.getNumNodes=function(){return this.children.length},SceneJS._Node.prototype.getNodes=function(){for(var e=new Array(this.children.length),t=this.children.length,n=0;t>n;n++)e[n]=this.children[n];return e},SceneJS._Node.prototype.getNodeAt=function(e){return 0>e||e>=this.children.length?null:this.children[e]},SceneJS._Node.prototype.getFirstNode=function(){return 0==this.children.length?null:this.children[0]},SceneJS._Node.prototype.getLastNode=function(){return 0==this.children.length?null:this.children[this.children.length-1]},SceneJS._Node.prototype.getNode=function(e){for(var t=0;this.children.length>t;t++)if(this.children[t].attr.id==e)return this.children[t];return null},SceneJS._Node.prototype.disconnectNodeAt=function(e){var t=this.children.splice(e,1);return this._resetCompilationMemos(),t.length>0?(t[0].parent=null,t[0]):null},SceneJS._Node.prototype.disconnect=function(){if(this.parent)for(var e=0;this.parent.children.length>e;e++)if(this.parent.children[e]===this)return this.parent.disconnectNodeAt(e)},SceneJS._Node.prototype.removeNodeAt=function(e){var t=this.disconnectNodeAt(e);t&&t.destroy()},SceneJS._Node.prototype.removeNode=function(e){if(!e)throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Node#removeNode - node argument undefined");if(!e._compile&&"string"==typeof e){var t=this.scene.nodeMap.items[e];if(!t)throw SceneJS_errorModule.fatalError(SceneJS.errors.NODE_NOT_FOUND,"Node#removeNode - node not found anywhere: '"+e+"'");e=t}if(e._compile)for(var n=0;this.children.length>n;n++)if(this.children[n]===e)return this.removeNodeAt(n);throw SceneJS_errorModule.fatalError(SceneJS.errors.NODE_NOT_FOUND,"Node#removeNode - child node not found: "+(e._compile?": "+e.attr.id:e))},SceneJS._Node.prototype.disconnectNodes=function(){for(var e=0;this.children.length>e;e++)this.children[e].parent=null;var t=this.children;return this.children=[],this._resetCompilationMemos(),t},SceneJS._Node.prototype.removeNodes=function(){for(var e=this.disconnectNodes(),t=0;e.length>t;t++)e[t].destroy()},SceneJS._Node.prototype.splice=function(){var e,t;if(null==this.parent)return null;var n=this.parent,i=this.disconnectNodes();for(e=0,t=i.length;t>e;e++)i[e].parent=this.parent;for(e=0,t=n.children.length;t>e;e++)if(n.children[e]===this)return n.children.splice.apply(n.children,[e,1].concat(i)),this.parent=null,this.destroy(),n._resetTreeCompilationMemos(),SceneJS_compileModule.nodeUpdated(n),n},SceneJS._Node.prototype.addNodes=function(e){if(!e)throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Node#addNodes - nodes argument is undefined");for(var t=e.length-1;t>=0;t--)this.addNode(e[t]);return this._resetCompilationMemos(),this},SceneJS._Node.prototype.addNode=function(e){if(!e)throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Node#addNode - node argument is undefined");if(!e._compile)if("string"==typeof e){var t=this.scene.nodeMap.items[e];if(!t)throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Node#addNode - node not found: '"+e+"'");e=t}else e=SceneJS._parseNodeJSON(e,this.scene);if(!e._compile)throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Node#addNode - node argument is not a Node or subclass!");if(null!=e.parent)throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Node#addNode - node argument is still attached to another parent!");return this.children.push(e),e.parent=this,e._resetTreeCompilationMemos(),e},SceneJS._Node.prototype.insertNode=function(e,t){if(!e)throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Node#insertNode - node argument is undefined");if(e._compile||(e=SceneJS._parseNodeJSON(e,this.scene)),!e._compile)throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Node#insertNode - node argument is not a Node or subclass!");if(null!=e.parent)throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Node#insertNode - node argument is still attached to another parent!");if(void 0==t||null==t){for(var n=this.disconnectNodes(),i=e;i.getNumNodes()>0;)i=i.getLastNode();i.addNodes(n),this.addNode(e)}else{if(0>t)throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Node#insertNode - node index out of range: -1");t>=this.children.length?this.children.push(e):this.children.splice(t,0,e)}return e.parent=this,e._resetTreeCompilationMemos(),e},SceneJS._Node.prototype.mapNodes=function(e){if(e(this))return this;for(var t,n=0;this.children.length>n;n++)if(t=this.children[n].mapNodes(e))return t;return null},SceneJS._Node.prototype.addListener=function(e,t,n){var i=this.listeners[e];return i||(i=[],this.listeners[e]=i),i.push({eventName:e,fn:t,options:n||{}}),this.numListeners++,this._resetCompilationMemos(),this},SceneJS._Node.prototype.destroy=function(){return this._destroyed||(this._destroyed=!0,this._scheduleNodeDestroy()),SceneJS_compileModule.nodeUpdated(this,"destroyed"),this},SceneJS._Node.prototype._scheduleNodeDestroy=function(){if(this.disconnect(),this.scene.nodeMap.removeItem(this.attr.id),this.children.length>0)for(var e=this.children.slice(0),t=0;e.length>t;t++)e[t]._scheduleNodeDestroy();SceneJS._destroyedNodes.push(this)},SceneJS._Node.prototype._doDestroy=function(){return this._destroy&&this._destroy(),0>=--this.core._nodeCount&&(this._cores[this.scene.attr.id][this.attr.type][this.core._coreId]=null),this},SceneJS._Node.prototype._fireEvent=function(e,t,n){var i=this.listeners[e];if(i){t||(t={});for(var r,o={name:e,params:t,options:n||{}},a=0,s=i.length;s>a;a++)r=i[a],r.options.scope?r.fn.call(r.options.scope,o):r.fn.call(this,o)}},SceneJS._Node.prototype.removeListener=function(e,t){var n=this.listeners[e];if(!n)return null;for(var i=0;n.length>i;i++)if(n[i].fn==t)return n.splice(i,1),t;return this.numListeners--,null},SceneJS._Node.prototype.hasListener=function(e){return this.listeners[e]},SceneJS._Node.prototype.hasListeners=function(){return this.numListeners>0},SceneJS._Node.prototype.removeListeners=function(){return this.listeners={},this.numListeners=0,this},SceneJS._Node.prototype.getParent=function(){return this.parent},SceneJS._Node.prototype.findNodesByType=function(e,t){return this._findNodesByType(e,[],t)},SceneJS._Node.prototype._findNodesByType=function(e,t,n){var i;for(i=0;this.children>i;i++){var r=this.children[i];r.type==e&&t.add(r)}if(n)for(i=0;this.children>i;i++)this.children[i]._findNodesByType(e,t,n);return t},SceneJS._Node.prototype.getJSON=function(){return this.attr};var SceneJS_State=function(e){this.core=e.core||{},this.state=e.state||{},e.parent&&e.parent.addChild(this),this.children=[],this.dirty=!0,this._cleanFunc=e.cleanFunc};SceneJS_State.prototype.addChild=function(e){e.parent=this,this.children.push(e)},SceneJS_State.prototype.setDirty=function(){if(!this.dirty&&(this.dirty=!0,this.children.length>0))for(var e,t=0,n=this.children.length;n>t;t++)e=this.children[t],e.dirty||e.setDirty()},SceneJS_State.prototype._cleanStack=[],SceneJS_State.prototype._cleanStackLen=0,SceneJS_State.prototype.setClean=function(){if(this.dirty&&this._cleanFunc){if(!this.parent)return this._cleanFunc(this.parent?this.parent:null,this),this.dirty=!1,void 0;this._cleanStackLen=0;for(var e=this;e&&e.dirty;)this._cleanStack[this._cleanStackLen++]=e,e=e.parent;e&&e.parent&&(this._cleanStack[this._cleanStackLen++]=e.parent);for(var t,n=this._cleanStackLen-1;n>0;n--)t=this._cleanStack[n-1],e=this._cleanStack[n],this._cleanFunc(t,e),t.dirty=!1,e.dirty=!1}},SceneJS_State.prototype.reset=function(){this.children=[],this.dirty=!0},SceneJS.Services=new function(){this.NODE_LOADER_SERVICE_ID="node-loader",this.GEO_LOADER_SERVICE_ID="geo-loader",this.MORPH_GEO_LOADER_SERVICE_ID="morph-geo-loader",this.COMMAND_SERVICE_ID="command",this._services={},this.addService=function(e,t){this._services[e]=t},this.hasService=function(e){var t=this._services[e];return null!=t&&void 0!=t},this.getService=function(e){return this._services[e]},this.addService(this.NODE_LOADER_SERVICE_ID,{loadNode:function(){}}),this.addService(this.GEO_LOADER_SERVICE_ID,{loadGeometry:function(){throw SceneJS_errorModule.fatalError("SceneJS.Services service not installed: SceneJS.Services.GEO_LOADER_SERVICE_ID")}}),this.addService(this.MORPH_GEO_LOADER_SERVICE_ID,{loadMorphGeometry:function(){throw SceneJS_errorModule.fatalError("SceneJS.Services service not installed: SceneJS.Services.MORPH_GEO_LOADER_SERVICE_ID")}})},function(){var e=function(e){this._targetNode=e,this._methods={}};SceneJS._selectNode=function(t){return t.__selector||(t.__selector=new e(t)),t.__selector},e.prototype.parent=function(){var e=this._targetNode.parent;return e?SceneJS._selectNode(e):null},e.prototype.node=function(e){if(null===e||void 0===e)throw SceneJS_errorModule.fatalError("node param 'node' is null or undefined");var t,n=typeof e;if("number"==n)t=this._targetNode.getNodeAt(e);else{if("string"!=n)throw SceneJS_errorModule.fatalError("node param 'node' should be either an index number or an ID string");t=this._targetNode.getNode(e)}if(!t)throw"node not found: '"+e+"'";return SceneJS._selectNode(t)},e.prototype.findNode=function(e){if("scene"!=this._targetNode.attr.type)throw SceneJS_errorModule.fatalError('findNode attempted on node that is not a "scene" type: \''+this._targetNode.attr.id+"'");return this._targetNode.findNode(e)},e.prototype.findNodes=function(e){if("scene"!=this._targetNode.attr.type)throw SceneJS_errorModule.fatalError('findNode attempted on node that is not a "scene" type: \''+this._targetNode.attr.id+"'");return this._targetNode.findNodes(e)},e.prototype.scene=function(){return SceneJS._selectNode(this._targetNode.scene)},e.prototype.hasNode=function(e){if(null===e||"undefined"==typeof e)throw SceneJS_errorModule.fatalError("hasNode param 'node' is null or undefined");var t,n=typeof e;if("number"==n)t=this._targetNode.getNodeAt(e);else{if("string"!=n)throw SceneJS_errorModule.fatalError("hasNode param 'node' should be either an index number or an ID string");t=this._targetNode.getNode(e)}return void 0!=t&&null!=t},e.prototype.eachParent=function(e){if(!e)throw SceneJS_errorModule.fatalError("eachParent param 'fn' is null or undefined");for(var t,n=0,i=this._targetNode;i.parent;){if(t=SceneJS._selectNode(i.parent),e.call(t,n++)===!0)return t;i=i.parent}return void 0},e.prototype.eachNode=function(e,t){if(!e)throw SceneJS_errorModule.fatalError("eachNode param 'fn' is null or undefined");if("function"!=typeof e)throw SceneJS_errorModule.fatalError("eachNode param 'fn' should be a function");var n;t=t||{};var i=0;return t.andSelf&&e.call(this,i++)===!0?this:(t.depthFirst||t.breadthFirst?t.depthFirst&&(n=this._iterateEachNodeDepthFirst(e,this._targetNode,i,!1)):n=this._iterateEachNode(e,this._targetNode,i),n?n:void 0)},e.prototype.numNodes=function(){return this._targetNode.children.length},e.prototype.set=function(e,t){if(!e)throw SceneJS_errorModule.fatalError("set param 'attr' null or undefined");return"string"==typeof e?this._callNodeMethod("set",e,t,this._targetNode):this._callNodeMethods("set",e,this._targetNode),this},e.prototype.add=function(e,t){if(!e)throw SceneJS_errorModule.fatalError("add param 'attr' null or undefined");return"string"==typeof e?this._callNodeMethod("add",e,t,this._targetNode):this._callNodeMethods("add",e,this._targetNode),this},e.prototype.inc=function(e,t){if(!e)throw SceneJS_errorModule.fatalError("inc param 'attr' null or undefined");return"string"==typeof e?this._callNodeMethod("inc",e,t,this._targetNode):this._callNodeMethods("inc",e,this._targetNode),this},e.prototype.insert=function(e,t){if(!e)throw SceneJS_errorModule.fatalError("insert param 'attr' null or undefined");return"string"==typeof e?this._callNodeMethod("insert",e,t,this._targetNode):this._callNodeMethods("insert",e,this._targetNode),this},e.prototype.remove=function(e,t){if(!e)throw SceneJS_errorModule.fatalError("remove param 'attr' null or undefined");return"string"==typeof e?this._callNodeMethod("remove",e,t,this._targetNode):this._callNodeMethods("remove",e,this._targetNode),this},e.prototype.get=function(e){if(!e)return this._targetNode.getJSON();var t="get"+e.substr(0,1).toUpperCase()+e.substr(1),n=this._targetNode[t];if(!n)throw SceneJS_errorModule.fatalError("Attribute '"+e+"' not found on node '"+this._targetNode.attr.id+"'");return n.call(this._targetNode)},e.prototype.bind=function(e,t){if(!e)throw SceneJS_errorModule.fatalError("bind param 'name' null or undefined");if("string"!=typeof e)throw SceneJS_errorModule.fatalError("bind param 'name' should be a string");if(!t)throw SceneJS_errorModule.fatalError("bind param 'handler' null or undefined");if("function"!=typeof t)throw SceneJS_errorModule.fatalError("bind param 'handler' should be a function");return this._targetNode.addListener(e,t,{scope:this}),SceneJS_compileModule.nodeUpdated(this._targetNode,"bind",e),this},e.prototype.unbind=function(e,t){if(!e)throw SceneJS_errorModule.fatalError("bind param 'name' null or undefined");if("string"!=typeof e)throw SceneJS_errorModule.fatalError("bind param 'name' should be a string");if(!t)throw SceneJS_errorModule.fatalError("bind param 'handler' null or undefined");if("function"!=typeof t)throw SceneJS_errorModule.fatalError("bind param 'handler' should be a function");return this._targetNode.removeListener(e,t),SceneJS_compileModule.nodeUpdated(this._targetNode,"unbind",e),this},e.prototype.pick=function(e,t,n){if(!e)throw SceneJS_errorModule.fatalError("pick param 'offsetX' null or undefined");if("number"!=typeof e)throw SceneJS_errorModule.fatalError("pick param 'offsetX' should be a number");if(!t)throw SceneJS_errorModule.fatalError("pick param 'offsetY' null or undefined");if("number"!=typeof t)throw SceneJS_errorModule.fatalError("pick param 'offsetY' should be a number");if("scene"!=this._targetNode.attr.type)throw SceneJS_errorModule.fatalError('pick attempted on node that is not a "scene" type: \''+this._targetNode.attr.id+"'");return this._targetNode.pick(e,t,n)},e.prototype.renderFrame=function(e){if("scene"!=this._targetNode.attr.type)throw SceneJS_errorModule.fatalError('renderFrame attempted on node that is not a "scene" type: \''+this._targetNode.attr.id+"'");return this._targetNode.renderFrame(e)},e.prototype.start=function(e){if("scene"!=this._targetNode.attr.type)throw SceneJS_errorModule.fatalError('start attempted on node that is not a "scene" type: \''+this._targetNode.attr.id+"'");e=e||{};var t=this;if(e.idleFunc){var n=e.idleFunc;e.idleFunc=function(e){n.call(t,e)}}if(e.frameFunc){var i=e.frameFunc;e.frameFunc=function(){i.call(t)}}if(e.sleepFunc){var r=e.sleepFunc;e.sleepFunc=function(){r.call(t)}}return this._targetNode.start(e),this},e.prototype.stop=function(){if("scene"!=this._targetNode.attr.type)throw SceneJS_errorModule.fatalError('stop attempted on node that is not a "scene" \''+this._targetNode.attr.id+"'");return this._targetNode.stop(),this},e.prototype.pause=function(e){if("scene"!=this._targetNode.attr.type)throw SceneJS_errorModule.fatalError('pause attempted on node that is not a "scene" \''+this._targetNode.attr.id+"'");return this._targetNode.pause(e),this},e.prototype.splice=function(){return this._targetNode.splice(),this},e.prototype.destroy=function(){return this._targetNode.destroy(),this},e.prototype.data=function(e,t){return e?(this._targetNode.attr.data=this._targetNode.attr.data||{},"string"==typeof e?void 0!=t?(this._targetNode.attr.data[e]=t,this):this._targetNode.attr.data[e]:void 0!=t?(this._targetNode.attr.data=t,this):this._targetNode.attr.data):this._targetNode.attr.data},e.prototype._iterateEachNode=function(e,t,n){for(var i,r=t.children.length,o=0;r>o;o++)if(i=SceneJS._selectNode(t.children[o]),1==e.call(i,n++))return i;return void 0},e.prototype._iterateEachNodeDepthFirst=function(e,t,n,i){var r;if(i&&(r=SceneJS._selectNode(t),1==e.call(r,n++)))return r;i=!0;for(var o=t.children.length,a=0;o>a;a++)if(r=this._iterateEachNodeDepthFirst(e,t.children[a],n,i))return r;return void 0},e.prototype._callNodeMethod=function(e,t,n,i){var r=this._methods[e];r||(r=this._methods[e]={});var o=r[t];if(!o){t=t.replace(/^\s*/,"").replace(/\s*$/,"");var a=e+t.substr(0,1).toUpperCase()+t.substr(1);if(o=i[a],!o)throw SceneJS_errorModule.fatalError("Attribute '"+t+"' not found on node '"+i.attr.id+"' for "+e);r[t]=o}o.call(i,n);var s={};s[t]=n,SceneJS_compileModule.nodeUpdated(i,e,t,n),i._fireEvent("updated",s)},e.prototype._callNodeMethods=function(e,t,n){var i=this._methods[e];i||(i=this._methods[e]={});for(var r in t)if(t.hasOwnProperty(r)){var o=i[r];if(!o){r=r.replace(/^\s*/,"").replace(/\s*$/,"");var a=e+r.substr(0,1).toUpperCase()+r.substr(1);if(o=n[a],!o)throw SceneJS_errorModule.fatalError("Attribute '"+r+"' not found on node '"+n.attr.id+"' for "+e);i[r]=o}o.call(n,t[r]),SceneJS_compileModule.nodeUpdated(n,e,r,t[r])}n._fireEvent("updated",{attr:t})},e.prototype._parseAttr=function(e,t){var n=e.split(".");if(1>=n.length)return t;for(var i,r={},o=r,a=0,s=n.length-1;s>a;)r[n[a++]]=t;return r=r[i]={},o}}(),SceneJS.Services.addService(SceneJS.Services.COMMAND_SERVICE_ID,function(){var e={};return{addCommand:function(t,n){if(!n.execute)throw SceneJS_errorModule.fatalError("SceneJS Command Service (ID '"+SceneJS.Services.COMMAND_SERVICE_ID+") requires an 'execute' method on your '"+t+" command implementation");e[t]=n},hasCommand:function(t){var n=e[t];return null!=n&&void 0!=n},getCommand:function(t){return e[t]},executeCommand:function(e,t){if(!t)throw SceneJS_errorModule.fatalError("sendMessage param 'message' null or undefined");var n=t.command;if(!n)throw SceneJS_errorModule.fatalError("Message element expected: 'command'");var i=SceneJS.Services.getService(SceneJS.Services.COMMAND_SERVICE_ID),r=i.getCommand(n);if(!r)throw SceneJS_errorModule.fatalError("Message command not supported: '"+n+"' - perhaps this command needs to be added to the SceneJS Command Service?");r.execute(e,t)}}}()),function(){function e(e,t,n){for(var i,r,o=0;n.length>o;o++)if(i=n[o],t){if(r=e.findNode(t),!r)continue;r.add("node",n[o])}else e.addNode(n[o])}function t(e,t,i){var r=e.findNode(t);if(r){var o=i.set;o&&n("set",o,r),i.insert&&n("insert",i.insert,r),i.inc&&n("inc",i.inc,r),i.dec&&n("dec",i.dec,r),i.add&&n("add",i.add,r),i.remove&&n("remove",i.remove,r)}}function n(e,t,n){for(var i in t)t.hasOwnProperty(i)&&n[e](t)}var i=SceneJS.Services.getService(SceneJS.Services.COMMAND_SERVICE_ID);i.addCommand("create",function(){return{execute:function(t,n){var i=n.nodes;if(i){var r,o,a=n.target;if(t.scenes){r=t.scenes;for(var s=0,l=r.length;l>s;s++)o=r[s],o&&e(o,a,i)}else{r=SceneJS._scenes;for(var c in r)r.hasOwnProperty(c)&&(o=r[c],o&&e(o,a,i))}}}}}()),i.addCommand("update",{execute:function(e,n){var r,o,a,s,l=n.target;if(e.scenes)for(a=e.scenes,r=0,o=a.length;o>r;r++)s=a[r],s&&t(s,l,n);else{a=SceneJS._scenes;for(var c in a)a.hasOwnProperty(c)&&(s=a[c],s&&t(s,l,n))}var u=n.messages;if(u&&u.length>0)for(r=0;u.length>r;r++)i.executeCommand(e,u[r])}}),i.addCommand("selectScenes",{execute:function(e,t){var n,r,o=t.scenes;if(o){var a,s=[];for(n=0,r=o.length;r>n;n++)a=o[n],SceneJS._scenes[a]&&s.push(SceneJS.scene(a));e=SceneJS._shallowClone(e),e.scenes=s}var l=t.messages;if(l)for(n=0;l.length>n;n++)i.executeCommand(e,l[n])}})}();var SceneJS_debugModule=new function(){this.configs={},this.getConfigs=function(e){if(e){for(var t=this.configs,n=e.split("."),i=0;t&&n.length>i;i++)t=t[n[i]];return t||{}}return this.configs},this.setConfigs=function(e,t){if(e){for(var n,i,r=e.split("."),o=this.configs,a=0;r.length-1>a;a++)i=r[a],n=o[i],n||(n=o[i]={}),o=n;o[r.length-1]=t}else this.configs=t}};SceneJS.setConfigs=SceneJS.setDebugConfigs=function(){if(1==arguments.length)SceneJS_debugModule.setConfigs(null,arguments[0]);else{if(2!=arguments.length)throw SceneJS_errorModule.fatalError("Illegal arguments given to SceneJS.setDebugs - should be either ({String}:name, {Object}:cfg) or ({Object}:cfg)");SceneJS_debugModule.setConfigs(arguments[0],arguments[1])}},SceneJS.getConfigs=SceneJS.getDebugConfigs=function(e){return SceneJS_debugModule.getConfigs(e)},SceneJS.errors={},SceneJS.errors.ERROR=0,SceneJS.errors.WEBGL_NOT_SUPPORTED=1,SceneJS.errors.NODE_CONFIG_EXPECTED=2,SceneJS.errors.ILLEGAL_NODE_CONFIG=3,SceneJS.errors.SHADER_COMPILATION_FAILURE=4,SceneJS.errors.SHADER_LINK_FAILURE=5,SceneJS.errors.CANVAS_NOT_FOUND=6,SceneJS.errors.OUT_OF_VRAM=7,SceneJS.errors.WEBGL_UNSUPPORTED_NODE_CONFIG=8,SceneJS.errors.INSTANCE_TARGET_NOT_FOUND=9,SceneJS.errors.INSTANCE_CYCLE=10,SceneJS.errors.NODE_NOT_FOUND=11,SceneJS.errors.NODE_ILLEGAL_STATE=12,SceneJS.errors.ID_CLASH=13,SceneJS.errors.ILLEGAL_MESSAGE=14,SceneJS.errors.SCENE_ILLEGAL_UPDATE=15,SceneJS.errors._getErrorName=function(e){for(var t in SceneJS.errors)if(SceneJS.errors.hasOwnProperty(t)&&SceneJS.errors[t]==e)return t;return null};/*
 * Copyright (c) 2010 Brandon Jones
 *
 * This software is provided 'as-is', without any express or implied
 * warranty. In no event will the authors be held liable for any damages
 * arising from the use of this software.
 *
 * Permission is granted to anyone to use this software for any purpose,
 * including commercial applications, and to alter it and redistribute it
 * freely, subject to the following restrictions:
 *
 *    1. The origin of this software must not be misrepresented; you must not
 *    claim that you wrote the original software. If you use this software
 *    in a product, an acknowledgment in the product documentation would be
 *    appreciated but is not required.
 *
 *    2. Altered source versions must be plainly marked as such, and must not
 *    be misrepresented as being the original software.
 *
 *    3. This notice may not be removed or altered from any source
 *    distribution.
 */
var SceneJS_math_divVec3=function(e,t,n){return n||(n=e),n[0]=e[0]/t[0],n[1]=e[1]/t[1],n[2]=e[2]/t[2],n},SceneJS_math_negateVector4=function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},SceneJS_math_addVec4=function(e,t,n){return n||(n=e),n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n},SceneJS_math_addVec4s=function(e,t,n){return n||(n=e),n[0]=e[0]+t,n[1]=e[1]+t,n[2]=e[2]+t,n[3]=e[3]+t,n},SceneJS_math_addVec3=function(e,t,n){return n||(n=e),n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n},SceneJS_math_addVec3s=function(e,t,n){return n||(n=e),n[0]=e[0]+t,n[1]=e[1]+t,n[2]=e[2]+t,n},SceneJS_math_addScalarVec4=function(e,t,n){return SceneJS_math_addVec4s(t,e,n)},SceneJS_math_subVec4=function(e,t,n){return n||(n=e),n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n[3]=e[3]-t[3],n},SceneJS_math_subVec3=function(e,t,n){return n||(n=e),n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n},SceneJS_math_lerpVec3=function(e,t,n,i,r){var o=(e-t)/(n-t),a=1-o;return{x:i.x*a+r.x*o,y:i.y*a+r.y*o,z:i.z*a+r.z*o}},SceneJS_math_subVec2=function(e,t,n){return n||(n=e),n[0]=e[0]-t[0],n[1]=e[1]-t[1],n},SceneJS_math_subVec4Scalar=function(e,t,n){return n||(n=e),n[0]=e[0]-t,n[1]=e[1]-t,n[2]=e[2]-t,n[3]=e[3]-t,n},SceneJS_math_subScalarVec4=function(e,t,n){return n||(n=e),n[0]=t-e[0],n[1]=t-e[1],n[2]=t-e[2],n[3]=t-e[3],n},SceneJS_math_mulVec4=function(e,t,n){return n||(n=e),n[0]=e[0]*t[0],n[1]=e[1]*t[1],n[2]=e[2]*t[2],n[3]=e[3]*t[3],n},SceneJS_math_mulVec4Scalar=function(e,t,n){return n||(n=e),n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n},SceneJS_math_mulVec3Scalar=function(e,t,n){return n||(n=e),n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n},SceneJS_math_mulVec2Scalar=function(e,t,n){return n||(n=e),n[0]=e[0]*t,n[1]=e[1]*t,n},SceneJS_math_divVec4=function(e,t,n){return n||(n=e),n[0]=e[0]/t[0],n[1]=e[1]/t[1],n[2]=e[2]/t[2],n[3]=e[3]/t[3],n},SceneJS_math_divScalarVec3=function(e,t,n){return n||(n=t),n[0]=e/t[0],n[1]=e/t[1],n[2]=e/t[2],n},SceneJS_math_divVec3s=function(e,t,n){return n||(n=e),n[0]=e[0]/t,n[1]=e[1]/t,n[2]=e[2]/t,n},SceneJS_math_divVec4s=function(e,t,n){return n||(n=e),n[0]=e[0]/t,n[1]=e[1]/t,n[2]=e[2]/t,n[3]=e[3]/t,n},SceneJS_math_divScalarVec4=function(e,t,n){return n||(n=t),n[0]=e/t[0],n[1]=e/t[1],n[2]=e/t[2],n[3]=e/t[3],n},SceneJS_math_dotVector4=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},SceneJS_math_cross3Vec4=function(e,t){var n=e[0],i=e[1],r=e[2],o=t[0],a=t[1],s=t[2];return[i*s-r*a,r*o-n*s,n*a-i*o,0]},SceneJS_math_cross3Vec3=function(e,t,n){n||(n=e);var i=e[0],r=e[1],o=e[2],a=t[0],s=t[1],l=t[2];return n[0]=r*l-o*s,n[1]=o*a-i*l,n[2]=i*s-r*a,n},SceneJS_math_sqLenVec4=function(e){return SceneJS_math_dotVector4(e,e)},SceneJS_math_lenVec4=function(e){return Math.sqrt(SceneJS_math_sqLenVec4(e))},SceneJS_math_dotVector3=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},SceneJS_math_dotVector2=function(e,t){return e[0]*t[0]+e[1]*t[1]},SceneJS_math_sqLenVec3=function(e){return SceneJS_math_dotVector3(e,e)},SceneJS_math_sqLenVec2=function(e){return SceneJS_math_dotVector2(e,e)},SceneJS_math_lenVec3=function(e){return Math.sqrt(SceneJS_math_sqLenVec3(e))},SceneJS_math_lenVec2=function(e){return Math.sqrt(SceneJS_math_sqLenVec2(e))},SceneJS_math_rcpVec3=function(e,t){return SceneJS_math_divScalarVec3(1,e,t)},SceneJS_math_normalizeVec4=function(e,t){var n=1/SceneJS_math_lenVec4(e);return SceneJS_math_mulVec4Scalar(e,n,t)},SceneJS_math_normalizeVec3=function(e,t){var n=1/SceneJS_math_lenVec3(e);return SceneJS_math_mulVec3Scalar(e,n,t)},SceneJS_math_normalizeVec2=function(e,t){var n=1/SceneJS_math_lenVec2(e);return SceneJS_math_mulVec2Scalar(e,n,t)},SceneJS_math_mat4=function(){return new Array(16)},SceneJS_math_dupMat4=function(e){return e.slice(0,16)},SceneJS_math_getCellMat4=function(e,t,n){return e[t+4*n]},SceneJS_math_setCellMat4=function(e,t,n,i){e[t+4*n]=i},SceneJS_math_getRowMat4=function(e,t){return[e[t],e[t+4],e[t+8],e[t+12]]},SceneJS_math_setRowMat4=function(e,t,n){e[t]=n[0],e[t+4]=n[1],e[t+8]=n[2],e[t+12]=n[3]},SceneJS_math_setRowMat4c=function(e,t,n,i,r,o){SceneJS_math_setRowMat4(e,t,[n,i,r,o])},SceneJS_math_setRowMat4s=function(e,t,n){SceneJS_math_setRowMat4c(e,t,n,n,n,n)},SceneJS_math_getColMat4=function(e,t){var n=4*t;return[e[n],e[n+1],e[n+2],e[n+3]]},SceneJS_math_setColMat4v=function(e,t,n){var i=4*t;e[i]=n[0],e[i+1]=n[1],e[i+2]=n[2],e[i+3]=n[3]},SceneJS_math_setColMat4c=function(e,t,n,i,r,o){SceneJS_math_setColMat4v(e,t,[n,i,r,o])},SceneJS_math_setColMat4Scalar=function(e,t,n){SceneJS_math_setColMat4c(e,t,n,n,n,n)},SceneJS_math_mat4To3=function(e){return[e[0],e[1],e[2],e[4],e[5],e[6],e[8],e[9],e[10]]},SceneJS_math_m4s=function(e){return[e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e]},SceneJS_math_setMat4ToZeroes=function(){return SceneJS_math_m4s(0)},SceneJS_math_setMat4ToOnes=function(){return SceneJS_math_m4s(1)},SceneJS_math_diagonalMat4v=function(e){return[e[0],0,0,0,0,e[1],0,0,0,0,e[2],0,0,0,0,e[3]]},SceneJS_math_diagonalMat4c=function(e,t,n,i){return SceneJS_math_diagonalMat4v([e,t,n,i])},SceneJS_math_diagonalMat4s=function(e){return SceneJS_math_diagonalMat4c(e,e,e,e)},SceneJS_math_identityMat4=function(){return SceneJS_math_diagonalMat4v([1,1,1,1])},SceneJS_math_isIdentityMat4=function(e){return 1!==e[0]||0!==e[1]||0!==e[2]||0!==e[3]||0!==e[4]||1!==e[5]||0!==e[6]||0!==e[7]||0!==e[8]||0!==e[9]||1!==e[10]||0!==e[11]||0!==e[12]||0!==e[13]||0!==e[14]||1!==e[15]?!1:!0},SceneJS_math_negateMat4=function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=-e[7],t[8]=-e[8],t[9]=-e[9],t[10]=-e[10],t[11]=-e[11],t[12]=-e[12],t[13]=-e[13],t[14]=-e[14],t[15]=-e[15],t},SceneJS_math_addMat4=function(e,t,n){return n||(n=e),n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n[4]=e[4]+t[4],n[5]=e[5]+t[5],n[6]=e[6]+t[6],n[7]=e[7]+t[7],n[8]=e[8]+t[8],n[9]=e[9]+t[9],n[10]=e[10]+t[10],n[11]=e[11]+t[11],n[12]=e[12]+t[12],n[13]=e[13]+t[13],n[14]=e[14]+t[14],n[15]=e[15]+t[15],n},SceneJS_math_addMat4Scalar=function(e,t,n){return n||(n=e),n[0]=e[0]+t,n[1]=e[1]+t,n[2]=e[2]+t,n[3]=e[3]+t,n[4]=e[4]+t,n[5]=e[5]+t,n[6]=e[6]+t,n[7]=e[7]+t,n[8]=e[8]+t,n[9]=e[9]+t,n[10]=e[10]+t,n[11]=e[11]+t,n[12]=e[12]+t,n[13]=e[13]+t,n[14]=e[14]+t,n[15]=e[15]+t,n},SceneJS_math_addScalarMat4=function(e,t,n){return SceneJS_math_addMat4Scalar(t,e,n)},SceneJS_math_subMat4=function(e,t,n){return n||(n=e),n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n[3]=e[3]-t[3],n[4]=e[4]-t[4],n[5]=e[5]-t[5],n[6]=e[6]-t[6],n[7]=e[7]-t[7],n[8]=e[8]-t[8],n[9]=e[9]-t[9],n[10]=e[10]-t[10],n[11]=e[11]-t[11],n[12]=e[12]-t[12],n[13]=e[13]-t[13],n[14]=e[14]-t[14],n[15]=e[15]-t[15],n},SceneJS_math_subMat4Scalar=function(e,t,n){return n||(n=e),n[0]=e[0]-t,n[1]=e[1]-t,n[2]=e[2]-t,n[3]=e[3]-t,n[4]=e[4]-t,n[5]=e[5]-t,n[6]=e[6]-t,n[7]=e[7]-t,n[8]=e[8]-t,n[9]=e[9]-t,n[10]=e[10]-t,n[11]=e[11]-t,n[12]=e[12]-t,n[13]=e[13]-t,n[14]=e[14]-t,n[15]=e[15]-t,n},SceneJS_math_subScalarMat4=function(e,t,n){return n||(n=t),n[0]=e-t[0],n[1]=e-t[1],n[2]=e-t[2],n[3]=e-t[3],n[4]=e-t[4],n[5]=e-t[5],n[6]=e-t[6],n[7]=e-t[7],n[8]=e-t[8],n[9]=e-t[9],n[10]=e-t[10],n[11]=e-t[11],n[12]=e-t[12],n[13]=e-t[13],n[14]=e-t[14],n[15]=e-t[15],n},SceneJS_math_mulMat4=function(e,t,n){n||(n=e);var i=e[0],r=e[1],o=e[2],a=e[3],s=e[4],l=e[5],c=e[6],u=e[7],d=e[8],h=e[9],p=e[10],f=e[11],m=e[12],g=e[13],v=e[14],y=e[15],b=t[0],_=t[1],w=t[2],S=t[3],x=t[4],C=t[5],$=t[6],E=t[7],T=t[8],k=t[9],A=t[10],N=t[11],M=t[12],D=t[13],P=t[14],I=t[15];return n[0]=b*i+_*s+w*d+S*m,n[1]=b*r+_*l+w*h+S*g,n[2]=b*o+_*c+w*p+S*v,n[3]=b*a+_*u+w*f+S*y,n[4]=x*i+C*s+$*d+E*m,n[5]=x*r+C*l+$*h+E*g,n[6]=x*o+C*c+$*p+E*v,n[7]=x*a+C*u+$*f+E*y,n[8]=T*i+k*s+A*d+N*m,n[9]=T*r+k*l+A*h+N*g,n[10]=T*o+k*c+A*p+N*v,n[11]=T*a+k*u+A*f+N*y,n[12]=M*i+D*s+P*d+I*m,n[13]=M*r+D*l+P*h+I*g,n[14]=M*o+D*c+P*p+I*v,n[15]=M*a+D*u+P*f+I*y,n},SceneJS_math_mulMat4s=function(e,t,n){return n||(n=e),n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n[4]=e[4]*t,n[5]=e[5]*t,n[6]=e[6]*t,n[7]=e[7]*t,n[8]=e[8]*t,n[9]=e[9]*t,n[10]=e[10]*t,n[11]=e[11]*t,n[12]=e[12]*t,n[13]=e[13]*t,n[14]=e[14]*t,n[15]=e[15]*t,n},SceneJS_math_mulMat4v4=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3];return[e[0]*n+e[4]*i+e[8]*r+e[12]*o,e[1]*n+e[5]*i+e[9]*r+e[13]*o,e[2]*n+e[6]*i+e[10]*r+e[14]*o,e[3]*n+e[7]*i+e[11]*r+e[15]*o]},SceneJS_math_transposeMat4=function(e,t){var n=e[4],i=e[14],r=e[8],o=e[13],a=e[12],s=e[9];if(!t||e==t){var l=e[1],c=e[2],u=e[3],d=e[6],h=e[7],p=e[11];return e[1]=n,e[2]=r,e[3]=a,e[4]=l,e[6]=s,e[7]=o,e[8]=c,e[9]=d,e[11]=i,e[12]=u,e[13]=h,e[14]=p,e}return t[0]=e[0],t[1]=n,t[2]=r,t[3]=a,t[4]=e[1],t[5]=e[5],t[6]=s,t[7]=o,t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=i,t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t},SceneJS_math_determinantMat4=function(e){var t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],a=e[5],s=e[6],l=e[7],c=e[8],u=e[9],d=e[10],h=e[11],p=e[12],f=e[13],m=e[14],g=e[15];return p*u*s*r-c*f*s*r-p*a*d*r+o*f*d*r+c*a*m*r-o*u*m*r-p*u*i*l+c*f*i*l+p*n*d*l-t*f*d*l-c*n*m*l+t*u*m*l+p*a*i*h-o*f*i*h-p*n*s*h+t*f*s*h+o*n*m*h-t*a*m*h-c*a*i*g+o*u*i*g+c*n*s*g-t*u*s*g-o*n*d*g+t*a*d*g},SceneJS_math_inverseMat4=function(e,t){t||(t=e);var n=e[0],i=e[1],r=e[2],o=e[3],a=e[4],s=e[5],l=e[6],c=e[7],u=e[8],d=e[9],h=e[10],p=e[11],f=e[12],m=e[13],g=e[14],v=e[15],y=n*s-i*a,b=n*l-r*a,_=n*c-o*a,w=i*l-r*s,S=i*c-o*s,x=r*c-o*l,C=u*m-d*f,$=u*g-h*f,E=u*v-p*f,T=d*g-h*m,k=d*v-p*m,A=h*v-p*g,N=1/(y*A-b*k+_*T+w*E-S*$+x*C);return t[0]=(s*A-l*k+c*T)*N,t[1]=(-i*A+r*k-o*T)*N,t[2]=(m*x-g*S+v*w)*N,t[3]=(-d*x+h*S-p*w)*N,t[4]=(-a*A+l*E-c*$)*N,t[5]=(n*A-r*E+o*$)*N,t[6]=(-f*x+g*_-v*b)*N,t[7]=(u*x-h*_+p*b)*N,t[8]=(a*k-s*E+c*C)*N,t[9]=(-n*k+i*E-o*C)*N,t[10]=(f*S-m*_+v*y)*N,t[11]=(-u*S+d*_-p*y)*N,t[12]=(-a*T+s*$-l*C)*N,t[13]=(n*T-i*$+r*C)*N,t[14]=(-f*w+m*b-g*y)*N,t[15]=(u*w-d*b+h*y)*N,t},SceneJS_math_traceMat4=function(e){return e[0]+e[5]+e[10]+e[15]},SceneJS_math_translationMat4v=function(e){var t=SceneJS_math_identityMat4();return t[12]=e[0],t[13]=e[1],t[14]=e[2],t},SceneJS_math_translationMat4c=function(e,t,n){return SceneJS_math_translationMat4v([e,t,n])},SceneJS_math_translationMat4s=function(e){return SceneJS_math_translationMat4c(e,e,e)},SceneJS_math_rotationMat4v=function(e,t){var n,i,r,o,a,s,l=SceneJS_math_normalizeVec4([t[0],t[1],t[2],0]),c=Math.sin(e),u=Math.cos(e),d=1-u,h=l[0],p=l[1],f=l[2];n=h*p,i=p*f,r=f*h,o=h*c,a=p*c,s=f*c;var m=SceneJS_math_mat4();return m[0]=d*h*h+u,m[1]=d*n+s,m[2]=d*r-a,m[3]=0,m[4]=d*n-s,m[5]=d*p*p+u,m[6]=d*i+o,m[7]=0,m[8]=d*r+a,m[9]=d*i-o,m[10]=d*f*f+u,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m},SceneJS_math_rotationMat4c=function(e,t,n,i){return SceneJS_math_rotationMat4v(e,[t,n,i])},SceneJS_math_scalingMat4v=function(e){var t=SceneJS_math_identityMat4();return t[0]=e[0],t[5]=e[1],t[10]=e[2],t},SceneJS_math_scalingMat4c=function(e,t,n){return SceneJS_math_scalingMat4v([e,t,n])},SceneJS_math_scalingMat4s=function(e){return SceneJS_math_scalingMat4c(e,e,e)},SceneJS_math_LOOKAT_OBJ={eye:{x:0,y:0,z:1},look:{x:0,y:0,z:0},up:{x:0,y:1,z:0}},SceneJS_math_LOOKAT_ARRAYS={eye:[0,0,1],look:[0,0,0],up:[0,1,0]},SceneJS_math_ORTHO_OBJ={left:-1,right:1,bottom:-1,near:.1,top:1,far:5e3},SceneJS_math_lookAtMat4v=function(e,t,n,i){i||(i=SceneJS_math_mat4());var r=e[0],o=e[1],a=e[2],s=n[0],l=n[1],c=n[2],u=t[0],d=t[1],h=t[2];if(r==u&&o==d&&a==h)return SceneJS_math_identityMat4();var p,f,m,g,v,y,b,_,w,S;return p=r-u,f=o-d,m=a-h,S=1/Math.sqrt(p*p+f*f+m*m),p*=S,f*=S,m*=S,g=l*m-c*f,v=c*p-s*m,y=s*f-l*p,S=Math.sqrt(g*g+v*v+y*y),S?(S=1/S,g*=S,v*=S,y*=S):(g=0,v=0,y=0),b=f*y-m*v,_=m*g-p*y,w=p*v-f*g,S=Math.sqrt(b*b+_*_+w*w),S?(S=1/S,b*=S,_*=S,w*=S):(b=0,_=0,w=0),i[0]=g,i[1]=b,i[2]=p,i[3]=0,i[4]=v,i[5]=_,i[6]=f,i[7]=0,i[8]=y,i[9]=w,i[10]=m,i[11]=0,i[12]=-(g*r+v*o+y*a),i[13]=-(b*r+_*o+w*a),i[14]=-(p*r+f*o+m*a),i[15]=1,i},SceneJS_math_lookAtMat4c=function(e,t,n,i,r,o,a,s,l){return SceneJS_math_lookAtMat4v([e,t,n],[i,r,o],[a,s,l])},SceneJS_math_orthoMat4c=function(e,t,n,i,r,o,a){a||(a=SceneJS_math_mat4());var s=t-e,l=i-n,c=o-r;return a[0]=2/s,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2/l,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=-2/c,a[11]=0,a[12]=-(e+t)/s,a[13]=-(i+n)/l,a[14]=-(o+r)/c,a[15]=1,a},SceneJS_math_frustumMat4v=function(e,t){var n=[e[0],e[1],e[2],0],i=[t[0],t[1],t[2],0],r=SceneJS_math_mat4();SceneJS_math_addVec4(i,n,r);var o=SceneJS_math_mat4();SceneJS_math_subVec4(i,n,o);var a=2*n[2],s=SceneJS_math_mat4(),l=o[0],c=o[1],u=o[2];return s[0]=a/l,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=a/c,s[6]=0,s[7]=0,s[8]=r[0]/l,s[9]=r[1]/c,s[10]=-r[2]/u,s[11]=-1,s[12]=0,s[13]=0,s[14]=-a*i[2]/u,s[15]=0,s},SceneJS_math_frustumMatrix4=function(e,t,n,i,r,o,a){a||(a=SceneJS_math_mat4());var s=t-e,l=i-n,c=o-r;return a[0]=2*r/s,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*r/l,a[6]=0,a[7]=0,a[8]=(t+e)/s,a[9]=(i+n)/l,a[10]=-(o+r)/c,a[11]=-1,a[12]=0,a[13]=0,a[14]=-(2*o*r)/c,a[15]=0,a},SceneJS_math_perspectiveMatrix4=function(e,t,n,i){var r=new Array(4),o=new Array(4);return r[2]=n,o[2]=i,o[1]=r[2]*Math.tan(e/2),r[1]=-o[1],o[0]=o[1]*t,r[0]=-o[0],SceneJS_math_frustumMat4v(r,o)},SceneJS_math_transformPoint3=function(e,t){var n=t[0],i=t[1],r=t[2];return[e[0]*n+e[4]*i+e[8]*r+e[12],e[1]*n+e[5]*i+e[9]*r+e[13],e[2]*n+e[6]*i+e[10]*r+e[14],e[3]*n+e[7]*i+e[11]*r+e[15]]},SceneJS_math_transformPoints3=function(e,t){for(var n,i,r,o,a=new Array(t.length),s=t.length,l=e[0],c=e[1],u=e[2],d=e[3],h=e[4],p=e[5],f=e[6],m=e[7],g=e[8],v=e[9],y=e[10],b=e[11],_=e[12],w=e[13],S=e[14],x=e[15],C=0;s>C;++C)o=t[C],n=o[0],i=o[1],r=o[2],a[C]=[l*n+h*i+g*r+_,c*n+p*i+v*r+w,u*n+f*i+y*r+S,d*n+m*i+b*r+x];return a},SceneJS_math_transformVector3=function(e,t){var n=t[0],i=t[1],r=t[2];return[e[0]*n+e[4]*i+e[8]*r,e[1]*n+e[5]*i+e[9]*r,e[2]*n+e[6]*i+e[10]*r]},SceneJS_math_transformVector4=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3];return[e[0]*n+e[4]*i+e[8]*r+e[12]*o,e[1]*n+e[5]*i+e[9]*r+e[13]*o,e[2]*n+e[6]*i+e[10]*r+e[14]*o,e[3]*n+e[7]*i+e[11]*r+e[15]*o]},SceneJS_math_projectVec4=function(e){var t=1/e[3];return[e[0]*t,e[1]*t,e[2]*t,1]},SceneJS_math_Plane3=function(e,t,n){if(this.normal=[0,0,1],this.offset=0,e&&t){var i=e[0],r=e[1],o=e[2];if(this.offset=t,n){var a=Math.sqrt(i*i+r*r+o*o);a>0&&(a=1/a,this.normal[0]=i*a,this.normal[1]=r*a,this.normal[2]=o*a,this.offset*=a)}}},SceneJS_math_MAX_DOUBLE=Number.POSITIVE_INFINITY,SceneJS_math_MIN_DOUBLE=Number.NEGATIVE_INFINITY,SceneJS_math_Box3=function(e,t){this.min=e||[SceneJS_math_MAX_DOUBLE,SceneJS_math_MAX_DOUBLE,SceneJS_math_MAX_DOUBLE],this.max=t||[SceneJS_math_MIN_DOUBLE,SceneJS_math_MIN_DOUBLE,SceneJS_math_MIN_DOUBLE],this.init=function(e,t){return this.min[0]=e[0],this.min[1]=e[1],this.min[2]=e[2],this.max[0]=t[0],this.max[1]=t[1],this.max[2]=t[2],this},this.fromPoints=function(e){for(var t=e.length,n=0;t>n;++n){var i=e[n][3],r=e[n][0]/i,o=e[n][1]/i,a=e[n][2]/i;this.min[0]>r&&(this.min[0]=r),this.min[1]>o&&(this.min[1]=o),this.min[2]>a&&(this.min[2]=a),r>this.max[0]&&(this.max[0]=r),o>this.max[1]&&(this.max[1]=o),a>this.max[2]&&(this.max[2]=a)}return this},this.isEmpty=function(){return this.min[0]>=this.max[0]&&this.min[1]>=this.max[1]&&this.min[2]>=this.max[2]},this.getCenter=function(){return[(this.max[0]+this.min[0])/2,(this.max[1]+this.min[1])/2,(this.max[2]+this.min[2])/2]},this.getSize=function(){return[this.max[0]-this.min[0],this.max[1]-this.min[1],this.max[2]-this.min[2]]},this.getFacesAreas=function(){var e=this.size;return[e[1]*e[2],e[0]*e[2],e[0]*e[1]]},this.getSurfaceArea=function(){var e=this.getFacesAreas();return 2*(e[0]+e[1]+e[2])},this.getVolume=function(){var e=this.size;return e[0]*e[1]*e[2]},this.getOffset=function(e){return this.min[0]-=e,this.min[1]-=e,this.min[2]-=e,this.max[0]+=e,this.max[1]+=e,this.max[2]+=e,this}},SceneJS_math_AxisBox3=function(e,t){var n=e[0],i=e[1],r=e[2],o=t[0],a=t[1],s=t[2];this.verts=[[n,i,r],[o,i,r],[o,a,r],[n,a,r],[n,i,s],[o,i,s],[o,a,s],[n,a,s]],this.toBox3=function(){for(var e=new SceneJS_math_Box3,t=0;8>t;++t)for(var n=this.verts[t],i=0;3>i;++i)n[i]<e.min[i]&&(e.min[i]=n[i]),n[i]>e.max[i]&&(e.max[i]=n[i])}},SceneJS_math_Sphere3=function(e,t){this.center=[e[0],e[1],e[2]],this.radius=t,this.isEmpty=function(){return 0===this.radius},this.surfaceArea=function(){return 4*Math.PI*this.radius*this.radius},this.getVolume=function(){var e=this.radius;return 4/3*Math.PI*e*e*e}},SceneJS_math_billboardMat=function(e){var t=[SceneJS_math_getColMat4(e,0),SceneJS_math_getColMat4(e,1),SceneJS_math_getColMat4(e,2)],n=[SceneJS_math_lenVec4(t[0]),SceneJS_math_lenVec4(t[1]),SceneJS_math_lenVec4(t[2])],i=SceneJS_math_mat4();SceneJS_math_rcpVec3(n,i);var r=SceneJS_math_scalingMat4v(n);SceneJS_math_mulVec4Scalar(t[0],i[0]),SceneJS_math_mulVec4Scalar(t[1],i[1]),SceneJS_math_mulVec4Scalar(t[2],i[2]);var o=SceneJS_math_identityMat4();return SceneJS_math_setRowMat4(o,0,t[0]),SceneJS_math_setRowMat4(o,1,t[1]),SceneJS_math_setRowMat4(o,2,t[2]),SceneJS_math_mulMat4(o,r)},SceneJS_math_FrustumPlane=function(e,t,n,i){var r=1/Math.sqrt(e*e+t*t+n*n);this.normal=[e*r,t*r,n*r],this.offset=i*r,this.testVertex=[this.normal[0]>=0?1:0,this.normal[1]>=0?1:0,this.normal[2]>=0?1:0]},SceneJS_math_OUTSIDE_FRUSTUM=3,SceneJS_math_INTERSECT_FRUSTUM=4,SceneJS_math_INSIDE_FRUSTUM=5,SceneJS_math_Frustum=function(e,t,n){var i=SceneJS_math_mat4();SceneJS_math_mulMat4(t,e,i);var r=i[0],o=i[1],a=i[2],s=i[3],l=i[4],c=i[5],u=i[6],d=i[7],h=i[8],p=i[9],f=i[10],m=i[11],g=i[12],v=i[13],y=i[14],b=i[15],_=[new SceneJS_math_FrustumPlane(s-r,d-l,m-h,b-g),new SceneJS_math_FrustumPlane(s+r,d+l,m+h,b+g),new SceneJS_math_FrustumPlane(s-o,d-c,m-p,b-v),new SceneJS_math_FrustumPlane(s+o,d+c,m+p,b+v),new SceneJS_math_FrustumPlane(s-a,d-u,m-f,b-y),new SceneJS_math_FrustumPlane(s+a,d+u,m+f,b+y)],w=[SceneJS_math_getColMat4(e,0),SceneJS_math_getColMat4(e,1),SceneJS_math_getColMat4(e,2)],S=[SceneJS_math_lenVec4(w[0]),SceneJS_math_lenVec4(w[1]),SceneJS_math_lenVec4(w[2])],x=SceneJS_math_rcpVec3(S),C=SceneJS_math_scalingMat4v(S),$=SceneJS_math_scalingMat4v(x);SceneJS_math_mulVec4Scalar(w[0],x[0]),SceneJS_math_mulVec4Scalar(w[1],x[1]),SceneJS_math_mulVec4Scalar(w[2],x[2]);var E=SceneJS_math_identityMat4();SceneJS_math_setRowMat4(E,0,w[0]),SceneJS_math_setRowMat4(E,1,w[1]),SceneJS_math_setRowMat4(E,2,w[2]),this.matrix||(this.matrix=SceneJS_math_mat4()),SceneJS_math_mulMat4(t,e,this.matrix),this.billboardMatrix||(this.billboardMatrix=SceneJS_math_mat4()),SceneJS_math_mulMat4($,SceneJS_math_mulMat4(E,C),this.billboardMatrix),this.viewport=n.slice(0,4),this.textAxisBoxIntersection=function(e){for(var t=SceneJS_math_INSIDE_FRUSTUM,n=[e.min,e.max],i=null,r=0;6>r;++r){if(i=_[r],0>i.normal[0]*n[i.testVertex[0]][0]+i.normal[1]*n[i.testVertex[1]][1]+i.normal[2]*n[i.testVertex[2]][2]+i.offset)return SceneJS_math_OUTSIDE_FRUSTUM;0>i.normal[0]*n[1-i.testVertex[0]][0]+i.normal[1]*n[1-i.testVertex[1]][1]+i.normal[2]*n[1-i.testVertex[2]][2]+i.offset&&(t=SceneJS_math_INTERSECT_FRUSTUM)}return t},this.getProjectedSize=function(e){var t=SceneJS_math_mat4();SceneJS_math_subVec3(e.max,e.min,t);var i=SceneJS_math_lenVec3(t),r=Math.abs(i),o=[.5*(e.min[0]+e.max[0]),.5*(e.min[1]+e.max[1]),.5*(e.min[2]+e.max[2]),0],a=.5*r,s=[-a,0,0,1],l=[a,0,0,1];return s=SceneJS_math_mulMat4v4(this.billboardMatrix,s),s=SceneJS_math_addVec4(s,o),s=SceneJS_math_projectVec4(SceneJS_math_mulMat4v4(this.matrix,s)),l=SceneJS_math_mulMat4v4(this.billboardMatrix,l),l=SceneJS_math_addVec4(l,o),l=SceneJS_math_projectVec4(SceneJS_math_mulMat4v4(this.matrix,l)),n[2]*Math.abs(l[0]-s[0])},this.getProjectedState=function(e){for(var t,i,r,o=SceneJS_math_transformPoints3(this.matrix,e),a=1e7,s=1e7,l=-1e7,c=-1e7,u=o.length,d=0;u>d;++d)t=SceneJS_math_projectVec4(o[d]),i=t[0],r=t[1],-.5>i&&(i=-.5),-.5>r&&(r=-.5),i>.5&&(i=.5),r>.5&&(r=.5),a>i&&(a=i),s>r&&(s=r),i>l&&(l=i),r>c&&(c=r);a+=.5,s+=.5,l+=.5,c+=.5;var h=n[2],p=n[3];a*=h+15,s*=p+15,l*=h+15,c*=p+15;var f=SceneJS_math_mat4();SceneJS_math_subVec2([l,c],[a,s],f);var m=SceneJS_math_lenVec2(f);return 0>a&&(a=0),l>h&&(l=h),0>s&&(s=0),c>p&&(c=p),{canvasBox:{min:[a,s],max:[l,c]},canvasSize:m}}},SceneJS_math_identityQuaternion=function(){return[0,0,0,1]},SceneJS_math_angleAxisQuaternion=function(e,t,n,i){var r=i/180*Math.PI,o=r/2,a=Math.sin(o);return[a*e,a*t,a*n,Math.cos(o)]},SceneJS_math_mulQuaternions=function(e,t){var n=e[0],i=e[1],r=e[2],o=e[3],a=t[0],s=t[1],l=t[2],c=t[3];return[o*a+n*c+i*l-r*s,o*s+i*c+r*a-n*l,o*l+r*c+n*s-i*a,o*c-n*a-i*s-r*l]},SceneJS_math_newMat4FromQuaternion=function(e){var t=e[0],n=e[1],i=e[2],r=e[3],o=2*t,a=2*n,s=2*i,l=o*r,c=a*r,u=s*r,d=o*t,h=a*t,p=s*t,f=a*n,m=s*n,g=s*i,v=SceneJS_math_identityMat4();return SceneJS_math_setCellMat4(v,0,0,1-(f+g)),SceneJS_math_setCellMat4(v,0,1,h-u),SceneJS_math_setCellMat4(v,0,2,p+c),SceneJS_math_setCellMat4(v,1,0,h+u),SceneJS_math_setCellMat4(v,1,1,1-(d+g)),SceneJS_math_setCellMat4(v,1,2,m-l),SceneJS_math_setCellMat4(v,2,0,p-c),SceneJS_math_setCellMat4(v,2,1,m+l),SceneJS_math_setCellMat4(v,2,2,1-(d+f)),v},SceneJS_math_slerp=function(e,t,n){var i=.0174532925*t[3],r=.0174532925*n[3],o=i*r+t[0]*n[0]+t[1]*n[1]+t[2]*n[2];if(Math.abs(o)>=1)return[t[0],t[1],t[2],t[3]];var a=Math.acos(o),s=Math.sqrt(1-o*o);if(.001>Math.abs(s))return[.5*t[0]+.5*n[0],.5*t[1]+.5*n[1],.5*t[2]+.5*n[2],.5*t[3]+.5*n[3]];var l=Math.sin((1-e)*a)/s,c=Math.sin(e*a)/s;return[t[0]*l+n[0]*c,t[1]*l+n[1]*c,t[2]*l+n[2]*c,57.295779579*(i*l+r*c)]},SceneJS_math_normalizeQuaternion=function(e){var t=SceneJS_math_lenVec4([e[0],e[1],e[2],e[3]]);return[e[0]/t,e[1]/t,e[2]/t,e[3]/t]},SceneJS_math_conjugateQuaternion=function(e){return[-e[0],-e[1],-e[2],e[3]]},SceneJS_math_angleAxisFromQuaternion=function(e){e=SceneJS_math_normalizeQuaternion(e);var t=e[3],n=2*Math.acos(t),i=Math.sqrt(1-t*t);return.001>i?{x:e[0],y:e[1],z:e[2],angle:57.295779579*n}:{x:e[0]/i,y:e[1]/i,z:e[2]/i,angle:57.295779579*n}},SceneJS_webgl_enumMap={funcAdd:"FUNC_ADD",funcSubtract:"FUNC_SUBTRACT",funcReverseSubtract:"FUNC_REVERSE_SUBTRACT",zero:"ZERO",one:"ONE",srcColor:"SRC_COLOR",oneMinusSrcColor:"ONE_MINUS_SRC_COLOR",dstColor:"DST_COLOR",oneMinusDstColor:"ONE_MINUS_DST_COLOR",srcAlpha:"SRC_ALPHA",oneMinusSrcAlpha:"ONE_MINUS_SRC_ALPHA",dstAlpha:"DST_ALPHA",oneMinusDstAlpha:"ONE_MINUS_DST_ALPHA",contantColor:"CONSTANT_COLOR",oneMinusConstantColor:"ONE_MINUS_CONSTANT_COLOR",constantAlpha:"CONSTANT_ALPHA",oneMinusConstantAlpha:"ONE_MINUS_CONSTANT_ALPHA",srcAlphaSaturate:"SRC_ALPHA_SATURATE",front:"FRONT",back:"BACK",frontAndBack:"FRONT_AND_BACK",never:"NEVER",less:"LESS",equal:"EQUAL",lequal:"LEQUAL",greater:"GREATER",notequal:"NOTEQUAL",gequal:"GEQUAL",always:"ALWAYS",cw:"CW",ccw:"CCW",linear:"LINEAR",nearest:"NEAREST",linearMipMapNearest:"LINEAR_MIPMAP_NEAREST",nearestMipMapNearest:"NEAREST_MIPMAP_NEAREST",nearestMipMapLinear:"NEAREST_MIPMAP_LINEAR",linearMipMapLinear:"LINEAR_MIPMAP_LINEAR",repeat:"REPEAT",clampToEdge:"CLAMP_TO_EDGE",mirroredRepeat:"MIRRORED_REPEAT",alpha:"ALPHA",rgb:"RGB",rgba:"RGBA",luminance:"LUMINANCE",luminanceAlpha:"LUMINANCE_ALPHA",textureBinding2D:"TEXTURE_BINDING_2D",textureBindingCubeMap:"TEXTURE_BINDING_CUBE_MAP",compareRToTexture:"COMPARE_R_TO_TEXTURE",unsignedByte:"UNSIGNED_BYTE"},SceneJS_webgl_ProgramUniform=function(e,t,n,i,r,o){var a=null;if(i==e.BOOL)a=function(t){e.uniform1i(o,t)};else if(i==e.BOOL_VEC2)a=function(t){e.uniform2iv(o,t)};else if(i==e.BOOL_VEC3)a=function(t){e.uniform3iv(o,t)};else if(i==e.BOOL_VEC4)a=function(t){e.uniform4iv(o,t)};else if(i==e.INT)a=function(t){e.uniform1iv(o,t)};else if(i==e.INT_VEC2)a=function(t){e.uniform2iv(o,t)};else if(i==e.INT_VEC3)a=function(t){e.uniform3iv(o,t)};else if(i==e.INT_VEC4)a=function(t){e.uniform4iv(o,t)};else if(i==e.FLOAT)a=function(t){e.uniform1f(o,t)};else if(i==e.FLOAT_VEC2)a=function(t){e.uniform2fv(o,t)};else if(i==e.FLOAT_VEC3)a=function(t){e.uniform3fv(o,t)};else if(i==e.FLOAT_VEC4)a=function(t){e.uniform4fv(o,t)};else if(i==e.FLOAT_MAT2)a=function(t){e.uniformMatrix2fv(o,e.FALSE,t)};else if(i==e.FLOAT_MAT3)a=function(t){e.uniformMatrix3fv(o,e.FALSE,t)};else{if(i!=e.FLOAT_MAT4)throw"Unsupported shader uniform type: "+i;a=function(t){e.uniformMatrix4fv(o,e.FALSE,t)}}this.setValue=a,this.getValue=function(){return e.getUniform(t,o)},this.getLocation=function(){return o}},SceneJS_webgl_ProgramSampler=function(e,t,n,i,r,o){this.bindTexture=function(t,n){return t.bind(n)?(e.uniform1i(o,n),!0):!1}},SceneJS_webgl_ProgramAttribute=function(e,t,n,i,r,o){this.bindFloatArrayBuffer=function(t){t.bind(),e.enableVertexAttribArray(o),e.vertexAttribPointer(o,t.itemSize,e.FLOAT,!1,0,0)}},SceneJS_webgl_Shader=function(e,t,n,i){if(this.handle=e.createShader(t),this.valid=!0,e.shaderSource(this.handle,n),e.compileShader(this.handle),0!=e.getShaderParameter(this.handle,e.COMPILE_STATUS)||(this.valid=!1,i.error("Shader compile failed:"+e.getShaderInfoLog(this.handle))),!this.valid)throw SceneJS_errorModule.fatalError(SceneJS.errors.SHADER_COMPILATION_FAILURE,"Shader program failed to compile")},SceneJS_webgl_Program=function(e,t,n,i,r){var o,a,s,l,c,u;this.hash=e;var d=[];for(a=0;n.length>a;a++)d.push(new SceneJS_webgl_Shader(t,t.VERTEX_SHADER,n[a],r));for(a=0;i.length>a;a++)d.push(new SceneJS_webgl_Shader(t,t.FRAGMENT_SHADER,i[a],r));var h=t.createProgram();for(a=0;d.length>a;a++)u=d[a],u.valid&&t.attachShader(h,u.handle);t.linkProgram(h),this.valid=!0,this.valid=this.valid&&0!=t.getProgramParameter(h,t.LINK_STATUS);var p=SceneJS_debugModule.getConfigs("shading");if(p.validate!==!1&&(t.validateProgram(h),this.valid=this.valid&&0!=t.getProgramParameter(h,t.VALIDATE_STATUS)),!this.valid)throw r.debug("Program link failed: "+t.getProgramInfoLog(h)),SceneJS_errorModule.fatalError(SceneJS.errors.SHADER_LINK_FAILURE,"Shader program failed to link");var f={},m={},g=t.getProgramParameter(h,t.ACTIVE_UNIFORMS);for(a=0;g>a;++a)s=t.getActiveUniform(h,a),s&&(l=s.name,"\0"==l[l.length-1]&&(l=l.substr(0,l.length-1)),c=t.getUniformLocation(h,l),s.type==t.SAMPLER_2D||s.type==t.SAMPLER_CUBE||35682==s.type?m[l]=new SceneJS_webgl_ProgramSampler(t,h,l,s.type,s.size,c,r):f[l]=new SceneJS_webgl_ProgramUniform(t,h,l,s.type,s.size,c,r));var v={},y=t.getProgramParameter(h,t.ACTIVE_ATTRIBUTES);for(a=0;y>a;a++)o=t.getActiveAttrib(h,a),o&&(c=t.getAttribLocation(h,o.name),v[o.name]=new SceneJS_webgl_ProgramAttribute(t,h,o.name,o.type,o.size,c,r));this.setProfile=function(e){this._profile=e},this.bind=function(){t.useProgram(h),this._profile&&this._profile.program++},this.getUniformLocation=function(e){var t=f[e];return t?t.getLocation():void 0},this.getUniform=function(e){var t=f[e];return t?t:void 0},this.setUniform=function(e,t){var n=f[e];n&&(n.setValue(t),this._profile&&this._profile.uniform++)},this.getAttribute=function(e){var t=v[e];return t?t:void 0},this.bindFloatArrayBuffer=function(e,t){var n=v[e];n&&(n.bindFloatArrayBuffer(t),this._profile&&this._profile.varying++)},this.bindTexture=function(e,t,n){var i=m[e];return i?(this._profile&&this._profile.texture++,i.bindTexture(t,n)):!1},this.unbind=function(){},this.destroy=function(){if(this.valid){t.deleteProgram(h);for(var e in d)t.deleteShader(d[e].handle);v=null,f=null,m=null,this.valid=!1}}},SceneJS_webgl_Texture2D=function(e,t,n){if(this._init=function(i){i=SceneJS_webgl_ensureImageSizePowerOfTwo(i),this.canvas=t.canvas,this.textureId=t.textureId,this.handle=e.createTexture(),this.target=e.TEXTURE_2D,this.minFilter=t.minFilter,this.magFilter=t.magFilter,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.update=t.update,e.bindTexture(this.target,this.handle);try{e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i)}catch(r){e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i,null)}this.format=e.RGBA,this.width=i.width,this.height=i.height,this.isDepth=!1,this.depthMode=0,this.depthCompareMode=0,this.depthCompareFunc=0,t.minFilter&&e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t.minFilter),t.magFilter&&e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t.magFilter),t.wrapS&&e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,t.wrapS),t.wrapT&&e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,t.wrapT),(t.minFilter==e.NEAREST_MIPMAP_NEAREST||t.minFilter==e.LINEAR_MIPMAP_NEAREST||t.minFilter==e.NEAREST_MIPMAP_LINEAR||t.minFilter==e.LINEAR_MIPMAP_LINEAR)&&e.generateMipmap(e.TEXTURE_2D),e.bindTexture(this.target,null),n&&n(this)},t.image)this._init(t.image);else{if(!t.url)throw"texture 'image' or 'url' expected";var i=this,r=new Image;r.crossOrigin="anonymous",r.onload=function(){i._init(r)},r.src=t.url}this.bind=function(t){return this.handle?(e.activeTexture(e["TEXTURE"+t]),e.bindTexture(this.target,this.handle),this.update&&this.update(e),!0):!1},this.unbind=function(t){this.handle&&(e.activeTexture(e["TEXTURE"+t]),e.bindTexture(this.target,null))},this.generateMipmap=function(){this.handle&&e.generateMipmap(e.TEXTURE_2D)},this.destroy=function(){this.handle&&(e.deleteTexture(this.handle),this.handle=null)}},SceneJS_webgl_ArrayBuffer;(function(){var e=new SceneJS_Map;SceneJS_webgl_ArrayBuffer=function(t,n,i,r,o,a){this.handle=t.createBuffer(),this.id=e.addItem(this),t.bindBuffer(n,this.handle),t.bufferData(n,i,a),this.handle.numItems=r,this.handle.itemSize=o,t.bindBuffer(n,null),this.type=n,this.numItems=r,this.itemSize=o,this.bind=function(){t.bindBuffer(n,this.handle)},this.setData=function(e,i){i||0===i?t.bufferSubData(n,i,new Float32Array(e)):t.bufferData(n,new Float32Array(e))},this.unbind=function(){t.bindBuffer(n,null)},this.destroy=function(){t.deleteBuffer(this.handle),e.removeItem(this.id)}}})();var SceneJS_webgl_VertexBuffer;(function(){var e=new SceneJS_Map;SceneJS_webgl_VertexBuffer=function(t,n){this.handle=t.createBuffer(),this.id=e.addItem(this),t.bindBuffer(t.ARRAY_BUFFER,this.handle),t.bufferData(t.ARRAY_BUFFER,new Float32Array(n),t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),this.bind=function(){t.bindBuffer(t.ARRAY_BUFFER,this.handle)},this.setData=function(e,n){n?t.bufferSubData(t.ARRAY_BUFFER,n,new Float32Array(e)):t.bufferData(t.ARRAY_BUFFER,new Float32Array(e))},this.unbind=function(){t.bindBuffer(t.ARRAY_BUFFER,null)},this.destroy=function(){t.deleteBuffer(this.handle),e.removeItem(this.id)}}})();//Copyright (c) 2009 The Chromium Authors. All rights reserved.
var WebGLDebugUtils=function(){function e(e){if(null==l){l={};for(var t in e)"number"==typeof e[t]&&(l[e[t]]=t)}}function t(){if(null==l)throw"WebGLDebugUtils.init(ctx) not called"}function n(e){return t(),void 0!==l[e]}function i(e,t,i){return n(i)?e in s&&t in s[e]:!1}function r(e){t();var n=l[e];return void 0!==n?n:"*UNKNOWN WebGL ENUM (0x"+e.toString(16)+")"}function o(t,o){function s(e,t){for(var i="",o=0;t.length>o;++o)i+=(0==o?"":", ")+(n(t[o])?r(t[o]):t[o]);return e+"("+i+")"}function l(e){for(var t="'",n=e.length,i=0;n>i;i++){var r=e.charAt(i),o=e.charCodeAt(i),a=m[r];if(void 0!=a)t+=a;else if(32>o||o>=128){var s="000"+o.toString(16);t+="\\u"+s.substring(s.length-4)}else t+=e.charAt(i)}return t+="'"}function c(e){var t=0;return function(){var n=e+t;return t++,n}}function u(e){var t=y[e];if(void 0===t)return void 0;var n="new "+t+"( [";return n+="] )"}function d(e,t){for(var n="",o=0;t.length>o;++o){var a=t[o];o>0&&(n+=", ");var s;try{null!==a&&void 0!==a&&(s=a[v])}catch(c){throw alert(e),c}var d=u(a);n+=void 0!=s?s:void 0!=d?d:"string"==typeof a?l(a):i(e,o,a)?"gl."+r(a):a}return"gl."+e+"("+n+");"}function h(e,t){return function(){var n;if(f){var i="",r=g[t];void 0!=r&&(n=r(),i="var "+n+" = "),a(i+d(t,arguments))}var s=e[t].apply(e,arguments);f&&void 0!=n&&s&&(s[v]=n);var l=e.getError();return 0!=l&&(p[l]=!0,o(l,t,arguments)),s}}e(t),o=o||function(e,t,n){alert("WebGL error "+r(e)+" in "+s(t,n))};var p={},f=!1;t.setTracing=function(e){!f&&e&&a("gl.setTracing("+e+");"),f=e};var m={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t"},g={createBuffer:c("buffer"),createFrameBuffer:c("frameBuffer"),createProgram:c("program"),createRenderbuffer:c("renderBuffer"),createShader:c("shader"),createTexture:c("texture"),getUniformLocation:c("uniformLocation"),readPixels:c("pixels")},v="__webgl_trace_name__",y={"[object WebGLByteArray]":"WebGLByteArray","[object WebGLUnsignedByteArray]":"WebGLUnsignedByteArray","[object WebGLShortArray]":"WebGLShortArray","[object Uint16Array]":"Uint16Array","[object WebGLIntArray]":"WebGLIntArray","[object WebGLUnsignedIntArray]":"WebGLUnsignedIntArray","[object Float32Array]":"Float32Array"},b={};for(var _ in t)b[_]="function"==typeof t[_]?h(t,_):t[_];return b.getError=function(){for(var e in p)if(p[e])return p[e]=!1,e;return t.NO_ERROR},b}var a=function(e){window.console&&window.console.log&&window.console.log(e)},s={enable:{0:!0},disable:{0:!0},getParameter:{0:!0},drawArrays:{0:!0},drawElements:{0:!0,2:!0},createShader:{0:!0},getShaderParameter:{1:!0},getProgramParameter:{1:!0},getVertexAttrib:{1:!0},vertexAttribPointer:{2:!0},bindTexture:{0:!0},activeTexture:{0:!0},getTexParameter:{0:!0,1:!0},texParameterf:{0:!0,1:!0},texParameteri:{0:!0,1:!0,2:!0},texImage2D:{0:!0,2:!0,6:!0,7:!0},texSubImage2D:{0:!0,6:!0,7:!0},copyTexImage2D:{0:!0,2:!0},copyTexSubImage2D:{0:!0},generateMipmap:{0:!0},bindBuffer:{0:!0},bufferData:{0:!0,2:!0},bufferSubData:{0:!0},getBufferParameter:{0:!0,1:!0},pixelStorei:{0:!0,1:!0},readPixels:{4:!0,5:!0},bindRenderbuffer:{0:!0},bindFramebuffer:{0:!0},checkFramebufferStatus:{0:!0},framebufferRenderbuffer:{0:!0,1:!0,2:!0},framebufferTexture2D:{0:!0,1:!0,2:!0},getFramebufferAttachmentParameter:{0:!0,1:!0,2:!0},getRenderbufferParameter:{0:!0,1:!0},renderbufferStorage:{0:!0,1:!0},clear:{0:!0},depthFunc:{0:!0},blendFunc:{0:!0,1:!0},blendFuncSeparate:{0:!0,1:!0,2:!0,3:!0},blendEquation:{0:!0},blendEquationSeparate:{0:!0,1:!0},stencilFunc:{0:!0},stencilFuncSeparate:{0:!0,1:!0},stencilMaskSeparate:{0:!0},stencilOp:{0:!0,1:!0,2:!0},stencilOpSeparate:{0:!0,1:!0,2:!0,3:!0},cullFace:{0:!0},frontFace:{0:!0}},l=null;return{init:e,mightBeEnum:n,glEnumToString:r,makeDebugContext:o}}(),SceneJS_eventModule=new function(){this.ERROR=0,this.INIT=1,this.RESET=2,this.TIME_UPDATED=3,this.SCENE_CREATED=4,this.SCENE_IDLE=5,this.SCENE_COMPILING=6,this.SCENE_COMPILED=7,this.SCENE_DESTROYED=8,this.RENDERER_UPDATED=9,this.RENDERER_EXPORTED=10,this.CANVAS_DEACTIVATED=11,this.GEOMETRY_UPDATED=13,this.GEOMETRY_EXPORTED=14,this.MODEL_TRANSFORM_UPDATED=15,this.MODEL_TRANSFORM_EXPORTED=16,this.PROJECTION_TRANSFORM_UPDATED=17,this.PROJECTION_TRANSFORM_EXPORTED=18,this.VIEW_TRANSFORM_UPDATED=19,this.VIEW_TRANSFORM_EXPORTED=20,this.LIGHTS_UPDATED=21,this.LIGHTS_EXPORTED=22,this.MATERIAL_UPDATED=23,this.MATERIAL_EXPORTED=24,this.TEXTURES_UPDATED=25,this.TEXTURES_EXPORTED=26,this.SHADER_ACTIVATE=27,this.SHADER_ACTIVATED=28,this.SCENE_RENDERING=29,this.LOGGING_ELEMENT_ACTIVATED=37,this.PICK_COLOR_EXPORTED=38,this.NODE_CREATED=39,this.NODE_UPDATED=40,this.NODE_DESTROYED=41;var e=new Array(37);this.addListener=function(t,n,i){var r=e[t];r||(r=[],e[t]=r);for(var o={command:n,priority:void 0==i?r.length:i},a=0;r.length>a;a++)if(r[a].priority>o.priority)return r.splice(a,0,o),void 0;r.push(o)},this.fireEvent=function(t,n){var i=e[t];if(i){n||(n={});for(var r=0;i.length>r;r++)i[r].command(n)}}};SceneJS.bind=function(e,t){switch(e){case"error":SceneJS_eventModule.addListener(SceneJS_eventModule.ERROR,function(e){t({code:e.code,errorName:e.errorName,exception:e.exception,fatal:e.fatal})});break;case"reset":SceneJS_eventModule.addListener(SceneJS_eventModule.RESET,function(){t()});break;case"scene-created":SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_CREATED,function(e){t({sceneId:e.sceneId})});break;case"node-created":SceneJS_eventModule.addListener(SceneJS_eventModule.NODE_CREATED,function(e){t({nodeId:e.nodeId,json:e.json})});break;case"node-updated":SceneJS_eventModule.addListener(SceneJS_eventModule.NODE_UPDATED,function(e){t({nodeId:e.nodeId})});break;case"node-destroyed":SceneJS_eventModule.addListener(SceneJS_eventModule.NODE_DESTROYED,function(e){t({nodeId:e.nodeId})});break;case"scene-rendering":SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_COMPILING,function(e){t({sceneId:e.sceneId})});break;case"scene-rendered":SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_COMPILED,function(e){t({sceneId:e.sceneId})});break;case"scene-destroyed":SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_DESTROYED,function(e){t({sceneId:e.sceneId})});break;default:throw SceneJS_errorModule.fatalError("SceneJS.bind - this event type not supported: '"+e+"'")}},SceneJS.addListener=SceneJS.onEvent=SceneJS.bind;var SceneJS_compileCfg=new function(){this.COMPILE_NOTHING=-2,this.REDRAW=-1,this.COMPILE_SCENE=0,this.COMPILE_BRANCH=1,this.COMPILE_PATH=2,this.RESORT=3,this.levelNameStrings=["COMPILE_SCENE","COMPILE_BRANCH","COMPILE_SUBTREE","COMPILE_PATH","COMPILE_NODE"],this.config={node:{add:{attr:{node:{level:this.COMPILE_SCENE},nodes:{level:this.COMPILE_SCENE}},level:this.COMPILE_SCENE},remove:{attr:{node:{level:this.RESORT},nodes:{level:this.RESORT}},level:this.COMPILE_SCENE},insert:{attr:{node:{level:this.COMPILE_SCENE}},level:this.COMPILE_SCENE},bind:{attr:{rendered:{level:this.COMPILE_SCENE}}},unbind:{attr:{rendered:{level:this.COMPILE_SCENE}}},destroyed:{level:this.COMPILE_SCENE}},billboard:{alwaysCompile:!0},clip:{set:{level:this.COMPILE_BRANCH},inc:{level:this.COMPILE_BRANCH}},colortrans:{set:{level:this.REDRAW},inc:{level:this.REDRAW},mul:{level:this.REDRAW}},layer:{set:{attr:{priority:{level:this.RESORT},enabled:{level:this.RESORT}}}},lights:{},scene:{created:{level:this.COMPILE_SCENE},start:{level:this.COMPILE_SCENE},set:{attr:{tagMask:{level:this.RESORT}}}},scale:{set:{level:this.COMPILE_BRANCH},inc:{level:this.COMPILE_BRANCH}},stationary:{alwaysCompile:!0},tag:{set:{attr:{tag:{level:this.RESORT}}}},rotate:{set:{level:this.COMPILE_BRANCH},inc:{level:this.COMPILE_BRANCH}},translate:{set:{level:this.COMPILE_BRANCH},inc:{level:this.COMPILE_BRANCH}},quaternion:{set:{level:this.COMPILE_BRANCH},add:{level:this.COMPILE_BRANCH}},matrix:{set:{level:this.COMPILE_BRANCH}},xform:{set:{level:this.REDRAW}},material:{set:{level:this.REDRAW}},lookAt:{set:{level:this.COMPILE_PATH},inc:{level:this.COMPILE_PATH}},camera:{set:{level:this.COMPILE_PATH},inc:{level:this.COMPILE_PATH}},morphGeometry:{set:{level:this.REDRAW},loaded:{level:this.REDRAW}},texture:{set:{attr:{layers:{level:this.REDRAW}}},loaded:{level:this.REDRAW}},geometry:{set:{attr:{positions:{level:this.REDRAW},normals:{level:this.REDRAW},uv:{level:this.REDRAW},uv2:{level:this.REDRAW},indices:{level:this.REDRAW}}},loaded:{level:this.COMPILE_SCENE}},text:{loadedImage:{level:this.COMPILE_BRANCH}},shader:{set:{attr:{params:{level:this.REDRAW}}}},shaderParams:{set:{attr:{params:{level:this.REDRAW}}}},flags:{set:{attr:{flags:{level:this.RESORT}}},add:{attr:{flags:{attr:{level:this.RESORT}}}}}},this.getCompileLevel=function(e,t,n,i){var r=this.config[e];if(r){if(t){var o=r[t];if(o){if(o.attr&&n){var a=o.attr[n];if(a){if(i&&"object"==typeof i){var s=a.attr;if(s){var l,c;for(var u in i)i.hasOwnProperty(u)&&(c=s[u],c&&void 0!=c.level&&(void 0==l||l>c.level)&&(l=c.level));if(l)return l}}if(void 0!=a.level)return a.level}}if(void 0!=o.level)return o.level}}if(void 0!=r.level)return r.level}return void 0}},SceneJS_compileModule=new function(){this._debugCfg=null,this._enableCompiler=!0,this._scenes={},this._scene=null,this._nodeStack=[],this._stackLen=0;var e=function(){this._bins=[],this.size=0,this.insert=function(e,t){var n=this._bins[e];n||(n=this._bins[e]=[],n.numNodes=0);var i=n[n.numNodes];i||(i=n[n.numNodes]={}),i.node=t,i.level=e,n.numNodes++,this.size++},this.remove=function(){for(var e,t=SceneJS_compileCfg.COMPILE_NOTHING;SceneJS_compileCfg.RESORT>=t;t++)if(e=this._bins[t],e&&e.numNodes>0)return this.size--,e[--e.numNodes];return null},this.clear=function(){for(var e,t=SceneJS_compileCfg.COMPILE_NOTHING;SceneJS_compileCfg.RESORT>=t;t++)e=this._bins[t],e&&(this._bins[t].numNodes=0);this.size=0}},t=this;SceneJS_eventModule.addListener(SceneJS_eventModule.INIT,function(){t._debugCfg=SceneJS_debugModule.getConfigs("compilation")}),SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_CREATED,function(n){t._scenes[n.sceneId]={flagSceneCompile:!1,dirtyNodes:{},dirtyNodesWithinBranches:{},countTraversedSubtreesToCompile:0,compilationQueue:new e,nodeCompilationLevels:{},nodeAlwaysCompile:{},stats:{nodes:0}}}),SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_DESTROYED,function(e){t._scenes[e.sceneId]=null}),this.redraw=function(e){if(this._enableCompiler){var t=this._scenes[e];t.compilingScene||(t.redraw=!0)}},this.nodeUpdated=function(e,t,n,i){if(this._enableCompiler){var r=e.scene,o=this._scenes[r.attr.id];if(!o.compilingScene){var a,s=e.attr.type,l=e.attr.id;if("node"!=s&&(a=SceneJS_compileCfg.getCompileLevel("node",t,n,i)),void 0===a&&(a=SceneJS_compileCfg.getCompileLevel(s,t,n,i)),a==SceneJS_compileCfg.REDRAW)return o.redraw=!0,void 0;if(a!=SceneJS_compileCfg.COMPILE_NOTHING){if(void 0===a&&(a=SceneJS_compileCfg.COMPILE_SCENE),a==SceneJS_compileCfg.COMPILE_SCENE&&"light"!=s)return o.compilingScene=!0,o.compilationQueue.clear(),void 0;"light"==s&&(a=2),a>=o.nodeCompilationLevels[l]||(o.nodeCompilationLevels[l]=a,o.compilationQueue.insert(a,e))}}}},this.COMPILE_NOTHING=0,this.REDRAW=1,this.COMPILE_PARTIAL=2,this.COMPILE_EVERYTHING=3,this.beginSceneCompile=function(e){var t=this._scenes[e];if(this._scene=t,this._stackLen=0,t.countTraversedSubtreesToCompile=0,!this._enableCompiler)return{level:this.COMPILE_EVERYTHING};if(t.nodeCompilationLevels={},t.compilingScene)return t.flagSceneCompile=!0,t.compilingScene=!1,{level:this.COMPILE_EVERYTHING};var n=t.compilationQueue;if(0==n.size)return t.redraw?(t.redraw=!1,{level:this.REDRAW}):{level:this.COMPILE_NOTHING};var i,r,o,a;t.stats={scene:0,branch:0,path:0,subtree:0,nodes:0},t.stats;for(var s={level:this.REDRAW,resort:!1};n.size>0;)i=n.remove(),a=i.level,r=i.node,o=r.attr.id,a==SceneJS_compileCfg.COMPILE_BRANCH?(this._flagCompilePath(t,r),t.dirtyNodesWithinBranches[o]=!0,s.level=this.COMPILE_PARTIAL):a==SceneJS_compileCfg.COMPILE_PATH?(this._flagCompilePath(t,r),s.level=this.COMPILE_PARTIAL):a==SceneJS_compileCfg.RESORT&&(s.resort=!0);return s},this._flagCompilePath=function(e,t){for(var n,i=e.dirtyNodes,r=t;r;){if(n=r.attr.id,i[n])return;if(e.dirtyNodesWithinBranches[n])return;i[n]=!0,r=r.parent}},this.preVisitNode=function(e){if(!this._enableCompiler)return!0;var t=this._scene,n=SceneJS_compileCfg.config[e.attr.type],i=e.attr.id;return t.stats.nodes++,t.flagSceneCompile&&(t.nodeAlwaysCompile[i]=!1,n&&n.alwaysCompile&&this._alwaysCompilePath(t,e)),this._nodeStack[this._stackLen++]=e,(t.dirtyNodesWithinBranches[i]===!0||n&&n.alwaysCompile)&&t.countTraversedSubtreesToCompile++,t.flagSceneCompile?!0:t.nodeAlwaysCompile[i]?!0:t.countTraversedSubtreesToCompile>0?!0:t.dirtyNodes[i]===!0?!0:(t.stats.nodes--,!1)},this._alwaysCompilePath=function(e,t){var n,i=t;if(!e.nodeAlwaysCompile[i.attr.id])for(;i;)n=i.attr.id,e.nodeAlwaysCompile[n]=!0,i=i.parent},this.postVisitNode=function(e){if(this._stackLen>0){var t=this._scene,n=e.attr.id,i=this._nodeStack[this._stackLen-1];if(i.attr.id==n){this._stackLen--;var r=SceneJS_compileCfg.config[e.attr.type];(t.dirtyNodesWithinBranches[n]===!0||r&&r.alwaysCompile)&&t.countTraversedSubtreesToCompile--}t.dirtyNodes[n]=!1,t.dirtyNodesWithinBranches[n]=!1}},this.finishSceneCompile=function(){this._scene.flagSceneCompile=!1}},SceneJS_loggingModule=new function(){function e(e,r){if(SceneJS._isArray(r)){t(e,i(r));for(var o=0;r.length>o;o++)n(r[o])}else t(e,r),n(r)}function t(e,t){t=o?c+o+": "+t:c+t;var n=a?a[e]:null;if(n)n(t);else{var i=s[e];i||(i=s[e]=[]),i.push(t)}}function n(e){"object"==typeof console&&(e=o?c+o+": "+e:c+e,console.log(e))}function i(e){for(var t=[],n=0;e.length>n;n++){var i=10>n?"&nbsp;&nbsp;&nbsp;":100>n?"&nbsp;&nbsp;":1e3>n?"&nbsp;":"";t.push(n+i+": "+e[n])}return t.join("<br/>")}function r(e){var t=s[e];if(t){var n=a?a[e]:null;if(n){for(var i=0;t.length>i;i++)n(t[i]);s[e]=[]}}}var o,a=null,s={},l=0,c="";SceneJS_eventModule.addListener(SceneJS_eventModule.LOGGING_ELEMENT_ACTIVATED,function(e){var t=e.loggingElement;a=t?{warn:function(e){t.innerHTML+='<p style="color:orange;">'+e+"</p>"},error:function(e){t.innerHTML+='<p style="color:darkred;">'+e+"</p>"},debug:function(e){t.innerHTML+='<p style="color:darkblue;">'+e+"</p>"},info:function(e){t.innerHTML+='<p style="color:darkgreen;">'+e+"</p>"}}:null}),SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_COMPILING,function(e){o=e.sceneId}),SceneJS_eventModule.addListener(SceneJS_eventModule.RESET,function(){s={},a=null},1e5),this.setIndent=function(e){l=e;for(var t=[],n=0;l>n;n++)t.push("----");c=t.join("")},this.error=function(t){e("error",t)},this.warn=function(t){e("warn",t)},this.info=function(t){e("info",t)},this.debug=function(t){e("debug",t)},this.getFuncs=function(){return a},this.setFuncs=function(e){if(e){a=e;for(var t in s)r(t)}}},SceneJS_errorModule=new function(){this.fatalError=function(e,t){return"string"==typeof e&&(t=e,e=SceneJS.errors.ERROR),SceneJS_eventModule.fireEvent(SceneJS_eventModule.ERROR,{errorName:SceneJS.errors._getErrorName(e)||"ERROR",code:e,exception:t,fatal:!0}),t},this.error=function(e,t){SceneJS_eventModule.fireEvent(SceneJS_eventModule.ERROR,{errorName:SceneJS.errors._getErrorName(e)||"ERROR",code:e,exception:t,fatal:!1})}};(function(){this.DEFAULT_LAYER_NAME="___default";var e=[],t=[],n=0,i=!0;SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_COMPILING,function(){n=0}),SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_RENDERING,function(){i&&(n>0?SceneJS_DrawList.setLayer(t[n-1],e[n-1]):SceneJS_DrawList.setLayer(),i=!1)});var r=SceneJS.createNodeType("layer");r.prototype._init=function(e){1==this.core._nodeCount&&(this.core.priority=e.priority||0,this.core.enabled=e.enabled!==!1)},r.prototype.setPriority=function(e){this.core.priority=e},r.prototype.getPriority=function(){return this.core.priority},r.prototype.setEnabled=function(e){this.core.enabled=e},r.prototype.getEnabled=function(){return this.core.enabled},r.prototype._compile=function(){e[n]=this.core,t[n]=this.attr.id,n++,i=!0,this._compileNodes(),n--,i=!0}})(),function(){var e=SceneJS.createNodeType("library");e.prototype._compile=function(){}}(),new function(){function e(e){var t;return e?(t=document.getElementById(e),t?SceneJS_loggingModule.info("SceneJS.Scene logging to element with ID '"+e+"' - logging to browser console also"):(t=document.getElementById(s.DEFAULT_LOGGING_ELEMENT_ID),t?SceneJS_loggingModule.info("SceneJS.Scene config 'loggingElementId' unresolved - found default logging element with ID '"+s.DEFAULT_LOGGING_ELEMENT_ID+"' - logging to browser console also"):SceneJS_loggingModule.info("SceneJS.Scene config 'loggingElementId' unresolved and failed to find default logging element with ID '"+s.DEFAULT_LOGGING_ELEMENT_ID+"' - that's OK, logging to browser console instead"))):(t=document.getElementById(s.DEFAULT_LOGGING_ELEMENT_ID),t||SceneJS_loggingModule.info("SceneJS.Scene config 'loggingElementId' omitted and failed to find default logging element with ID '"+s.DEFAULT_LOGGING_ELEMENT_ID+"' - that's OK, logging to browser console instead")),t}function t(e,t){var n;if(e){if(n=document.getElementById(e),!n&&(SceneJS_loggingModule.warn("Scene config 'canvasId' unresolved - looking for default canvas with ID '"+s.DEFAULT_CANVAS_ID+"'"),e=s.DEFAULT_CANVAS_ID,n=document.getElementById(e),!n))throw SceneJS_errorModule.fatalError(SceneJS.errors.CANVAS_NOT_FOUND,"Scene attribute 'canvasId' does not match any elements in the page and no default canvas found with ID '"+s.DEFAULT_CANVAS_ID+"'")}else if(SceneJS_loggingModule.info("Scene attribute 'canvasId' omitted - looking for default canvas with ID '"+s.DEFAULT_CANVAS_ID+"'"),e=s.DEFAULT_CANVAS_ID,n=document.getElementById(e),!n)throw SceneJS_errorModule.fatalError(SceneJS.errors.CANVAS_NOT_FOUND,"Scene failed to find default canvas with ID '"+s.DEFAULT_CANVAS_ID+"'");n.width=n.clientWidth,n.height=n.clientHeight;for(var i,r=SceneJS.SUPPORTED_WEBGL_CONTEXT_NAMES,o=0;!i&&r.length>o;o++)try{1==SceneJS_debugModule.getConfigs("webgl.logTrace")?(i=n.getContext(r[o],t),i&&(i=WebGLDebugUtils.makeDebugContext(i,function(e,t){SceneJS_loggingModule.error("WebGL error calling "+t+" on WebGL canvas context - see console log for details")}),i.setTracing(!0))):i=n.getContext(r[o],t)}catch(a){}if(!i)throw SceneJS_errorModule.fatalError(SceneJS.errors.WEBGL_NOT_SUPPORTED,"Canvas document element with ID '"+e+"' failed to provide a supported WebGL context");try{i.clearColor(0,0,0,1),i.clearDepth(1),i.enable(i.DEPTH_TEST),i.disable(i.CULL_FACE),i.depthRange(0,1),i.disable(i.SCISSOR_TEST)}catch(a){throw SceneJS_errorModule.fatalError(SceneJS.errors.WEBGL_NOT_SUPPORTED,"Canvas document element with ID '"+e+"' provided a supported WebGL context, but functions appear to be missing")}return{canvas:n,context:i,canvasId:e}}function n(){var e=[];for(var t in o){var n=o[t];n&&e.push(n.scene)}return e}function i(){}var r=!1,o={},a=0,s=SceneJS.createNodeType("scene");SceneJS_eventModule.addListener(SceneJS_eventModule.RESET,function(){o={},a=0}),s.prototype._init=function(n){if(!n.canvasId)throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Scene canvasId expected");this._loggingElementId=n.loggingElementId,this._destroyed=!1,this.scene=this,this.nodeMap=new SceneJS_Map,n.tagMask&&this.setTagMask(n.tagMask),this.canvas=t(n.canvasId,n.contextAttr);var i=this.attr.id;o[i]={sceneId:i,scene:this,canvas:this.canvas,loggingElement:e(this._loggingElementId)},a++,r||(SceneJS_loggingModule.info("SceneJS V"+SceneJS.VERSION+" initialised"),SceneJS_eventModule.fireEvent(SceneJS_eventModule.INIT),r=!0),SceneJS_eventModule.fireEvent(SceneJS_eventModule.SCENE_CREATED,{sceneId:i,canvas:this.canvas}),SceneJS_loggingModule.info("Scene defined: "+i),SceneJS_compileModule.nodeUpdated(this,"created")},s.DEFAULT_CANVAS_ID="_scenejs-default-canvas",s.DEFAULT_LOGGING_ELEMENT_ID="_scenejs-default-logging",s.prototype.getZBufferDepth=function(){if(this._destroyed)throw SceneJS_errorModule.fatalError(SceneJS.errors.NODE_ILLEGAL_STATE,"Scene has been destroyed");var e=this.canvas.context;return e.getParameter(e.DEPTH_BITS)},self.Int32Array||(self.Int32Array=Array,self.Float32Array=Array),function(){for(var e=0,t=["ms","moz","webkit","o"],n=0;t.length>n&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"RequestCancelAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var n=(new Date).getTime(),i=Math.max(0,16-(n-e)),r=window.setTimeout(function(){t(n+i)},i);return e=n+i,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),s.prototype.setTagMask=function(e){this.tagSelector||(this.tagSelector={}),this.tagSelector.mask=e,this.tagSelector.regex=e?new RegExp(e):null},s.prototype.getTagMask=function(){return this.tagSelector?this.tagSelector.mask:null},s.prototype._compileScene=function(){var e=SceneJS_compileModule.beginSceneCompile(this.attr.id);return e.level!=SceneJS_compileModule.COMPILE_NOTHING?(SceneJS_DrawList.bindScene({sceneId:this.attr.id},{compileMode:e.level==SceneJS_compileModule.COMPILE_EVERYTHING?SceneJS_DrawList.COMPILE_SCENE:SceneJS_DrawList.COMPILE_NODES,resort:e.resort}),this._compile(),SceneJS_compileModule.finishSceneCompile(),!0):!1},s.prototype.renderFrame=function(e){return this._compileScene()?(SceneJS_DrawList.renderFrame({tagSelector:this.tagSelector}),!0):e&&e.force?(SceneJS_DrawList.bindScene({sceneId:this.attr.id},{compileMode:SceneJS_DrawList.COMPILE_NODES,resort:!1}),SceneJS_DrawList.renderFrame({tagSelector:this.tagSelector}),!0):!1},s.prototype.start=function(e){if(this._destroyed)throw SceneJS_errorModule.fatalError(SceneJS.errors.NODE_ILLEGAL_STATE,"Scene has been destroyed");var t=this._setupFps();if(!this._running){e=e||{},this._running=!0,this._paused=!1;var n=this,i="__scenejs_sceneLoop"+this.attr.id,r=!1;SceneJS_compileModule.nodeUpdated(this,"start");var o=n.attr.id;window[i]=function(){if(n._running&&!n._paused){if(e.idleFunc&&e.idleFunc(),!n._running)return;SceneJS_eventModule.fireEvent(SceneJS_eventModule.SCENE_IDLE,{sceneId:o}),n._compileScene()?(r=!1,SceneJS_DrawList.renderFrame({profileFunc:e.profileFunc,tagSelector:n.tagSelector}),e.frameFunc&&e.frameFunc({fps:t()}),window.requestAnimationFrame(window[i])):(!r&&e.sleepFunc&&e.sleepFunc(),r=!0,window.requestAnimationFrame(window[i]))}else window[i]&&window.requestAnimationFrame(window[i])},this._startCfg=e,window.requestAnimationFrame(window[i])}},s.prototype._setupFps=function(){var e=new Date,t=0,n=0;return function(){t++;var i=new Date;if(i.getTime()-e.getTime()>1e3){var r=i.getTime()-e.getTime();n=Math.round(1e3*t/r),t=0,e=i}return n}},s.prototype.pause=function(e){if(this._destroyed)throw SceneJS_errorModule.fatalError(SceneJS.errors.NODE_ILLEGAL_STATE,"Scene has been destroyed");this._paused=e},s.prototype.isRunning=function(){return this._running},s.prototype.pick=function(e,t,n){if(this._destroyed)throw SceneJS_errorModule.fatalError(SceneJS.errors.NODE_ILLEGAL_STATE,"Scene has been destroyed");n=n||{},this._compileScene()&&SceneJS_DrawList.renderFrame({tagSelector:this.tagSelector});var i=SceneJS_DrawList.pick({sceneId:this.attr.id,canvasX:e,canvasY:t,rayPick:n.rayPick,tagSelector:this.tagSelector,averageDepth:n.averageDepth});return i&&(i.canvasX=e,i.canvasY=t),i},s.prototype._compile=function(){SceneJS._actionNodeDestroys();var e=this.attr.id,t=o[e];SceneJS_eventModule.fireEvent(SceneJS_eventModule.LOGGING_ELEMENT_ACTIVATED,{loggingElement:t.loggingElement}),SceneJS_eventModule.fireEvent(SceneJS_eventModule.SCENE_COMPILING,{sceneId:e,nodeId:e,canvas:t.canvas}),SceneJS_compileModule.preVisitNode(this)&&this._compileNodes(),SceneJS_compileModule.postVisitNode(this),i()},s.prototype.destroy=function(){if(!this._destroyed){this.stop(),this._destroyed=!0,this._scheduleNodeDestroy(),SceneJS._actionNodeDestroys();var e=this.attr.id;o[e]=null,a--,SceneJS_eventModule.fireEvent(SceneJS_eventModule.SCENE_DESTROYED,{sceneId:e}),SceneJS_loggingModule.info("Scene destroyed: "+e),0==a&&(SceneJS_loggingModule.info("SceneJS reset"),SceneJS_eventModule.fireEvent(SceneJS_eventModule.RESET))}},s.prototype.isActive=function(){return!this._destroyed},s.prototype.stop=function(){if(this._destroyed)throw SceneJS_errorModule.fatalError(SceneJS.errors.NODE_ILLEGAL_STATE,"Scene has been destroyed");this._running&&(this._running=!1,window["__scenejs_sceneLoop"+this.attr.id]=null)},s.prototype.containsNode=function(e){if(this._destroyed)throw SceneJS_errorModule.fatalError(SceneJS.errors.NODE_ILLEGAL_STATE,"Scene has been destroyed");var t=this.nodeMap.items[e];return t?!0:!1},s.prototype.findNodes=function(e){var t=new RegExp(e),n=[],i=this.nodeMap.items;for(var r in i)i.hasOwnProperty(r)&&t.test(r)&&n.push(i[r]);return n},s.prototype.findNode=function(e){var t=this.nodeMap.items[e];return t?SceneJS._selectNode(t):null},s.prototype.getStatus=function(){return this._destroyed?{destroyed:!0}:SceneJS._shallowClone(SceneJS_sceneStatusModule.sceneStatus[this.attr.id])},SceneJS.reset=function(){for(var e=n(),t=[],i=0;e.length>i;i++)t.push(e[i]);for(;t.length>0;)t.pop().destroy()}};var SceneJS_PickBuffer=function(e){var t,n=e.canvas,i=n.context;this.bound=!1,this._touch=function(){var e=n.canvas.width,r=n.canvas.height;if(t){if(t.width==e&&t.height==r)return;i.deleteTexture(t.texture),i.deleteFramebuffer(t.frameBuf),i.deleteRenderbuffer(t.renderBuf)}t={frameBuf:i.createFramebuffer(),renderBuf:i.createRenderbuffer(),texture:i.createTexture(),width:e,height:r},i.bindFramebuffer(i.FRAMEBUFFER,t.frameBuf),i.bindTexture(i.TEXTURE_2D,t.texture),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE);try{i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e,r,0,i.RGBA,i.UNSIGNED_BYTE,null)}catch(o){var a=new WebGLUnsignedByteArray(3*e*r);i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e,r,0,i.RGBA,i.UNSIGNED_BYTE,a)}if(i.bindRenderbuffer(i.RENDERBUFFER,t.renderBuf),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,e,r),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,t.texture,0),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,t.renderBuf),i.bindTexture(i.TEXTURE_2D,null),i.bindRenderbuffer(i.RENDERBUFFER,null),i.bindFramebuffer(i.FRAMEBUFFER,null),i.polygonOffset(1,1),i.enable(i.POLYGON_OFFSET_FILL),i.bindFramebuffer(i.FRAMEBUFFER,t.frameBuf),!i.isFramebuffer(t.frameBuf))throw SceneJS_errorModule.fatalError("Invalid framebuffer");var s=i.checkFramebufferStatus(i.FRAMEBUFFER);switch(s){case i.FRAMEBUFFER_COMPLETE:break;case i.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw SceneJS_errorModule.fatalError("Incomplete framebuffer (picking): FRAMEBUFFER_INCOMPLETE_ATTACHMENT");case i.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw SceneJS_errorModule.fatalError("Incomplete framebuffer (picking): FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");case i.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw SceneJS_errorModule.fatalError("Incomplete framebuffer (picking): FRAMEBUFFER_INCOMPLETE_DIMENSIONS");case i.FRAMEBUFFER_UNSUPPORTED:throw SceneJS_errorModule.fatalError("Incomplete framebuffer (picking): FRAMEBUFFER_UNSUPPORTED");default:throw SceneJS_errorModule.fatalError("Incomplete framebuffer (picking): "+s)}this.bound=!1},this.bind=function(){this._touch(),this.bound||(i.bindFramebuffer(i.FRAMEBUFFER,t.frameBuf),this.bound=!0)},this.clear=function(){if(!this.bound)throw"Pick buffer not bound";i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),i.disable(i.BLEND)},this.read=function(e,t){var r=e,o=n.canvas.height-t,a=new Uint8Array(4);return i.readPixels(r,o,1,1,i.RGBA,i.UNSIGNED_BYTE,a),a},this.readAll=function(){var e=new Uint8Array(4*n.canvas.height*n.canvas.width);return i.readPixels(0,0,n.canvas.width,n.canvas.height,i.RGBA,i.UNSIGNED_BYTE,e),e},this.unbind=function(){i.bindFramebuffer(i.FRAMEBUFFER,null),this.bound=!1}},SceneJS_DrawList=new function(){this.SORT_ORDER_TEXTURE=0,this.SORT_ORDER_VBO=1,this._sortOrder=[this.SORT_ORDER_TEXTURE,this.SORT_ORDER_VBO],this._GEO=0,this._CLIPS=1,this._COLORTRANS=2,this._FLAGS=3,this._LAYER=4,this._FRAMEBUF=5,this._LIGHTS=6,this._MATERIAL=7,this._MORPH=8,this._PICKCOLOR=9,this._TEXTURE=10,this._RENDERER=11,this._MODEL_TRANSFORM=12,this._PROJ_TRANSFORM=13,this._VIEW_TRANSFORM=14,this._PICK_LISTENERS=15,this._NAME=16,this._TAG=17,this._RENDER_LISTENERS=18,this._SHADER=19,this._SHADER_PARAMS=20;var e=function(){var e=-1;return function(t){return t._id=e,t._stateId=e--,t._nodeCount=0,t._default=!0,t}}();this._DEFAULT_MAT=new Float32Array(SceneJS_math_identityMat4()),this._DEFAULT_NORMAL_MAT=new Float32Array(SceneJS_math_transposeMat4(SceneJS_math_inverseMat4(SceneJS_math_identityMat4(),SceneJS_math_mat4()))),this._DEFAULT_CLIP_STATE=e({clips:[],hash:""}),this._DEFAULT_COLORTRANS_STATE=e({core:null,hash:"f"}),this._DEFAULT_FLAGS_STATE=e({flags:{colortrans:!0,picking:!0,clipping:!0,enabled:!0,transparent:!1,backfaces:!0,frontface:"ccw"}}),this._DEFAULT_LAYER_STATE=e({core:{priority:0,enabled:!0}}),this._DEFAULT_FRAMEBUF_STATE=e({frameBuf:null}),this._DEFAULT_LIGHTS_STATE=e({lights:[],hash:""}),this._DEFAULT_MATERIAL_STATE=e({material:{baseColor:[0,0,0],specularColor:[0,0,0],specular:1,shine:10,reflect:.8,alpha:1,emit:0}}),this._DEFAULT_MORPH_STATE=e({morph:null,hash:""}),this._DEFAULT_PICK_COLOR_STATE=e({pickColor:null,hash:""}),this._DEFAULT_PICK_LISTENERS_STATE=e({listeners:[]}),this._DEFAULT_NAME_STATE=e({core:null}),this._DEFAULT_TAG_STATE=e({core:null}),this._DEFAULT_TEXTURE_STATE=e({hash:""}),this._DEFAULT_RENDERER_STATE=e({props:null}),this._DEFAULT_MODEL_TRANSFORM_STATE=e({mat:this._DEFAULT_MAT,normalMat:this._DEFAULT_NORMAL_MAT}),this._DEFAULT_PROJ_TRANSFORM_STATE=e({mat:new Float32Array(SceneJS_math_orthoMat4c(SceneJS_math_ORTHO_OBJ.left,SceneJS_math_ORTHO_OBJ.right,SceneJS_math_ORTHO_OBJ.bottom,SceneJS_math_ORTHO_OBJ.top,SceneJS_math_ORTHO_OBJ.near,SceneJS_math_ORTHO_OBJ.far)),optics:SceneJS_math_ORTHO_OBJ}),this._DEFAULT_VIEW_TRANSFORM_STATE=e({mat:this._DEFAULT_MAT,normalMat:this._DEFAULT_NORMAL_MAT,lookAt:SceneJS_math_LOOKAT_ARRAYS}),this._DEFAULT_RENDER_LISTENERS_STATE=e({listeners:[]}),this._DEFAULT_SHADER_STATE=e({shader:{},hash:""}),this._DEFAULT_SHADER_PARAMS_STATE=e({params:null}),this._programs={};var t;this._sceneStates={},this._states=null,this._nodeMap=null,this._stateMap=null;var n,i=0;this.COMPILE_SCENE=0,this.COMPILE_BRANCH=1,this.COMPILE_NODES=2,this.compileMode=null;var r,o,a,s,l,c,u,d,h,p,f,m,g,v,y,b,_,w,S,x,C;this._stateHash=null;var $=[],E=this;SceneJS_eventModule.addListener(SceneJS_eventModule.INIT,function(){t=SceneJS_debugModule.getConfigs("shading")}),SceneJS_eventModule.addListener(SceneJS_eventModule.RESET,function(){var e,t=E._programs;for(var n in t)t.hasOwnProperty(n)&&(e=t[n],e.pick.destroy(),e.render.destroy());E._programs={},i=0}),SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_CREATED,function(e){var t=e.sceneId;E._sceneStates[t]||(E._sceneStates[t]={sceneId:t,canvas:e.canvas,nodeRenderer:new SceneJS_DrawListRenderer({canvas:e.canvas.canvas,context:e.canvas.context}),bin:[],lenBin:0,visibleCacheBin:[],lenVisibleCacheBin:0,nodeMap:{},geoNodesMap:{},stateMap:{},pickCallListDirty:!0,pickBufDirty:!0})}),SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_DESTROYED,function(){}),this.setStateSortDelay=function(e){e="number"==typeof e?void 0==e:this._DEFAULT_STATE_SORT_DELAY},this.bindScene=function(e,t){t=t||{},this._states=this._sceneStates[e.sceneId],this._nodeMap=this._states.nodeMap,this._stateMap=this._states.stateMap,this._stateHash=null,(t.compileMode==SceneJS_DrawList.COMPILE_SCENE||t.compileMode==SceneJS_DrawList.COMPILE_BRANCH)&&(y=this._DEFAULT_CLIP_STATE,c=this._DEFAULT_COLORTRANS_STATE,o=this._DEFAULT_FLAGS_STATE,a=this._DEFAULT_LAYER_STATE,v=this._DEFAULT_FRAMEBUF_STATE,l=this._DEFAULT_LIGHTS_STATE,u=this._DEFAULT_MATERIAL_STATE,b=this._DEFAULT_MORPH_STATE,g=this._DEFAULT_PICK_COLOR_STATE,s=this._DEFAULT_RENDERER_STATE,d=this._DEFAULT_TEXTURE_STATE,p=this._DEFAULT_MODEL_TRANSFORM_STATE,m=this._DEFAULT_PROJ_TRANSFORM_STATE,f=this._DEFAULT_VIEW_TRANSFORM_STATE,_=this._DEFAULT_NAME_STATE,w=this._DEFAULT_TAG_STATE,S=this._DEFAULT_RENDER_LISTENERS_STATE,x=this._DEFAULT_SHADER_STATE,C=this._DEFAULT_SHADER_PARAMS_STATE,this._forceStateSort(!0),t.compileMode==SceneJS_DrawList.COMPILE_SCENE&&(this._states.lenBin=0,n=0,this._nodeMap=this._states.nodeMap={},this._stateMap=this._states.stateMap={})),t.compileMode==SceneJS_DrawList.COMPILE_NODES&&(this._nodeMap=this._states.nodeMap,this._stateMap=this._states.stateMap,t.resort&&this._forceStateSort(!0)),this.compileMode=t.compileMode,r=!1},this.marshallStates=function(){SceneJS_eventModule.fireEvent(SceneJS_eventModule.SCENE_RENDERING,{fullCompile:this.compileMode===SceneJS_DrawList.COMPILE_SCENE})
},this._getState=function(e,t){var i,r=this._stateMap[e];return r||(r=this._stateMap[e]={}),this.compileMode!=SceneJS_DrawList.COMPILE_SCENE?(i=r[t],i||(i={_id:t,_stateId:n++,_stateType:e,_nodeCount:0},r[t]=i)):(i={_id:t,_stateId:n++,_stateType:e,_nodeCount:0},t&&(r[t]=i)),i},this._releaseState=function(e){if(void 0!=e._stateType&&!(0>=e._nodeCount)&&0==--e._nodeCount){var t=this._stateMap[e._stateType];t&&delete t[e.id]}},this.setClips=function(e,t){if(!e)return y=this._DEFAULT_CLIP_STATE,this._stateHash=null,void 0;if(y=this._getState(this._CLIPS,e),t=t||[],this.compileMode==SceneJS_DrawList.COMPILE_SCENE){if(t.length>0){for(var n=[],i=0;t.length>i;i++){var r=t[i];n.push(r.mode)}y.hash=n.join("")}else y.hash="";this._stateHash=null}y.clips=t},this.setColortrans=function(e,t){return e?(c=this._getState(this._COLORTRANS,e,!0),c.core=t,this.compileMode==SceneJS_DrawList.COMPILE_SCENE&&(c.hash=t?"t":"f",this._stateHash=null),void 0):(c=this._DEFAULT_COLORTRANS_STATE,this._stateHash=null,void 0)},this.setFlags=function(e,t){return 0==arguments.length?(o=this._DEFAULT_FLAGS_STATE,void 0):(o=this._getState(this._FLAGS,e),t=t||this._DEFAULT_FLAGS_STATE.flags,o.flags=t||this._DEFAULT_FLAGS_STATE.flags,void 0)},this.setLayer=function(e,t){return 0==arguments.length?(a=this._DEFAULT_LAYER_STATE,void 0):(a=this._getState(this._LAYER,e),a.core=t,void 0)},this.setFrameBuf=function(e,t){return 0==arguments.length?(v=this._DEFAULT_FRAMEBUF_STATE,void 0):(v=this._getState(this._FRAMEBUF,e),v.frameBuf=t,void 0)},this.setLights=function(e,t){if(0==arguments.length)return l=this._DEFAULT_LIGHTS_STATE,this._stateHash=null,void 0;if(l=this._getState(this._LIGHTS,e),t=t||[],this.compileMode==SceneJS_DrawList.COMPILE_SCENE){for(var n=[],i=0;t.length>i;i++){var r=t[i];n.push(r.mode),r.specular&&n.push("s"),r.diffuse&&n.push("d")}l.hash=n.join(""),this._stateHash=null}l.lights=t},this.setMaterial=function(e,t){return 0==arguments.length?(u=this._DEFAULT_MATERIAL_STATE,void 0):(u=this._getState(this._MATERIAL,e,!0),u.material=t||this._DEFAULT_MATERIAL_STATE.material,void 0)},this.setMorph=function(e,t){if(0==arguments.length)return b=this._DEFAULT_MORPH_STATE,this._stateHash=null,void 0;if(b=this._getState(this._MORPH,e),this.compileMode==SceneJS_DrawList.COMPILE_SCENE){if(t){var n=t.targets[0];b.hash=[n.vertexBuf?"t":"f",n.normalBuf?"t":"f",n.uvBuf?"t":"f",n.uvBuf2?"t":"f"].join("")}else b.hash="";this._stateHash=null}b.morph=t},this.setTexture=function(e,t){if(0==arguments.length)return d=this._DEFAULT_TEXTURE_STATE,this._stateHash=null,void 0;if(d=this._getState(this._TEXTURE,e),this.compileMode==SceneJS_DrawList.COMPILE_SCENE){var n;if(t&&t.layers.length>0){for(var i=t.layers,r=[],o=0,a=i.length;a>o;o++){var s=i[o];r.push("/"),r.push(s.applyFrom),r.push("/"),r.push(s.applyTo),r.push("/"),r.push(s.blendMode),s.matrix&&r.push("/anim")}n=r.join("")}else n="__scenejs_no_tex";d.hash=n,this._stateHash=null}d.core=t},this.setRenderer=function(e,t){return 0==arguments.length?(s=this._DEFAULT_RENDERER_STATE,void 0):(s=this._getState(this._RENDERER,e),s.props=t,this._stateHash=null,void 0)},this.setModelTransform=function(e,t,n){return 0==arguments.length?(p=this._DEFAULT_MODEL_TRANSFORM_STATE,void 0):(p=this._getState(this._MODEL_TRANSFORM,e),p.mat=t||this._DEFAULT_MAT,p.normalMat=n||this._DEFAULT_NORMAL_MAT,void 0)},this.setProjectionTransform=function(e,t){return 0==arguments.length?(m=this._DEFAULT_PROJ_TRANSFORM_STATE,void 0):(m=this._getState(this._PROJ_TRANSFORM,e),m.mat=t.matrixAsArray||this._DEFAULT_PROJ_TRANSFORM_STATE.mat,m.optics=t.optics||this._DEFAULT_PROJ_TRANSFORM_STATE.optics,void 0)},this.setViewTransform=function(e,t,n,i){return 0==arguments.length?(f=this._DEFAULT_VIEW_TRANSFORM_STATE,void 0):(f=this._getState(this._VIEW_TRANSFORM,e),f.mat=t||this._DEFAULT_MAT,f.normalMat=n||this._DEFAULT_NORMAL_MAT,f.lookAt=i||SceneJS_math_LOOKAT_ARRAYS,void 0)},this.setName=function(e,t){return 0==arguments.length?(_=this._DEFAULT_NAME_STATE,void 0):(_=this._getState(this._NAME,e),_.name=t,void 0)},this.setTag=function(e,t){return 0==arguments.length?(w=this._DEFAULT_TAG_STATE,void 0):(w=this._getState(this._TAG,e),w.core=t,void 0)},this.setRenderListeners=function(e,t){return 0==arguments.length?(S=this._DEFAULT_RENDER_LISTENERS_STATE,void 0):(S=this._getState(this._RENDER_LISTENERS,e),S.listeners=t||[],void 0)},this.setShader=function(e,t){return 0==arguments.length?(x=this._DEFAULT_SHADER_STATE,this._stateHash=null,void 0):(x=this._getState(this._SHADER,e),x.shader=t||{},x.hash=t.hash,this._stateHash=null,void 0)},this.setShaderParams=function(e,t){return 0==arguments.length?(C=this._DEFAULT_SHADER_PARAMS_STATE,void 0):(C=this._getState(this._SHADER_PARAMS,e),C.paramsStack=t,void 0)},this.setGeometry=function(e,t){this.marshallStates();var n;if(this.compileMode!=SceneJS_DrawList.COMPILE_SCENE)return n=this._nodeMap[e],n.renderListenersState._stateId!=S._stateId&&(this._releaseState(n.renderListenersState),n.renderListenersState=S,S._nodeCount++),n.flagsState._stateId!=o._stateId&&(this._releaseState(n.flagsState),n.flagsState=o,o._nodeCount++),void 0;var i=null!=h?h.hash:null;h=this._getState(this._GEO,e),h.geo=t,h.hash=[t.normalBuf?"t":"f",t.uvBuf?"t":"f",t.uvBuf2?"t":"f",t.colorBuf?"t":"f",t.primitive].join(""),i!=h.hash&&(this._stateHash=null),this._stateHash||(this._stateHash=this._getSceneHash());var r=this._getProgram(this._stateHash);h._nodeCount++,o._nodeCount++,a._nodeCount++,s._nodeCount++,l._nodeCount++,c._nodeCount++,u._nodeCount++,p._nodeCount++,f._nodeCount++,m._nodeCount++,d._nodeCount++,g._nodeCount++,v._nodeCount++,y._nodeCount++,b._nodeCount++,_._nodeCount++,w._nodeCount++,S._nodeCount++,x._nodeCount++,C._nodeCount++,n={id:e,sortId:0,stateHash:this._stateHash,program:r,geoState:h,layerState:a,flagsState:o,rendererState:s,lightState:l,colortransState:c,materialState:u,modelXFormState:p,viewXFormState:f,projXFormState:m,texState:d,pickColorState:g,frameBufState:v,clipState:y,morphState:b,nameState:_,tagState:w,renderListenersState:S,shaderState:x,shaderParamsState:C},this._states.nodeMap[e]=n,this._states.bin[this._states.lenBin++]=n;var $=this._states.geoNodesMap[e];$||($=this._states.geoNodesMap[e]=[]),$.push(n)},this._attachState=function(e,t,n){var i=e[t];return i&&i._stateId!=n._stateId&&this._releaseState(i),e[t]=n,n._nodeCount++,n},this.removeGeometry=function(e,t){var n=this._sceneStates[e],i=n.geoNodesMap,r=i[t];if(r){for(var o=0,a=r.length;a>o;o++){var s=r[o];s.destroyed=!0,this._releaseProgram(s.program),this._releaseState(s.geoState),this._releaseState(s.flagsState),this._releaseState(s.layerState),this._releaseState(s.rendererState),this._releaseState(s.lightState),this._releaseState(s.colortransState),this._releaseState(s.materialState),this._releaseState(s.modelXFormState),this._releaseState(s.viewXFormState),this._releaseState(s.projXFormState),this._releaseState(s.texState),this._releaseState(s.pickColorState),this._releaseState(s.frameBufState),this._releaseState(s.clipState),this._releaseState(s.morphState),this._releaseState(s.nameState),this._releaseState(s.tagState),this._releaseState(s.renderListenersState),this._releaseState(s.shaderState),this._releaseState(s.shaderParamsState)}i[t]=null,n.lenVisibleCacheBin=0}},this._createStateStateSortIDs=function(e){if(this._states.stateSortIDsDirty){for(var t,n=0,i=e.length;i>n;n++)t=e[n],t.sortId=1e5*t.layerState.core.priority+t.program.id;this._states.stateSortIDsDirty=!1}},this._createStateStateSortIDsNew=function(e){if(this._states.stateSortIDsDirty){for(var t,n,i,r,o=0,a=0,s=0,l=e.length;l--;)t=e[l],t.program.id!=n&&(t.program._sortId=o,n=t.program.id,o++),t.texState._stateId!=i&&(t.texState._sortId=a,i=t.texState._stateId,a++),t.geoState._stateId!=r&&(t.geoState._sortId=s,r=t.geoState._stateId,s++);for(l=e.length;l--;)t=e[l],t.sortId=t.layerState.core.priority*o*a+t.program.id*a+t.texState._sortId*s+t.geoState._sortId;this._states.stateSortIDsDirty=!1}},this._forceStateSort=function(e){e&&(this._states.stateSortIDsDirty=e),this._states.stateSortDirty=!0},this._stateSortBins=function(){var e=this._states;e.stateSortIDsDirty&&this._createStateStateSortIDs(e.bin),e.bin.length=e.lenBin,e.bin.sort(this._stateSortNodes),e.lenVisibleCacheBin=0},this._stateSortNodes=function(e,t){return e.sortId-t.sortId},this.renderFrame=function(e){var t=this._states;if(!t)throw SceneJS_errorModule.fatalError("No scene bound");t.pickBufDirty=!0,e=e||{};var n=!1;t.stateSortDirty&&(this._stateSortBins(),t.stateSortDirty=!1,n=!0);var i=n||this.compileMode==SceneJS_DrawList.COMPILE_SCENE||this.compileMode==SceneJS_DrawList.COMPILE_BRANCH,r=this.compileMode==SceneJS_DrawList.COMPILE_SCENE;i&&(t.pickCallListDirty=i),i&&(t.pickCallFuncsDirty=r);var o=e.profileFunc?!0:!1,a=t.nodeRenderer;a.init({doProfile:o,pciking:!1,callListDirty:i,callFuncsDirty:r}),SceneJS_GC_Hooks.renderFrameHook?SceneJS_GC_Hooks.renderFrameHook(this._renderDrawList,t,!1,e.tagSelector):this._renderDrawList(t,!1,e.tagSelector),a.cleanup(),o&&e.profileFunc(a.profile),this._states=null},this.pick=function(e){var t=this._sceneStates[e.sceneId];if(!t)throw"No drawList found for scene '"+e.sceneId+"'";var n=t.canvas.canvas,i=null,r=e.canvasX,o=e.canvasY,a=t.pickBuf;a||(a=t.pickBuf=new SceneJS_PickBuffer({canvas:t.canvas}),t.pickBufDirty=!0);var s=t.nodeRenderer;a.bind(),a.clear(),s.init({picking:!0,callListDirty:t.pickCallListDirty,callFuncsDirty:t.pickCallFuncsDirty}),SceneJS_GC_Hooks.renderFrameHook?SceneJS_GC_Hooks.renderFrameHook(this._renderDrawList,t,!0,e.tagSelector):this._renderDrawList(t,!0,e.tagSelector),s.cleanup(),t.pickCallListDirty=!1,t.pickCallFuncsDirty=!1,t.pickBufDirty=!1;var l=a.read(r,o),c=l[0]+256*l[1]+65536*l[2],u=c>=1?c-1:-1;a.unbind();var d=s.pickNameStates[u];if((d||e.averageDepth)&&(i={name:d?d.name:null},e.rayPick||e.averageDepth)){var h=t.rayPickBuf;h||(h=t.rayPickBuf=new SceneJS_PickBuffer({canvas:t.canvas})),h.bind(),h.clear(),s.init({pick:!1,rayPick:!0,callListDirty:!1,callFuncsDirty:!1});for(var p,f,m=t.visibleCacheBin,g=t.lenVisibleCacheBin,v=0;g>v;v++)p=m[v],f=p.flagsState.flags,f.picking!==!1&&s.renderNode(p);s.cleanup();var y=0,b=0;if(e.averageDepth){for(var l=h.readAll(),_=4*Math.ceil(l.length/4e3),w=0;l.length>w;w+=_)if(255!=l[w]||255!=l[w+1]||255!=l[w+2]||255!=l[w+3]){var S=this._unpackDepth(l,w);S>0&&(y+=S,b++)}b>0&&(y/=b)}0==b&&(l=h.read(r,o),y=this._unpackDepth(l)),y=2*y-1,h.unbind();var x=n.width,C=n.height,$=(r-x/2)/(x/2),E=-(o-C/2)/(C/2),T=p.viewXFormState.mat,k=p.projXFormState.mat,A=SceneJS_math_mulMat4(k,T,[]),N=SceneJS_math_inverseMat4(A,[]),M=SceneJS_math_transformVector4(N,[$,E,y,1]);M=SceneJS_math_mulVec4Scalar(M,1/M[3]),i.canvasPos=[r,o],i.worldPos=M}return i},this._unpackDepth=function(e,t){t||(t=0);var n=[e[0+t]/255,e[1+t]/255,e[2+t]/255,e[3+t]/255],i=[1/16581375,1/65025,1/255,1];return SceneJS_math_dotVector4(n,i)},this._renderDrawList=function(e,t,n){var i=e.canvas.context;i.enable(i.POLYGON_OFFSET_FILL),i.polygonOffset(1,1);var r=e.visibleCacheBin,o=e.lenVisibleCacheBin,a=e.nodeRenderer,s=0,l=$;if(o>0){for(var c=0;o>c;c++)if(u=r[c],d=u.flagsState.flags,!t||1!=u.geoState.geo.primitive){if(t&&d.picking===!1)continue;t||d.transparent!==!0?a.renderNode(u):l[s++]=u}}else{var u,d,h,p,f,m=e.bin,g=0,v=t;n&&(p=n.mask,f=n.regex);for(var c=0,y=e.lenBin;y>c;c++)u=m[c],u.destroyed?y>c&&(g++,m[c]=m[c+g]):(g>0&&(m[c]=m[c+g]),d=u.flagsState.flags,d.enabled!==!1&&(p&&(h=u.tagState.core,h&&(h.mask!=p&&(h.mask=p,h.matches=f.test(h.tag)),!h.matches))||u.layerState.core.enabled&&(v&&d.picking===!1||(v||d.transparent!==!0?a.renderNode(u):l[s++]=u,r[e.lenVisibleCacheBin++]=u))));g>0&&(m.length-=g,e.lenBin=m.length,y=m.length)}if(s>0){for(i.enable(i.BLEND),SceneJS_GC_Hooks.compareMode&&i.polygonOffset(3,3),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA),c=0,y=s;y>c;c++)a.renderNode($[c]);SceneJS_GC_Hooks.compareMode&&i.polygonOffset(1,1),i.disable(i.BLEND)}},this._getSceneHash=function(){return[this._states.canvas.canvasId,y.hash,c.hash,l.hash,b.hash,d.hash,x.hash,s.hash,h.hash].join(";")},this._getProgram=function(e){var n=this._programs[e];return n||(t.logScripts===!0&&SceneJS_loggingModule.info("Creating render and pick shaders: '"+e+"'"),n=this._programs[e]={id:i++,render:this._createShader(this._composeRenderingVertexShader(),this._composeRenderingFragmentShader()),pick:this._createShader(this._composePickingVertexShader(),this._composePickingFragmentShader()),stateHash:e,refCount:0}),n.refCount++,n},this._releaseProgram=function(e){0>=--e.refCount},this._createShader=function(e,t){try{return new SceneJS_webgl_Program(this._stateHash,this._states.canvas.context,[e.join("\n")],[t.join("\n")],SceneJS_loggingModule)}catch(n){throw console.error("-----------------------------------------------------------------------------------------:"),console.error("Failed to create SceneJS Shader"),console.error("SceneJS Version: "+SceneJS.VERSION),console.error("Error message: "+n),console.error(""),console.error("Vertex shader:"),console.error(""),this._logShaderLoggingSource(e),console.error(""),console.error("Fragment shader:"),this._logShaderLoggingSource(t),console.error("-----------------------------------------------------------------------------------------:"),SceneJS_errorModule.fatalError(SceneJS.errors.ERROR,"Failed to create SceneJS Shader: "+n)}},this._logShaderLoggingSource=function(e){for(var t=0,n=e.length;n>t;t++)console.error(e[t])},this._writeHooks=function(e,t,n,i,r){for(var o=0,a=i.length;a>o;o++)r?e.push(t+"="+n+"("+t+");"):e.push(n+"("+t+");")},this._composePickingVertexShader=function(){var e=x.shader.shaders||{},n=e.vertex||{},i=n.hooks||{},r=e.fragment||{},o=r.hooks||{};y.clips.length>0;var a=b.morph&&!0,s=this._hasNormals(),l=["precision mediump float;","attribute vec3 SCENEJS_aVertex;","attribute vec3 SCENEJS_aNormal;","uniform mat4 SCENEJS_uMMatrix;","uniform mat4 SCENEJS_uMNMatrix;","uniform mat4 SCENEJS_uVMatrix;","uniform mat4 SCENEJS_uVNMatrix;","uniform mat4 SCENEJS_uPMatrix;"];return s&&(o.worldNormal||o.viewNormal)&&(l.push("varying   vec3 SCENEJS_vWorldNormal;"),l.push("varying   vec3 SCENEJS_vViewNormal;")),l.push("varying vec4 SCENEJS_vModelVertex;"),l.push("varying vec4 SCENEJS_vWorldVertex;"),l.push("varying vec4 SCENEJS_vViewVertex;\n"),l.push("varying vec4 SCENEJS_vProjVertex;\n"),l.push("uniform vec3 SCENEJS_uWorldEye;"),l.push("varying vec3 SCENEJS_vEyeVec;"),n.code&&l.push("\n"+n.code+"\n"),a&&(l.push("uniform float SCENEJS_uMorphFactor;"),b.morph.targets[0].vertexBuf&&l.push("attribute vec3 SCENEJS_aMorphVertex;")),l.push("void main(void) {"),l.push("   vec4 tmpVertex=vec4(SCENEJS_aVertex, 1.0); "),s&&l.push("  vec4 modelNormal = vec4(SCENEJS_aNormal, 0.0); "),l.push("  SCENEJS_vModelVertex = tmpVertex; "),i.modelPos&&l.push("tmpVertex="+i.modelPos+"(tmpVertex);"),a&&b.morph.targets[0].vertexBuf&&(l.push("  vec4 vMorphVertex = vec4(SCENEJS_aMorphVertex, 1.0); "),i.modelPos&&l.push("vMorphVertex="+i.modelPos+"(vMorphVertex);"),l.push("  tmpVertex = vec4(mix(tmpVertex.xyz, vMorphVertex.xyz, SCENEJS_uMorphFactor), 1.0); ")),l.push("  tmpVertex = SCENEJS_uMMatrix * tmpVertex; "),i.worldPos&&l.push("tmpVertex="+i.worldPos+"(tmpVertex);"),l.push("  SCENEJS_vWorldVertex = tmpVertex; "),l.push("SCENEJS_vEyeVec = normalize(SCENEJS_uWorldEye - tmpVertex.xyz);"),l.push("  tmpVertex = SCENEJS_uVMatrix * tmpVertex; "),i.viewPos&&l.push("tmpVertex="+i.viewPos+"(tmpVertex);"),l.push("  SCENEJS_vViewVertex = tmpVertex;"),s&&(o.worldNormal||o.viewNormal)&&(l.push("  vec3 worldNormal = normalize((SCENEJS_uMNMatrix * modelNormal).xyz); "),l.push("  SCENEJS_vWorldNormal = worldNormal;"),l.push("  SCENEJS_vViewNormal = (SCENEJS_uVNMatrix * vec4(worldNormal, 1.0)).xyz;")),l.push("  SCENEJS_vProjVertex = SCENEJS_uPMatrix * tmpVertex;"),l.push("  gl_Position = SCENEJS_vProjVertex;"),l.push("}"),1==t.logScripts&&SceneJS_loggingModule.info(l),l},this._composePickingFragmentShader=function(){var e=x.shader.shaders||{},n=e.fragment||{},i=n.hooks||{},r=y&&y.clips.length>0,o=this._hasNormals(),a=["precision mediump float;"];if(a.push("vec4 packDepth(const in float depth) {"),a.push("  const vec4 bitShift = vec4(255.0*255.0*255.0, 255.0*255.0, 255.0, 1.0);"),a.push("  const vec4 bitMask  = vec4(0.0, 1.0/255.0, 1.0/255.0, 1.0/255.0);"),a.push("  vec4 res = fract(depth * bitShift);"),a.push("  res -= res.xxyz * bitMask;"),a.push("  return res;"),a.push("}"),a.push("varying vec4 SCENEJS_vModelVertex;"),a.push("varying vec4 SCENEJS_vWorldVertex;"),a.push("varying vec4 SCENEJS_vViewVertex;"),a.push("varying vec4 SCENEJS_vProjVertex;"),a.push("uniform bool SCENEJS_uRayPickMode;"),a.push("uniform vec3 SCENEJS_uPickColor;"),a.push("uniform float SCENEJS_uZNear;"),a.push("uniform float SCENEJS_uZFar;"),a.push("varying vec3 SCENEJS_vEyeVec;"),o&&(i.worldNormal||i.viewNormal)&&(a.push("varying vec3 SCENEJS_vWorldNormal;"),a.push("varying vec3 SCENEJS_vViewNormal;")),r)for(var s=0;y.clips.length>s;s++)a.push("uniform float SCENEJS_uClipMode"+s+";"),a.push("uniform vec4  SCENEJS_uClipNormalAndDist"+s+";");if(n.code&&a.push("\n"+n.code+"\n"),a.push("void main(void) {"),i.worldPosClip&&a.push("if ("+i.worldPosClip+"(SCENEJS_vWorldVertex) == false) { discard; };"),i.viewPosClip&&a.push("if (!"+i.viewPosClip+"(SCENEJS_vViewVertex) == false) { discard; };"),r){a.push("  float   dist;");for(var s=0;y.clips.length>s;s++)a.push("    if (SCENEJS_uClipMode"+s+" != 0.0) {"),a.push("        dist = dot(SCENEJS_vWorldVertex.xyz, SCENEJS_uClipNormalAndDist"+s+".xyz) - SCENEJS_uClipNormalAndDist"+s+".w;"),a.push("        if (SCENEJS_uClipMode"+s+" == 1.0) {"),a.push("            if (dist < 0.0) { discard; }"),a.push("        }"),a.push("        if (SCENEJS_uClipMode"+s+" == 2.0) {"),a.push("            if (dist > 0.0) { discard; }"),a.push("        }"),a.push("    }")}return i.worldPos&&a.push(i.worldPos+"(SCENEJS_vWorldVertex);"),i.viewPos&&a.push(i.viewPos+"(SCENEJS_vViewVertex);"),i.worldEyeVec&&a.push(i.worldEyeVec+"(SCENEJS_vEyeVec);"),o&&i.worldNormal&&a.push(i.worldNormal+"(SCENEJS_vWorldNormal);"),o&&i.viewNormal&&a.push(i.viewNormal+"(SCENEJS_vViewNormal);"),a.push("    if (SCENEJS_uRayPickMode) {"),a.push("          float zNormalizedDepth = ( ( SCENEJS_vProjVertex.z / SCENEJS_vProjVertex.w ) + 1.0 ) / 2.0;"),a.push("          gl_FragColor = packDepth(zNormalizedDepth); "),a.push("    } else {"),a.push("          gl_FragColor = vec4(SCENEJS_uPickColor.rgb, 1.0);  "),a.push("    }"),a.push("}"),1==t.logScripts&&SceneJS_loggingModule.info(a),a},this._isTexturing=function(){if(d.core&&d.core.layers.length>0){if(h.geo.uvBuf||h.geo.uvBuf2)return!0;if(b.morph&&(b.morph.targets[0].uvBuf||b.morph.targets[0].uvBuf2))return!0}return!1},this._hasNormals=function(){return h.geo.normalBuf?!0:b.morph&&b.morph.targets[0].normalBuf?!0:!1},this._composeRenderingVertexShader=function(){var e=x.shader.shaders||{};if(e.vertex&&e.vertex.code&&!e.vertex.hooks)return e.vertex.code;var n=e.vertex||{},i=n.hooks||{},r=e.fragment||{},o=r.hooks||{},a=this._isTexturing(),s=this._hasNormals(),c=y.clips.length>0,u=b.morph&&!0,d=["precision mediump float;"];if(d.push("attribute vec3 SCENEJS_aVertex;"),d.push("uniform vec3 SCENEJS_uWorldEye;"),d.push("varying vec3 SCENEJS_vWorldEyeVec;"),s){d.push("attribute vec3 SCENEJS_aNormal;"),d.push("uniform   mat4 SCENEJS_uMNMatrix;"),d.push("uniform   mat4 SCENEJS_uVNMatrix;"),d.push("varying   vec3 SCENEJS_vWorldNormal;"),d.push("varying   vec3 SCENEJS_vViewNormal;");for(var p=0;l.lights.length>p;p++){var f=l.lights[p];"ambient"!=f.mode&&("dir"==f.mode&&d.push("uniform vec3 SCENEJS_uLightDir"+p+";"),"point"==f.mode&&d.push("uniform vec3 SCENEJS_uLightPos"+p+";"),"spot"==f.mode&&d.push("uniform vec3 SCENEJS_uLightPos"+p+";"),d.push("varying vec4 SCENEJS_vViewLightVecAndDist"+p+";"))}}if(a&&(h.geo.uvBuf&&d.push("attribute vec2 SCENEJS_aUVCoord;"),h.geo.uvBuf2&&d.push("attribute vec2 SCENEJS_aUVCoord2;")),h.geo.colorBuf&&(d.push("attribute vec4 SCENEJS_aVertexColor;"),d.push("varying vec4 SCENEJS_vColor;")),d.push("uniform mat4 SCENEJS_uMMatrix;"),d.push("uniform mat4 SCENEJS_uVMatrix;"),d.push("uniform mat4 SCENEJS_uPMatrix;"),(c||o.worldPos)&&d.push("varying vec4 SCENEJS_vWorldVertex;"),o.viewPos&&d.push("varying vec4 SCENEJS_vViewVertex;"),a&&(h.geo.uvBuf&&d.push("varying vec2 SCENEJS_vUVCoord;"),h.geo.uvBuf2&&d.push("varying vec2 SCENEJS_vUVCoord2;")),u&&(d.push("uniform float SCENEJS_uMorphFactor;"),b.morph.targets[0].vertexBuf&&d.push("attribute vec3 SCENEJS_aMorphVertex;"),s&&b.morph.targets[0].normalBuf&&d.push("attribute vec3 SCENEJS_aMorphNormal;")),n.code&&d.push("\n"+n.code+"\n"),d.push("void main(void) {"),d.push("vec4 tmpVertex=vec4(SCENEJS_aVertex, 1.0); "),i.modelPos&&d.push("tmpVertex="+i.modelPos+"(tmpVertex);"),d.push("  vec4 modelVertex = tmpVertex; "),s&&d.push("  vec4 modelNormal = vec4(SCENEJS_aNormal, 0.0); "),u&&(b.morph.targets[0].vertexBuf&&(d.push("  vec4 vMorphVertex = vec4(SCENEJS_aMorphVertex, 1.0); "),d.push("  modelVertex = vec4(mix(modelVertex.xyz, vMorphVertex.xyz, SCENEJS_uMorphFactor), 1.0); ")),s&&b.morph.targets[0].normalBuf&&(d.push("  vec4 vMorphNormal = vec4(SCENEJS_aMorphNormal, 1.0); "),d.push("  modelNormal = vec4( mix(modelNormal.xyz, vMorphNormal.xyz, 0.0), 1.0); "))),d.push("  vec4 worldVertex = SCENEJS_uMMatrix * modelVertex; "),i.worldPos&&d.push("worldVertex="+i.worldPos+"(worldVertex);"),i.viewMatrix?d.push("vec4 viewVertex = "+i.viewMatrix+"(SCENEJS_uVMatrix) * worldVertex;"):d.push("vec4 viewVertex  = SCENEJS_uVMatrix * worldVertex; "),i.viewPos&&d.push("viewVertex="+i.viewPos+"(viewVertex);"),s&&(d.push("  vec3 worldNormal = normalize((SCENEJS_uMNMatrix * modelNormal).xyz); "),d.push("  SCENEJS_vWorldNormal = worldNormal;"),d.push("  SCENEJS_vViewNormal = (SCENEJS_uVNMatrix * vec4(worldNormal, 1.0)).xyz;")),(c||o.worldPos)&&d.push("  SCENEJS_vWorldVertex = worldVertex;"),o.viewPos&&d.push("  SCENEJS_vViewVertex = viewVertex;"),i.projMatrix?d.push("gl_Position = "+i.projMatrix+"(SCENEJS_uPMatrix) * viewVertex;"):d.push("  gl_Position = SCENEJS_uPMatrix * viewVertex;"),d.push("  vec3 tmpVec3;"),s)for(var p=0;l.lights.length>p;p++)f=l.lights[p],"ambient"!=f.mode&&("dir"==f.mode&&("world"==f.space?d.push("SCENEJS_vViewLightVecAndDist"+p+" = vec4(-normalize((SCENEJS_uVMatrix * vec4(SCENEJS_uLightDir"+p+", 0.0)).xyz), 0.0);"):d.push("SCENEJS_vViewLightVecAndDist"+p+" = vec4(-normalize(SCENEJS_uLightDir"+p+"), 0.0);")),"point"==f.mode&&("world"==f.space?(d.push("tmpVec3 = ((SCENEJS_uVMatrix * vec4(SCENEJS_uLightPos"+p+", 1.0)).xyz - worldVertex.xyz);"),d.push("SCENEJS_vViewLightVecAndDist"+p+" = vec4(normalize(tmpVec3), length(tmpVec3));")):(d.push("tmpVec3 = (SCENEJS_uLightPos"+p+".xyz - worldVertex.xyz);"),d.push("SCENEJS_vViewLightVecAndDist"+p+" = vec4(normalize(tmpVec3), length(tmpVec3));"))));return d.push("SCENEJS_vWorldEyeVec = normalize(SCENEJS_uWorldEye - worldVertex.xyz);"),a&&(h.geo.uvBuf&&d.push("SCENEJS_vUVCoord = SCENEJS_aUVCoord;"),h.geo.uvBuf2&&d.push("SCENEJS_vUVCoord2 = SCENEJS_aUVCoord2;")),h.geo.colorBuf&&d.push("SCENEJS_vColor = SCENEJS_aVertexColor;"),d.push("}"),t.logScripts===!0&&SceneJS_loggingModule.info(d),d},this._composeRenderingFragmentShader=function(){var e=x.shader.shaders||{};if(e.fragment&&e.fragment.code&&!e.fragment.hooks)return e.fragment.code;var n=e.fragment||{},i=n.hooks||{},r=this._isTexturing(),o=this._hasNormals(),a=y&&y.clips.length>0,s=["\n"];if(s.push("precision mediump float;"),(a||i.worldPos)&&s.push("varying vec4 SCENEJS_vWorldVertex;"),i.viewPos&&s.push("varying vec4 SCENEJS_vViewVertex;"),a)for(var c=0;y.clips.length>c;c++)s.push("uniform float SCENEJS_uClipMode"+c+";"),s.push("uniform vec4  SCENEJS_uClipNormalAndDist"+c+";");if(r){h.geo.uvBuf&&s.push("varying vec2 SCENEJS_vUVCoord;"),h.geo.uvBuf2&&s.push("varying vec2 SCENEJS_vUVCoord2;");for(var u,c=0,p=d.core.layers.length;p>c;c++)u=d.core.layers[c],s.push("uniform sampler2D SCENEJS_uSampler"+c+";"),u.matrix&&s.push("uniform mat4 SCENEJS_uLayer"+c+"Matrix;"),s.push("uniform float SCENEJS_uLayer"+c+"BlendFactor;")}if(s.push("uniform bool  SCENEJS_uBackfaceTexturing;"),s.push("uniform bool  SCENEJS_uBackfaceLighting;"),s.push("uniform bool  SCENEJS_uSpecularLighting;"),s.push("uniform bool  SCENEJS_uTransparent;"),h.geo.colorBuf&&s.push("varying vec4 SCENEJS_vColor;"),s.push("uniform vec3  SCENEJS_uAmbientColor;"),s.push("uniform vec3  SCENEJS_uMaterialBaseColor;"),s.push("uniform float SCENEJS_uMaterialAlpha;"),s.push("uniform float SCENEJS_uMaterialEmit;"),s.push("uniform vec3  SCENEJS_uMaterialSpecularColor;"),s.push("uniform float SCENEJS_uMaterialSpecular;"),s.push("uniform float SCENEJS_uMaterialShine;"),s.push("varying vec3 SCENEJS_vWorldEyeVec;"),o){s.push("varying vec3 SCENEJS_vWorldNormal;"),s.push("varying vec3 SCENEJS_vViewNormal;");for(var f,c=0;l.lights.length>c;c++)f=l.lights[c],"ambient"!=f.mode&&(s.push("uniform vec3  SCENEJS_uLightColor"+c+";"),"point"==f.mode&&s.push("uniform vec3  SCENEJS_uLightAttenuation"+c+";"),s.push("varying vec4  SCENEJS_vViewLightVecAndDist"+c+";"))}if(n.code&&s.push("\n"+n.code+"\n"),s.push("void main(void) {"),s.push("  vec3    ambient= vec3(0.17, 0.17, 0.17);"),a){s.push("  float   dist;");for(var c=0;y.clips.length>c;c++)s.push("    if (SCENEJS_uClipMode"+c+" != 0.0) {"),s.push("        dist = dot(SCENEJS_vWorldVertex.xyz, SCENEJS_uClipNormalAndDist"+c+".xyz) - SCENEJS_uClipNormalAndDist"+c+".w;"),s.push("        if (SCENEJS_uClipMode"+c+" == 1.0) {"),s.push("            if (dist < 0.0) { discard; }"),s.push("        }"),s.push("        if (SCENEJS_uClipMode"+c+" == 2.0) {"),s.push("            if (dist > 0.0) { discard; }"),s.push("        }"),s.push("    }")}i.worldPos&&s.push(i.worldPos+"(SCENEJS_vWorldVertex);"),i.viewPos&&s.push(i.viewPos+"(SCENEJS_vViewVertex);"),i.worldEyeVec&&s.push(i.worldEyeVec+"(SCENEJS_vWorldEyeVec);"),o&&i.worldNormal&&s.push(i.worldNormal+"(SCENEJS_vWorldNormal);"),o&&i.viewNormal&&s.push(i.viewNormal+"(SCENEJS_vViewNormal);"),h.geo.colorBuf?s.push("  vec3    color   = SCENEJS_vColor.rgb;"):s.push("  vec3    color   = SCENEJS_uMaterialBaseColor;"),s.push("  float alpha         = SCENEJS_uMaterialAlpha;"),s.push("  float emit          = SCENEJS_uMaterialEmit;"),s.push("  float specular      = SCENEJS_uMaterialSpecular;"),s.push("  vec3  specularColor = SCENEJS_uMaterialSpecularColor;"),s.push("  float shine         = SCENEJS_uMaterialShine;"),i.materialBaseColor&&s.push("color="+i.materialBaseColor+"(color);"),i.materialAlpha&&s.push("alpha="+i.materialAlpha+"(alpha);"),i.materialEmit&&s.push("emit="+i.materialEmit+"(emit);"),i.materialSpecular&&s.push("specular="+i.materialSpecular+"(specular);"),i.materialSpecularColor&&s.push("specularColor="+i.materialSpecularColor+"(specularColor);"),i.materialShine&&s.push("shine="+i.materialShine+"(shine);"),o&&(s.push("  float   attenuation = 1.0;"),s.push("  vec3    viewNormalVec = SCENEJS_vViewNormal;"));var u;if(r){o&&s.push("if (SCENEJS_uBackfaceTexturing || dot(SCENEJS_vWorldNormal, SCENEJS_vWorldEyeVec) > 0.0) {"),s.push("  vec4    texturePos;"),s.push("  vec2    textureCoord=vec2(0.0,0.0);");for(var c=0,p=d.core.layers.length;p>c;c++){if(u=d.core.layers[c],"normal"==u.applyFrom&&o){if(!h.geo.normalBuf){SceneJS_loggingModule.warn("Texture layer applyFrom='normal' but geo has no normal vectors");continue}s.push("texturePos=vec4(normalVec.xyz, 1.0);")}if("uv"==u.applyFrom){if(!h.geo.uvBuf){SceneJS_loggingModule.warn("Texture layer applyTo='uv' but geometry has no UV coordinates");continue}s.push("texturePos = vec4(SCENEJS_vUVCoord.s, SCENEJS_vUVCoord.t, 1.0, 1.0);")}if("uv2"==u.applyFrom){if(!h.geo.uvBuf2){SceneJS_loggingModule.warn("Texture layer applyTo='uv2' but geometry has no UV2 coordinates");continue}s.push("texturePos = vec4(SCENEJS_vUVCoord2.s, SCENEJS_vUVCoord2.t, 1.0, 1.0);")}u.matrix?s.push("textureCoord=(SCENEJS_uLayer"+c+"Matrix * texturePos).xy;"):s.push("textureCoord=texturePos.xy;"),"alpha"==u.applyTo&&("multiply"==u.blendMode?s.push("alpha = alpha * (SCENEJS_uLayer"+c+"BlendFactor * texture2D(SCENEJS_uSampler"+c+", vec2(textureCoord.x, 1.0 - textureCoord.y)).b);"):"add"==u.blendMode&&s.push("alpha = ((1.0 - SCENEJS_uLayer"+c+"BlendFactor) * alpha) + (SCENEJS_uLayer"+c+"BlendFactor * texture2D(SCENEJS_uSampler"+c+", vec2(textureCoord.x, 1.0 - textureCoord.y)).b);")),"baseColor"==u.applyTo&&("multiply"==u.blendMode?s.push("color = color * (SCENEJS_uLayer"+c+"BlendFactor * texture2D(SCENEJS_uSampler"+c+", vec2(textureCoord.x, 1.0 - textureCoord.y)).rgb);"):s.push("color = ((1.0 - SCENEJS_uLayer"+c+"BlendFactor) * color) + (SCENEJS_uLayer"+c+"BlendFactor * texture2D(SCENEJS_uSampler"+c+", vec2(textureCoord.x, 1.0 - textureCoord.y)).rgb);")),"emit"==u.applyTo&&("multiply"==u.blendMode?s.push("emit  = emit * (SCENEJS_uLayer"+c+"BlendFactor * texture2D(SCENEJS_uSampler"+c+", vec2(textureCoord.x, 1.0 - textureCoord.y)).r);"):s.push("emit = ((1.0 - SCENEJS_uLayer"+c+"BlendFactor) * emit) + (SCENEJS_uLayer"+c+"BlendFactor * texture2D(SCENEJS_uSampler"+c+", vec2(textureCoord.x, 1.0 - textureCoord.y)).r);")),"specular"==u.applyTo&&o&&("multiply"==u.blendMode?s.push("specular  = specular * (SCENEJS_uLayer"+c+"BlendFactor * texture2D(SCENEJS_uSampler"+c+", vec2(textureCoord.x, 1.0 - textureCoord.y)).r);"):s.push("specular = ((1.0 - SCENEJS_uLayer"+c+"BlendFactor) * specular) + (SCENEJS_uLayer"+c+"BlendFactor * texture2D(SCENEJS_uSampler"+c+", vec2(textureCoord.x, 1.0 - textureCoord.y)).r);")),"normals"==u.applyTo&&o&&(s.push("vec3 bump = normalize(texture2D(SCENEJS_uSampler"+c+", vec2(textureCoord.x, -textureCoord.y)).xyz * 2.0 - 1.0);"),s.push("viewNormalVec *= -bump;"))}o&&s.push("}")}if(s.push("  vec4    fragColor;"),o){s.push("if (SCENEJS_uBackfaceLighting || dot(SCENEJS_vWorldNormal, SCENEJS_vWorldEyeVec) > 0.0) {"),s.push("  vec3    lightValue      = vec3(0.0, 0.0, 0.0);"),s.push("  vec3    specularValue   = vec3(0.0, 0.0, 0.0);"),s.push("  vec3    viewLightVec;"),s.push("  float   dotN;"),s.push("  float   lightDist;");for(var f,c=0;l.lights.length>c;c++)f=l.lights[c],"ambient"!=f.mode&&(s.push("viewLightVec = SCENEJS_vViewLightVecAndDist"+c+".xyz;"),"point"==f.mode&&(s.push("dotN = abs(dot(viewNormalVec, viewLightVec));"),s.push("lightDist = SCENEJS_vViewLightVecAndDist"+c+".w;"),s.push("attenuation = 1.0 - (  SCENEJS_uLightAttenuation"+c+"[0] + "+"  SCENEJS_uLightAttenuation"+c+"[1] * lightDist + "+"  SCENEJS_uLightAttenuation"+c+"[2] * lightDist * lightDist);"),f.diffuse&&s.push("  lightValue += dotN *  SCENEJS_uLightColor"+c+" * attenuation;"),f.specular&&(s.push("if (SCENEJS_uSpecularLighting) {"),s.push("    specularValue += specularColor * SCENEJS_uLightColor"+c+" * specular * pow(max(dot(reflect(-viewLightVec, -viewNormalVec), vec3(0.0,0.0,1.0)), 0.0), shine) * attenuation;"),s.push("}"))),"dir"==f.mode&&(s.push("dotN = abs(dot(viewNormalVec, viewLightVec));"),f.diffuse&&s.push("lightValue += dotN * SCENEJS_uLightColor"+c+";"),f.specular&&(s.push("if (SCENEJS_uSpecularLighting) {"),s.push("    specularValue += specularColor * SCENEJS_uLightColor"+c+" * specular * pow(max(dot(reflect(-viewLightVec, -viewNormalVec), vec3(0.0,0.0,1.0)), 0.0), shine);"),s.push("}"))));s.push("      fragColor = vec4((specularValue.rgb + color.rgb * (lightValue.rgb + ambient.rgb)) + (emit * color.rgb), alpha);"),s.push("   } else {"),s.push("      fragColor = vec4((color.rgb + (emit * color.rgb)) *  (vec3(1.0, 1.0, 1.0) + ambient.rgb), alpha);"),s.push("   }")}else s.push("fragColor = vec4((color.rgb + (emit * color.rgb)) *  (vec3(1.0, 1.0, 1.0) + ambient.rgb), alpha);");return i.pixelColor&&s.push("fragColor="+i.pixelColor+"(fragColor);"),1==t.whitewash?s.push("    gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);"):s.push("    gl_FragColor = fragColor;"),s.push("}"),1==t.logScripts&&SceneJS_loggingModule.info(s),s}},SceneJS_DrawListRenderer=function(e){this._canvas=e.canvas,this._context=e.context,this.pickNameStates=[],this._callCtx={};var t=this;this._queryFacade={_node:null,_setNode:function(e){this._node=e,this._mem={}},getCameraMatrix:function(){return this._mem.camMat?this._mem.camMat:this._mem.camMat=this._node.projXFormState.mat},getViewMatrix:function(){return this._mem.viewMat?this._mem.viewMat:this._mem.viewMat=this._node.viewXFormState.mat},getModelMatrix:function(){return this._mem.modelMat?this._mem.modelMat:this._mem.modelMat=this._node.modelXFormState.mat},getCanvasPos:function(e){this.getProjPos(e),this._mem.canvasWidth||(this._mem.canvasWidth=t._canvas.width,this._mem.canvasHeight=t._canvas.height);var n=this._mem.pc,i=.5*n[0]/n[3]*this._mem.canvasWidth,r=.5*n[1]/n[3]*this._mem.canvasHeight;return this._mem.canvasPos={x:i+.5*t._canvas.width,y:this._mem.canvasHeight-r-.5*this._mem.canvasHeight}},getCameraPos:function(e){return this.getProjPos(e),this._mem.camPos=SceneJS_math_normalizeVec3(this._mem.pc,[0,0,0]),{x:this._mem.camPos[0],y:this._mem.camPos[1],z:this._mem.camPos[2]}
},getProjPos:function(e){return this.getViewPos(e),this._mem.pc=SceneJS_math_transformPoint3(this._node.projXFormState.mat,this._mem.vc),{x:this._mem.pc[0],y:this._mem.pc[1],z:this._mem.pc[2],w:this._mem.pc[3]}},getViewPos:function(e){return this.getWorldPos(e),this._mem.vc=SceneJS_math_transformPoint3(this._node.viewXFormState.mat,this._mem.wc),{x:this._mem.vc[0],y:this._mem.vc[1],z:this._mem.vc[2],w:this._mem.vc[3]}},getWorldPos:function(e){return this._mem.wc=SceneJS_math_transformPoint3(this._node.modelXFormState.mat,e||[0,0,0]),{x:this._mem.wc[0],y:this._mem.wc[1],z:this._mem.wc[2],w:this._mem.wc[3]}}},this.init=function(e){e=e||{},this._picking=e.picking,this._rayPicking=e.rayPick,this._callListDirty=e.callListDirty,this._callFuncsDirty=e.callFuncsDirty,this._program=null,this._lastFramebuf=null,this._lastFlagsState=null,this._lastRendererState=null,this._lastRenderListenersState=null,this._pickIndex=0,this._callCtx.picking=this._picking,this._callCtx.rayPicking=this._rayPicking,this._callCtx.lastFrameBuf=null,this._callCtx.lastRendererProps=null,this._callCtx.lastFlagsState=null,this.stateSortProfile={numTextures:0,numGeometries:0}},this.createCall=function(e){this._picking?this._node.__pickCallList[this._node.__pickCallListLen++]=e:this._node.__drawCallList[this._node.__drawCallListLen++]=e,e()},this.renderNode=function(e){var i=null;if(SceneJS_GC_Hooks.renderNodeHook){var r=SceneJS_GC_Hooks.renderNodeHook(e,this);if(!r)return;i=r.gcDrawFunction}var o,a,s;if(this._picking||this._rayPicking){if(!this._callListDirty&&!this._callFuncsDirty){var l=e.__pickCallList;for(o=0,a=e.__pickCallListLen;a>o;o++)l[o]();return SceneJS_GC_Hooks.postRenderNodeHook&&SceneJS_GC_Hooks.postRenderNodeHook(e),void 0}e.__pickCallList||(e._pickCallFuncs=e._pickCallFuncs||{},e.__pickCallList=[]),e.__pickCallListLen=0,this._callFuncsDirty&&(e._pickCallFuncs={})}else{if(this._queryFacade._setNode(e),!this._callListDirty&&!this._callFuncsDirty){var c=e.__drawCallList;for(o=0,a=e.__drawCallListLen;a>o;o++)c[o]();return SceneJS_GC_Hooks.postRenderNodeHook&&SceneJS_GC_Hooks.postRenderNodeHook(e),void 0}e.__drawCallList||(e._drawCallFuncs=e._drawCallFuncs||{},e.__drawCallList=[]),e.__drawCallListLen=0,this._callFuncsDirty&&(e._drawCallFuncs={})}this._node=e,this._callFuncs=this._picking?e._pickCallFuncs:e._drawCallFuncs;var u=e.flagsState,d=e.geoState;if(this._program&&e.program.id==this._lastProgramId||(this._program=this._picking?e.program.pick:e.program.render,this.stateSortProfile&&this._program.setProfile(this.profile),this._picking?this.createCall(this._callFuncs.pickShader||(this._callFuncs.pickShader=function(){var n,i=e.program.pick,r=t._context,o=t._callCtx;return function(){o.program&&o.program.unbind(),i.bind(),n||(n=i.getUniformLocation("SCENEJS_uRayPickMode")),r.uniform1i(n,!!o.rayPicking),o.program=i}}())):this.createCall(this._callFuncs.renderShader||(this._callFuncs.renderShader=function(){var n=e.program.render,i=t._callCtx;return function(){i.program&&i.program.unbind(),n.bind(),i.program=n}}())),this._lastProgramId=e.program.id,this._lastShaderStateId=-1,this._lastShaderParamsStateId=-1,this._lastGeoStateId=-1,this._lastFlagsStateId=-1,this._lastColortransStateId=-1,this._lastLightStateId=-1,this._lastClipStateId=-1,this._lastMorphStateId=-1,this._lastTexStateId=-1,this._lastMaterialStateId=-1,this._lastViewXFormStateId=-1,this._lastModelXFormStateId=-1,this._lastProjXFormStateId=-1,this._lastPickStateId=-1,this._lastFramebufStateId=-1,this._lastRenderListenersStateId=-1,e.shaderState.shader&&e.shaderState.shader.paramsStack&&this._lastShaderStateId!=e.shaderState._stateId&&(this.createCall(this._callFuncs.shader||(this._callFuncs.shader=function(){var n=t._program,i=e.shaderState.shader.paramsStack;return function(){for(var e,t,r=0,o=i.length;o>r;r++){e=i[r];for(t in e)e.hasOwnProperty(t)&&n.setUniform(t,e[t])}}}())),this._lastShaderStateId=e.shaderState._stateId)),e.shaderParamsState.paramsStack&&this._lastShaderParamsStateId!=e.shaderParamsState._stateId&&(this.createCall(this._callFuncs.shaderParams||(this._callFuncs.shaderParams=function(){var n=t._program,i=e.shaderParamsState.paramsStack;return function(){for(var e,t,r=0,o=i.length;o>r;r++){e=i[r];for(t in e)e.hasOwnProperty(t)&&n.setUniform(t,e[t])}}}())),this._lastShaderParamsStateId=e.shaderParamsState._stateId),this._lastFrameBuf&&this._lastFramebufStateId==e.frameBufState._stateId||(this.createCall(this._callFuncs.frameBuf||(this._callFuncs.frameBuf=function(){var n=t._context,i=t._callCtx,r=e.frameBufState.frameBuf;return function(){i.lastFrameBuf&&(n.finish(),i.lastFrameBuf.unbind()),r&&r.bind(),i.lastFrameBuf=r}}())),this._lastFramebufStateId=e.frameBufState._stateId),!this._picking){if(e.texState._stateId!=this._lastTexStateId){var h=e.texState.core;h&&this.createCall(this._callFuncs.texture||(this._callFuncs.texture=function(){for(var e=t._program,n=h.layers.length,i=h.layers,r=[],o=0;n>o;o++)r.push({texSamplerName:"SCENEJS_uSampler"+o,texMatrixName:"SCENEJS_uLayer"+o+"Matrix",texBlendFactorName:"SCENEJS_uLayer"+o+"BlendFactor"});return function(){for(var t,o,a=0,s=n;s>a;a++)t=i[a],o=r[a],t.texture&&(e.bindTexture(o.texSamplerName,t.texture,a),t.matrixAsArray&&e.setUniform(o.texMatrixName,t.matrixAsArray),e.setUniform(o.texBlendFactorName,t.blendFactor))}}()))}this._lastTexStateId=e.texState._stateId}if(d._stateId!=this._lastGeoStateId||e.morphState.morph&&e.morphState._stateId!=this._lastMorphStateId){this.createCall(this._callFuncs.unbindVBOs||(this._callFuncs.unbindVBOs=function(){var e=t._context;return function(){for(var t=0;8>t;t++)e.disableVertexAttribArray(t)}}()));var p=!1,f=!1,m=!1;e.morphState.morph&&e.morphState._stateId!=this._lastMorphStateId&&(this.createCall(this._callFuncs.morph||(this._callFuncs.morph=function(){var n=t._program,i=t._context,r=n.getAttribute("SCENEJS_aVertex"),o=n.getAttribute("SCENEJS_aMorphVertex"),a=n.getAttribute("SCENEJS_aNormal"),s=n.getAttribute("SCENEJS_aMorphNormal"),l=n.getAttribute("SCENEJS_aMorphUVCoord"),c=n.getUniformLocation("SCENEJS_uMorphFactor"),u=e.morphState.morph;return function(){var e=u.targets[u.key1],t=u.targets[u.key2];r&&(r.bindFloatArrayBuffer(e.vertexBuf),o.bindFloatArrayBuffer(t.vertexBuf),p=!0),s?(a.bindFloatArrayBuffer(e.normalBuf),s.bindFloatArrayBuffer(t.normalBuf),f=!0):a&&e.normalBuf&&(a.bindFloatArrayBuffer(e.normalBuf),f=!0),l&&e.uvBuf&&(n.bindFloatArrayBuffer(e.uvBuf),n.bindFloatArrayBuffer(t.uvBuf),m=!0),c&&i.uniform1f(c,u.factor)}}())),this._lastMorphStateId=e.morphState._stateId),this.createCall(this._callFuncs.geo||(this._callFuncs.geo=function(){var e=t._program,n=d.geo,i=n.vertexBuf,r=n.normalBuf,o=n.colorBuf,a=!p&&i?e.getAttribute("SCENEJS_aVertex"):void 0,s=!f&&r?e.getAttribute("SCENEJS_aNormal"):void 0,l=o?e.getAttribute("SCENEJS_aVertexColor"):void 0;return function(){a&&a.bindFloatArrayBuffer(i),s&&s.bindFloatArrayBuffer(r),l&&l.bindFloatArrayBuffer(o)}}())),this._picking||e.texState&&e.texState.core&&e.texState.core.layers.length>0&&this.createCall(this._callFuncs.uvs||(this._callFuncs.uvs=function(){var e=t._program,n=d.geo,i=n.uvBuf,r=n.uvBuf2,o=i?e.getAttribute("SCENEJS_aUVCoord"):void 0,a=i?e.getAttribute("SCENEJS_aUVCoord2"):void 0;return function(){o&&o.bindFloatArrayBuffer(i),a&&a.bindFloatArrayBuffer(r)}}())),this.createCall(this._callFuncs.ibo||(this._callFuncs.ibo=function(){var e=d.geo.indexBuf;return function(){e.bind()}}())),this.stateSortProfile.numGeometries++,this._lastGeoStateId=d._stateId}if(this._lastRendererState&&e.rendererState._stateId==this._lastRendererState._stateId||(this.createCall(this._callFuncs.bindProps||(this._callFuncs.bindProps=function(){var n=t._context,i=t._callCtx,r=e.rendererState;return function(){i.lastRendererProps&&i.lastRendererProps.restoreProps(n),r.props&&r.props.setProps(n),i.lastRendererProps=r.props}}())),this.createCall(this._callFuncs.ambient||(this._callFuncs.ambient=function(){var n=t._context,i=t._program,r=e.rendererState,o=[0,0,0],a=i.getUniformLocation("SCENEJS_uAmbientColor");return function(){if(a){var e=r.props;if(e&&e.clearColor){var t=e.clearColor;n.uniform3fv(a,[t.r,t.g,t.b])}else n.uniform3fv(a,o)}}}())),this._lastRendererState=e.rendererState),e.viewXFormState._stateId!=this._lastViewXFormStateId&&(this.createCall(this._callFuncs.lookAt||(this._callFuncs.lookAt=function(){var n=t._program,i=t._context,r=e.viewXFormState,o=n.getUniformLocation("SCENEJS_uVMatrix"),a=n.getUniformLocation("SCENEJS_uVNMatrix"),s=n.getUniformLocation("SCENEJS_uWorldEye");return function(){var e=r.mat,t=r.normalMat,n=r.lookAt;o&&i.uniformMatrix4fv(o,i.FALSE,e),a&&i.uniformMatrix4fv(a,i.FALSE,t),s&&i.uniform3fv(s,n.eye)}}())),this._lastViewXFormStateId=e.viewXFormState._stateId),e.modelXFormState._stateId!=this._lastModelXFormStateId&&(this.createCall(this._callFuncs.modelXF||(this._callFuncs.modelXF=function(){var n=t._program,i=t._context,r=e.modelXFormState,o=n.getUniformLocation("SCENEJS_uMMatrix"),a=n.getUniformLocation("SCENEJS_uMNMatrix");return function(){var e=r.mat,t=r.normalMat;o&&i.uniformMatrix4fv(o,i.FALSE,e),a&&i.uniformMatrix4fv(a,i.FALSE,t)}}())),this._lastModelXFormStateId=e.modelXFormState._stateId),e.projXFormState._stateId!=this._lastProjXFormStateId&&(this.createCall(this._callFuncs.camera||(this._callFuncs.camera=function(){var n=t._program,i=t._context,r=t._callCtx,o=e.projXFormState,a=n.getUniformLocation("SCENEJS_uPMatrix"),s=n.getUniformLocation("SCENEJS_uZNear"),l=n.getUniformLocation("SCENEJS_uZFar");return function(){var e=o.mat,t=o.optics;a&&i.uniformMatrix4fv(a,i.FALSE,e),r.rayPicking&&(l&&i.uniform1f(s,t.near),l&&i.uniform1f(l,t.far))}}())),this._lastProjXFormStateId=e.projXFormState._stateId),e.clipState&&(e.clipState._stateId!=this._lastClipStateId||u._stateId!=this._lastFlagsStateId)){var g=e.clipState.clips;for(s=0,a=g.length;a>s;s++)this.createCall(function(){var e=t._context,n=t._program,i=g[s],r=u.flags,o=n.getUniformLocation("SCENEJS_uClipMode"+s),a=n.getUniformLocation("SCENEJS_uClipNormalAndDist"+s);return function(){o&&a&&(r.clipping===!1?e.uniform1f(o,0):"inside"==i.mode?e.uniform1f(o,2):"outside"==i.mode?e.uniform1f(o,1):e.uniform1f(o,0),e.uniform4fv(a,i.normalAndDist))}}());this._lastClipStateId=e.clipState._stateId}if(this._picking||this._rayPicking||e.colortransState&&e.colortransState.core&&(e.colortransState._stateId!=this._lastColortransStateId||u._stateId!=this._lastFlagsStateId)&&(this.createCall(this._callFuncs.colortrans||(this._callFuncs.colortrans=function(){var n=t._program,i=u.flags,r=e.colortransState.core;return function(){if(i.colortrans===!1)n.setUniform("SCENEJS_uColorTransMode",0);else{var e=r.scale,t=r.add;n.setUniform("SCENEJS_uColorTransMode",1),n.setUniform("SCENEJS_uColorTransScale",[e.r,e.g,e.b,e.a]),n.setUniform("SCENEJS_uColorTransAdd",[t.r,t.g,t.b,t.a]),n.setUniform("SCENEJS_uColorTransSaturation",r.saturation)}}}())),this._lastColortransStateId=e.colortransState._stateId),this._picking||e.materialState&&e.materialState!=this._lastMaterialStateId&&(this.createCall(this._callFuncs.material||(this._callFuncs.material=function(){var n=t._program,i=t._context,r=n.getUniformLocation("SCENEJS_uMaterialBaseColor"),o=n.getUniformLocation("SCENEJS_uMaterialSpecularColor"),a=n.getUniformLocation("SCENEJS_uMaterialSpecular"),s=n.getUniformLocation("SCENEJS_uMaterialShine"),l=n.getUniformLocation("SCENEJS_uMaterialEmit"),c=n.getUniformLocation("SCENEJS_uMaterialAlpha");return function(){var t=e.materialState.material;r&&i.uniform3fv(r,t.baseColor),o&&i.uniform3fv(o,t.specularColor),a&&i.uniform1f(a,t.specular),s&&i.uniform1f(s,t.shine),l&&i.uniform1f(l,t.emit),c&&i.uniform1f(c,t.alpha)}}())),this._lastMaterialStateId=e.materialState._stateId),!this._picking&&e.lightState&&e.lightState._stateId!=this._lastLightStateId){var v=e.lightState.lights;for(s=0,a=v.length;a>s;s++)this.createCall(this._callFuncs["light"+s]||(this._callFuncs["light"+s]=function(){var e=t._program,n=t._context,i=e.getUniformLocation("SCENEJS_uLightColor"+s),r=e.getUniformLocation("SCENEJS_uLightDir"+s),o=e.getUniformLocation("SCENEJS_uLightPos"+s);e.getUniformLocation("SCENEJS_uLightCutOff"+s),e.getUniformLocation("SCENEJS_uLightSpotExpOff"+s),e.getUniformLocation("SCENEJS_uLightAttenuation"+s);var a=v[s];switch(a.mode){case"ambient":return function(){i&&n.uniform3fv(i,a.color)};case"dir":return function(){i&&n.uniform3fv(i,a.color),r&&n.uniform3fv(r,a.worldDir)};case"point":return function(){i&&n.uniform3fv(i,a.color),o&&n.uniform3fv(o,a.worldPos)};case"spot":return function(){}}}()));this._lastLightStateId=e.lightState._stateId}this._picking&&(this._lastNameState&&e.nameState._stateId==this._lastNameState._stateId||(this.createCall(this._callFuncs.name||(this._callFuncs.name=function(){var n=t._program,i=t._context,r=t._callCtx,o=e.nameState,a=n.getUniformLocation("SCENEJS_uPickColor");return function(){if(r.picking&&o.name){t.pickNameStates[t._pickIndex++]=o;var e=255&t._pickIndex>>16,n=255&t._pickIndex>>8,s=255&t._pickIndex;i.uniform3fv(a,[s/255,n/255,e/255])}}}())),this._lastNameState=e.nameState)),this._picking||this._lastRenderListenersState&&e.renderListenersState._stateId==this._lastRenderListenersState._stateId||(this.createCall(this._callFuncs.rendered||(this._callFuncs.rendered=function(){var n=e.renderListenersState.listeners,i=t._queryFacade;return function(){for(var e=n.length-1;e>=0;e--)n[e](i)}}())),this._lastRenderListenersState=e.renderListenersState),this._lastFlagsState&&u._stateId==this._lastFlagsState._stateId||(this.createCall(this._callFuncs.flags||(this._callFuncs.flags=function(){var e=t._context,i=t._program,r=t._callCtx,o=i.getUniformLocation("SCENEJS_uBackfaceTexturing"),a=i.getUniformLocation("SCENEJS_uBackfaceLighting"),s=i.getUniformLocation("SCENEJS_uSpecularLighting"),l=u;return function(){var t=l.flags,i=r.lastFlagsState,c=i?i.flags:null;c&&t.backfaces==c.backfaces||(t.backfaces?e.disable(e.CULL_FACE):e.enable(e.CULL_FACE)),c&&t.frontface==c.frontface||("cw"==t.frontface?e.frontFace(e.CW):e.frontFace(e.CCW)),c&&t.blendFunc==c.blendFunc||(t.blendFunc?e.blendFunc(n(e,t.blendFunc.sfactor||"one"),n(e,t.blendFunc.dfactor||"zero")):SceneJS_GC_Hooks.compareMode?e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ZERO,e.ONE):e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA)),e.uniform1i(o,void 0==t.backfaceTexturing?!0:!!t.backfaceTexturing),e.uniform1i(a,void 0==t.backfaceLighting?!0:!!t.backfaceLighting),e.uniform1i(s,void 0==t.specular?!0:!!t.specular)}}())),this._lastFlagsState=u),i?this.createCall(i):this.createCall(this._callFuncs.draw||(this._callFuncs.draw=function(){var e=t._context,n=d.geo.primitive,i=d.geo.indexBuf.numItems;return function(){e.drawElements(n,i,e.UNSIGNED_SHORT,0)}}())),SceneJS_GC_Hooks.postRenderNodeHook&&SceneJS_GC_Hooks.postRenderNodeHook(e)};var n=function(e,t){if(!t)throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,'Null SceneJS.renderer node config: "'+t+'"');var n=SceneJS_webgl_enumMap[t];if(!n)throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,'Unrecognised SceneJS.renderer node config value: "'+t+'"');var i=e[n];if(!i)throw SceneJS_errorModule.fatalError(SceneJS.errors.WEBGL_UNSUPPORTED_NODE_CONFIG,"This browser's WebGL does not support renderer node config value: \""+t+'"');return i};this.cleanup=function(){this._context.flush();var e=this._callCtx;this._lastRendererState=null,e.lastRendererProps&&e.lastRendererProps.restoreProps(this._context),this._lastFlagsState=null,this._lastFrameBufState=null,this._lastNameState=null,e.lastFrameBuf&&(e.lastFrameBuf.unbind(),e.lastFrameBuf=null),this._lastProgramId=-1,this._program=null}};new(function(){function e(e){var n;if(l>0){n={};for(var i in e)e.hasOwnProperty(i)&&void 0!=e[i]&&(n[i]=c(i))}return e=t(e),{props:e,setProps:function(t){u(t,e)},restoreProps:function(e){n&&d(e,n)}}}function t(e){var t;for(var n in e)e.hasOwnProperty(n)&&(t=e[n],void 0!=t&&null!=t&&(p[n]?e[n]=p[n](null,t):f[n]&&(e[n]=f[n](null,t))));return e}function n(e,t){a[l]=e,s[l]=t,l++,o=!0}function i(){s[l-1],l--,s[l-1],o=!0}var r,o,a=[],s=[],l=0;SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_COMPILING,function(t){l=0,o=!0,r=t.canvas,l=0;var i=e({clear:{depth:!0,color:!0},clearDepth:1,enableDepthTest:!0,enableCullFace:!1,frontFace:"ccw",cullFace:"back",depthFunc:"less",depthRange:{zNear:0,zFar:1},enableScissorTest:!1,viewport:{x:1,y:1,width:r.canvas.width,height:r.canvas.height},wireframe:!1,highlight:!1,enableClip:void 0,enableBlend:!1,blendFunc:{sfactor:"srcAlpha",dfactor:"one"}});u(r.context,i.props),n("__scenejs_default_props",i)}),SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_RENDERING,function(){o&&(l>0?SceneJS_DrawList.setRenderer(a[l-1],s[l-1]):SceneJS_DrawList.setRenderer(),o=!1)});var c=function(e){for(var t,n,i=l-1;i>=0;i--)if(t=s[i].props,n=t[e],void 0!=n&&null!=n)return t[e];return null},u=function(e,t){for(var n in t)if(t.hasOwnProperty(n)){var i=p[n];i&&i(e,t[n])}t.viewport&&f.viewport(e,t.viewport),t.scissor&&f.clear(e,t.scissor),t.clear&&f.clear(e,t.clear)},d=function(e,t){var n;for(var i in t)if(t.hasOwnProperty(i)&&(n=t[i],void 0!=n&&null!=n)){var r=p[i];r&&r(e,n)}t.viewport&&f.viewport(e,t.viewport),t.scissor&&f.clear(e,t.scissor)},h=function(e,t){if(!t)throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,'Null SceneJS.renderer node config: "'+t+'"');var n=SceneJS_webgl_enumMap[t];if(!n)throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,'Unrecognised SceneJS.renderer node config value: "'+t+'"');var i=e[n];if(!i)throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"This browser's WebGL does not support renderer node config value: \""+t+'"');return i},p={enableBlend:function(e,t){return e?(t?e.enable(e.BLEND):e.disable(e.BLEND),void 0):((null==t||void 0==t)&&(t=!1),t)},blendColor:function(e,t){return e?(e.blendColor(t.r,t.g,t.b,t.a),void 0):(t=t||{},{r:t.r||0,g:t.g||0,b:t.b||0,a:void 0==t.a||null==t.a?1:t.a})},blendEquation:function(e,t){return e?(e.blendEquation(e,h(e,t)),void 0):t||"funcAdd"},blendEquationSeparate:function(e,t){return e?(e.blendEquation(h(e,t.rgb),h(e,t.alpha)),void 0):(t=t||{},{rgb:t.rgb||"funcAdd",alpha:t.alpha||"funcAdd"})},blendFunc:function(e,t){return e?(e.blendFunc(h(e,t.sfactor||"srcAlpha"),h(e,t.dfactor||"oneMinusSrcAlpha")),void 0):(t=t||{},{sfactor:t.sfactor||"srcAlpha",dfactor:t.dfactor||"oneMinusSrcAlpha"})},blendFuncSeparate:function(e,t){return e?(e.blendFuncSeparate(h(e,t.srcRGB||"zero"),h(e,t.dstRGB||"zero"),h(e,t.srcAlpha||"zero"),h(e,t.dstAlpha||"zero")),void 0):(t=t||{},{srcRGB:t.srcRGB||"zero",dstRGB:t.dstRGB||"zero",srcAlpha:t.srcAlpha||"zero",dstAlpha:t.dstAlpha||"zero"})},clearColor:function(e,t){return e?(e.clearColor(t.r,t.g,t.b,t.a),void 0):(t=t||{},{r:t.r||0,g:t.g||0,b:t.b||0,a:void 0==t.a||null==t.a?1:t.a})},clearDepth:function(e,t){return e?(e.clearDepth(t),void 0):null==t||void 0==t?1:t},clearStencil:function(e,t){return e?(e.clearStencil(t),void 0):t||0},colorMask:function(e,t){return e?(e.colorMask(t.r,t.g,t.b,t.a),void 0):(t=t||{},{r:t.r||0,g:t.g||0,b:t.b||0,a:void 0==t.a||null==t.a?1:t.a})},enableCullFace:function(e,t){return e?(t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),void 0):t},cullFace:function(e,t){return e?(e.cullFace(h(e,t)),void 0):t||"back"},enableDepthTest:function(e,t){return e?(t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),void 0):((null==t||void 0==t)&&(t=!0),t)},depthFunc:function(e,t){return e?(e.depthFunc(h(e,t)),void 0):t||"less"},enableDepthMask:function(e,t){return e?(e.depthMask(t),void 0):((null==t||void 0==t)&&(t=!0),t)},depthRange:function(e,t){return e?(e.depthRange(t.zNear,t.zFar),void 0):(t=t||{},{zNear:void 0==t.zNear||null==t.zNear?0:t.zNear,zFar:void 0==t.zFar||null==t.zFar?1:t.zFar})},frontFace:function(e,t){return e?(e.frontFace(h(e,t)),void 0):t||"ccw"},lineWidth:function(e,t){return e?(e.lineWidth(t),void 0):t||1},enableScissorTest:function(e,t){return e?(t?e.enable(e.SCISSOR_TEST):(t=!1,e.disable(e.SCISSOR_TEST)),void 0):t}},f={viewport:function(e,t){return e?(e.viewport(t.x,t.y,t.width,t.height),void 0):(t=t||{},{x:t.x||1,y:t.y||1,width:t.width||r.canvas.width,height:t.height||r.canvas.height})},scissor:function(e,t){return e?(e.scissor(t.x,t.y,t.width,t.height),void 0):(t=t||{},{x:t.x||0,y:t.y||0,width:t.width||1,height:t.height||1})},clear:function(e,t){if(SceneJS_GC_Hooks.clearHook&&!SceneJS_GC_Hooks.clearHook(e))return!1;if(!e)return t=t||{};var n;t.color&&(n=e.COLOR_BUFFER_BIT),t.depth&&(n|=e.DEPTH_BUFFER_BIT),t.stencil&&(n|=e.STENCIL_BUFFER_BIT),n&&e.clear(n)}},m=SceneJS.createNodeType("renderer");m.prototype._init=function(e){if(1==this.core._nodeCount)for(var t in e)e.hasOwnProperty(t)&&(this.core[t]=e[t])},m.prototype.setViewport=function(e){this.core.viewport=e?{x:e.x||1,y:e.y||1,width:e.width||1e3,height:e.height||1e3}:void 0},m.prototype.getViewport=function(){return this.core.viewport?{x:this.core.viewport.x,y:this.core.viewport.y,width:this.core.viewport.width,height:this.core.viewport.height}:void 0},m.prototype.setScissor=function(e){this.core.scissor=e?{x:e.x||1,y:e.y||1,width:e.width||1e3,height:e.height||1e3}:void 0},m.prototype.getScissor=function(){return this.core.scissor?{x:this.core.scissor.x,y:this.core.scissor.y,width:this.core.scissor.width,height:this.core.scissor.height}:void 0},m.prototype.setClear=function(e){this.core.clear=e?{r:e.r||0,g:e.g||0,b:e.b||0}:void 0},m.prototype.getClear=function(){return this.core.clear?{r:this.core.clear.r,g:this.core.clear.g,b:this.core.clear.b}:null},m.prototype.setEnableBlend=function(e){this.core.enableBlend=e},m.prototype.getEnableBlend=function(){return this.core.enableBlend},m.prototype.setBlendColor=function(e){this.core.blendColor=e?{r:e.r||0,g:e.g||0,b:e.b||0,a:void 0==e.a||null==e.a?1:e.a}:void 0},m.prototype.getBlendColor=function(){return this.core.blendColor?{r:this.core.blendColor.r,g:this.core.blendColor.g,b:this.core.blendColor.b,a:this.core.blendColor.a}:void 0},m.prototype.setBlendEquation=function(e){this.core.blendEquation=e},m.prototype.getBlendEquation=function(){return this.core.blendEquation},m.prototype.setBlendEquationSeparate=function(e){this.core.blendEquationSeparate=e?{rgb:e.rgb||"funcAdd",alpha:e.alpha||"funcAdd"}:void 0},m.prototype.getBlendEquationSeparate=function(){return this.core.blendEquationSeparate?{rgb:this.core.rgb,alpha:this.core.alpha}:void 0},m.prototype.setBlendFunc=function(e){this.core.blendFunc=e?{sfactor:e.sfactor||"srcAlpha",dfactor:e.dfactor||"one"}:void 0},m.prototype.getBlendFunc=function(){return this.core.blendFunc?{sfactor:this.core.sfactor,dfactor:this.core.dfactor}:void 0},m.prototype.setBlendFuncSeparate=function(e){this.core.blendFuncSeparate=e?{srcRGB:e.srcRGB||"zero",dstRGB:e.dstRGB||"zero",srcAlpha:e.srcAlpha||"zero",dstAlpha:e.dstAlpha||"zero"}:void 0},m.prototype.getBlendFuncSeparate=function(){return this.core.blendFuncSeparate?{srcRGB:this.core.blendFuncSeparate.srcRGB,dstRGB:this.core.blendFuncSeparate.dstRGB,srcAlpha:this.core.blendFuncSeparate.srcAlpha,dstAlpha:this.core.blendFuncSeparate.dstAlpha}:void 0},m.prototype.setEnableCullFace=function(e){this.core.enableCullFace=e},m.prototype.getEnableCullFace=function(){return this.core.enableCullFace},m.prototype.setCullFace=function(e){this.core.cullFace=e},m.prototype.getCullFace=function(){return this.core.cullFace},m.prototype.setEnableDepthTest=function(e){this.core.enableDepthTest=e},m.prototype.getEnableDepthTest=function(){return this.core.enableDepthTest},m.prototype.setDepthFunc=function(e){this.core.depthFunc=e},m.prototype.getDepthFunc=function(){return this.core.depthFunc},m.prototype.setEnableDepthMask=function(e){this.core.enableDepthMask=e},m.prototype.getEnableDepthMask=function(){return this.core.enableDepthMask},m.prototype.setClearDepth=function(e){this.core.clearDepth=e},m.prototype.getClearDepth=function(){return this.core.clearDepth},m.prototype.setDepthRange=function(e){this.core.depthRange=e?{zNear:void 0==e.zNear||null==e.zNear?0:e.zNear,zFar:void 0==e.zFar||null==e.zFar?1:e.zFar}:void 0},m.prototype.getDepthRange=function(){return this.core.depthRange?{zNear:this.core.depthRange.zNear,zFar:this.core.depthRange.zFar}:void 0},m.prototype.setFrontFace=function(e){this.core.frontFace=e},m.prototype.getFrontFace=function(){return this.core.frontFace},m.prototype.setLineWidth=function(e){this.core.lineWidth=e},m.prototype.getLineWidth=function(){return this.core.lineWidth},m.prototype.setEnableScissorTest=function(e){this.core.enableScissorTest=e},m.prototype.getEnableScissorTest=function(){return this.core.enableScissorTest},m.prototype.setClearStencil=function(e){this.core.clearStencil=e},m.prototype.getClearStencil=function(){return this.core.clearStencil},m.prototype.setColorMask=function(e){this.core.colorMask=e?{r:e.r||0,g:e.g||0,b:e.b||0,a:void 0==e.a||null==e.a?1:e.a}:void 0},m.prototype.getColorMask=function(){return this.core.colorMask?{r:this.core.colorMask.r,g:this.core.colorMask.g,b:this.core.colorMask.b,a:this.core.colorMask.a}:void 0},m.prototype.setWireframe=function(e){this.core.wireframe=e},m.prototype.getWireframe=function(){return this.core.wireframe},m.prototype.setHighlight=function(e){this.core.highlight=e},m.prototype.getHighlight=function(){return this.core.highlight},m.prototype.setEnableClip=function(e){this.core.enableClip=e},m.prototype.getEnableClip=function(){return this.core.enableClip},m.prototype.setEnableFog=function(e){this.core.enableFog=e},m.prototype.getEnableFog=function(){return this.core.enableFog},m.prototype._compile=function(){this._preCompile(),this._compileNodes(),this._postCompile()},m.prototype._preCompile=function(){0==this._compileMemoLevel&&(this._props=e(this.core),this._compileMemoLevel=1),n(this.core.id,this._props)},m.prototype._postCompile=function(){i()}}),function(){var e,t=[],n=[],i=0;SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_COMPILING,function(){i=0,e=!0}),SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_RENDERING,function(){e&&(i>0?SceneJS_DrawList.setFlags(t[i-1],n[i-1]):SceneJS_DrawList.setFlags(),e=!1)});var r=SceneJS.createNodeType("flags");r.prototype._init=function(e){if(1==this.core._nodeCount){if(!e.flags)throw SceneJS_errorModule.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"flags node 'flags' attribute missing ");this.core.flags={},this.setFlags(e.flags)}},r.prototype.setFlags=function(e){SceneJS._apply(e,this.core.flags,!0)},r.prototype.addFlags=function(e){SceneJS._apply(e,this.core.flags)},r.prototype.getFlags=function(){return SceneJS._shallowClone(this.core.flags)},r.prototype._compile=function(){t[i]=this.attr.id,n[i]=this.core.flags,i++,e=!0,this._compileNodes(),i--,e=!0}}(),function(){var e,t=[],n=[],i=0;SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_COMPILING,function(){i=0,e=!0}),SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_RENDERING,function(){e&&(i>0?SceneJS_DrawList.setTag(t[i-1],n[i-1]):SceneJS_DrawList.setTag(),e=!1)});var r=SceneJS.createNodeType("tag");r.prototype._init=function(e){if(1==this.core._nodeCount){if(!e.tag)throw SceneJS_errorModule.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"tag node attribute missing : 'tag'");this.core.tag="enabled",this.setTag(e.tag)}},r.prototype.setTag=function(e){var t=this.core;t.tag=e,t.pattern=null,t.matched=!1},r.prototype.getTag=function(){return this.core.tag},r.prototype._compile=function(){t[i]=this.attr.id,n[i]=this.core,i++,e=!0,this._compileNodes(),i--,e=!0}}();var SceneJS_sceneStatusModule=new function(){this.sceneStatus={};var e=this;SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_CREATED,function(t){e.sceneStatus[t.sceneId]={numLoading:0}}),this.nodeLoading=function(e){this.sceneStatus[e.scene.attr.id].numLoading++},this.nodeLoaded=function(e){this.sceneStatus[e.scene.attr.id].numLoading--}};new(function(){function e(e){document.getElementById(e.canvas.canvasId)&&(e.vertexBuf&&e.vertexBuf.destroy(),e.normalBuf&&e.normalBuf.destroy(),e.indexBuf&&e.indexBuf.destroy(),e.uvBuf&&e.uvBuf.destroy(),e.uvBuf2&&e.uvBuf2.destroy(),e.colorBuf&&e.colorBuf.destroy())}function t(e,t){switch(t){case"points":return e.POINTS;case"lines":return e.LINES;case"line-loop":return e.LINE_LOOP;case"line-strip":return e.LINE_STRIP;case"triangles":return e.TRIANGLES;case"triangle-strip":return e.TRIANGLE_STRIP;case"triangle-fan":return e.TRIANGLE_FAN;default:throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"SceneJS.geometry primitive unsupported: '"+t+"' - supported types are: 'points', 'lines', 'line-loop', "+"'line-strip', 'triangles', 'triangle-strip' and 'triangle-fan'")}}function n(e,t,n,o){if("string"!=typeof t){var a=i(t,o);return a.primitive=t.primitive,r(e,a)}var s=SceneJS.Services.getService(SceneJS.Services.GEO_LOADER_SERVICE_ID);s.loadGeometry(t,function(t){n(r(e,t,o))})}function i(e,t){return{positions:e.positions?new Float32Array(t.scale||t.origin?o(e.positions,t):e.positions):void 0,normals:e.normals?new Float32Array(e.normals):void 0,uv:e.uv?new Float32Array(e.uv):void 0,uv2:e.uv2?new Float32Array(e.uv2):void 0,colors:e.colors?new Float32Array(e.colors):void 0,indices:e.indices?new Int32Array(e.indices):void 0}}function r(e,n){var i=e.canvas.context;if(!n.primitive)throw SceneJS_errorModule.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"SceneJS.geometry node property expected : primitive");var r,o,a,s,l,c,u=i.STATIC_DRAW;try{n.positions&&n.positions.length>0&&(r=new SceneJS_webgl_ArrayBuffer(i,i.ARRAY_BUFFER,n.positions,n.positions.length,3,u)),n.normals&&n.normals.length>0&&(o=new SceneJS_webgl_ArrayBuffer(i,i.ARRAY_BUFFER,n.normals,n.normals.length,3,u)),n.uv&&n.uv.length>0&&n.uv&&(a=new SceneJS_webgl_ArrayBuffer(i,i.ARRAY_BUFFER,n.uv,n.uv.length,2,u)),n.uv2&&n.uv2.length>0&&n.uv2&&(s=new SceneJS_webgl_ArrayBuffer(i,i.ARRAY_BUFFER,n.uv2,n.uv2.length,2,u)),n.colors&&n.colors.length>0&&n.colors&&(l=new SceneJS_webgl_ArrayBuffer(i,i.ARRAY_BUFFER,n.colors,n.colors.length,4,u));var d;n.indices&&n.indices.length>0&&(d=t(i,n.primitive),c=new SceneJS_webgl_ArrayBuffer(i,i.ELEMENT_ARRAY_BUFFER,new Uint16Array(n.indices),n.indices.length,3,u));var h={fixed:!0,primitive:d,scene:e,canvas:e.canvas,context:i,vertexBuf:r,normalBuf:o,indexBuf:c,uvBuf:a,uvBuf2:s,colorBuf:l,arrays:n};return n.positions,h}catch(p){throw r&&r.destroy(),o&&o.destroy(),a&&a.destroy(),s&&s.destroy(),l&&l.destroy(),c&&c.destroy(),p.message="Error during WebGL allocation (scenejs _createGeometry). Probable GPU resource problem. Original message: "+p.message,p}}function o(e,t){var n=e.slice(0);if(t.scale)for(var i=void 0!=t.scale.x?t.scale.x:1,r=void 0!=t.scale.y?t.scale.y:1,o=void 0!=t.scale.z?t.scale.z:1,a=0,s=n.length;s>a;a+=3)n[a+0]*=i,n[a+1]*=r,n[a+2]*=o;if(t.origin)for(var l=void 0!=t.origin.x?t.origin.x:0,c=void 0!=t.origin.y?t.origin.y:0,u=void 0!=t.origin.z?t.origin.z:0,a=0,s=n.length;s>a;a+=3)n[a+0]-=l,n[a+1]-=c,n[a+2]-=u;return n}function a(t){e(t)}function s(e,t){t.vertexBuf||(t=l(t)),t.indexBuf&&SceneJS_DrawList.setGeometry(e,t),u[d++]=t}function l(e){for(var t={primitive:e.primitive,boundary:e.boundary,normalBuf:e.normalBuf,uvBuf:e.uvBuf,uvBuf2:e.uvBuf2,colorBuf:e.colorBuf,indexBuf:e.indexBuf},n=d-1;n>=0;n--)if(u[n].vertexBuf)return t.vertexBuf=u[n].vertexBuf,t.boundary=u[n].boundary,t.normalBuf=u[n].normalBuf,t.uvBuf=u[n].uvBuf,t.uvBuf2=u[n].uvBuf2,t.colorBuf=u[n].colorBuf,t;return t}function c(){d--}var u=[],d=0;SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_CREATED,function(){d=0}),window.SceneJS_geometry=SceneJS.createNodeType("geometry"),SceneJS_geometry.prototype._init=function(e){if(1==this.core._nodeCount){var t={origin:e.origin,scale:e.scale};if(e.create instanceof Function){var i=e.create();SceneJS._apply(n(this.scene,i,null,t),this.core)}else if(e.stream){this._stream=e.stream,this.core._loading=!0;var r=this;n(this.scene,this._stream,function(e){SceneJS._apply(e,r.core),r.core._loading=!1,SceneJS_compileModule.nodeUpdated(r,"loaded")},t)}else{var o={positions:e.positions||[],normals:e.normals||[],colors:e.colors||[],indices:e.indices||[],uv:e.uv||[],uv2:e.uv2||[],primitive:e.primitive||"triangles"};SceneJS._apply(n(this.scene,o,null,t),this.core)}}},SceneJS_geometry.prototype.getStream=function(){return this._stream},SceneJS_geometry.prototype.getPositions=function(){return this._getArrays().positions},SceneJS_geometry.prototype.setPositions=function(e){this.core.vertexBuf.bind(),this.core.vertexBuf.setData(e.positions,e.offset||0)},SceneJS_geometry.prototype.getNormals=function(){return this._getArrays().normals},SceneJS_geometry.prototype.setNormals=function(e){this.core.normalBuf.bind(),this.core.normalBuf.setData(e.normals,e.offset||0)},SceneJS_geometry.prototype.getColors=function(){return this._getArrays().colors
},SceneJS_geometry.prototype.setColors=function(e){this.core.colorBuf.bind(),this.core.colorBuf.setData(e.colors,e.offset||0)},SceneJS_geometry.prototype.getIndices=function(){return this._getArrays().indices},SceneJS_geometry.prototype.getUv=function(){return this._getArrays().uv},SceneJS_geometry.prototype.setUv=function(e){this.core.uvBuf.bind(),this.core.uvBuf.setData(e.uv,e.offset||0)},SceneJS_geometry.prototype.getUv2=function(){return this._getArrays().uv2},SceneJS_geometry.prototype.setUv2=function(e){this.core.uvBuf2.bind(),this.core.uvBuf2.setData(e.uv2,e.offset||0)},SceneJS_geometry.prototype.getPrimitive=function(){return this.attr.primitive},SceneJS_geometry.prototype._getArrays=function(){if(this.attr.positions)return this.attr;if(!this.core)throw SceneJS_errorModule.fatalError(SceneJS.errors.NODE_ILLEGAL_STATE,"Invalid node state exception: geometry stream not loaded yet - can't query geometry data yet");return this.core.arrays},SceneJS_geometry.prototype.getBoundary=function(){if(this._boundary)return this._boundary;var e=this._getArrays().positions;this._boundary={xmin:SceneJS_math_MAX_DOUBLE,ymin:SceneJS_math_MAX_DOUBLE,zmin:SceneJS_math_MAX_DOUBLE,xmax:SceneJS_math_MIN_DOUBLE,ymax:SceneJS_math_MIN_DOUBLE,zmax:SceneJS_math_MIN_DOUBLE};for(var t,n,i,r=0,o=e.length-2;o>r;r+=3)t=e[r],n=e[r+1],i=e[r+2],this._boundary.xmin>t&&(this._boundary.xmin=t),this._boundary.ymin>n&&(this._boundary.ymin=n),this._boundary.zmin>i&&(this._boundary.zmin=i),t>this._boundary.xmax&&(this._boundary.xmax=t),n>this._boundary.ymax&&(this._boundary.ymax=n),i>this._boundary.zmax&&(this._boundary.zmax=i);return this._boundary},SceneJS_geometry.prototype._compile=function(){this.core._loading||s(this.attr.id,this.core),this._compileNodes(),this.core._loading||c()},SceneJS_geometry.prototype._destroy=function(){1==this.core._nodeCount&&(a(this.core),SceneJS_DrawList.removeGeometry(this.scene.attr.id,this.attr.id))}}),function(){function e(){var e=[[-3,1.65,0],[-2.98711,1.65,-.098438],[-2.98711,1.65,.098438],[-2.98538,1.56732,-.049219],[-2.98538,1.56732,.049219],[-2.9835,1.48308,0],[-2.98189,1.72347,-.049219],[-2.98189,1.72347,.049219],[-2.97656,1.79853,0],[-2.9709,1.48621,-.098438],[-2.9709,1.48621,.098438],[-2.96388,1.79534,-.098438],[-2.96388,1.79534,.098438],[-2.96221,1.57017,-.133594],[-2.96221,1.57017,.133594],[-2.95864,1.72057,-.133594],[-2.95864,1.72057,.133594],[-2.95313,1.65,-.16875],[-2.95313,1.65,.16875],[-2.95247,1.40374,-.049219],[-2.95247,1.40374,.049219],[-2.9377,1.49447,-.16875],[-2.9377,1.49447,.16875],[-2.93523,1.85215,-.049219],[-2.93523,1.85215,.049219],[-2.93359,1.32012,0],[-2.93045,1.78693,-.16875],[-2.93045,1.78693,.16875],[-2.93037,1.4115,-.133594],[-2.93037,1.4115,.133594],[-2.92188,1.32553,-.098438],[-2.92188,1.32553,.098438],[-2.91278,1.84417,-.133594],[-2.91278,1.84417,.133594],[-2.90625,1.91016,0],[-2.89423,1.90457,-.098438],[-2.89423,1.90457,.098438],[-2.89138,1.5791,-.196875],[-2.89138,1.5791,.196875],[-2.89099,1.3398,-.16875],[-2.89099,1.3398,.16875],[-2.89065,1.71208,-.196875],[-2.89065,1.71208,.196875],[-2.88346,1.24579,-.048343],[-2.88346,1.24579,.048343],[-2.86346,1.25713,-.132718],[-2.86346,1.25713,.132718],[-2.86266,1.43483,-.196875],[-2.86266,1.43483,.196875],[-2.86255,1.88983,-.16875],[-2.86255,1.88983,.16875],[-2.85,1.65,-.225],[-2.85,1.65,.225],[-2.84971,1.16155,0],[-2.8471,1.82082,-.196875],[-2.8471,1.82082,.196875],[-2.84194,1.94692,-.049219],[-2.84194,1.94692,.049219],[-2.829,1.7614,-.225],[-2.829,1.7614,.225],[-2.82867,1.17598,-.094933],[-2.82867,1.17598,.094933],[-2.8247,1.52194,-.225],[-2.8247,1.52194,.225],[-2.82115,1.9352,-.133594],[-2.82115,1.9352,.133594],[-2.81231,1.18719,-.16875],[-2.81231,1.18719,.16875],[-2.80501,1.28997,-.196875],[-2.80501,1.28997,.196875],[-2.79727,1.38311,-.225],[-2.79727,1.38311,.225],[-2.78906,1.99014,0],[-2.78836,1.69932,-.196875],[-2.78836,1.69932,.196875],[-2.77821,1.98283,-.098438],[-2.77821,1.98283,.098438],[-2.77442,1.52738,-.196875],[-2.77442,1.52738,.196875],[-2.77356,1.0986,-.084375],[-2.77356,1.0986,.084375],[-2.76641,1.84512,-.225],[-2.76641,1.84512,.225],[-2.76034,1.9009,-.196875],[-2.76034,1.9009,.196875],[-2.7496,1.96356,-.16875],[-2.7496,1.96356,.16875],[-2.74831,1.7857,-.196875],[-2.74831,1.7857,.196875],[-2.74688,1.65,-.16875],[-2.74688,1.65,.16875],[-2.73125,1.00781,0],[-2.72756,1.73587,-.16875],[-2.72756,1.73587,.16875],[-2.72036,1.69083,-.133594],[-2.72036,1.69083,.133594],[-2.71948,1.24977,-.225],[-2.71948,1.24977,.225],[-2.71678,1.14468,-.196875],[-2.71678,1.14468,.196875],[-2.71289,1.65,-.098438],[-2.71289,1.65,.098438],[-2.70899,1.54177,-.133594],[-2.70899,1.54177,.133594],[-2.70354,1.42641,-.16875],[-2.70354,1.42641,.16875],[-2.70098,1.03784,-.16875],[-2.70098,1.03784,.16875],[-2.7,1.65,0],[-2.69965,2.01079,-.048346],[-2.69965,2.01079,.048346],[-2.69712,1.68793,-.049219],[-2.69712,1.68793,.049219],[-2.69413,1.72746,-.098438],[-2.69413,1.72746,.098438],[-2.68662,1.54669,-.049219],[-2.68662,1.54669,.049219],[-2.68263,1.76235,-.133594],[-2.68263,1.76235,.133594],[-2.68148,1.99646,-.132721],[-2.68148,1.99646,.132721],[-2.68144,1.72427,0],[-2.67574,1.27085,-.196875],[-2.67574,1.27085,.196875],[-2.67265,1.44068,-.098438],[-2.67265,1.44068,.098438],[-2.67026,1.8004,-.16875],[-2.67026,1.8004,.16875],[-2.6678,1.84623,-.196875],[-2.6678,1.84623,.196875],[-2.66279,1.9051,-.225],[-2.66279,1.9051,.225],[-2.66094,1.44609,0],[-2.66018,1.75437,-.049219],[-2.66018,1.75437,.049219],[-2.63858,1.78567,-.098438],[-2.63858,1.78567,.098438],[-2.63438,1.10391,-.225],[-2.63438,1.10391,.225],[-2.63074,1.95674,-.196875],[-2.63074,1.95674,.196875],[-2.62656,1.78008,0],[-2.625,2.04375,0],[-2.62464,1.30502,-.132813],[-2.62464,1.30502,.132813],[-2.60642,1.31745,-.048438],[-2.60642,1.31745,.048438],[-2.60632,2.02644,-.094945],[-2.60632,2.02644,.094945],[-2.5918,2.01299,-.16875],[-2.5918,2.01299,.16875],[-2.57173,1.83429,-.16875],[-2.57173,1.83429,.16875],[-2.56777,1.16997,-.16875],[-2.56777,1.16997,.16875],[-2.5546,1.18304,-.095315],[-2.5546,1.18304,.095315],[-2.54975,1.89059,-.196875],[-2.54975,1.89059,.196875],[-2.54954,.878984,-.084375],[-2.54954,.878984,.084375],[-2.54643,1.83197,-.132721],[-2.54643,1.83197,.132721],[-2.5375,1.2,0],[-2.52721,1.8192,-.048346],[-2.52721,1.8192,.048346],[-2.51875,1.94531,-.225],[-2.51875,1.94531,.225],[-2.51683,.932671,-.196875],[-2.51683,.932671,.196875],[-2.47184,1.00649,-.196875],[-2.47184,1.00649,.196875],[-2.4457,1.87764,-.16875],[-2.4457,1.87764,.16875],[-2.43913,1.06018,-.084375],[-2.43913,1.06018,.084375],[-2.43118,1.86418,-.094945],[-2.43118,1.86418,.094945],[-2.4125,1.84687,0],[-2.38828,.716602,0],[-2.38225,.737663,-.095854],[-2.38225,.737663,.095854],[-2.37884,2.05202,-.084375],[-2.37884,2.05202,.084375],[-2.37766,.75368,-.16875],[-2.37766,.75368,.16875],[-2.36475,.798761,-.199836],[-2.36475,.798761,.199836],[-2.3543,.835254,-.225],[-2.3543,.835254,.225],[-2.34384,.871747,-.199836],[-2.34384,.871747,.199836],[-2.34115,1.99972,-.196875],[-2.34115,1.99972,.196875],[-2.33093,.916827,-.16875],[-2.33093,.916827,.16875],[-2.32031,.953906,0],[-2.28932,1.92782,-.196875],[-2.28932,1.92782,.196875],[-2.25162,1.87552,-.084375],[-2.25162,1.87552,.084375],[-2.24741,.882285,-.084375],[-2.24741,.882285,.084375],[-2.17363,.844043,0],[-2.16853,.826951,-.097184],[-2.16853,.826951,.097184],[-2.16477,.814364,-.16875],[-2.16477,.814364,.16875],[-2.15688,.786694,-.187068],[-2.15688,.786694,.187068],[-2.15625,2.09297,0],[-2.15412,.74052,-.215193],[-2.15412,.74052,.215193],[-2.15017,.694734,-.215193],[-2.15017,.694734,.215193],[-2.14742,.64856,-.187068],[-2.14742,.64856,.187068],[-2.14496,.612777,-.132948],[-2.14496,.612777,.132948],[-2.14371,.591789,-.048573],[-2.14371,.591789,.048573],[-2.14233,2.05836,-.16875],[-2.14233,2.05836,.16875],[-2.11172,1.98223,-.225],[-2.11172,1.98223,.225],[-2.08447,.789526,-.048905],[-2.08447,.789526,.048905],[-2.0811,1.90609,-.16875],[-2.0811,1.90609,.16875],[-2.07834,.770387,-.13328],[-2.07834,.770387,.13328],[-2.06719,1.87148,0],[-2,.75,0],[-1.9957,.737109,-.098438],[-1.9957,.737109,.098438],[-1.98438,.703125,-.16875],[-1.98438,.703125,.16875],[-1.97852,.59165,0],[-1.96937,.670825,-.202656],[-1.96937,.670825,.202656],[-1.96836,.655078,-.210938],[-1.96836,.655078,.210938],[-1.96,.75,-.4075],[-1.96,.75,.4075],[-1.95873,.925195,-.201561],[-1.95873,.925195,.201561],[-1.95703,1.10039,0],[-1.95,.6,-.225],[-1.95,.6,.225],[-1.93895,.59165,-.403123],[-1.93895,.59165,.403123],[-1.93164,.544922,-.210938],[-1.93164,.544922,.210938],[-1.93069,.522583,-.198676],[-1.93069,.522583,.198676],[-1.92188,.453516,0],[-1.91789,1.10039,-.398745],[-1.91789,1.10039,.398745],[-1.91562,.496875,-.16875],[-1.91562,.496875,.16875],[-1.9043,.462891,-.098438],[-1.9043,.462891,.098438],[-1.9,.45,0],[-1.89228,.670825,-.593047],[-1.89228,.670825,.593047],[-1.88344,.453516,-.391582],[-1.88344,.453516,.391582],[-1.88206,.925195,-.589845],[-1.88206,.925195,.589845],[-1.88139,1.28613,-.193602],[-1.88139,1.28613,.193602],[-1.85512,.522583,-.581402],[-1.85512,.522583,.581402],[-1.845,.75,-.785],[-1.845,.75,.785],[-1.84375,1.47187,0],[-1.83317,1.89068,-.084375],[-1.83317,1.89068,.084375],[-1.8318,1.94649,-.196875],[-1.8318,1.94649,.196875],[-1.82992,2.02323,-.196875],[-1.82992,2.02323,.196875],[-1.82855,2.07904,-.084375],[-1.82855,2.07904,.084375],[-1.82518,.59165,-.776567],[-1.82518,.59165,.776567],[-1.81758,.343945,-.187036],[-1.81758,.343945,.187036],[-1.80775,1.28613,-.566554],[-1.80775,1.28613,.566554],[-1.80687,1.47187,-.375664],[-1.80687,1.47187,.375664],[-1.80536,1.10039,-.768135],[-1.80536,1.10039,.768135],[-1.77293,.453516,-.754336],[-1.77293,.453516,.754336],[-1.75,.234375,0],[-1.74644,.343945,-.547339],[-1.74644,.343945,.547339],[-1.74433,.670825,-.949871],[-1.74433,.670825,.949871],[-1.73491,.925195,-.944741],[-1.73491,.925195,.944741],[-1.715,.234375,-.356563],[-1.715,.234375,.356562],[-1.71008,.522583,-.931218],[-1.71008,.522583,.931218],[-1.70086,1.47187,-.723672],[-1.70086,1.47187,.723672],[-1.6664,1.28613,-.907437],[-1.6664,1.28613,.907437],[-1.6625,.75,-1.125],[-1.6625,.75,1.125],[-1.65516,1.86094,-.170322],[-1.65516,1.86094,.170322],[-1.64742,.159961,-.169526],[-1.64742,.159961,.169526],[-1.64464,.59165,-1.11292],[-1.64464,.59165,1.11292],[-1.62678,1.10039,-1.10083],[-1.62678,1.10039,1.10083],[-1.61437,.234375,-.686875],[-1.61437,.234375,.686875],[-1.60989,.343945,-.87666],[-1.60989,.343945,.87666],[-1.6,1.875,0],[-1.59756,.453516,-1.08106],[-1.59756,.453516,1.08106],[-1.59037,1.86094,-.498428],[-1.59037,1.86094,.498428],[-1.58438,1.91016,-.16875],[-1.58438,1.91016,.16875],[-1.58294,.159961,-.496099],[-1.58294,.159961,.496099],[-1.57813,.085547,0],[-1.55,1.9875,-.225],[-1.55,1.9875,.225],[-1.54656,.085547,-.321543],[-1.54656,.085547,.321543],[-1.53297,.670825,-1.26567],[-1.53297,.670825,1.26567],[-1.53262,1.47187,-1.03711],[-1.53262,1.47187,1.03711],[-1.52469,.925195,-1.25883],[-1.52469,.925195,1.25883],[-1.52367,.042773,-.156792],[-1.52367,.042773,.156792],[-1.51563,2.06484,-.16875],[-1.51563,2.06484,.16875],[-1.50287,.522583,-1.24081],[-1.50287,.522583,1.24081],[-1.5,0,0],[-1.5,2.1,0],[-1.5,2.25,0],[-1.47,0,-.305625],[-1.47,0,.305625],[-1.47,2.25,-.305625],[-1.47,2.25,.305625],[-1.46602,1.86094,-.79832],[-1.46602,1.86094,.79832],[-1.46449,1.28613,-1.20912],[-1.46449,1.28613,1.20912],[-1.46403,.042773,-.458833],[-1.46403,.042773,.458833],[-1.45986,2.28691,-.150226],[-1.45986,2.28691,.150226],[-1.45917,.159961,-.79459],[-1.45917,.159961,.79459],[-1.45582,.085547,-.619414],[-1.45582,.085547,.619414],[-1.45469,.234375,-.984375],[-1.45469,.234375,.984375],[-1.44922,2.32383,0],[-1.42023,2.32383,-.295278],[-1.42023,2.32383,.295278],[-1.42,.75,-1.42],[-1.42,.75,1.42],[-1.41482,.343945,-1.16812],[-1.41482,.343945,1.16812],[-1.41191,2.33613,-.145291],[-1.41191,2.33613,.145291],[-1.40475,.59165,-1.40475],[-1.40475,.59165,1.40475],[-1.40313,2.34844,0],[-1.40272,2.28691,-.439618],[-1.40272,2.28691,.439618],[-1.4,2.25,0],[-1.38949,1.10039,-1.38949],[-1.38949,1.10039,1.38949],[-1.38375,0,-.58875],[-1.38375,0,.58875],[-1.38375,2.25,-.58875],[-1.38375,2.25,.58875],[-1.38047,2.32383,0],[-1.37788,2.33613,-.141789],[-1.37788,2.33613,.141789],[-1.37633,2.28691,-.14163],[-1.37633,2.28691,.14163],[-1.37506,2.34844,-.285887],[-1.37506,2.34844,.285887],[-1.372,2.25,-.28525],[-1.372,2.25,.28525],[-1.36453,.453516,-1.36453],[-1.36453,.453516,1.36453],[-1.35665,2.33613,-.425177],[-1.35665,2.33613,.425177],[-1.35286,2.32383,-.281271],[-1.35286,2.32383,.281271],[-1.34957,.042773,-.734902],[-1.34957,.042773,.734902],[-1.3369,2.32383,-.568818],[-1.3369,2.32383,.568818],[-1.32395,2.33613,-.414929],[-1.32395,2.33613,.414929],[-1.32246,2.28691,-.414464],[-1.32246,2.28691,.414464],[-1.31182,.085547,-.887695],[-1.31182,.085547,.887695],[-1.30906,1.47187,-1.30906],[-1.30906,1.47187,1.30906],[-1.3,2.25,0],[-1.29438,2.34844,-.550727],[-1.29438,2.34844,.550727],[-1.29305,2.28691,-.704126],[-1.29305,2.28691,.704126],[-1.2915,2.25,-.5495],[-1.2915,2.25,.5495],[-1.28839,1.86094,-1.06373],[-1.28839,1.86094,1.06373],[-1.28237,.159961,-1.05876],[-1.28237,.159961,1.05876],[-1.274,2.25,-.264875],[-1.274,2.25,.264875],[-1.27348,2.32383,-.541834],[-1.27348,2.32383,.541834],[-1.26766,2.2749,-.130448],[-1.26766,2.2749,.130448],[-1.26567,.670825,-1.53297],[-1.26567,.670825,1.53297],[-1.26094,2.2998,0],[-1.25883,.925195,-1.52469],[-1.25883,.925195,1.52469],[-1.25057,2.33613,-.680997],[-1.25057,2.33613,.680997],[-1.24688,0,-.84375],[-1.24688,0,.84375],[-1.24688,2.25,-.84375],[-1.24688,2.25,.84375],[-1.2425,.234375,-1.2425],[-1.2425,.234375,1.2425],[-1.24081,.522583,-1.50287],[-1.24081,.522583,1.50287],[-1.23572,2.2998,-.256916],[-1.23572,2.2998,.256916],[-1.22043,2.33613,-.664583],[-1.22043,2.33613,.664583],[-1.21906,2.28691,-.663837],[-1.21906,2.28691,.663837],[-1.21805,2.2749,-.38174],[-1.21805,2.2749,.38174],[-1.20912,1.28613,-1.46449],[-1.20912,1.28613,1.46449],[-1.20466,2.32383,-.815186],[-1.20466,2.32383,.815186],[-1.19925,2.25,-.51025],[-1.19925,2.25,.51025],[-1.19651,2.31943,-.123125],[-1.19651,2.31943,.123125],[-1.18604,.042773,-.979229],[-1.18604,.042773,.979229],[-1.16812,.343945,-1.41482],[-1.16812,.343945,1.41482],[-1.16635,2.34844,-.789258],[-1.16635,2.34844,.789258],[-1.16375,2.25,-.7875],[-1.16375,2.25,.7875],[-1.16322,2.2998,-.494918],[-1.16322,2.2998,.494918],[-1.15625,2.33906,0],[-1.14968,2.31943,-.360312],[-1.14968,2.31943,.360312],[-1.14752,2.32383,-.776514],[-1.14752,2.32383,.776514],[-1.13637,2.28691,-.93822],[-1.13637,2.28691,.93822],[-1.13312,2.33906,-.235586],[-1.13312,2.33906,.235586],[-1.125,.75,-1.6625],[-1.125,.75,1.6625],[-1.12281,2.2749,-.611424],[-1.12281,2.2749,.611424],[-1.12047,.085547,-1.12047],[-1.12047,.085547,1.12047],[-1.11292,.59165,-1.64464],[-1.11292,.59165,1.64464],[-1.10083,1.10039,-1.62678],[-1.10083,1.10039,1.62678],[-1.09904,2.33613,-.907402],[-1.09904,2.33613,.907402],[-1.08106,.453516,-1.59756],[-1.08106,.453516,1.59756],[-1.08063,2.25,-.73125],[-1.08063,2.25,.73125],[-1.07255,2.33613,-.885531],[-1.07255,2.33613,.885531],[-1.07135,2.28691,-.884537],[-1.07135,2.28691,.884537],[-1.06664,2.33906,-.453828],[-1.06664,2.33906,.453828],[-1.065,0,-1.065],[-1.065,0,1.065],[-1.065,2.25,-1.065],[-1.065,2.25,1.065],[-1.06373,1.86094,-1.28839],[-1.06373,1.86094,1.28839],[-1.05979,2.31943,-.577104],[-1.05979,2.31943,.577104],[-1.05876,.159961,-1.28237],[-1.05876,.159961,1.28237],[-1.04815,2.2998,-.709277],[-1.04815,2.2998,.709277],[-1.03711,1.47187,-1.53262],[-1.03711,1.47187,1.53262],[-1.02894,2.32383,-1.02894],[-1.02894,2.32383,1.02894],[-.996219,2.34844,-.996219],[-.996219,2.34844,.996219],[-.994,2.25,-.994],[-.994,2.25,.994],[-.986761,2.2749,-.814698],[-.986761,2.2749,.814698],[-.984375,.234375,-1.45469],[-.984375,.234375,1.45469],[-.980719,2.36953,-.10092],[-.980719,2.36953,.10092],[-.980133,2.32383,-.980133],[-.980133,2.32383,.980133],[-.979229,.042773,-1.18604],[-.979229,.042773,1.18604],[-.961133,2.33906,-.650391],[-.961133,2.33906,.650391],[-.949871,.670825,-1.74433],[-.949871,.670825,1.74433],[-.944741,.925195,-1.73491],[-.944741,.925195,1.73491],[-.942332,2.36953,-.29533],[-.942332,2.36953,.29533],[-.93822,2.28691,-1.13637],[-.93822,2.28691,1.13637],[-.931373,2.31943,-.768968],[-.931373,2.31943,.768968],[-.931218,.522583,-1.71008],[-.931218,.522583,1.71008],[-.923,2.25,-.923],[-.923,2.25,.923],[-.907437,1.28613,-1.6664],[-.907437,1.28613,1.6664],[-.907402,2.33613,-1.09904],[-.907402,2.33613,1.09904],[-.895266,2.2998,-.895266],[-.895266,2.2998,.895266],[-.887695,.085547,-1.31182],[-.887695,.085547,1.31182],[-.885531,2.33613,-1.07255],[-.885531,2.33613,1.07255],[-.884537,2.28691,-1.07135],[-.884537,2.28691,1.07135],[-.87666,.343945,-1.60989],[-.87666,.343945,1.60989],[-.868654,2.36953,-.473023],[-.868654,2.36953,.473023],[-.84375,0,-1.24688],[-.84375,0,1.24688],[-.84375,2.25,-1.24688],[-.84375,2.25,1.24688],[-.825,2.4,0],[-.820938,2.33906,-.820938],[-.820938,2.33906,.820938],[-.815186,2.32383,-1.20466],[-.815186,2.32383,1.20466],[-.814698,2.2749,-.986761],[-.814698,2.2749,.986761],[-.8085,2.4,-.168094],[-.8085,2.4,.168094],[-.79832,1.86094,-1.46602],[-.79832,1.86094,1.46602],[-.79459,.159961,-1.45917],[-.79459,.159961,1.45917],[-.789258,2.34844,-1.16635],[-.789258,2.34844,1.16635],[-.7875,2.25,-1.16375],[-.7875,2.25,1.16375],[-.785,.75,-1.845],[-.785,.75,1.845],[-.776567,.59165,-1.82518],[-.776567,.59165,1.82518],[-.776514,2.32383,-1.14752],[-.776514,2.32383,1.14752],[-.768968,2.31943,-.931373],[-.768968,2.31943,.931373],[-.768135,1.10039,-1.80536],[-.768135,1.10039,1.80536],[-.7634,2.36953,-.630285],[-.7634,2.36953,.630285],[-.761063,2.4,-.323813],[-.761063,2.4,.323813],[-.754336,.453516,-1.77293],[-.754336,.453516,1.77293],[-.734902,.042773,-1.34957],[-.734902,.042773,1.34957],[-.73125,2.25,-1.08063],[-.73125,2.25,1.08063],[-.723672,1.47187,-1.70086],[-.723672,1.47187,1.70086],[-.709277,2.2998,-1.04815],[-.709277,2.2998,1.04815],[-.704126,2.28691,-1.29305],[-.704126,2.28691,1.29305],[-.686875,.234375,-1.61437],[-.686875,.234375,1.61437],[-.685781,2.4,-.464063],[-.685781,2.4,.464063],[-.680997,2.33613,-1.25057],[-.680997,2.33613,1.25057],[-.664583,2.33613,-1.22043],[-.664583,2.33613,1.22043],[-.663837,2.28691,-1.21906],[-.663837,2.28691,1.21906],[-.650391,2.33906,-.961133],[-.650391,2.33906,.961133],[-.631998,2.43047,-.064825],[-.631998,2.43047,.064825],[-.630285,2.36953,-.7634],[-.630285,2.36953,.7634],[-.619414,.085547,-1.45582],[-.619414,.085547,1.45582],[-.611424,2.2749,-1.12281],[-.611424,2.2749,1.12281],[-.607174,2.43047,-.190548],[-.607174,2.43047,.190548],[-.593047,.670825,-1.89228],[-.593047,.670825,1.89228],[-.589845,.925195,-1.88206],[-.589845,.925195,1.88206],[-.58875,0,-1.38375],[-.58875,0,1.38375],[-.58875,2.25,-1.38375],[-.58875,2.25,1.38375],[-.58575,2.4,-.58575],[-.58575,2.4,.58575],[-.581402,.522583,-1.85512],[-.581402,.522583,1.85512],[-.577104,2.31943,-1.05979],[-.577104,2.31943,1.05979],[-.568818,2.32383,-1.3369],[-.568818,2.32383,1.3369],[-.566554,1.28613,-1.80775],[-.566554,1.28613,1.80775],[-.559973,2.43047,-.304711],[-.559973,2.43047,.304711],[-.550727,2.34844,-1.29438],[-.550727,2.34844,1.29438],[-.5495,2.25,-1.2915],[-.5495,2.25,1.2915],[-.547339,.343945,-1.74644],[-.547339,.343945,1.74644],[-.541834,2.32383,-1.27348],[-.541834,2.32383,1.27348],[-.51025,2.25,-1.19925],[-.51025,2.25,1.19925],[-.498428,1.86094,-1.59037],[-.498428,1.86094,1.59037],[-.496099,.159961,-1.58294],[-.496099,.159961,1.58294],[-.494918,2.2998,-1.16322],[-.494918,2.2998,1.16322],[-.491907,2.43047,-.40641],[-.491907,2.43047,.40641],[-.473023,2.36953,-.868654],[-.473023,2.36953,.868654],[-.464063,2.4,-.685781],[-.464063,2.4,.685781],[-.458833,.042773,-1.46403],[-.458833,.042773,1.46403],[-.45625,2.46094,0],[-.453828,2.33906,-1.06664],[-.453828,2.33906,1.06664],[-.439618,2.28691,-1.40272],[-.439618,2.28691,1.40272],[-.438241,2.46094,-.091207],[-.438241,2.46094,.091207],[-.425177,2.33613,-1.35665],[-.425177,2.33613,1.35665],[-.420891,2.46094,-.179078],[-.420891,2.46094,.179078],[-.414929,2.33613,-1.32395],[-.414929,2.33613,1.32395],[-.414464,2.28691,-1.32246],[-.414464,2.28691,1.32246],[-.4075,.75,-1.96],[-.4075,.75,1.96],[-.40641,2.43047,-.491907],[-.40641,2.43047,.491907],[-.403123,.59165,-1.93895],[-.403123,.59165,1.93895],[-.398745,1.10039,-1.91789],[-.398745,1.10039,1.91789],[-.391582,.453516,-1.88344],[-.391582,.453516,1.88344],[-.38174,2.2749,-1.21805],[-.38174,2.2749,1.21805],[-.375664,1.47187,-1.80687],[-.375664,1.47187,1.80687],[-.372159,2.46094,-.251889],[-.372159,2.46094,.251889],[-.362109,2.89717,0],[-.360312,2.31943,-1.14968],[-.360312,2.31943,1.14968],[-.356563,.234375,1.715],[-.356562,.234375,-1.715],[-.340625,2.95078,0],[-.337859,2.92397,-.069278],[-.337859,2.92397,.069278],[-.334238,2.89717,-.142705],[-.334238,2.89717,.142705],[-.330325,2.86421,-.067672],[-.330325,2.86421,.067672],[-.325,2.83125,0],[-.323938,2.46094,-.323938],[-.323938,2.46094,.323938],[-.323813,2.4,-.761063],[-.323813,2.4,.761063],[-.321543,.085547,-1.54656],[-.321543,.085547,1.54656],[-.31541,2.50547,-.064395],[-.31541,2.50547,.064395],[-.314464,2.95078,-.134407],[-.314464,2.95078,.134407],[-.305625,0,-1.47],[-.305625,0,1.47],[-.305625,2.25,-1.47],[-.305625,2.25,1.47],[-.304711,2.43047,-.559973],[-.304711,2.43047,.559973],[-.299953,2.83125,-.127984],[-.299953,2.83125,.127984],[-.29533,2.36953,-.942332],[-.29533,2.36953,.942332],[-.295278,2.32383,-1.42023],[-.295278,2.32383,1.42023],[-.287197,2.92397,-.1943],[-.287197,2.92397,.1943],[-.285887,2.34844,-1.37506],[-.285887,2.34844,1.37506],[-.28525,2.25,-1.372],[-.28525,2.25,1.372],[-.281271,2.32383,-1.35286],[-.281271,2.32383,1.35286],[-.280732,2.86421,-.189856],[-.280732,2.86421,.189856],[-.274421,2.9688,-.05638],[-.274421,2.9688,.05638],[-.267832,2.50547,-.180879],[-.267832,2.50547,.180879],[-.264875,2.25,-1.274],[-.264875,2.25,1.274],[-.25761,2.89717,-.25761],[-.25761,2.89717,.25761],[-.256916,2.2998,-1.23572],[-.256916,2.2998,1.23572],[-.251889,2.46094,-.372159],[-.251889,2.46094,.372159],[-.250872,2.75742,-.051347],[-.250872,2.75742,.051347],[-.242477,2.95078,-.242477],[-.242477,2.95078,.242477],[-.235586,2.33906,-1.13312],[-.235586,2.33906,1.13312],[-.233382,2.9688,-.158018],[-.233382,2.9688,.158018],[-.231125,2.83125,-.231125],[-.231125,2.83125,.231125],[-.230078,2.98682,0],[-.213159,2.75742,-.144103],[-.213159,2.75742,.144103],[-.212516,2.98682,-.091113],[-.212516,2.98682,.091113],[-.202656,.670825,-1.96937],[-.202656,.670825,1.96937],[-.201561,.925195,-1.95873],[-.201561,.925195,1.95873],[-.2,2.55,0],[-.198676,.522583,-1.93069],[-.198676,.522583,1.93069],[-.196875,2.68359,0],[-.1943,2.92397,-.287197],[-.1943,2.92397,.287197],[-.193602,1.28613,-1.88139],[-.193602,1.28613,1.88139],[-.190548,2.43047,-.607174],[-.190548,2.43047,.607174],[-.189856,2.86421,-.280732],[-.189856,2.86421,.280732],[-.187036,.343945,-1.81758],[-.187036,.343945,1.81758],[-.1845,2.55,-.0785],[-.1845,2.55,.0785],[-.181661,2.68359,-.077405],[-.181661,2.68359,.077405],[-.180879,2.50547,-.267832],[-.180879,2.50547,.267832],[-.179078,2.46094,-.420891],[-.179078,2.46094,.420891],[-.176295,2.5812,-.036001],[-.176295,2.5812,.036001],[-.174804,2.648,-.035727],[-.174804,2.648,.035727],[-.170322,1.86094,-1.65516],[-.170322,1.86094,1.65516],[-.169526,.159961,-1.64742],[-.169526,.159961,1.64742],[-.168094,2.4,-.8085],[-.168094,2.4,.8085],[-.166797,2.6124,0],[-.164073,2.98682,-.164073],[-.164073,2.98682,.164073],[-.158018,2.9688,-.233382],[-.158018,2.9688,.233382],[-.156792,.042773,-1.52367],[-.156792,.042773,1.52367],[-.153882,2.6124,-.065504],[-.153882,2.6124,.065504],[-.150226,2.28691,-1.45986],[-.150226,2.28691,1.45986],[-.14971,2.5812,-.101116],[-.14971,2.5812,.101116],[-.148475,2.648,-.100316],[-.148475,2.648,.100316],[-.145291,2.33613,-1.41191],[-.145291,2.33613,1.41191],[-.144103,2.75742,-.213159],[-.144103,2.75742,.213159],[-.142705,2.89717,-.334238],[-.142705,2.89717,.334238],[-.142,2.55,-.142],[-.142,2.55,.142],[-.141789,2.33613,-1.37788],[-.141789,2.33613,1.37788],[-.14163,2.28691,-1.37633],[-.14163,2.28691,1.37633],[-.139898,2.68359,-.139898],[-.139898,2.68359,.139898],[-.134407,2.95078,-.314464],[-.134407,2.95078,.314464],[-.130448,2.2749,-1.26766],[-.130448,2.2749,1.26766],[-.127984,2.83125,-.299953],[-.127984,2.83125,.299953],[-.123125,2.31943,-1.19651],[-.123125,2.31943,1.19651],[-.118458,2.6124,-.118458],[-.118458,2.6124,.118458],[-.110649,2.99341,-.022778],[-.110649,2.99341,.022778],[-.101116,2.5812,-.14971],[-.101116,2.5812,.14971],[-.10092,2.36953,-.980719],[-.10092,2.36953,.980719],[-.100316,2.648,-.148475],[-.100316,2.648,.148475],[-.094147,2.99341,-.063797],[-.094147,2.99341,.063797],[-.091207,2.46094,-.438241],[-.091207,2.46094,.438241],[-.091113,2.98682,-.212516],[-.091113,2.98682,.212516],[-.0785,2.55,-.1845],[-.0785,2.55,.1845],[-.077405,2.68359,-.181661],[-.077405,2.68359,.181661],[-.069278,2.92397,-.337859],[-.069278,2.92397,.337859],[-.067672,2.86421,-.330325],[-.067672,2.86421,.330325],[-.065504,2.6124,-.153882],[-.065504,2.6124,.153882],[-.064825,2.43047,-.631998],[-.064825,2.43047,.631998],[-.064395,2.50547,-.31541],[-.064395,2.50547,.31541],[-.063797,2.99341,-.094147],[-.063797,2.99341,.094147],[-.05638,2.9688,-.274421],[-.05638,2.9688,.274421],[-.051347,2.75742,-.250872],[-.051347,2.75742,.250872],[-.036001,2.5812,-.176295],[-.036001,2.5812,.176295],[-.035727,2.648,-.174804],[-.035727,2.648,.174804],[-.022778,2.99341,-.110649],[-.022778,2.99341,.110649],[0,0,-1.5],[0,0,1.5],[0,.085547,-1.57813],[0,.085547,1.57813],[0,.234375,-1.75],[0,.234375,1.75],[0,.453516,-1.92188],[0,.453516,1.92188],[0,.59165,-1.97852],[0,.59165,1.97852],[0,.75,-2],[0,.75,2],[0,1.10039,-1.95703],[0,1.10039,1.95703],[0,1.47187,-1.84375],[0,1.47187,1.84375],[0,2.25,-1.5],[0,2.25,-1.4],[0,2.25,-1.3],[0,2.25,1.3],[0,2.25,1.4],[0,2.25,1.5],[0,2.2998,-1.26094],[0,2.2998,1.26094],[0,2.32383,-1.44922],[0,2.32383,-1.38047],[0,2.32383,1.38047],[0,2.32383,1.44922],[0,2.33906,-1.15625],[0,2.33906,1.15625],[0,2.34844,-1.40313],[0,2.34844,1.40313],[0,2.4,-.825],[0,2.4,.825],[0,2.46094,-.45625],[0,2.46094,.45625],[0,2.55,-.2],[0,2.55,.2],[0,2.6124,-.166797],[0,2.6124,.166797],[0,2.68359,-.196875],[0,2.68359,.196875],[0,2.83125,-.325],[0,2.83125,.325],[0,2.89717,-.362109],[0,2.89717,.362109],[0,2.95078,-.340625],[0,2.95078,.340625],[0,2.98682,-.230078],[0,2.98682,.230078],[0,3,0],[.022778,2.99341,-.110649],[.022778,2.99341,.110649],[.035727,2.648,-.174804],[.035727,2.648,.174804],[.036001,2.5812,-.176295],[.036001,2.5812,.176295],[.051347,2.75742,-.250872],[.051347,2.75742,.250872],[.05638,2.9688,-.274421],[.05638,2.9688,.274421],[.063797,2.99341,-.094147],[.063797,2.99341,.094147],[.064395,2.50547,-.31541],[.064395,2.50547,.31541],[.064825,2.43047,-.631998],[.064825,2.43047,.631998],[.065504,2.6124,-.153882],[.065504,2.6124,.153882],[.067672,2.86421,-.330325],[.067672,2.86421,.330325],[.069278,2.92397,-.337859],[.069278,2.92397,.337859],[.077405,2.68359,-.181661],[.077405,2.68359,.181661],[.0785,2.55,-.1845],[.0785,2.55,.1845],[.091113,2.98682,-.212516],[.091113,2.98682,.212516],[.091207,2.46094,-.438241],[.091207,2.46094,.438241],[.094147,2.99341,-.063797],[.094147,2.99341,.063797],[.100316,2.648,-.148475],[.100316,2.648,.148475],[.10092,2.36953,-.980719],[.10092,2.36953,.980719],[.101116,2.5812,-.14971],[.101116,2.5812,.14971],[.110649,2.99341,-.022778],[.110649,2.99341,.022778],[.118458,2.6124,-.118458],[.118458,2.6124,.118458],[.123125,2.31943,-1.19651],[.123125,2.31943,1.19651],[.127984,2.83125,-.299953],[.127984,2.83125,.299953],[.130448,2.2749,-1.26766],[.130448,2.2749,1.26766],[.134407,2.95078,-.314464],[.134407,2.95078,.314464],[.139898,2.68359,-.139898],[.139898,2.68359,.139898],[.14163,2.28691,-1.37633],[.14163,2.28691,1.37633],[.141789,2.33613,-1.37788],[.141789,2.33613,1.37788],[.142,2.55,-.142],[.142,2.55,.142],[.142705,2.89717,-.334238],[.142705,2.89717,.334238],[.144103,2.75742,-.213159],[.144103,2.75742,.213159],[.145291,2.33613,-1.41191],[.145291,2.33613,1.41191],[.148475,2.648,-.100316],[.148475,2.648,.100316],[.14971,2.5812,-.101116],[.14971,2.5812,.101116],[.150226,2.28691,-1.45986],[.150226,2.28691,1.45986],[.153882,2.6124,-.065504],[.153882,2.6124,.065504],[.156792,.042773,-1.52367],[.156792,.042773,1.52367],[.158018,2.9688,-.233382],[.158018,2.9688,.233382],[.164073,2.98682,-.164073],[.164073,2.98682,.164073],[.166797,2.6124,0],[.168094,2.4,-.8085],[.168094,2.4,.8085],[.169526,.159961,-1.64742],[.169526,.159961,1.64742],[.170322,1.86094,-1.65516],[.170322,1.86094,1.65516],[.174804,2.648,-.035727],[.174804,2.648,.035727],[.176295,2.5812,-.036001],[.176295,2.5812,.036001],[.179078,2.46094,-.420891],[.179078,2.46094,.420891],[.180879,2.50547,-.267832],[.180879,2.50547,.267832],[.181661,2.68359,-.077405],[.181661,2.68359,.077405],[.1845,2.55,-.0785],[.1845,2.55,.0785],[.187036,.343945,-1.81758],[.187036,.343945,1.81758],[.189856,2.86421,-.280732],[.189856,2.86421,.280732],[.190548,2.43047,-.607174],[.190548,2.43047,.607174],[.193602,1.28613,-1.88139],[.193602,1.28613,1.88139],[.1943,2.92397,-.287197],[.1943,2.92397,.287197],[.196875,2.68359,0],[.198676,.522583,-1.93069],[.198676,.522583,1.93069],[.2,2.55,0],[.201561,.925195,-1.95873],[.201561,.925195,1.95873],[.202656,.670825,-1.96937],[.202656,.670825,1.96937],[.212516,2.98682,-.091113],[.212516,2.98682,.091113],[.213159,2.75742,-.144103],[.213159,2.75742,.144103],[.230078,2.98682,0],[.231125,2.83125,-.231125],[.231125,2.83125,.231125],[.233382,2.9688,-.158018],[.233382,2.9688,.158018],[.235586,2.33906,-1.13312],[.235586,2.33906,1.13312],[.242477,2.95078,-.242477],[.242477,2.95078,.242477],[.250872,2.75742,-.051347],[.250872,2.75742,.051347],[.251889,2.46094,-.372159],[.251889,2.46094,.372159],[.256916,2.2998,-1.23572],[.256916,2.2998,1.23572],[.25761,2.89717,-.25761],[.25761,2.89717,.25761],[.264875,2.25,-1.274],[.264875,2.25,1.274],[.267832,2.50547,-.180879],[.267832,2.50547,.180879],[.274421,2.9688,-.05638],[.274421,2.9688,.05638],[.280732,2.86421,-.189856],[.280732,2.86421,.189856],[.281271,2.32383,-1.35286],[.281271,2.32383,1.35286],[.28525,2.25,-1.372],[.28525,2.25,1.372],[.285887,2.34844,-1.37506],[.285887,2.34844,1.37506],[.287197,2.92397,-.1943],[.287197,2.92397,.1943],[.295278,2.32383,-1.42023],[.295278,2.32383,1.42023],[.29533,2.36953,-.942332],[.29533,2.36953,.942332],[.299953,2.83125,-.127984],[.299953,2.83125,.127984],[.304711,2.43047,-.559973],[.304711,2.43047,.559973],[.305625,0,-1.47],[.305625,0,1.47],[.305625,2.25,-1.47],[.305625,2.25,1.47],[.314464,2.95078,-.134407],[.314464,2.95078,.134407],[.31541,2.50547,-.064395],[.31541,2.50547,.064395],[.321543,.085547,-1.54656],[.321543,.085547,1.54656],[.323813,2.4,-.761063],[.323813,2.4,.761063],[.323938,2.46094,-.323938],[.323938,2.46094,.323938],[.325,2.83125,0],[.330325,2.86421,-.067672],[.330325,2.86421,.067672],[.334238,2.89717,-.142705],[.334238,2.89717,.142705],[.337859,2.92397,-.069278],[.337859,2.92397,.069278],[.340625,2.95078,0],[.356562,.234375,1.715],[.356563,.234375,-1.715],[.360312,2.31943,-1.14968],[.360312,2.31943,1.14968],[.362109,2.89717,0],[.372159,2.46094,-.251889],[.372159,2.46094,.251889],[.375664,1.47187,-1.80687],[.375664,1.47187,1.80687],[.38174,2.2749,-1.21805],[.38174,2.2749,1.21805],[.391582,.453516,-1.88344],[.391582,.453516,1.88344],[.398745,1.10039,-1.91789],[.398745,1.10039,1.91789],[.403123,.59165,-1.93895],[.403123,.59165,1.93895],[.40641,2.43047,-.491907],[.40641,2.43047,.491907],[.4075,.75,-1.96],[.4075,.75,1.96],[.414464,2.28691,-1.32246],[.414464,2.28691,1.32246],[.414929,2.33613,-1.32395],[.414929,2.33613,1.32395],[.420891,2.46094,-.179078],[.420891,2.46094,.179078],[.425177,2.33613,-1.35665],[.425177,2.33613,1.35665],[.438241,2.46094,-.091207],[.438241,2.46094,.091207],[.439618,2.28691,-1.40272],[.439618,2.28691,1.40272],[.453828,2.33906,-1.06664],[.453828,2.33906,1.06664],[.45625,2.46094,0],[.458833,.042773,-1.46403],[.458833,.042773,1.46403],[.464063,2.4,-.685781],[.464063,2.4,.685781],[.473023,2.36953,-.868654],[.473023,2.36953,.868654],[.491907,2.43047,-.40641],[.491907,2.43047,.40641],[.494918,2.2998,-1.16322],[.494918,2.2998,1.16322],[.496099,.159961,-1.58294],[.496099,.159961,1.58294],[.498428,1.86094,-1.59037],[.498428,1.86094,1.59037],[.51025,2.25,-1.19925],[.51025,2.25,1.19925],[.541834,2.32383,-1.27348],[.541834,2.32383,1.27348],[.547339,.343945,-1.74644],[.547339,.343945,1.74644],[.5495,2.25,-1.2915],[.5495,2.25,1.2915],[.550727,2.34844,-1.29438],[.550727,2.34844,1.29438],[.559973,2.43047,-.304711],[.559973,2.43047,.304711],[.566554,1.28613,-1.80775],[.566554,1.28613,1.80775],[.568818,2.32383,-1.3369],[.568818,2.32383,1.3369],[.577104,2.31943,-1.05979],[.577104,2.31943,1.05979],[.581402,.522583,-1.85512],[.581402,.522583,1.85512],[.58575,2.4,-.58575],[.58575,2.4,.58575],[.58875,0,-1.38375],[.58875,0,1.38375],[.58875,2.25,-1.38375],[.58875,2.25,1.38375],[.589845,.925195,-1.88206],[.589845,.925195,1.88206],[.593047,.670825,-1.89228],[.593047,.670825,1.89228],[.607174,2.43047,-.190548],[.607174,2.43047,.190548],[.611424,2.2749,-1.12281],[.611424,2.2749,1.12281],[.619414,.085547,-1.45582],[.619414,.085547,1.45582],[.630285,2.36953,-.7634],[.630285,2.36953,.7634],[.631998,2.43047,-.064825],[.631998,2.43047,.064825],[.650391,2.33906,-.961133],[.650391,2.33906,.961133],[.663837,2.28691,-1.21906],[.663837,2.28691,1.21906],[.664583,2.33613,-1.22043],[.664583,2.33613,1.22043],[.680997,2.33613,-1.25057],[.680997,2.33613,1.25057],[.685781,2.4,-.464063],[.685781,2.4,.464063],[.686875,.234375,-1.61437],[.686875,.234375,1.61437],[.704126,2.28691,-1.29305],[.704126,2.28691,1.29305],[.709277,2.2998,-1.04815],[.709277,2.2998,1.04815],[.723672,1.47187,-1.70086],[.723672,1.47187,1.70086],[.73125,2.25,-1.08063],[.73125,2.25,1.08063],[.734902,.042773,-1.34957],[.734902,.042773,1.34957],[.754336,.453516,-1.77293],[.754336,.453516,1.77293],[.761063,2.4,-.323813],[.761063,2.4,.323813],[.7634,2.36953,-.630285],[.7634,2.36953,.630285],[.768135,1.10039,-1.80536],[.768135,1.10039,1.80536],[.768968,2.31943,-.931373],[.768968,2.31943,.931373],[.776514,2.32383,-1.14752],[.776514,2.32383,1.14752],[.776567,.59165,-1.82518],[.776567,.59165,1.82518],[.785,.75,-1.845],[.785,.75,1.845],[.7875,2.25,-1.16375],[.7875,2.25,1.16375],[.789258,2.34844,-1.16635],[.789258,2.34844,1.16635],[.79459,.159961,-1.45917],[.79459,.159961,1.45917],[.79832,1.86094,-1.46602],[.79832,1.86094,1.46602],[.8085,2.4,-.168094],[.8085,2.4,.168094],[.814698,2.2749,-.986761],[.814698,2.2749,.986761],[.815186,2.32383,-1.20466],[.815186,2.32383,1.20466],[.820938,2.33906,-.820938],[.820938,2.33906,.820938],[.825,2.4,0],[.84375,0,-1.24688],[.84375,0,1.24688],[.84375,2.25,-1.24688],[.84375,2.25,1.24688],[.868654,2.36953,-.473023],[.868654,2.36953,.473023],[.87666,.343945,-1.60989],[.87666,.343945,1.60989],[.884537,2.28691,-1.07135],[.884537,2.28691,1.07135],[.885531,2.33613,-1.07255],[.885531,2.33613,1.07255],[.887695,.085547,-1.31182],[.887695,.085547,1.31182],[.895266,2.2998,-.895266],[.895266,2.2998,.895266],[.907402,2.33613,-1.09904],[.907402,2.33613,1.09904],[.907437,1.28613,-1.6664],[.907437,1.28613,1.6664],[.923,2.25,-.923],[.923,2.25,.923],[.931218,.522583,-1.71008],[.931218,.522583,1.71008],[.931373,2.31943,-.768968],[.931373,2.31943,.768968],[.93822,2.28691,-1.13637],[.93822,2.28691,1.13637],[.942332,2.36953,-.29533],[.942332,2.36953,.29533],[.944741,.925195,-1.73491],[.944741,.925195,1.73491],[.949871,.670825,-1.74433],[.949871,.670825,1.74433],[.961133,2.33906,-.650391],[.961133,2.33906,.650391],[.979229,.042773,-1.18604],[.979229,.042773,1.18604],[.980133,2.32383,-.980133],[.980133,2.32383,.980133],[.980719,2.36953,-.10092],[.980719,2.36953,.10092],[.984375,.234375,-1.45469],[.984375,.234375,1.45469],[.986761,2.2749,-.814698],[.986761,2.2749,.814698],[.994,2.25,-.994],[.994,2.25,.994],[.996219,2.34844,-.996219],[.996219,2.34844,.996219],[1.02894,2.32383,-1.02894],[1.02894,2.32383,1.02894],[1.03711,1.47187,-1.53262],[1.03711,1.47187,1.53262],[1.04815,2.2998,-.709277],[1.04815,2.2998,.709277],[1.05876,.159961,-1.28237],[1.05876,.159961,1.28237],[1.05979,2.31943,-.577104],[1.05979,2.31943,.577104],[1.06373,1.86094,-1.28839],[1.06373,1.86094,1.28839],[1.065,0,-1.065],[1.065,0,1.065],[1.065,2.25,-1.065],[1.065,2.25,1.065],[1.06664,2.33906,-.453828],[1.06664,2.33906,.453828],[1.07135,2.28691,-.884537],[1.07135,2.28691,.884537],[1.07255,2.33613,-.885531],[1.07255,2.33613,.885531],[1.08063,2.25,-.73125],[1.08063,2.25,.73125],[1.08106,.453516,-1.59756],[1.08106,.453516,1.59756],[1.09904,2.33613,-.907402],[1.09904,2.33613,.907402],[1.10083,1.10039,-1.62678],[1.10083,1.10039,1.62678],[1.11292,.59165,-1.64464],[1.11292,.59165,1.64464],[1.12047,.085547,-1.12047],[1.12047,.085547,1.12047],[1.12281,2.2749,-.611424],[1.12281,2.2749,.611424],[1.125,.75,-1.6625],[1.125,.75,1.6625],[1.13312,2.33906,-.235586],[1.13312,2.33906,.235586],[1.13637,2.28691,-.93822],[1.13637,2.28691,.93822],[1.14752,2.32383,-.776514],[1.14752,2.32383,.776514],[1.14968,2.31943,-.360312],[1.14968,2.31943,.360312],[1.15625,2.33906,0],[1.16322,2.2998,-.494918],[1.16322,2.2998,.494918],[1.16375,2.25,-.7875],[1.16375,2.25,.7875],[1.16635,2.34844,-.789258],[1.16635,2.34844,.789258],[1.16812,.343945,-1.41482],[1.16812,.343945,1.41482],[1.18604,.042773,-.979229],[1.18604,.042773,.979229],[1.19651,2.31943,-.123125],[1.19651,2.31943,.123125],[1.19925,2.25,-.51025],[1.19925,2.25,.51025],[1.20466,2.32383,-.815186],[1.20466,2.32383,.815186],[1.20912,1.28613,-1.46449],[1.20912,1.28613,1.46449],[1.21805,2.2749,-.38174],[1.21805,2.2749,.38174],[1.21906,2.28691,-.663837],[1.21906,2.28691,.663837],[1.22043,2.33613,-.664583],[1.22043,2.33613,.664583],[1.23572,2.2998,-.256916],[1.23572,2.2998,.256916],[1.24081,.522583,-1.50287],[1.24081,.522583,1.50287],[1.2425,.234375,-1.2425],[1.2425,.234375,1.2425],[1.24688,0,-.84375],[1.24688,0,.84375],[1.24688,2.25,-.84375],[1.24688,2.25,.84375],[1.25057,2.33613,-.680997],[1.25057,2.33613,.680997],[1.25883,.925195,-1.52469],[1.25883,.925195,1.52469],[1.26094,2.2998,0],[1.26567,.670825,-1.53297],[1.26567,.670825,1.53297],[1.26766,2.2749,-.130448],[1.26766,2.2749,.130448],[1.27348,2.32383,-.541834],[1.27348,2.32383,.541834],[1.274,2.25,-.264875],[1.274,2.25,.264875],[1.28237,.159961,-1.05876],[1.28237,.159961,1.05876],[1.28839,1.86094,-1.06373],[1.28839,1.86094,1.06373],[1.2915,2.25,-.5495],[1.2915,2.25,.5495],[1.29305,2.28691,-.704126],[1.29305,2.28691,.704126],[1.29438,2.34844,-.550727],[1.29438,2.34844,.550727],[1.3,2.25,0],[1.30906,1.47187,-1.30906],[1.30906,1.47187,1.30906],[1.31182,.085547,-.887695],[1.31182,.085547,.887695],[1.32246,2.28691,-.414464],[1.32246,2.28691,.414464],[1.32395,2.33613,-.414929],[1.32395,2.33613,.414929],[1.3369,2.32383,-.568818],[1.3369,2.32383,.568818],[1.34957,.042773,-.734902],[1.34957,.042773,.734902],[1.35286,2.32383,-.281271],[1.35286,2.32383,.281271],[1.35665,2.33613,-.425177],[1.35665,2.33613,.425177],[1.36453,.453516,-1.36453],[1.36453,.453516,1.36453],[1.372,2.25,-.28525],[1.372,2.25,.28525],[1.37506,2.34844,-.285887],[1.37506,2.34844,.285887],[1.37633,2.28691,-.14163],[1.37633,2.28691,.14163],[1.37788,2.33613,-.141789],[1.37788,2.33613,.141789],[1.38047,2.32383,0],[1.38375,0,-.58875],[1.38375,0,.58875],[1.38375,2.25,-.58875],[1.38375,2.25,.58875],[1.38949,1.10039,-1.38949],[1.38949,1.10039,1.38949],[1.4,2.25,0],[1.40272,2.28691,-.439618],[1.40272,2.28691,.439618],[1.40313,2.34844,0],[1.40475,.59165,-1.40475],[1.40475,.59165,1.40475],[1.41191,2.33613,-.145291],[1.41191,2.33613,.145291],[1.41482,.343945,-1.16812],[1.41482,.343945,1.16812],[1.42,.75,-1.42],[1.42,.75,1.42],[1.42023,2.32383,-.295278],[1.42023,2.32383,.295278],[1.44922,2.32383,0],[1.45469,.234375,-.984375],[1.45469,.234375,.984375],[1.45582,.085547,-.619414],[1.45582,.085547,.619414],[1.45917,.159961,-.79459],[1.45917,.159961,.79459],[1.45986,2.28691,-.150226],[1.45986,2.28691,.150226],[1.46403,.042773,-.458833],[1.46403,.042773,.458833],[1.46449,1.28613,-1.20912],[1.46449,1.28613,1.20912],[1.46602,1.86094,-.79832],[1.46602,1.86094,.79832],[1.47,0,-.305625],[1.47,0,.305625],[1.47,2.25,-.305625],[1.47,2.25,.305625],[1.5,0,0],[1.5,2.25,0],[1.50287,.522583,-1.24081],[1.50287,.522583,1.24081],[1.52367,.042773,-.156792],[1.52367,.042773,.156792],[1.52469,.925195,-1.25883],[1.52469,.925195,1.25883],[1.53262,1.47187,-1.03711],[1.53262,1.47187,1.03711],[1.53297,.670825,-1.26567],[1.53297,.670825,1.26567],[1.54656,.085547,-.321543],[1.54656,.085547,.321543],[1.57813,.085547,0],[1.58294,.159961,-.496099],[1.58294,.159961,.496099],[1.59037,1.86094,-.498428],[1.59037,1.86094,.498428],[1.59756,.453516,-1.08106],[1.59756,.453516,1.08106],[1.60989,.343945,-.87666],[1.60989,.343945,.87666],[1.61437,.234375,-.686875],[1.61437,.234375,.686875],[1.62678,1.10039,-1.10083],[1.62678,1.10039,1.10083],[1.64464,.59165,-1.11292],[1.64464,.59165,1.11292],[1.64742,.159961,-.169526],[1.64742,.159961,.169526],[1.65516,1.86094,-.170322],[1.65516,1.86094,.170322],[1.6625,.75,-1.125],[1.6625,.75,1.125],[1.6664,1.28613,-.907437],[1.6664,1.28613,.907437],[1.7,.45,0],[1.7,.485449,-.216563],[1.7,.485449,.216563],[1.7,.578906,-.37125],[1.7,.578906,.37125],[1.7,.711035,-.464063],[1.7,.711035,.464063],[1.7,.8625,-.495],[1.7,.8625,.495],[1.7,1.01397,-.464063],[1.7,1.01397,.464063],[1.7,1.14609,-.37125],[1.7,1.14609,.37125],[1.7,1.23955,-.216563],[1.7,1.23955,.216563],[1.7,1.275,0],[1.70086,1.47187,-.723672],[1.70086,1.47187,.723672],[1.71008,.522583,-.931218],[1.71008,.522583,.931218],[1.715,.234375,-.356562],[1.715,.234375,.356563],[1.73491,.925195,-.944741],[1.73491,.925195,.944741],[1.74433,.670825,-.949871],[1.74433,.670825,.949871],[1.74644,.343945,-.547339],[1.74644,.343945,.547339],[1.75,.234375,0],[1.77293,.453516,-.754336],[1.77293,.453516,.754336],[1.80536,1.10039,-.768135],[1.80536,1.10039,.768135],[1.80687,1.47187,-.375664],[1.80687,1.47187,.375664],[1.80775,1.28613,-.566554],[1.80775,1.28613,.566554],[1.80868,.66944,-.415335],[1.80868,.66944,.415335],[1.81523,.556498,-.292881],[1.81523,.556498,.292881],[1.81758,.343945,-.187036],[1.81758,.343945,.187036],[1.8185,.493823,-.107904],[1.8185,.493823,.107904],[1.82518,.59165,-.776567],[1.82518,.59165,.776567],[1.84375,1.47187,0],[1.84408,1.27311,-.106836],[1.84408,1.27311,.106836],[1.845,.75,-.785],[1.845,.75,.785],[1.84989,1.21245,-.289984],[1.84989,1.21245,.289984],[1.85512,.522583,-.581402],[1.85512,.522583,.581402],[1.86007,1.10628,-.412082],[1.86007,1.10628,.412082],[1.87286,.97282,-.473131],[1.87286,.97282,.473131],[1.88139,1.28613,-.193602],[1.88139,1.28613,.193602],[1.88206,.925195,-.589845],[1.88206,.925195,.589845],[1.88344,.453516,-.391582],[1.88344,.453516,.391582],[1.88652,.830257,-.473131],[1.88652,.830257,.473131],[1.89228,.670825,-.593047],[1.89228,.670825,.593047],[1.90898,.762851,-.457368],[1.90898,.762851,.457368],[1.91789,1.10039,-.398745],[1.91789,1.10039,.398745],[1.92188,.453516,0],[1.92572,.624968,-.36866],[1.92572,.624968,.36866],[1.93069,.522583,-.198676],[1.93069,.522583,.198676],[1.9352,.536667,-.215052],[1.9352,.536667,.215052],[1.93879,.503174,0],[1.93895,.59165,-.403123],[1.93895,.59165,.403123],[1.95703,1.10039,0],[1.95873,.925195,-.201561],[1.95873,.925195,.201561],[1.96,.75,-.4075],[1.96,.75,.4075],[1.96937,.670825,-.202656],[1.96937,.670825,.202656],[1.97852,.59165,0],[1.98496,1.30459,0],[1.99136,1.27331,-.210782],[1.99136,1.27331,.210782],[2,.75,0],[2.00799,.721263,-.409761],[2.00799,.721263,.409761],[2.00821,1.19084,-.36134],[2.00821,1.19084,.36134],[2.02471,.614949,-.288958],[2.02471,.614949,.288958],[2.03205,1.07424,-.451675],[2.03205,1.07424,.451675],[2.03379,.556062,-.106458],[2.03379,.556062,.106458],[2.05938,.940576,-.481787],[2.05938,.940576,.481787],[2.08644,1.33048,-.101581],[2.08644,1.33048,.101581],[2.0867,.806915,-.451675],[2.0867,.806915,.451675],[2.10141,1.27815,-.27572],[2.10141,1.27815,.27572],[2.11053,.690317,-.36134],[2.11053,.690317,.36134],[2.12739,.607845,-.210782],[2.12739,.607845,.210782],[2.1276,1.18656,-.391812],[2.1276,1.18656,.391812],[2.13379,.576563,0],[2.16054,1.07143,-.449859],[2.16054,1.07143,.449859],[2.16922,.790259,-.39936],[2.16922,.790259,.39936],[2.17969,1.38516,0],[2.18976,1.35887,-.195542],[2.18976,1.35887,.195542],[2.19481,.691761,-.281559],[2.19481,.691761,.281559],[2.19571,.948444,-.449859],[2.19571,.948444,.449859],[2.20837,.637082,-.103732],[2.20837,.637082,.103732],[2.21631,1.28957,-.335215],[2.21631,1.28957,.335215],[2.2202,.891314,-.434457],[2.2202,.891314,.434457],[2.24857,1.433,-.092384],[2.24857,1.433,.092384],[2.25384,1.1916,-.419019],[2.25384,1.1916,.419019],[2.25944,.772489,-.349967],[2.25944,.772489,.349967],[2.26857,1.39016,-.250758],[2.26857,1.39016,.250758],[2.28189,.696393,-.204147],[2.28189,.696393,.204147],[2.29041,.667529,0],[2.29688,1.0793,-.446953],[2.29688,1.0793,.446953],[2.29925,.874953,-.384664],[2.29925,.874953,.384664],[2.30358,1.3152,-.35634],[2.30358,1.3152,.35634],[2.30644,1.5044,0],[2.31838,1.48356,-.173996],[2.31838,1.48356,.173996],[2.33069,.784406,-.271218],[2.33069,.784406,.271218],[2.33991,.966989,-.419019],[2.33991,.966989,.419019],[2.34759,.734271,-.099922],[2.34759,.734271,.099922],[2.34759,1.22096,-.409131],[2.34759,1.22096,.409131],[2.34984,1.42864,-.298279],[2.34984,1.42864,.298279],[2.35318,1.56816,-.080823],[2.35318,1.56816,.080823],[2.37575,1.53531,-.219377],[2.37575,1.53531,.219377],[2.37744,.869019,-.335215],[2.37744,.869019,.335215],[2.3875,1.65,0],[2.39432,1.35098,-.372849],[2.39432,1.35098,.372849],[2.3946,1.1203,-.409131],[2.3946,1.1203,.409131],[2.40039,1.63469,-.149297],[2.40039,1.63469,.149297],[2.40399,.799722,-.195542],[2.40399,.799722,.195542],[2.41406,.773438,0],[2.41524,1.47781,-.311747],[2.41524,1.47781,.311747],[2.43438,1.59434,-.255938],[2.43438,1.59434,.255938],[2.43861,1.02606,-.35634],[2.43861,1.02606,.35634],[2.44531,1.26196,-.397705],[2.44531,1.26196,.397705],[2.45168,1.80534,-.063087],[2.45168,1.80534,.063087],[2.46489,1.40552,-.357931],[2.46489,1.40552,.357931],[2.47362,.951099,-.250758],[2.47362,.951099,.250758],[2.47768,1.78638,-.171237],[2.47768,1.78638,.171237],[2.48242,1.53728,-.319922],[2.48242,1.53728,.319922],[2.49362,.908264,-.092384],[2.49362,.908264,.092384],[2.4963,1.17295,-.372849],[2.4963,1.17295,.372849],[2.50156,1.97109,0],[2.51727,1.96555,-.103052],[2.51727,1.96555,.103052],[2.51792,1.32831,-.357931],[2.51792,1.32831,.357931],[2.52318,1.75322,-.243336],[2.52318,1.75322,.243336],[2.5375,1.47187,-.34125],[2.5375,1.47187,.34125],[2.54078,1.09529,-.298279],[2.54078,1.09529,.298279],[2.54911,2.04464,-.047716],[2.54911,2.04464,.047716],[2.55869,1.95095,-.17666],[2.55869,1.95095,.17666],[2.56757,1.25603,-.311747],[2.56757,1.25603,.311747],[2.57225,1.04036,-.173996],[2.57225,1.04036,.173996],[2.5791,2.12197,0],[2.58039,1.71153,-.279386],[2.58039,1.71153,.279386],[2.58101,2.03773,-.129515],[2.58101,2.03773,.129515],[2.58418,1.01953,0],[2.59258,1.40647,-.319922],[2.59258,1.40647,.319922],[2.59849,2.11992,-.087812],[2.59849,2.11992,.087812],[2.60178,1.55472,-.304019],[2.60178,1.55472,.304019],[2.60707,1.19853,-.219377],[2.60707,1.19853,.219377],[2.61162,1.69128,-.287908],[2.61162,1.69128,.287908],[2.61725,1.93031,-.220825],[2.61725,1.93031,.220825],[2.62963,1.16568,-.080823],[2.62963,1.16568,.080823],[2.63788,2.02555,-.180818],[2.63788,2.02555,.180818],[2.64063,1.34941,-.255938],[2.64063,1.34941,.255938],[2.6496,2.11451,-.150535],[2.6496,2.11451,.150535],[2.65084,2.18547,-.042461],[2.65084,2.18547,.042461],[2.65391,1.5042,-.264113],[2.65391,1.5042,.264113],[2.66542,1.64925,-.266995],[2.66542,1.64925,.266995],[2.67461,1.30906,-.149297],[2.67461,1.30906,.149297],[2.67823,1.78254,-.252819],[2.67823,1.78254,.252819],[2.68438,1.90664,-.235547],[2.68438,1.90664,.235547],[2.6875,1.29375,0],[2.6919,2.18361,-.115251],[2.6919,2.18361,.115251],[2.69645,1.4638,-.185857],[2.69645,1.4638,.185857],[2.7,2.25,0],[2.70808,2.01037,-.208084],[2.70808,2.01037,.208084],[2.71703,1.61167,-.213596],[2.71703,1.61167,.213596],[2.72076,1.44072,-.068474],[2.72076,1.44072,.068474],[2.72578,2.25,-.082031],[2.72578,2.25,.082031],[2.72599,2.10643,-.17525],[2.72599,2.10643,.17525],[2.736,1.75155,-.219519],[2.736,1.75155,.219519],[2.75021,2.26919,-.039734],[2.75021,2.26919,.039734],[2.7515,1.88297,-.220825],[2.7515,1.88297,.220825],[2.75354,1.58508,-.124598],[2.75354,1.58508,.124598],[2.76738,1.575,0],[2.77556,2.284,0],[2.78099,1.99437,-.208084],[2.78099,1.99437,.208084],[2.78303,1.7267,-.154476],[2.78303,1.7267,.154476],[2.79375,2.25,-.140625],[2.79375,2.25,.140625],[2.79782,2.27175,-.107849],[2.79782,2.27175,.107849],[2.79949,2.29275,-.076904],[2.79949,2.29275,.076904],[2.8,2.25,0],[2.80469,2.0981,-.200713],[2.80469,2.0981,.200713],[2.8099,1.7125,-.056912],[2.8099,1.7125,.056912],[2.81006,1.86233,-.17666],[2.81006,1.86233,.17666],[2.81201,2.17815,-.169843],[2.81201,2.17815,.169843],[2.81274,2.29754,-.035632],[2.81274,2.29754,.035632],[2.81719,2.25,-.049219],[2.81719,2.25,.049219],[2.825,2.30625,0],[2.83011,2.27129,-.025891],[2.83011,2.27129,.025891],[2.84063,2.29219,0],[2.84479,2.29964,-.029993],[2.84479,2.29964,.029993],[2.85092,2.30716,-.065625],[2.85092,2.30716,.065625],[2.85118,1.97919,-.180818],[2.85118,1.97919,.180818],[2.85148,1.84773,-.103052],[2.85148,1.84773,.103052],[2.86048,2.30093,-.096716],[2.86048,2.30093,.096716],[2.8625,2.25,-.084375],[2.8625,2.25,.084375],[2.86263,2.29298,-.054346],[2.86263,2.29298,.054346],[2.86574,2.27201,-.070276],[2.86574,2.27201,.070276],[2.86719,1.84219,0],[2.87228,2.29425,-.131836],[2.87228,2.29425,.131836],[2.88339,2.08977,-.17525],[2.88339,2.08977,.17525],[2.88836,2.30119,-.081409],[2.88836,2.30119,.081409],[2.89827,2.17088,-.194382],[2.89827,2.17088,.194382],[2.90805,1.967,-.129515],[2.90805,1.967,.129515],[2.91924,2.30955,-.1125],[2.91924,2.30955,.1125],[2.92064,2.29507,-.093164],[2.92064,2.29507,.093164],[2.93279,2.13103,-.172211],[2.93279,2.13103,.172211],[2.9398,2.27326,-.158936],[2.9398,2.27326,.158936],[2.93996,1.9601,-.047716],[2.93996,1.9601,.047716],[2.95978,2.08168,-.150535],[2.95978,2.08168,.150535],[2.96995,2.27412,-.103564],[2.96995,2.27412,.103564],[3,2.25,-.1875],[3,2.25,-.1125],[3,2.25,.1125],[3,2.25,.1875],[3.00281,2.30484,-.142529],[3.00281,2.30484,.142529],[3.01089,2.07627,-.087812],[3.01089,2.07627,.087812],[3.01578,2.30571,-.119971],[3.01578,2.30571,.119971],[3.03027,2.07422,0],[3.0415,2.12567,-.116276],[3.0415,2.12567,.116276],[3.04323,2.21108,-.166431],[3.04323,2.21108,.166431],[3.06842,2.17345,-.143215],[3.06842,2.17345,.143215],[3.07929,2.12306,-.042838],[3.07929,2.12306,.042838],[3.09316,2.29878,-.175781],[3.09316,2.29878,.175781],[3.09668,2.30142,-.124219],[3.09668,2.30142,.124219],[3.12656,2.3168,-.15],[3.12656,2.3168,.15],[3.12672,2.27729,-.103564],[3.12672,2.27729,.103564],[3.12691,2.17128,-.083542],[3.12691,2.17128,.083542],[3.1375,2.25,-.084375],[3.1375,2.25,.084375],[3.1491,2.17046,0],[3.15337,2.27552,-.158936],[3.15337,2.27552,.158936],[3.16895,2.21118,-.112353],[3.16895,2.21118,.112353],[3.18281,2.25,-.049219],[3.18281,2.25,.049219],[3.2,2.25,0],[3.20625,2.25,-.140625],[3.20625,2.25,.140625],[3.20746,2.31251,-.119971],[3.20746,2.31251,.119971],[3.21256,2.21043,-.041393],[3.21256,2.21043,.041393],[3.21692,2.31073,-.142529],[3.21692,2.31073,.142529],[3.23094,2.2794,-.070276],[3.23094,2.2794,.070276],[3.26724,2.27814,-.025891],[3.26724,2.27814,.025891],[3.27272,2.30776,-.093164],[3.27272,2.30776,.093164],[3.27422,2.25,-.082031],[3.27422,2.25,.082031],[3.29534,2.27703,-.107849],[3.29534,2.27703,.107849],[3.3,2.25,0],[3.31405,2.30331,-.131836],[3.31405,2.30331,.131836],[3.33073,2.30985,-.054346],[3.33073,2.30985,.054346],[3.33389,2.32405,-.1125],[3.33389,2.32405,.1125],[3.33489,2.31702,-.081409],[3.33489,2.31702,.081409],[3.34236,2.28006,-.039734],[3.34236,2.28006,.039734],[3.35543,2.3027,0],[3.35925,2.31465,-.096716],[3.35925,2.31465,.096716],[3.37912,2.31658,-.029993],[3.37912,2.31658,.029993],[3.38684,2.30481,-.076904],[3.38684,2.30481,.076904],[3.40221,2.32644,-.065625],[3.40221,2.32644,.065625],[3.40639,2.3185,-.035632],[3.40639,2.3185,.035632],[3.40838,2.31543,0],[3.42812,2.32734,0]],t=[[1454,1468,1458],[1448,1454,1458],[1461,1448,1458],[1468,1461,1458],[1429,1454,1440],[1421,1429,1440],[1448,1421,1440],[1454,1448,1440],[1380,1429,1398],[1373,1380,1398],[1421,1373,1398],[1429,1421,1398],[1327,1380,1349],[1319,1327,1349],[1373,1319,1349],[1380,1373,1349],[1448,1461,1460],[1456,1448,1460],[1471,1456,1460],[1461,1471,1460],[1421,1448,1442],[1433,1421,1442],[1456,1433,1442],[1448,1456,1442],[1373,1421,1400],[1382,1373,1400],[1433,1382,1400],[1421,1433,1400],[1319,1373,1351],[1329,1319,1351],[1382,1329,1351],[1373,1382,1351],[1264,1327,1289],[1258,1264,1289],[1319,1258,1289],[1327,1319,1289],[1192,1264,1228],[1188,1192,1228],[1258,1188,1228],[1264,1258,1228],[1100,1192,1157],[1098,1100,1157],[1188,1098,1157],[1192,1188,1157],[922,1100,1006],[928,922,1006],[1098,928,1006],[1100,1098,1006],[1258,1319,1291],[1266,1258,1291],[1329,1266,1291],[1319,1329,1291],[1188,1258,1230],[1194,1188,1230],[1266,1194,1230],[1258,1266,1230],[1098,1188,1159],[1102,1098,1159],[1194,1102,1159],[1188,1194,1159],[928,1098,1008],[933,928,1008],[1102,933,1008],[1098,1102,1008],[1456,1471,1475],[1481,1456,1475],[1482,1481,1475],[1471,1482,1475],[1433,1456,1450],[1444,1433,1450],[1481,1444,1450],[1456,1481,1450],[1382,1433,1412],[1392,1382,1412],[1444,1392,1412],[1433,1444,1412],[1329,1382,1357],[1331,1329,1357],[1392,1331,1357],[1382,1392,1357],[1481,1482,1490],[1500,1481,1490],[1502,1500,1490],[1482,1502,1490],[1444,1481,1470],[1465,1444,1470],[1500,1465,1470],[1481,1500,1470],[1392,1444,1431],[1410,1392,1431],[1465,1410,1431],[1444,1465,1431],[1331,1392,1371],[1345,1331,1371],[1410,1345,1371],[1392,1410,1371],[1266,1329,1297],[1276,1266,1297],[1331,1276,1297],[1329,1331,1297],[1194,1266,1232],[1200,1194,1232],[1276,1200,1232],[1266,1276,1232],[1102,1194,1163],[1106,1102,1163],[1200,1106,1163],[1194,1200,1163],[933,1102,1016],[929,933,1016],[1106,929,1016],[1102,1106,1016],[1276,1331,1307],[1283,1276,1307],[1345,1283,1307],[1331,1345,1307],[1200,1276,1238],[1210,1200,1238],[1283,1210,1238],[1276,1283,1238],[1106,1200,1167],[1116,1106,1167],[1210,1116,1167],[1200,1210,1167],[929,1106,1022],[923,929,1022],[1116,923,1022],[1106,1116,1022],[755,922,849],[757,755,849],[928,757,849],[922,928,849],[663,755,698],[667,663,698],[757,667,698],[755,757,698],[591,663,627],[597,591,627],[667,597,627],[663,667,627],[528,591,566],[536,528,566],[597,536,566],[591,597,566],[757,928,847],[753,757,847],[933,753,847],[928,933,847],[667,757,696],[661,667,696],[753,661,696],[757,753,696],[597,667,625],[589,597,625],[661,589,625],[667,661,625],[536,597,564],[526,536,564],[589,526,564],[597,589,564],[475,528,506],[482,475,506],[536,482,506],[528,536,506],[426,475,457],[434,426,457],[482,434,457],[475,482,457],[401,426,415],[407,401,415],[434,407,415],[426,434,415],[386,401,397],[393,386,397],[407,393,397],[401,407,397],[482,536,504],[473,482,504],[526,473,504],[536,526,504],[434,482,455],[422,434,455],[473,422,455],[482,473,455],[407,434,413],[399,407,413],[422,399,413],[434,422,413],[393,407,395],[383,393,395],[399,383,395],[407,399,395],[753,933,839],[749,753,839],[929,749,839],[933,929,839],[661,753,692],[655,661,692],[749,655,692],[753,749,692],[589,661,623],[579,589,623],[655,579,623],[661,655,623],[526,589,558],[524,526,558],[579,524,558],[589,579,558],[749,929,833],[741,749,833],[923,741,833],[929,923,833],[655,749,688],[647,655,688],[741,647,688],[749,741,688],[579,655,617],[574,579,617],[647,574,617],[655,647,617],[524,579,548],[512,524,548],[574,512,548],[579,574,548],[473,526,498],[463,473,498],[524,463,498],[526,524,498],[422,473,443],[411,422,443],[463,411,443],[473,463,443],[399,422,405],[374,399,405],[411,374,405],[422,411,405],[383,399,380],[372,383,380],[374,372,380],[399,374,380],[463,524,484],[447,463,484],[512,447,484],[524,512,484],[411,463,424],[392,411,424],[447,392,424],[463,447,424],[374,411,385],[357,374,385],[392,357,385],[411,392,385],[372,374,365],[353,372,365],[357,353,365],[374,357,365],[400,386,396],[406,400,396],[393,406,396],[386,393,396],[425,400,414],[433,425,414],[406,433,414],[400,406,414],[474,425,456],[481,474,456],[433,481,456],[425,433,456],[527,474,505],[535,527,505],[481,535,505],[474,481,505],[406,393,394],[398,406,394],[383,398,394],[393,383,394],[433,406,412],[421,433,412],[398,421,412],[406,398,412],[481,433,454],[472,481,454],[421,472,454],[433,421,454],[535,481,503],[525,535,503],[472,525,503],[481,472,503],[590,527,565],[596,590,565],[535,596,565],[527,535,565],[662,590,626],[666,662,626],[596,666,626],[590,596,626],[754,662,697],[756,754,697],[666,756,697],[662,666,697],[919,754,848],[927,919,848],[756,927,848],[754,756,848],[596,535,563],[588,596,563],[525,588,563],[535,525,563],[666,596,624],[660,666,624],[588,660,624],[596,588,624],[756,666,695],[752,756,695],[660,752,695],[666,660,695],[927,756,846],[932,927,846],[752,932,846],[756,752,846],[398,383,379],[373,398,379],[372,373,379],[383,372,379],[421,398,404],[410,421,404],[373,410,404],[398,373,404],[472,421,442],[462,472,442],[410,462,442],[421,410,442],[525,472,497],[523,525,497],[462,523,497],[472,462,497],[373,372,364],[356,373,364],[353,356,364],[372,353,364],[410,373,384],[391,410,384],[356,391,384],[373,356,384],[462,410,423],[446,462,423],[391,446,423],[410,391,423],[523,462,483],[511,523,483],[446,511,483],[462,446,483],[588,525,557],[578,588,557],[523,578,557],[525,523,557],[660,588,622],[654,660,622],[578,654,622],[588,578,622],[752,660,691],[748,752,691],[654,748,691],[660,654,691],[932,752,838],[926,932,838],[748,926,838],[752,748,838],[578,523,547],[573,578,547],[511,573,547],[523,511,547],[654,578,616],[646,654,616],[573,646,616],[578,573,616],[748,654,687],[740,748,687],[646,740,687],[654,646,687],[926,748,832],[918,926,832],[740,918,832],[748,740,832],[1099,919,1005],[1097,1099,1005],[927,1097,1005],[919,927,1005],[1191,1099,1156],[1187,1191,1156],[1097,1187,1156],[1099,1097,1156],[1263,1191,1227],[1257,1263,1227],[1187,1257,1227],[1191,1187,1227],[1326,1263,1288],[1318,1326,1288],[1257,1318,1288],[1263,1257,1288],[1097,927,1007],[1101,1097,1007],[932,1101,1007],[927,932,1007],[1187,1097,1158],[1193,1187,1158],[1101,1193,1158],[1097,1101,1158],[1257,1187,1229],[1265,1257,1229],[1193,1265,1229],[1187,1193,1229],[1318,1257,1290],[1328,1318,1290],[1265,1328,1290],[1257,1265,1290],[1379,1326,1348],[1372,1379,1348],[1318,1372,1348],[1326,1318,1348],[1428,1379,1397],[1420,1428,1397],[1372,1420,1397],[1379,1372,1397],[1453,1428,1439],[1447,1453,1439],[1420,1447,1439],[1428,1420,1439],[1468,1453,1457],[1461,1468,1457],[1447,1461,1457],[1453,1447,1457],[1372,1318,1350],[1381,1372,1350],[1328,1381,1350],[1318,1328,1350],[1420,1372,1399],[1432,1420,1399],[1381,1432,1399],[1372,1381,1399],[1447,1420,1441],[1455,1447,1441],[1432,1455,1441],[1420,1432,1441],[1461,1447,1459],[1471,1461,1459],[1455,1471,1459],[1447,1455,1459],[1101,932,1015],[1105,1101,1015],[926,1105,1015],[932,926,1015],[1193,1101,1162],[1199,1193,1162],[1105,1199,1162],[1101,1105,1162],[1265,1193,1231],[1275,1265,1231],[1199,1275,1231],[1193,1199,1231],[1328,1265,1296],[1330,1328,1296],[1275,1330,1296],[1265,1275,1296],[1105,926,1021],[1115,1105,1021],[918,1115,1021],[926,918,1021],[1199,1105,1166],[1209,1199,1166],[1115,1209,1166],[1105,1115,1166],[1275,1199,1237],[1282,1275,1237],[1209,1282,1237],[1199,1209,1237],[1330,1275,1306],[1344,1330,1306],[1282,1344,1306],[1275,1282,1306],[1381,1328,1356],[1391,1381,1356],[1330,1391,1356],[1328,1330,1356],[1432,1381,1411],[1443,1432,1411],[1391,1443,1411],[1381,1391,1411],[1455,1432,1449],[1480,1455,1449],[1443,1480,1449],[1432,1443,1449],[1471,1455,1474],[1482,1471,1474],[1480,1482,1474],[1455,1480,1474],[1391,1330,1370],[1409,1391,1370],[1344,1409,1370],[1330,1344,1370],[1443,1391,1430],[1464,1443,1430],[1409,1464,1430],[1391,1409,1430],[1480,1443,1469],[1499,1480,1469],[1464,1499,1469],[1443,1464,1469],[1482,1480,1489],[1502,1482,1489],[1499,1502,1489],[1480,1499,1489],[1500,1502,1533],[1572,1500,1533],[1585,1572,1533],[1502,1585,1533],[1465,1500,1519],[1555,1465,1519],[1572,1555,1519],[1500,1572,1519],[1410,1465,1496],[1510,1410,1496],[1555,1510,1496],[1465,1555,1496],[1345,1410,1427],[1436,1345,1427],[1510,1436,1427],[1410,1510,1427],[1283,1345,1341],[1333,1283,1341],[1436,1333,1341],[1345,1436,1341],[1210,1283,1270],[1242,1210,1270],[1333,1242,1270],[1283,1333,1270],[1116,1210,1184],[1143,1116,1184],[1242,1143,1184],[1210,1242,1184],[923,1116,1037],[917,923,1037],[1143,917,1037],[1116,1143,1037],[1572,1585,1599],[1611,1572,1599],[1622,1611,1599],[1585,1622,1599],[1555,1572,1574],[1570,1555,1574],[1611,1570,1574],[1572,1611,1574],[1510,1555,1537],[1527,1510,1537],[1570,1527,1537],[1555,1570,1537],[1436,1510,1494],[1467,1436,1494],[1527,1467,1494],[1510,1527,1494],[1611,1622,1624],[1626,1611,1624],[1633,1626,1624],[1622,1633,1624],[1570,1611,1601],[1589,1570,1601],[1626,1589,1601],[1611,1626,1601],[1527,1570,1561],[1535,1527,1561],[1589,1535,1561],[1570,1589,1561],[1467,1527,1508],[1479,1467,1508],[1535,1479,1508],[1527,1535,1508],[1333,1436,1394],[1359,1333,1394],[1467,1359,1394],[1436,1467,1394],[1242,1333,1299],[1254,1242,1299],[1359,1254,1299],[1333,1359,1299],[1143,1242,1198],[1149,1143,1198],[1254,1149,1198],[1242,1254,1198],[917,1143,1057],[915,917,1057],[1149,915,1057],[1143,1149,1057],[1359,1467,1414],[1367,1359,1414],[1479,1367,1414],[1467,1479,1414],[1254,1359,1311],[1262,1254,1311],[1367,1262,1311],[1359,1367,1311],[1149,1254,1212],[1155,1149,1212],[1262,1155,1212],[1254,1262,1212],[915,1149,1065],[913,915,1065],[1155,913,1065],[1149,1155,1065],[741,923,818],[712,741,818],[917,712,818],[923,917,818],[647,741,671],[613,647,671],[712,613,671],[741,712,671],[574,647,585],[522,574,585],[613,522,585],[647,613,585],[512,574,514],[419,512,514],[522,419,514],[574,522,514],[447,512,428],[342,447,428],[419,342,428],[512,419,428],[392,447,359],[308,392,359],[342,308,359],[447,342,359],[357,392,329],[291,357,329],[308,291,329],[392,308,329],[353,357,314],[275,353,314],[291,275,314],[357,291,314],[712,917,798],[706,712,798],[915,706,798],[917,915,798],[613,712,657],[601,613,657],[706,601,657],[712,706,657],[522,613,556],[496,522,556],[601,496,556],[613,601,556],[419,522,461],[388,419,461],[496,388,461],[522,496,461],[706,915,790],[700,706,790],[913,700,790],[915,913,790],[601,706,643],[593,601,643],[700,593,643],[706,700,643],[496,601,544],[488,496,544],[593,488,544],[601,593,544],[388,496,441],[376,388,441],[488,376,441],[496,488,441],[342,419,361],[320,342,361],[388,320,361],[419,388,361],[308,342,310],[293,308,310],[320,293,310],[342,320,310],[291,308,289],[257,291,289],[293,257,289],[308,293,289],[275,291,270],[246,275,270],[257,246,270],[291,257,270],[320,388,344],[312,320,344],[376,312,344],[388,376,344],[293,320,302],[274,293,302],[312,274,302],[320,312,302],[257,293,268],[243,257,268],[274,243,268],[293,274,268],[246,257,245],[232,246,245],[243,232,245],[257,243,245],[356,353,313],[290,356,313],[275,290,313],[353,275,313],[391,356,328],[307,391,328],[290,307,328],[356,290,328],[446,391,358],[341,446,358],[307,341,358],[391,307,358],[511,446,427],[418,511,427],[341,418,427],[446,341,427],[573,511,513],[521,573,513],[418,521,513],[511,418,513],[646,573,584],[612,646,584],[521,612,584],[573,521,584],[740,646,670],[711,740,670],[612,711,670],[646,612,670],[918,740,817],[916,918,817],[711,916,817],[740,711,817],[290,275,269],[256,290,269],[246,256,269],[275,246,269],[307,290,288],[292,307,288],[256,292,288],[290,256,288],[341,307,309],[319,341,309],[292,319,309],[307,292,309],[418,341,360],[387,418,360],[319,387,360],[341,319,360],[256,246,244],[242,256,244],[232,242,244],[246,232,244],[292,256,267],[273,292,267],[242,273,267],[256,242,267],[319,292,301],[311,319,301],[273,311,301],[292,273,301],[387,319,343],[375,387,343],[311,375,343],[319,311,343],[521,418,460],[495,521,460],[387,495,460],[418,387,460],[612,521,555],[600,612,555],[495,600,555],[521,495,555],[711,612,656],[705,711,656],[600,705,656],[612,600,656],[916,711,797],[914,916,797],[705,914,797],[711,705,797],[495,387,440],[487,495,440],[375,487,440],[387,375,440],[600,495,543],[592,600,543],[487,592,543],[495,487,543],[705,600,642],[699,705,642],[592,699,642],[600,592,642],[914,705,789],[912,914,789],[699,912,789],[705,699,789],[1115,918,1036],[1142,1115,1036],[916,1142,1036],[918,916,1036],[1209,1115,1183],[1241,1209,1183],[1142,1241,1183],[1115,1142,1183],[1282,1209,1269],[1332,1282,1269],[1241,1332,1269],[1209,1241,1269],[1344,1282,1340],[1435,1344,1340],[1332,1435,1340],[1282,1332,1340],[1409,1344,1426],[1509,1409,1426],[1435,1509,1426],[1344,1435,1426],[1464,1409,1495],[1554,1464,1495],[1509,1554,1495],[1409,1509,1495],[1499,1464,1518],[1571,1499,1518],[1554,1571,1518],[1464,1554,1518],[1502,1499,1532],[1585,1502,1532],[1571,1585,1532],[1499,1571,1532],[1142,916,1056],[1148,1142,1056],[914,1148,1056],[916,914,1056],[1241,1142,1197],[1253,1241,1197],[1148,1253,1197],[1142,1148,1197],[1332,1241,1298],[1358,1332,1298],[1253,1358,1298],[1241,1253,1298],[1435,1332,1393],[1466,1435,1393],[1358,1466,1393],[1332,1358,1393],[1148,914,1064],[1154,1148,1064],[912,1154,1064],[914,912,1064],[1253,1148,1211],[1261,1253,1211],[1154,1261,1211],[1148,1154,1211],[1358,1253,1310],[1366,1358,1310],[1261,1366,1310],[1253,1261,1310],[1466,1358,1413],[1478,1466,1413],[1366,1478,1413],[1358,1366,1413],[1509,1435,1493],[1526,1509,1493],[1466,1526,1493],[1435,1466,1493],[1554,1509,1536],[1569,1554,1536],[1526,1569,1536],[1509,1526,1536],[1571,1554,1573],[1610,1571,1573],[1569,1610,1573],[1554,1569,1573],[1585,1571,1598],[1622,1585,1598],[1610,1622,1598],[1571,1610,1598],[1526,1466,1507],[1534,1526,1507],[1478,1534,1507],[1466,1478,1507],[1569,1526,1560],[1588,1569,1560],[1534,1588,1560],[1526,1534,1560],[1610,1569,1600],[1625,1610,1600],[1588,1625,1600],[1569,1588,1600],[1622,1610,1623],[1633,1622,1623],[1625,1633,1623],[1610,1625,1623],[1626,1633,1628],[1621,1626,1628],[1629,1621,1628],[1633,1629,1628],[1589,1626,1607],[1584,1589,1607],[1621,1584,1607],[1626,1621,1607],[1621,1629,1616],[1603,1621,1616],[1612,1603,1616],[1629,1612,1616],[1584,1621,1593],[1568,1584,1593],[1603,1568,1593],[1621,1603,1593],[1535,1589,1563],[1529,1535,1563],[1584,1529,1563],[1589,1584,1563],[1479,1535,1512],[1473,1479,1512],[1529,1473,1512],[1535,1529,1512],[1529,1584,1557],[1521,1529,1557],[1568,1521,1557],[1584,1568,1557],[1473,1529,1504],[1452,1473,1504],[1521,1452,1504],[1529,1521,1504],[1603,1612,1580],[1559,1603,1580],[1566,1559,1580],[1612,1566,1580],[1568,1603,1565],[1525,1568,1565],[1559,1525,1565],[1603,1559,1565],[1521,1568,1523],[1484,1521,1523],[1525,1484,1523],[1568,1525,1523],[1452,1521,1477],[1406,1452,1477],[1484,1406,1477],[1521,1484,1477],[1367,1479,1417],[1361,1367,1417],[1473,1361,1417],[1479,1473,1417],[1262,1367,1313],[1260,1262,1313],[1361,1260,1313],[1367,1361,1313],[1361,1473,1404],[1355,1361,1404],[1452,1355,1404],[1473,1452,1404],[1260,1361,1303],[1248,1260,1303],[1355,1248,1303],[1361,1355,1303],[1155,1262,1214],[1151,1155,1214],[1260,1151,1214],[1262,1260,1214],[913,1155,1067],[911,913,1067],[1151,911,1067],[1155,1151,1067],[1151,1260,1204],[1147,1151,1204],[1248,1147,1204],[1260,1248,1204],[911,1151,1062],[909,911,1062],[1147,909,1062],[1151,1147,1062],[1355,1452,1384],[1323,1355,1384],[1406,1323,1384],[1452,1406,1384],[1248,1355,1287],[1236,1248,1287],[1323,1236,1287],[1355,1323,1287],[1147,1248,1190],[1135,1147,1190],[1236,1135,1190],[1248,1236,1190],[909,1147,1051],[907,909,1051],[1135,907,1051],[1147,1135,1051],[1559,1566,1531],[1514,1559,1531],[1515,1514,1531],[1566,1515,1531],[1525,1559,1517],[1486,1525,1517],[1514,1486,1517],[1559,1514,1517],[1484,1525,1488],[1438,1484,1488],[1486,1438,1488],[1525,1486,1488],[1406,1484,1425],[1363,1406,1425],[1438,1363,1425],[1484,1438,1425],[1514,1515,1506],[1498,1514,1506],[1501,1498,1506],[1515,1501,1506],[1486,1514,1492],[1463,1486,1492],[1498,1463,1492],[1514,1498,1492],[1438,1486,1446],[1408,1438,1446],[1463,1408,1446],[1486,1463,1446],[1363,1438,1386],[1343,1363,1386],[1408,1343,1386],[1438,1408,1386],[1323,1406,1337],[1293,1323,1337],[1363,1293,1337],[1406,1363,1337],[1236,1323,1268],[1220,1236,1268],[1293,1220,1268],[1323,1293,1268],[1135,1236,1182],[1122,1135,1182],[1220,1122,1182],[1236,1220,1182],[907,1135,1035],[905,907,1035],[1122,905,1035],[1135,1122,1035],[1293,1363,1317],[1281,1293,1317],[1343,1281,1317],[1363,1343,1317],[1220,1293,1246],[1208,1220,1246],[1281,1208,1246],[1293,1281,1246],[1122,1220,1172],[1114,1122,1172],[1208,1114,1172],[1220,1208,1172],[905,1122,1026],[903,905,1026],[1114,903,1026],[1122,1114,1026],[700,913,788],[704,700,788],[911,704,788],[913,911,788],[593,700,641],[595,593,641],[704,595,641],[700,704,641],[704,911,793],[708,704,793],[909,708,793],[911,909,793],[595,704,651],[607,595,651],[708,607,651],[704,708,651],[488,593,542],[494,488,542],[595,494,542],[593,595,542],[376,488,438],[382,376,438],[494,382,438],[488,494,438],[494,595,552],[500,494,552],[607,500,552],[595,607,552],[382,494,451],[403,382,451],[500,403,451],[494,500,451],[708,909,804],[718,708,804],[907,718,804],[909,907,804],[607,708,665],[619,607,665],[718,619,665],[708,718,665],[500,607,568],[532,500,568],[619,532,568],[607,619,568],[403,500,471],[449,403,471],[532,449,471],[500,532,471],[312,376,340],[318,312,340],[382,318,340],[376,382,340],[274,312,300],[285,274,300],[318,285,300],[312,318,300],[318,382,350],[327,318,350],[403,327,350],[382,403,350],[285,318,306],[295,285,306],[327,295,306],[318,327,306],[243,274,264],[250,243,264],[285,250,264],[274,285,264],[232,243,239],[237,232,239],[250,237,239],[243,250,239],[250,285,272],[266,250,272],[295,266,272],[285,295,272],[237,250,254],[255,237,254],[266,255,254],[250,266,254],[327,403,378],[371,327,378],[449,371,378],[403,449,378],[295,327,324],[322,295,324],[371,322,324],[327,371,324],[266,295,298],[304,266,298],[322,304,298],[295,322,298],[255,266,287],[296,255,287],[304,296,287],[266,304,287],[718,907,820],[733,718,820],[905,733,820],[907,905,820],[619,718,673],[635,619,673],[733,635,673],[718,733,673],[532,619,587],[562,532,587],[635,562,587],[619,635,587],[449,532,518],[492,449,518],[562,492,518],[532,562,518],[733,905,829],[739,733,829],[903,739,829],[905,903,829],[635,733,683],[645,635,683],[739,645,683],[733,739,683],[562,635,609],[572,562,609],[645,572,609],[635,645,609],[492,562,538],[510,492,538],[572,510,538],[562,572,538],[371,449,430],[417,371,430],[492,417,430],[449,492,430],[322,371,367],[369,322,367],[417,369,367],[371,417,367],[304,322,333],[338,304,333],[369,338,333],[322,369,333],[296,304,316],[334,296,316],[338,334,316],[304,338,316],[417,492,469],[445,417,469],[510,445,469],[492,510,469],[369,417,409],[390,369,409],[445,390,409],[417,445,409],[338,369,363],[355,338,363],[390,355,363],[369,390,363],[334,338,346],[351,334,346],[355,351,346],[338,355,346],[242,232,238],[249,242,238],[237,249,238],[232,237,238],[273,242,263],[284,273,263],[249,284,263],[242,249,263],[249,237,253],[265,249,253],[255,265,253],[237,255,253],[284,249,271],[294,284,271],[265,294,271],[249,265,271],[311,273,299],[317,311,299],[284,317,299],[273,284,299],[375,311,339],[381,375,339],[317,381,339],[311,317,339],[317,284,305],[326,317,305],[294,326,305],[284,294,305],[381,317,349],[402,381,349],[326,402,349],[317,326,349],[265,255,286],[303,265,286],[296,303,286],[255,296,286],[294,265,297],[321,294,297],[303,321,297],[265,303,297],[326,294,323],[370,326,323],[321,370,323],[294,321,323],[402,326,377],[448,402,377],[370,448,377],[326,370,377],[487,375,437],[493,487,437],[381,493,437],[375,381,437],[592,487,541],[594,592,541],[493,594,541],[487,493,541],[493,381,450],[499,493,450],[402,499,450],[381,402,450],[594,493,551],[606,594,551],[499,606,551],[493,499,551],[699,592,640],[703,699,640],[594,703,640],[592,594,640],[912,699,787],[910,912,787],[703,910,787],[699,703,787],[703,594,650],[707,703,650],[606,707,650],[594,606,650],[910,703,792],[908,910,792],[707,908,792],[703,707,792],[499,402,470],[531,499,470],[448,531,470],[402,448,470],[606,499,567],[618,606,567],[531,618,567],[499,531,567],[707,606,664],[719,707,664],[618,719,664],[606,618,664],[908,707,803],[906,908,803],[719,906,803],[707,719,803],[303,296,315],[337,303,315],[334,337,315],[296,334,315],[321,303,332],[368,321,332],[337,368,332],[303,337,332],[370,321,366],[416,370,366],[368,416,366],[321,368,366],[448,370,429],[491,448,429],[416,491,429],[370,416,429],[337,334,345],[354,337,345],[351,354,345],[334,351,345],[368,337,362],[389,368,362],[354,389,362],[337,354,362],[416,368,408],[444,416,408],[389,444,408],[368,389,408],[491,416,468],[509,491,468],[444,509,468],[416,444,468],[531,448,517],[561,531,517],[491,561,517],[448,491,517],[618,531,586],[634,618,586],[561,634,586],[531,561,586],[719,618,672],[732,719,672],[634,732,672],[618,634,672],[906,719,819],[904,906,819],[732,904,819],[719,732,819],[561,491,537],[571,561,537],[509,571,537],[491,509,537],[634,561,608],[644,634,608],[571,644,608],[561,571,608],[732,634,682],[738,732,682],[644,738,682],[634,644,682],[904,732,828],[902,904,828],[738,902,828],[732,738,828],[1154,912,1066],[1150,1154,1066],[910,1150,1066],[912,910,1066],[1261,1154,1213],[1259,1261,1213],[1150,1259,1213],[1154,1150,1213],[1150,910,1061],[1146,1150,1061],[908,1146,1061],[910,908,1061],[1259,1150,1203],[1247,1259,1203],[1146,1247,1203],[1150,1146,1203],[1366,1261,1312],[1360,1366,1312],[1259,1360,1312],[1261,1259,1312],[1478,1366,1416],[1472,1478,1416],[1360,1472,1416],[1366,1360,1416],[1360,1259,1302],[1354,1360,1302],[1247,1354,1302],[1259,1247,1302],[1472,1360,1403],[1451,1472,1403],[1354,1451,1403],[1360,1354,1403],[1146,908,1050],[1136,1146,1050],[906,1136,1050],[908,906,1050],[1247,1146,1189],[1235,1247,1189],[1136,1235,1189],[1146,1136,1189],[1354,1247,1286],[1322,1354,1286],[1235,1322,1286],[1247,1235,1286],[1451,1354,1383],[1405,1451,1383],[1322,1405,1383],[1354,1322,1383],[1534,1478,1511],[1528,1534,1511],[1472,1528,1511],[1478,1472,1511],[1588,1534,1562],[1583,1588,1562],[1528,1583,1562],[1534,1528,1562],[1528,1472,1503],[1520,1528,1503],[1451,1520,1503],[1472,1451,1503],[1583,1528,1556],[1567,1583,1556],[1520,1567,1556],[1528,1520,1556],[1625,1588,1606],[1620,1625,1606],[1583,1620,1606],[1588,1583,1606],[1633,1625,1627],[1629,1633,1627],[1620,1629,1627],[1625,1620,1627],[1620,1583,1592],[1602,1620,1592],[1567,1602,1592],[1583,1567,1592],[1629,1620,1615],[1612,1629,1615],[1602,1612,1615],[1620,1602,1615],[1520,1451,1476],[1483,1520,1476],[1405,1483,1476],[1451,1405,1476],[1567,1520,1522],[1524,1567,1522],[1483,1524,1522],[1520,1483,1522],[1602,1567,1564],[1558,1602,1564],[1524,1558,1564],[1567,1524,1564],[1612,1602,1579],[1566,1612,1579],[1558,1566,1579],[1602,1558,1579],[1136,906,1034],[1121,1136,1034],[904,1121,1034],[906,904,1034],[1235,1136,1181],[1219,1235,1181],[1121,1219,1181],[1136,1121,1181],[1322,1235,1267],[1292,1322,1267],[1219,1292,1267],[1235,1219,1267],[1405,1322,1336],[1362,1405,1336],[1292,1362,1336],[1322,1292,1336],[1121,904,1025],[1113,1121,1025],[902,1113,1025],[904,902,1025],[1219,1121,1171],[1207,1219,1171],[1113,1207,1171],[1121,1113,1171],[1292,1219,1245],[1280,1292,1245],[1207,1280,1245],[1219,1207,1245],[1362,1292,1316],[1342,1362,1316],[1280,1342,1316],[1292,1280,1316],[1483,1405,1424],[1437,1483,1424],[1362,1437,1424],[1405,1362,1424],[1524,1483,1487],[1485,1524,1487],[1437,1485,1487],[1483,1437,1487],[1558,1524,1516],[1513,1558,1516],[1485,1513,1516],[1524,1485,1516],[1566,1558,1530],[1515,1566,1530],[1513,1515,1530],[1558,1513,1530],[1437,1362,1385],[1407,1437,1385],[1342,1407,1385],[1362,1342,1385],[1485,1437,1445],[1462,1485,1445],[1407,1462,1445],[1437,1407,1445],[1513,1485,1491],[1497,1513,1491],[1462,1497,1491],[1485,1462,1491],[1515,1513,1505],[1501,1515,1505],[1497,1501,1505],[1513,1497,1505],[331,325,277],[228,331,277],[231,228,277],[325,231,277],[336,331,279],[224,336,279],[228,224,279],[331,228,279],[228,231,200],[173,228,200],[178,173,200],[231,178,200],[224,228,198],[167,224,198],[173,167,198],[228,173,198],[348,336,281],[222,348,281],[224,222,281],[336,224,281],[352,348,283],[210,352,283],[222,210,283],[348,222,283],[222,224,193],[150,222,193],[167,150,193],[224,167,193],[210,222,183],[142,210,183],[150,142,183],[222,150,183],[177,178,165],[136,177,165],[141,136,165],[178,141,165],[173,177,162],[127,173,162],[136,127,162],[177,136,162],[167,173,158],[131,167,158],[152,131,158],[173,152,158],[131,152,129],[82,131,129],[127,82,129],[152,127,129],[136,141,134],[114,136,134],[121,114,134],[141,121,134],[127,136,118],[93,127,118],[114,93,118],[136,114,118],[114,121,112],[101,114,112],[108,101,112],[121,108,112],[93,114,95],[90,93,95],[101,90,95],[114,101,95],[82,127,88],[59,82,88],[93,59,88],[127,93,88],[59,93,74],[52,59,74],[90,52,74],[93,90,74],[150,167,140],[86,150,140],[131,86,140],[167,131,140],[86,131,84],[50,86,84],[82,50,84],[131,82,84],[148,150,120],[76,148,120],[86,76,120],[150,86,120],[142,148,110],[72,142,110],[76,72,110],[148,76,110],[76,86,65],[36,76,65],[50,36,65],[86,50,65],[72,76,57],[34,72,57],[36,34,57],[76,36,57],[50,82,55],[27,50,55],[59,27,55],[82,59,55],[27,59,42],[18,27,42],[52,18,42],[59,52,42],[36,50,33],[12,36,33],[27,12,33],[50,27,33],[34,36,24],[8,34,24],[12,8,24],[36,12,24],[12,27,16],[2,12,16],[18,2,16],[27,18,16],[8,12,7],[0,8,7],[2,0,7],[12,2,7],[347,352,282],[221,347,282],[210,221,282],[352,210,282],[335,347,280],[223,335,280],[221,223,280],[347,221,280],[221,210,182],[149,221,182],[142,149,182],[210,142,182],[223,221,192],[166,223,192],[149,166,192],[221,149,192],[330,335,278],[227,330,278],[223,227,278],[335,223,278],[325,330,276],[231,325,276],[227,231,276],[330,227,276],[227,223,197],[172,227,197],[166,172,197],[223,166,197],[231,227,199],[178,231,199],[172,178,199],[227,172,199],[147,142,109],[75,147,109],[72,75,109],[142,72,109],[149,147,119],[85,149,119],[75,85,119],[147,75,119],[75,72,56],[35,75,56],[34,35,56],[72,34,56],[85,75,64],[49,85,64],[35,49,64],[75,35,64],[166,149,139],[130,166,139],[85,130,139],[149,85,139],[130,85,83],[81,130,83],[49,81,83],[85,49,83],[35,34,23],[11,35,23],[8,11,23],[34,8,23],[49,35,32],[26,49,32],[11,26,32],[35,11,32],[11,8,6],[1,11,6],[0,1,6],[8,0,6],[26,11,15],[17,26,15],[1,17,15],[11,1,15],[81,49,54],[58,81,54],[26,58,54],[49,26,54],[58,26,41],[51,58,41],[17,51,41],[26,17,41],[172,166,157],[151,172,157],[130,151,157],[166,130,157],[151,130,128],[126,151,128],[81,126,128],[130,81,128],[176,172,161],[135,176,161],[126,135,161],[172,126,161],[178,176,164],[141,178,164],[135,141,164],[176,135,164],[126,81,87],[92,126,87],[58,92,87],[81,58,87],[92,58,73],[89,92,73],[51,89,73],[58,51,73],[135,126,117],[113,135,117],[92,113,117],[126,92,117],[141,135,133],[121,141,133],[113,121,133],[135,113,133],[113,92,94],[100,113,94],[89,100,94],[92,89,94],[121,113,111],[108,121,111],[100,108,111],[113,100,111],[101,108,116],[125,101,116],[132,125,116],[108,132,116],[90,101,103],[105,90,103],[125,105,103],[101,125,103],[52,90,78],[71,52,78],[105,71,78],[90,105,78],[125,132,146],[156,125,146],[163,156,146],[132,163,146],[105,125,144],[154,105,144],[156,154,144],[125,156,144],[71,105,123],[138,71,123],[154,138,123],[105,154,123],[18,52,38],[22,18,38],[63,22,38],[52,63,38],[22,63,48],[40,22,48],[71,40,48],[63,71,48],[2,18,14],[10,2,14],[22,10,14],[18,22,14],[0,2,4],[5,0,4],[10,5,4],[2,10,4],[10,22,29],[31,10,29],[40,31,29],[22,40,29],[5,10,20],[25,5,20],[31,25,20],[10,31,20],[40,71,69],[67,40,69],[97,67,69],[71,97,69],[67,97,99],[107,67,99],[138,107,99],[97,138,99],[31,40,46],[61,31,46],[67,61,46],[40,67,46],[25,31,44],[53,25,44],[61,53,44],[31,61,44],[53,67,80],[91,53,80],[107,91,80],[67,107,80],[154,163,175],[195,154,175],[196,195,175],[163,196,175],[138,154,171],[189,138,171],[195,189,171],[154,195,171],[195,196,202],[207,195,202],[203,207,202],[196,203,202],[205,203,226],[234,205,226],[232,234,226],[203,232,226],[207,205,230],[236,207,230],[234,236,230],[205,234,230],[191,195,209],[241,191,209],[236,241,209],[195,236,209],[189,191,212],[248,189,212],[241,248,212],[191,241,212],[107,138,169],[185,107,169],[189,185,169],[138,189,169],[91,107,160],[179,91,160],[185,179,160],[107,185,160],[187,189,214],[252,187,214],[248,252,214],[189,248,214],[185,187,216],[259,185,216],[252,259,216],[187,252,216],[181,185,218],[261,181,218],[259,261,218],[185,259,218],[179,181,220],[262,179,220],[261,262,220],[181,261,220],[1,0,3],[9,1,3],[5,9,3],[0,5,3],[17,1,13],[21,17,13],[9,21,13],[1,9,13],[9,5,19],[30,9,19],[25,30,19],[5,25,19],[21,9,28],[39,21,28],[30,39,28],[9,30,28],[51,17,37],[62,51,37],[21,62,37],[17,21,37],[62,21,47],[70,62,47],[39,70,47],[21,39,47],[30,25,43],[60,30,43],[53,60,43],[25,53,43],[39,30,45],[66,39,45],[60,66,45],[30,60,45],[66,53,79],[106,66,79],[91,106,79],[53,91,79],[70,39,68],[96,70,68],[66,96,68],[39,66,68],[96,66,98],[137,96,98],[106,137,98],[66,106,98],[89,51,77],[104,89,77],[70,104,77],[51,70,77],[100,89,102],[124,100,102],[104,124,102],[89,104,102],[108,100,115],[132,108,115],[124,132,115],[100,124,115],[104,70,122],[153,104,122],[137,153,122],[70,137,122],[124,104,143],[155,124,143],[153,155,143],[104,153,143],[132,124,145],[163,132,145],[155,163,145],[124,155,145],[106,91,159],[184,106,159],[179,184,159],[91,179,159],[137,106,168],[188,137,168],[184,188,168],[106,184,168],[180,179,219],[260,180,219],[262,260,219],[179,262,219],[184,180,217],[258,184,217],[260,258,217],[180,260,217],[186,184,215],[251,186,215],[258,251,215],[184,258,215],[188,186,213],[247,188,213],[251,247,213],[186,251,213],[153,137,170],[194,153,170],[188,194,170],[137,188,170],[163,153,174],[196,163,174],[194,196,174],[153,194,174],[190,188,211],[240,190,211],[247,240,211],[188,247,211],[194,190,208],[235,194,208],[240,235,208],[190,240,208],[196,194,201],[203,196,201],[206,203,201],[194,206,201],[204,206,229],[233,204,229],[235,233,229],[206,235,229],[203,204,225],[232,203,225],[233,232,225],[204,233,225],[1552,1553,1587],[1632,1552,1587],[1630,1632,1587],[1553,1630,1587],[1550,1552,1591],[1637,1550,1591],[1632,1637,1591],[1552,1632,1591],[1632,1630,1647],[1665,1632,1647],[1663,1665,1647],[1630,1663,1647],[1637,1632,1651],[1673,1637,1651],[1665,1673,1651],[1632,1665,1651],[1548,1550,1595],[1641,1548,1595],[1637,1641,1595],[1550,1637,1595],[1546,1548,1597],[1645,1546,1597],[1641,1645,1597],[1548,1641,1597],[1641,1637,1657],[1679,1641,1657],[1673,1679,1657],[1637,1673,1657],[1645,1641,1660],[1688,1645,1660],[1679,1688,1660],[1641,1679,1660],[1665,1663,1677],[1695,1665,1677],[1693,1695,1677],[1663,1693,1677],[1673,1665,1683],[1705,1673,1683],[1695,1705,1683],[1665,1695,1683],[1695,1693,1707],[1718,1695,1707],[1712,1718,1707],[1693,1712,1707],[1705,1695,1709],[1725,1705,1709],[1718,1725,1709],[1695,1718,1709],[1679,1673,1692],[1714,1679,1692],[1705,1714,1692],[1673,1705,1692],[1688,1679,1703],[1729,1688,1703],[1714,1729,1703],[1679,1714,1703],[1714,1705,1723],[1739,1714,1723],[1725,1739,1723],[1705,1725,1723],[1729,1714,1733],[1752,1729,1733],[1739,1752,1733],[1714,1739,1733],[1544,1546,1605],[1649,1544,1605],[1645,1649,1605],[1546,1645,1605],[1542,1544,1576],[1614,1542,1576],[1609,1614,1576],[1544,1609,1576],[1614,1609,1635],[1653,1614,1635],[1649,1653,1635],[1609,1649,1635],[1649,1645,1669],[1699,1649,1669],[1688,1699,1669],[1645,1688,1669],[1653,1649,1662],[1681,1653,1662],[1675,1681,1662],[1649,1675,1662],[1681,1675,1690],[1711,1681,1690],[1699,1711,1690],[1675,1699,1690],[1540,1542,1578],[1618,1540,1578],[1614,1618,1578],[1542,1614,1578],[1618,1614,1639],[1655,1618,1639],[1653,1655,1639],[1614,1653,1639],[1538,1540,1582],[1619,1538,1582],[1618,1619,1582],[1540,1618,1582],[1619,1618,1643],[1658,1619,1643],[1655,1658,1643],[1618,1655,1643],[1655,1653,1667],[1685,1655,1667],[1681,1685,1667],[1653,1681,1667],[1685,1681,1697],[1720,1685,1697],[1711,1720,1697],[1681,1711,1697],[1658,1655,1671],[1686,1658,1671],[1685,1686,1671],[1655,1685,1671],[1686,1685,1701],[1721,1686,1701],[1720,1721,1701],[1685,1720,1701],[1699,1688,1716],[1743,1699,1716],[1729,1743,1716],[1688,1729,1716],[1711,1699,1727],[1754,1711,1727],[1743,1754,1727],[1699,1743,1727],[1743,1729,1748],[1770,1743,1748],[1752,1770,1748],[1729,1752,1748],[1754,1743,1760],[1786,1754,1760],[1770,1786,1760],[1743,1770,1760],[1720,1711,1735],[1762,1720,1735],[1754,1762,1735],[1711,1754,1735],[1721,1720,1741],[1768,1721,1741],[1762,1768,1741],[1720,1762,1741],[1762,1754,1776],[1796,1762,1776],[1786,1796,1776],[1754,1786,1776],[1768,1762,1782],[1801,1768,1782],[1796,1801,1782],[1762,1796,1782],[1718,1712,1731],[1746,1718,1731],[1744,1746,1731],[1712,1744,1731],[1725,1718,1737],[1758,1725,1737],[1746,1758,1737],[1718,1746,1737],[1739,1725,1750],[1780,1739,1750],[1758,1780,1750],[1725,1758,1750],[1752,1739,1765],[1800,1752,1765],[1780,1800,1765],[1739,1780,1765],[1746,1744,1756],[1772,1746,1756],[1763,1772,1756],[1744,1763,1756],[1758,1746,1767],[1788,1758,1767],[1772,1788,1767],[1746,1772,1767],[1772,1763,1790],[1814,1772,1790],[1806,1814,1790],[1763,1806,1790],[1788,1772,1803],[1832,1788,1803],[1814,1832,1803],[1772,1814,1803],[1780,1758,1784],[1816,1780,1784],[1788,1816,1784],[1758,1788,1784],[1800,1780,1808],[1839,1800,1808],[1816,1839,1808],[1780,1816,1808],[1839,1788,1845],[1898,1839,1845],[1832,1898,1845],[1788,1832,1845],[1770,1752,1774],[1794,1770,1774],[1778,1794,1774],[1752,1778,1774],[1786,1770,1792],[1810,1786,1792],[1794,1810,1792],[1770,1794,1792],[1794,1778,1798],[1822,1794,1798],[1800,1822,1798],[1778,1800,1798],[1810,1794,1818],[1843,1810,1818],[1822,1843,1818],[1794,1822,1818],[1796,1786,1805],[1824,1796,1805],[1810,1824,1805],[1786,1810,1805],[1801,1796,1812],[1825,1801,1812],[1824,1825,1812],[1796,1824,1812],[1824,1810,1830],[1861,1824,1830],[1843,1861,1830],[1810,1843,1830],[1825,1824,1841],[1870,1825,1841],[1861,1870,1841],[1824,1861,1841],[1822,1800,1828],[1874,1822,1828],[1839,1874,1828],[1800,1839,1828],[1843,1822,1859],[1892,1843,1859],[1874,1892,1859],[1822,1874,1859],[1892,1839,1886],[1911,1892,1886],[1878,1911,1886],[1839,1878,1886],[1911,1878,1909],[1935,1911,1909],[1898,1935,1909],[1878,1898,1909],[1861,1843,1880],[1902,1861,1880],[1892,1902,1880],[1843,1892,1880],[1870,1861,1890],[1905,1870,1890],[1902,1905,1890],[1861,1902,1890],[1902,1892,1907],[1923,1902,1907],[1911,1923,1907],[1892,1911,1907],[1923,1911,1930],[1949,1923,1930],[1935,1949,1930],[1911,1935,1930],[1905,1902,1913],[1926,1905,1913],[1923,1926,1913],[1902,1923,1913],[1926,1923,1939],[1952,1926,1939],[1949,1952,1939],[1923,1949,1939],[1539,1538,1581],[1617,1539,1581],[1619,1617,1581],[1538,1619,1581],[1617,1619,1642],[1654,1617,1642],[1658,1654,1642],[1619,1658,1642],[1541,1539,1577],[1613,1541,1577],[1617,1613,1577],[1539,1617,1577],[1613,1617,1638],[1652,1613,1638],[1654,1652,1638],[1617,1654,1638],[1654,1658,1670],[1684,1654,1670],[1686,1684,1670],[1658,1686,1670],[1684,1686,1700],[1719,1684,1700],[1721,1719,1700],[1686,1721,1700],[1652,1654,1666],[1680,1652,1666],[1684,1680,1666],[1654,1684,1666],[1680,1684,1696],[1710,1680,1696],[1719,1710,1696],[1684,1719,1696],[1543,1541,1575],[1608,1543,1575],[1613,1608,1575],[1541,1613,1575],[1608,1613,1634],[1648,1608,1634],[1652,1648,1634],[1613,1652,1634],[1545,1543,1604],[1644,1545,1604],[1648,1644,1604],[1543,1648,1604],[1648,1652,1661],[1674,1648,1661],[1680,1674,1661],[1652,1680,1661],[1674,1680,1689],[1698,1674,1689],[1710,1698,1689],[1680,1710,1689],[1644,1648,1668],[1687,1644,1668],[1698,1687,1668],[1648,1698,1668],[1719,1721,1740],[1761,1719,1740],[1768,1761,1740],[1721,1768,1740],[1710,1719,1734],[1753,1710,1734],[1761,1753,1734],[1719,1761,1734],[1761,1768,1781],[1795,1761,1781],[1801,1795,1781],[1768,1801,1781],[1753,1761,1775],[1785,1753,1775],[1795,1785,1775],[1761,1795,1775],[1698,1710,1726],[1742,1698,1726],[1753,1742,1726],[1710,1753,1726],[1687,1698,1715],[1728,1687,1715],[1742,1728,1715],[1698,1742,1715],[1742,1753,1759],[1769,1742,1759],[1785,1769,1759],[1753,1785,1759],[1728,1742,1747],[1751,1728,1747],[1769,1751,1747],[1742,1769,1747],[1547,1545,1596],[1640,1547,1596],[1644,1640,1596],[1545,1644,1596],[1549,1547,1594],[1636,1549,1594],[1640,1636,1594],[1547,1640,1594],[1640,1644,1659],[1678,1640,1659],[1687,1678,1659],[1644,1687,1659],[1636,1640,1656],[1672,1636,1656],[1678,1672,1656],[1640,1678,1656],[1551,1549,1590],[1631,1551,1590],[1636,1631,1590],[1549,1636,1590],[1553,1551,1586],[1630,1553,1586],[1631,1630,1586],[1551,1631,1586],[1631,1636,1650],[1664,1631,1650],[1672,1664,1650],[1636,1672,1650],[1630,1631,1646],[1663,1630,1646],[1664,1663,1646],[1631,1664,1646],[1678,1687,1702],[1713,1678,1702],[1728,1713,1702],[1687,1728,1702],[1672,1678,1691],[1704,1672,1691],[1713,1704,1691],[1678,1713,1691],[1713,1728,1732],[1738,1713,1732],[1751,1738,1732],[1728,1751,1732],[1704,1713,1722],[1724,1704,1722],[1738,1724,1722],[1713,1738,1722],[1664,1672,1682],[1694,1664,1682],[1704,1694,1682],[1672,1704,1682],[1663,1664,1676],[1693,1663,1676],[1694,1693,1676],[1664,1694,1676],[1694,1704,1708],[1717,1694,1708],[1724,1717,1708],[1704,1724,1708],[1693,1694,1706],[1712,1693,1706],[1717,1712,1706],[1694,1717,1706],[1795,1801,1811],[1823,1795,1811],[1825,1823,1811],[1801,1825,1811],[1785,1795,1804],[1809,1785,1804],[1823,1809,1804],[1795,1823,1804],[1823,1825,1840],[1860,1823,1840],[1870,1860,1840],[1825,1870,1840],[1809,1823,1829],[1842,1809,1829],[1860,1842,1829],[1823,1860,1829],[1769,1785,1791],[1793,1769,1791],[1809,1793,1791],[1785,1809,1791],[1751,1769,1773],[1777,1751,1773],[1793,1777,1773],[1769,1793,1773],[1793,1809,1817],[1821,1793,1817],[1842,1821,1817],[1809,1842,1817],[1777,1793,1797],[1799,1777,1797],[1821,1799,1797],[1793,1821,1797],[1860,1870,1889],[1901,1860,1889],[1905,1901,1889],[1870,1905,1889],[1842,1860,1879],[1891,1842,1879],[1901,1891,1879],[1860,1901,1879],[1901,1905,1912],[1922,1901,1912],[1926,1922,1912],[1905,1926,1912],[1922,1926,1938],[1948,1922,1938],[1952,1948,1938],[1926,1952,1938],[1891,1901,1906],[1910,1891,1906],[1922,1910,1906],[1901,1922,1906],[1910,1922,1929],[1934,1910,1929],[1948,1934,1929],[1922,1948,1929],[1821,1842,1858],[1873,1821,1858],[1891,1873,1858],[1842,1891,1858],[1799,1821,1827],[1838,1799,1827],[1873,1838,1827],[1821,1873,1827],[1838,1891,1885],[1877,1838,1885],[1910,1877,1885],[1891,1910,1885],[1877,1910,1908],[1895,1877,1908],[1934,1895,1908],[1910,1934,1908],[1738,1751,1764],[1779,1738,1764],[1799,1779,1764],[1751,1799,1764],[1724,1738,1749],[1757,1724,1749],[1779,1757,1749],[1738,1779,1749],[1717,1724,1736],[1745,1717,1736],[1757,1745,1736],[1724,1757,1736],[1712,1717,1730],[1744,1712,1730],[1745,1744,1730],[1717,1745,1730],[1779,1799,1807],[1815,1779,1807],[1838,1815,1807],[1799,1838,1807],[1757,1779,1783],[1787,1757,1783],[1815,1787,1783],[1779,1815,1783],[1787,1838,1844],[1831,1787,1844],[1895,1831,1844],[1838,1895,1844],[1745,1757,1766],[1771,1745,1766],[1787,1771,1766],[1757,1787,1766],[1744,1745,1755],[1763,1744,1755],[1771,1763,1755],[1745,1771,1755],[1771,1787,1802],[1813,1771,1802],[1831,1813,1802],[1787,1831,1802],[1763,1771,1789],[1806,1763,1789],[1813,1806,1789],[1771,1813,1789],[1814,1806,1820],[1836,1814,1820],[1826,1836,1820],[1806,1826,1820],[1832,1814,1834],[1872,1832,1834],[1836,1872,1834],[1814,1836,1834],[1898,1832,1888],[1915,1898,1888],[1872,1915,1888],[1832,1872,1888],[1836,1826,1847],[1857,1836,1847],[1850,1857,1847],[1826,1850,1847],[1872,1836,1863],[1882,1872,1863],[1857,1882,1863],[1836,1857,1863],[1915,1872,1900],[1919,1915,1900],[1882,1919,1900],[1872,1882,1900],[1935,1898,1928],[1954,1935,1928],[1915,1954,1928],[1898,1915,1928],[1949,1935,1951],[1969,1949,1951],[1954,1969,1951],[1935,1954,1951],[1952,1949,1962],[1974,1952,1962],[1969,1974,1962],[1949,1969,1962],[1954,1915,1941],[1958,1954,1941],[1919,1958,1941],[1915,1919,1941],[1969,1954,1965],[1971,1969,1965],[1958,1971,1965],[1954,1958,1965],[1974,1969,1973],[1975,1974,1973],[1971,1975,1973],[1969,1971,1973],[1857,1850,1855],[1867,1857,1855],[1853,1867,1855],[1850,1853,1855],[1882,1857,1876],[1884,1882,1876],[1867,1884,1876],[1857,1867,1876],[1919,1882,1904],[1917,1919,1904],[1884,1917,1904],[1882,1884,1904],[1867,1853,1852],[1849,1867,1852],[1837,1849,1852],[1853,1837,1852],[1884,1867,1869],[1865,1884,1869],[1849,1865,1869],[1867,1849,1869],[1917,1884,1894],[1897,1917,1894],[1865,1897,1894],[1884,1865,1894],[1958,1919,1937],[1947,1958,1937],[1917,1947,1937],[1919,1917,1937],[1971,1958,1960],[1956,1971,1960],[1947,1956,1960],[1958,1947,1960],[1975,1971,1967],[1963,1975,1967],[1956,1963,1967],[1971,1956,1967],[1947,1917,1921],[1925,1947,1921],[1897,1925,1921],[1917,1897,1921],[1956,1947,1943],[1932,1956,1943],[1925,1932,1943],[1947,1925,1943],[1963,1956,1945],[1933,1963,1945],[1932,1933,1945],[1956,1932,1945],[1948,1952,1961],[1968,1948,1961],[1974,1968,1961],[1952,1974,1961],[1934,1948,1950],[1953,1934,1950],[1968,1953,1950],[1948,1968,1950],[1895,1934,1927],[1914,1895,1927],[1953,1914,1927],[1934,1953,1927],[1968,1974,1972],[1970,1968,1972],[1975,1970,1972],[1974,1975,1972],[1953,1968,1964],[1957,1953,1964],[1970,1957,1964],[1968,1970,1964],[1914,1953,1940],[1918,1914,1940],[1957,1918,1940],[1953,1957,1940],[1831,1895,1887],[1871,1831,1887],[1914,1871,1887],[1895,1914,1887],[1813,1831,1833],[1835,1813,1833],[1871,1835,1833],[1831,1871,1833],[1806,1813,1819],[1826,1806,1819],[1835,1826,1819],[1813,1835,1819],[1871,1914,1899],[1881,1871,1899],[1918,1881,1899],[1914,1918,1899],[1835,1871,1862],[1856,1835,1862],[1881,1856,1862],[1871,1881,1862],[1826,1835,1846],[1850,1826,1846],[1856,1850,1846],[1835,1856,1846],[1970,1975,1966],[1955,1970,1966],[1963,1955,1966],[1975,1963,1966],[1957,1970,1959],[1946,1957,1959],[1955,1946,1959],[1970,1955,1959],[1918,1957,1936],[1916,1918,1936],[1946,1916,1936],[1957,1946,1936],[1955,1963,1944],[1931,1955,1944],[1933,1931,1944],[1963,1933,1944],[1946,1955,1942],[1924,1946,1942],[1931,1924,1942],[1955,1931,1942],[1916,1946,1920],[1896,1916,1920],[1924,1896,1920],[1946,1924,1920],[1881,1918,1903],[1883,1881,1903],[1916,1883,1903],[1918,1916,1903],[1856,1881,1875],[1866,1856,1875],[1883,1866,1875],[1881,1883,1875],[1850,1856,1854],[1853,1850,1854],[1866,1853,1854],[1856,1866,1854],[1883,1916,1893],[1864,1883,1893],[1896,1864,1893],[1916,1896,1893],[1866,1883,1868],[1848,1866,1868],[1864,1848,1868],[1883,1864,1868],[1853,1866,1851],[1837,1853,1851],[1848,1837,1851],[1866,1848,1851],[1069,952,992],[1072,1069,992],[952,1072,992],[1069,1072,1094],[1118,1069,1094],[1134,1118,1094],[1072,1134,1094],[1030,952,984],[1069,1030,984],[952,1069,984],[1030,1069,1076],[1080,1030,1076],[1118,1080,1076],[1069,1118,1076],[1118,1134,1133],[1131,1118,1133],[1139,1131,1133],[1134,1139,1133],[1131,1139,1129],[1110,1131,1129],[1127,1110,1129],[1139,1127,1129],[1080,1118,1104],[1088,1080,1104],[1131,1088,1104],[1118,1131,1104],[1088,1131,1096],[1074,1088,1096],[1110,1074,1096],[1131,1110,1096],[980,952,964],[1030,980,964],[952,1030,964],[980,1030,1028],[1002,980,1028],[1080,1002,1028],[1030,1080,1028],[951,952,954],[980,951,954],[952,980,954],[951,980,962],[949,951,962],[1002,949,962],[980,1002,962],[1002,1080,1059],[1012,1002,1059],[1088,1012,1059],[1080,1088,1059],[1012,1088,1053],[998,1012,1053],[1074,998,1053],[1088,1074,1053],[949,1002,974],[947,949,974],[1012,947,974],[1002,1012,974],[947,1012,972],[945,947,972],[998,945,972],[1012,998,972],[1110,1127,1082],[1047,1110,1082],[1060,1047,1082],[1127,1060,1082],[1074,1110,1071],[1004,1074,1071],[1047,1004,1071],[1110,1047,1071],[1047,1060,1039],[1024,1047,1039],[1031,1024,1039],[1060,1031,1039],[1024,1031,1041],[1049,1024,1041],[1063,1049,1041],[1031,1063,1041],[1004,1047,1018],[994,1004,1018],[1024,994,1018],[1047,1024,1018],[994,1024,1020],[1010,994,1020],[1049,1010,1020],[1024,1049,1020],[998,1074,1014],[976,998,1014],[1004,976,1014],[1074,1004,1014],[945,998,960],[943,945,960],[976,943,960],[998,976,960],[976,1004,986],[970,976,986],[994,970,986],[1004,994,986],[970,994,990],[978,970,990],[1010,978,990],[994,1010,990],[943,976,956],[941,943,956],[970,941,956],[976,970,956],[941,970,958],[939,941,958],[978,939,958],[970,978,958],[875,952,901],[951,875,901],[952,951,901],[875,951,893],[853,875,893],[949,853,893],[951,949,893],[825,952,891],[875,825,891],[952,875,891],[825,875,827],[775,825,827],[853,775,827],[875,853,827],[853,949,881],[843,853,881],[947,843,881],[949,947,881],[843,947,883],[857,843,883],[945,857,883],[947,945,883],[775,853,796],[767,775,796],[843,767,796],[853,843,796],[767,843,802],[781,767,802],[857,781,802],[843,857,802],[786,952,871],[825,786,871],[952,825,871],[786,825,779],[737,786,779],[775,737,779],[825,775,779],[782,952,863],[786,782,863],[952,786,863],[782,786,761],[720,782,761],[737,720,761],[786,737,761],[737,775,751],[724,737,751],[767,724,751],[775,767,751],[724,767,759],[745,724,759],[781,745,759],[767,781,759],[720,737,722],[715,720,722],[724,715,722],[737,724,722],[715,724,726],[727,715,726],[745,727,726],[724,745,726],[857,945,895],[879,857,895],[943,879,895],[945,943,895],[781,857,841],[851,781,841],[879,851,841],[857,879,841],[879,943,899],[885,879,899],[941,885,899],[943,941,899],[885,941,897],[877,885,897],[939,877,897],[941,939,897],[851,879,869],[861,851,869],[885,861,869],[879,885,869],[861,885,865],[845,861,865],[877,845,865],[885,877,865],[745,781,784],[808,745,784],[851,808,784],[781,851,784],[727,745,773],[794,727,773],[808,794,773],[745,808,773],[808,851,837],[831,808,837],[861,831,837],[851,861,837],[831,861,835],[806,831,835],[845,806,835],[861,845,835],[794,808,816],[823,794,816],[831,823,816],[808,831,816],[823,831,814],[791,823,814],[806,791,814],[831,806,814],[785,952,862],[782,785,862],[952,782,862],[785,782,760],[736,785,760],[720,736,760],[782,720,760],[824,952,870],[785,824,870],[952,785,870],[824,785,778],[774,824,778],[736,774,778],[785,736,778],[736,720,721],[723,736,721],[715,723,721],[720,715,721],[723,715,725],[744,723,725],[727,744,725],[715,727,725],[774,736,750],[766,774,750],[723,766,750],[736,723,750],[766,723,758],[780,766,758],[744,780,758],[723,744,758],[874,952,890],[824,874,890],[952,824,890],[874,824,826],[852,874,826],[774,852,826],[824,774,826],[950,952,900],[874,950,900],[952,874,900],[950,874,892],[948,950,892],[852,948,892],[874,852,892],[852,774,795],[842,852,795],[766,842,795],[774,766,795],[842,766,801],[856,842,801],[780,856,801],[766,780,801],[948,852,880],[946,948,880],[842,946,880],[852,842,880],[946,842,882],[944,946,882],[856,944,882],[842,856,882],[744,727,772],[807,744,772],[794,807,772],[727,794,772],[780,744,783],[850,780,783],[807,850,783],[744,807,783],[807,794,815],[830,807,815],[823,830,815],[794,823,815],[830,823,813],[805,830,813],[791,805,813],[823,791,813],[850,807,836],[860,850,836],[830,860,836],[807,830,836],[860,830,834],[844,860,834],[805,844,834],[830,805,834],[856,780,840],[878,856,840],[850,878,840],[780,850,840],[944,856,894],[942,944,894],[878,942,894],[856,878,894],[878,850,868],[884,878,868],[860,884,868],[850,860,868],[884,860,864],[876,884,864],[844,876,864],[860,844,864],[942,878,898],[940,942,898],[884,940,898],[878,884,898],[940,884,896],[938,940,896],[876,938,896],[884,876,896],[979,952,953],[950,979,953],[952,950,953],[979,950,961],[1001,979,961],[948,1001,961],[950,948,961],[1029,952,963],[979,1029,963],[952,979,963],[1029,979,1027],[1079,1029,1027],[1001,1079,1027],[979,1001,1027],[1001,948,973],[1011,1001,973],[946,1011,973],[948,946,973],[1011,946,971],[997,1011,971],[944,997,971],[946,944,971],[1079,1001,1058],[1087,1079,1058],[1011,1087,1058],[1001,1011,1058],[1087,1011,1052],[1073,1087,1052],[997,1073,1052],[1011,997,1052],[1068,952,983],[1029,1068,983],[952,1029,983],[1068,1029,1075],[1117,1068,1075],[1079,1117,1075],[1029,1079,1075],[1072,952,991],[1068,1072,991],[952,1068,991],[1072,1068,1093],[1134,1072,1093],[1117,1134,1093],[1068,1117,1093],[1117,1079,1103],[1130,1117,1103],[1087,1130,1103],[1079,1087,1103],[1130,1087,1095],[1109,1130,1095],[1073,1109,1095],[1087,1073,1095],[1134,1117,1132],[1139,1134,1132],[1130,1139,1132],[1117,1130,1132],[1139,1130,1128],[1127,1139,1128],[1109,1127,1128],[1130,1109,1128],[997,944,959],[975,997,959],[942,975,959],[944,942,959],[1073,997,1013],[1003,1073,1013],[975,1003,1013],[997,975,1013],[975,942,955],[969,975,955],[940,969,955],[942,940,955],[969,940,957],[977,969,957],[938,977,957],[940,938,957],[1003,975,985],[993,1003,985],[969,993,985],[975,969,985],[993,969,989],[1009,993,989],[977,1009,989],[969,977,989],[1109,1073,1070],[1046,1109,1070],[1003,1046,1070],[1073,1003,1070],[1127,1109,1081],[1060,1127,1081],[1046,1060,1081],[1109,1046,1081],[1046,1003,1017],[1023,1046,1017],[993,1023,1017],[1003,993,1017],[1023,993,1019],[1048,1023,1019],[1009,1048,1019],[993,1009,1019],[1060,1046,1038],[1031,1060,1038],[1023,1031,1038],[1046,1023,1038],[1031,1023,1040],[1063,1031,1040],[1048,1063,1040],[1023,1048,1040],[1049,1063,1120],[1161,1049,1120],[1170,1161,1120],[1063,1170,1120],[1010,1049,1092],[1126,1010,1092],[1161,1126,1092],[1049,1161,1092],[1165,1170,1224],[1272,1165,1224],[1279,1272,1224],[1170,1279,1224],[1161,1165,1216],[1250,1161,1216],[1272,1250,1216],[1165,1272,1216],[1141,1161,1196],[1234,1141,1196],[1250,1234,1196],[1161,1250,1196],[1126,1141,1178],[1206,1126,1178],[1234,1206,1178],[1141,1234,1178],[978,1010,1045],[1043,978,1045],[1126,1043,1045],[1010,1126,1045],[939,978,966],[937,939,966],[1043,937,966],[978,1043,966],[1084,1126,1153],[1174,1084,1153],[1206,1174,1153],[1126,1206,1153],[1043,1084,1112],[1124,1043,1112],[1174,1124,1112],[1084,1174,1112],[982,1043,1055],[1033,982,1055],[1124,1033,1055],[1043,1124,1055],[937,982,968],[935,937,968],[1033,935,968],[982,1033,968],[1272,1279,1321],[1369,1272,1321],[1376,1369,1321],[1279,1376,1321],[1250,1272,1309],[1347,1250,1309],[1369,1347,1309],[1272,1369,1309],[1234,1250,1285],[1315,1234,1285],[1347,1315,1285],[1250,1347,1285],[1206,1234,1252],[1278,1206,1252],[1315,1278,1252],[1234,1315,1252],[1369,1376,1388],[1402,1369,1388],[1415,1402,1388],[1376,1415,1388],[1347,1369,1375],[1378,1347,1375],[1402,1378,1375],[1369,1402,1375],[1402,1415,1419],[1423,1402,1419],[1434,1423,1419],[1415,1434,1419],[1378,1402,1396],[1390,1378,1396],[1423,1390,1396],[1402,1423,1396],[1315,1347,1339],[1335,1315,1339],[1378,1335,1339],[1347,1378,1339],[1278,1315,1305],[1295,1278,1305],[1335,1295,1305],[1315,1335,1305],[1335,1378,1365],[1353,1335,1365],[1390,1353,1365],[1378,1390,1365],[1295,1335,1325],[1301,1295,1325],[1353,1301,1325],[1335,1353,1325],[1174,1206,1222],[1226,1174,1222],[1278,1226,1222],[1206,1278,1222],[1124,1174,1176],[1169,1124,1176],[1226,1169,1176],[1174,1226,1176],[1033,1124,1108],[1078,1033,1108],[1169,1078,1108],[1124,1169,1108],[935,1033,988],[931,935,988],[1078,931,988],[1033,1078,988],[1226,1278,1256],[1240,1226,1256],[1295,1240,1256],[1278,1295,1256],[1169,1226,1202],[1180,1169,1202],[1240,1180,1202],[1226,1240,1202],[1240,1295,1274],[1244,1240,1274],[1301,1244,1274],[1295,1301,1274],[1180,1240,1218],[1186,1180,1218],[1244,1186,1218],[1240,1244,1218],[1078,1169,1138],[1086,1078,1138],[1180,1086,1138],[1169,1180,1138],[931,1078,996],[925,931,996],[1086,925,996],[1078,1086,996],[1086,1180,1145],[1090,1086,1145],[1186,1090,1145],[1180,1186,1145],[925,1086,1e3],[921,925,1e3],[1090,921,1e3],[1086,1090,1e3],[877,939,889],[812,877,889],[937,812,889],[939,937,889],[845,877,810],[729,845,810],[812,729,810],[877,812,810],[873,937,887],[822,873,887],[935,822,887],[937,935,887],[812,873,800],[731,812,800],[822,731,800],[873,822,800],[771,812,743],[681,771,743],[731,681,743],[812,731,743],[729,771,702],[649,729,702],[681,649,702],[771,681,702],[806,845,763],[694,806,763],[729,694,763],[845,729,763],[791,806,735],[684,791,735],[694,684,735],[806,694,735],[714,729,677],[621,714,677],[649,621,677],[729,649,677],[694,714,659],[605,694,659],[621,605,659],[714,621,659],[690,694,639],[583,690,639],[605,583,639],[694,605,639],[684,690,631],[575,684,631],[583,575,631],[690,583,631],[822,935,867],[777,822,867],[931,777,867],[935,931,867],[731,822,747],[686,731,747],[777,686,747],[822,777,747],[681,731,679],[629,681,679],[686,629,679],[731,686,679],[649,681,633],[577,649,633],[629,577,633],[681,629,633],[777,931,859],[769,777,859],[925,769,859],[931,925,859],[686,777,717],[675,686,717],[769,675,717],[777,769,717],[769,925,855],[765,769,855],[921,765,855],[925,921,855],[675,769,710],[669,675,710],[765,669,710],[769,765,710],[629,686,653],[615,629,653],[675,615,653],[686,675,653],[577,629,599],[560,577,599],[615,560,599],[629,615,599],[615,675,637],[611,615,637],[669,611,637],[675,669,637],[560,615,581],[554,560,581],[611,554,581],[615,611,581],[621,649,603],[540,621,603],[577,540,603],[649,577,603],[605,621,570],[508,605,570],[540,508,570],[621,540,570],[583,605,546],[486,583,546],[508,486,546],[605,508,546],[575,583,534],[478,575,534],[486,478,534],[583,486,534],[540,577,550],[520,540,550],[560,520,550],[577,560,550],[508,540,516],[477,508,516],[520,477,516],[540,520,516],[520,560,530],[502,520,530],[554,502,530],[560,554,530],[477,520,490],[465,477,490],[502,465,490],[520,502,490],[486,508,480],[453,486,480],[477,453,480],[508,477,480],[478,486,467],[439,478,467],[453,439,467],[486,453,467],[453,477,459],[432,453,459],[465,432,459],[477,465,459],[439,453,436],[420,439,436],[432,420,436],[453,432,436],[805,791,734],[693,805,734],[684,693,734],[791,684,734],[844,805,762],[728,844,762],[693,728,762],[805,693,762],[689,684,630],[582,689,630],[575,582,630],[684,575,630],[693,689,638],[604,693,638],[582,604,638],[689,582,638],[713,693,658],[620,713,658],[604,620,658],[693,604,658],[728,713,676],[648,728,676],[620,648,676],[713,620,676],[876,844,809],[811,876,809],[728,811,809],[844,728,809],[938,876,888],[936,938,888],[811,936,888],[876,811,888],[770,728,701],[680,770,701],[648,680,701],[728,648,701],[811,770,742],[730,811,742],[680,730,742],[770,680,742],[872,811,799],[821,872,799],[730,821,799],[811,730,799],[936,872,886],[934,936,886],[821,934,886],[872,821,886],[582,575,533],[485,582,533],[478,485,533],[575,478,533],[604,582,545],[507,604,545],[485,507,545],[582,485,545],[620,604,569],[539,620,569],[507,539,569],[604,507,569],[648,620,602],[576,648,602],[539,576,602],[620,539,602],[485,478,466],[452,485,466],[439,452,466],[478,439,466],[507,485,479],[476,507,479],[452,476,479],[485,452,479],[452,439,435],[431,452,435],[420,431,435],[439,420,435],[476,452,458],[464,476,458],[431,464,458],[452,431,458],[539,507,515],[519,539,515],[476,519,515],[507,476,515],[576,539,549],[559,576,549],[519,559,549],[539,519,549],[519,476,489],[501,519,489],[464,501,489],[476,464,489],[559,519,529],[553,559,529],[501,553,529],[519,501,529],[680,648,632],[628,680,632],[576,628,632],[648,576,632],[730,680,678],[685,730,678],[628,685,678],[680,628,678],[821,730,746],[776,821,746],[685,776,746],[730,685,746],[934,821,866],[930,934,866],[776,930,866],[821,776,866],[628,576,598],[614,628,598],[559,614,598],[576,559,598],[685,628,652],[674,685,652],[614,674,652],[628,614,652],[614,559,580],[610,614,580],[553,610,580],[559,553,580],[674,614,636],[668,674,636],[610,668,636],[614,610,636],[776,685,716],[768,776,716],[674,768,716],[685,674,716],[930,776,858],[924,930,858],[768,924,858],[776,768,858],[768,674,709],[764,768,709],[668,764,709],[674,668,709],[924,768,854],[920,924,854],[764,920,854],[768,764,854],[977,938,965],[1042,977,965],[936,1042,965],[938,936,965],[1009,977,1044],[1125,1009,1044],[1042,1125,1044],[977,1042,1044],[981,936,967],[1032,981,967],[934,1032,967],[936,934,967],[1042,981,1054],[1123,1042,1054],[1032,1123,1054],[981,1032,1054],[1083,1042,1111],[1173,1083,1111],[1123,1173,1111],[1042,1123,1111],[1125,1083,1152],[1205,1125,1152],[1173,1205,1152],[1083,1173,1152],[1048,1009,1091],[1160,1048,1091],[1125,1160,1091],[1009,1125,1091],[1063,1048,1119],[1170,1063,1119],[1160,1170,1119],[1048,1160,1119],[1140,1125,1177],[1233,1140,1177],[1205,1233,1177],[1125,1205,1177],[1160,1140,1195],[1249,1160,1195],[1233,1249,1195],[1140,1233,1195],[1164,1160,1215],[1271,1164,1215],[1249,1271,1215],[1160,1249,1215],[1170,1164,1223],[1279,1170,1223],[1271,1279,1223],[1164,1271,1223],[1032,934,987],[1077,1032,987],[930,1077,987],[934,930,987],[1123,1032,1107],[1168,1123,1107],[1077,1168,1107],[1032,1077,1107],[1173,1123,1175],[1225,1173,1175],[1168,1225,1175],[1123,1168,1175],[1205,1173,1221],[1277,1205,1221],[1225,1277,1221],[1173,1225,1221],[1077,930,995],[1085,1077,995],[924,1085,995],[930,924,995],[1168,1077,1137],[1179,1168,1137],[1085,1179,1137],[1077,1085,1137],[1085,924,999],[1089,1085,999],[920,1089,999],[924,920,999],[1179,1085,1144],[1185,1179,1144],[1089,1185,1144],[1085,1089,1144],[1225,1168,1201],[1239,1225,1201],[1179,1239,1201],[1168,1179,1201],[1277,1225,1255],[1294,1277,1255],[1239,1294,1255],[1225,1239,1255],[1239,1179,1217],[1243,1239,1217],[1185,1243,1217],[1179,1185,1217],[1294,1239,1273],[1300,1294,1273],[1243,1300,1273],[1239,1243,1273],[1233,1205,1251],[1314,1233,1251],[1277,1314,1251],[1205,1277,1251],[1249,1233,1284],[1346,1249,1284],[1314,1346,1284],[1233,1314,1284],[1271,1249,1308],[1368,1271,1308],[1346,1368,1308],[1249,1346,1308],[1279,1271,1320],[1376,1279,1320],[1368,1376,1320],[1271,1368,1320],[1314,1277,1304],[1334,1314,1304],[1294,1334,1304],[1277,1294,1304],[1346,1314,1338],[1377,1346,1338],[1334,1377,1338],[1314,1334,1338],[1334,1294,1324],[1352,1334,1324],[1300,1352,1324],[1294,1300,1324],[1377,1334,1364],[1389,1377,1364],[1352,1389,1364],[1334,1352,1364],[1368,1346,1374],[1401,1368,1374],[1377,1401,1374],[1346,1377,1374],[1376,1368,1387],[1415,1376,1387],[1401,1415,1387],[1368,1401,1387],[1401,1377,1395],[1422,1401,1395],[1389,1422,1395],[1377,1389,1395],[1415,1401,1418],[1434,1415,1418],[1422,1434,1418],[1401,1422,1418]],n=function(e,t){for(var n=new Array(e.length),i=0;t.length>i;i++){var r=t[i][0],o=t[i][1],a=t[i][2],s=e[r],l=e[o],c=e[a];
l=SceneJS_math_subVec4(l,s,[0,0,0,0]),c=SceneJS_math_subVec4(c,s,[0,0,0,0]);var u=SceneJS_math_normalizeVec4(SceneJS_math_cross3Vec4(l,c,[0,0,0,0]),[0,0,0,0]);n[r]||(n[r]=[]),n[o]||(n[o]=[]),n[a]||(n[a]=[]),n[r].push(u),n[o].push(u),n[a].push(u)}for(var d=new Array(e.length),i=0;n.length>i;i++){for(var h=n[i].length,p=0,f=0,m=0,g=0;h>g;g++)p+=n[i][g][0],f+=n[i][g][1],m+=n[i][g][2];d[i]=[-(p/h),-(f/h),-(m/h)]}return d},i=function(e,t){for(var n=[],i=0;e.length>i;i++){if(t&&e[i].length!=t)throw SceneJS_errorModule.fatalError("Bad geometry array element");for(var r=0;e[i].length>r;r++)n.push(e[i][r])}return n};return{primitive:"triangles",positions:i(e,3),indices:i(t,3),normals:i(n(e,t),3)}}var t=SceneJS.createNodeType("teapot","geometry");t.prototype._init=function(){this.attr.type="teapot",SceneJS_geometry.prototype._init.call(this,{coreId:"teapot",create:e})}}(),function(){var e=SceneJS.createNodeType("box","geometry");e.prototype._init=function(e){this.attr.type="box";var t=e.xSize||1,n=e.ySize||1,i=e.zSize||1,r=void 0!=e.solid?e.solid:!0;SceneJS_geometry.prototype._init.call(this,{resource:"box_"+t+"_"+n+"_"+i+(r?"_solid":"wire"),create:function(){var e=[t,n,i,-t,n,i,-t,-n,i,t,-n,i,t,n,i,t,-n,i,t,-n,-i,t,n,-i,t,n,i,t,n,-i,-t,n,-i,-t,n,i,-t,n,i,-t,n,-i,-t,-n,-i,-t,-n,i,-t,-n,-i,t,-n,-i,t,-n,i,-t,-n,i,t,-n,-i,-t,-n,-i,-t,n,-i,t,n,-i],o=[0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1],a=[t,n,0,n,0,0,t,0,0,n,0,0,t,0,t,n,t,0,t,n,0,n,0,0,t,n,0,n,0,0,t,0,0,0,t,0,t,n,0,n,0,0,t,0,t,n,0,n],s=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];return{primitive:r?"triangles":"lines",positions:e,normals:o,uv:a,indices:s,colors:[]}}})},SceneJS.createNodeType("cube","box")}(),function(){var e=SceneJS.createNodeType("sphere","geometry");e.prototype._init=function(e){var t=e.slices||30,n=e.rings||30,i=e.radius||1,r=e.semiMajorAxis||1,o=1/r,a=e.sweep||1;a>1&&(a=1);var s=e.sliceDepth||1;s>1&&(s=1);var l=n*a,c=t*s;SceneJS_geometry.prototype._init.call(this,{coreId:e.coreId||"sphere_"+i+"_"+n+"_"+t+"_"+r+"_"+a+"_"+s,scale:e.scale,origin:e.origin,create:function(){var e,a,u,d=[],h=[],p=[];for(a=0;t>=a&&!(a>c);a++){var f=a*Math.PI/t,m=Math.sin(f),g=Math.cos(f);for(e=0;n>=e&&!(e>l);e++){var v=2*e*Math.PI/n,y=o*Math.sin(v),b=r*Math.cos(v),_=b*m,w=g,S=y*m,x=1-e/n,C=a/t;h.push(_),h.push(w),h.push(S),p.push(x),p.push(C),d.push(i*_),d.push(i*w),d.push(i*S)}}if(1>s){var $=Math.cos((a-1)*Math.PI/t)*i;d.push(0,$,0),h.push(1,1,1),p.push(1,1)}else d.push(0,0,0),h.push(1,1,1),p.push(1,1);var E=d.length/3-1,T=[];for(a=0;t>a&&!(a>=c);a++){for(e=0;n>e&&!(e>=l);e++){var k=a*(l+1)+e,A=k+l+1;T.push(k),T.push(A),T.push(k+1),T.push(A),T.push(A+1),T.push(k+1)}n>l&&(u=(l+1)*a,T.push(u,u+l+1,E),T.push(u+l,u+2*l+1,E))}if(t>c){for(e=1;l>=e;e++)u=a*l+e,T.push(u,u+1,E);T.push(u+1,a*l+1,E)}return{primitive:"triangles",positions:d,normals:h,uv:p,indices:T}}})}}(),function(){var e=SceneJS.createNodeType("quad","geometry");e.prototype._init=function(e){this.attr.type="quad";var t=void 0!=e.solid?e.solid:!0,n=e.xSize||1,i=e.ySize||1;SceneJS_geometry.prototype._init.call(this,{coreId:e.coreId||"quad_"+n+"_"+i+(t?"_solid":"_wire"),create:function(){var r,o,a,s,l=e.xDiv||1,c=e.yDiv||1;if(1==l&&1==c)r=[n,i,0,-n,i,0,-n,-i,0,n,-i,0],o=[0,0,1,0,0,1,0,0,1,0,0,1],a=[1,1,0,1,0,0,1,0],s=[2,1,0,3,2,0];else{if(0>l)throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"quad xDiv should be greater than zero");if(0>c)throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"quad yDiv should be greater than zero");r=[],o=[],a=[],s=[];for(var u=2*n/l,d=2*i/c,h=.5/l,p=.5/c,f=0,m=-i,g=0;i>=m;m+=d,g+=p)for(var v=-n,y=0;n>=v;v+=u,y+=h)r.push(v),r.push(m),r.push(0),o.push(0),o.push(0),o.push(1),a.push(y),a.push(g),i>m&&n>v&&(s.push(f+2),s.push(f+1),s.push(f),s.push(f+3),s.push(f+2),s.push(f)),f+=3}return{primitive:t?"triangles":"lines",positions:r,normals:o,uv:a,indices:s,colors:[]}}})}}(),function(){var e=SceneJS.createNodeType("disk","geometry");e.prototype._init=function(e){this.attr.type="disk";var t=e.radius||1,n=e.height||1,i=e.rings||30,r=e.innerRadius||0;r>t&&(r=t);var o=e.semiMajorAxis||1,a=1/o,s=e.sweep||1;s>1&&(s=1);var l=i*s;SceneJS_geometry.prototype._init.call(this,{coreId:e.coreId||"disk_"+t+"_"+n+"_"+i+"_"+r+"_"+o+"_"+s,create:function(){var e=[],s=[],c=[],u=n*-.5,d=.5*n;0>=r&&(s.push(0),s.push(-1),s.push(0),c.push(y),c.push(b),e.push(0),e.push(u),e.push(0),s.push(0),s.push(1),s.push(0),c.push(y),c.push(b),e.push(0),e.push(d),e.push(0));for(var h=0;i>=h&&!(h>l);h++){var p=2*h*Math.PI/i,f=a*Math.sin(p),m=o*Math.cos(p),g=m,v=f,y=1-h/i,b=.5;if(s.push(0),s.push(-1),s.push(0),c.push(y),c.push(b),e.push(t*g),e.push(u),e.push(t*v),s.push(g),s.push(0),s.push(v),c.push(y),c.push(b),e.push(t*g),e.push(u),e.push(t*v),s.push(0),s.push(1),s.push(0),c.push(y),c.push(b),e.push(t*g),e.push(d),e.push(t*v),s.push(g),s.push(0),s.push(v),c.push(y),c.push(b),e.push(t*g),e.push(d),e.push(t*v),r>0&&(s.push(0),s.push(-1),s.push(0),c.push(y),c.push(b),e.push(r*g),e.push(u),e.push(r*v),s.push(-g),s.push(0),s.push(-v),c.push(y),c.push(b),e.push(r*g),e.push(u),e.push(r*v),s.push(0),s.push(1),s.push(0),c.push(y),c.push(b),e.push(r*g),e.push(d),e.push(r*v),s.push(-g),s.push(0),s.push(-v),c.push(y),c.push(b),e.push(r*g),e.push(d),e.push(r*v)),h+1>l){s.push(0),s.push(0),s.push(-1),c.push(y),c.push(b),e.push(t*o),e.push(u),e.push(0),s.push(0),s.push(0),s.push(-1),c.push(y),c.push(b),e.push(t*o),e.push(d),e.push(0),s.push(-v),s.push(0),s.push(g),c.push(y),c.push(b),e.push(t*g),e.push(u),e.push(t*v),s.push(-v),s.push(0),s.push(g),c.push(y),c.push(b),e.push(t*g),e.push(d),e.push(t*v),r>0?(s.push(0),s.push(0),s.push(-1),c.push(y),c.push(b),e.push(r*o),e.push(u),e.push(0),s.push(0),s.push(0),s.push(-1),c.push(y),c.push(b),e.push(r*o),e.push(d),e.push(0),s.push(-v),s.push(0),s.push(g),c.push(y),c.push(b),e.push(r*g),e.push(u),e.push(r*v),s.push(-v),s.push(0),s.push(g),c.push(y),c.push(b),e.push(r*g),e.push(d),e.push(r*v)):(s.push(0),s.push(0),s.push(-1),c.push(y),c.push(b),e.push(0),e.push(u),e.push(0),s.push(0),s.push(0),s.push(-1),c.push(y),c.push(b),e.push(0),e.push(d),e.push(0),s.push(-v),s.push(0),s.push(g),c.push(y),c.push(b),e.push(0),e.push(u),e.push(0),s.push(-v),s.push(0),s.push(g),c.push(y),c.push(b),e.push(0),e.push(d),e.push(0));break}}var _=[];if(r>0)for(var w,h=0;i>h;h++){if(h+1>l){w=8*(h+1),_.push(w),_.push(w+4),_.push(w+5),_.push(w),_.push(w+5),_.push(w+1),_.push(w+2),_.push(w+7),_.push(w+6),_.push(w+2),_.push(w+3),_.push(w+7);break}w=8*h,_.push(w+1),_.push(w+3),_.push(w+11),_.push(w+1),_.push(w+11),_.push(w+9),_.push(w+5),_.push(w+7),_.push(w+15),_.push(w+5),_.push(w+15),_.push(w+13),_.push(w),_.push(w+8),_.push(w+12),_.push(w+0),_.push(w+12),_.push(w+4),_.push(w+2),_.push(w+6),_.push(w+14),_.push(w+2),_.push(w+14),_.push(w+10)}else for(var h=0;i>h;h++){if(h+1>l){w=2+4*(h+1),_.push(w),_.push(w+4),_.push(w+5),_.push(w+0),_.push(w+5),_.push(w+1),_.push(w+2),_.push(w+7),_.push(w+6),_.push(w+2),_.push(w+3),_.push(w+7);break}var w=4*h+2;_.push(w+1),_.push(w+3),_.push(w+7),_.push(w+1),_.push(w+7),_.push(w+5),_.push(w),_.push(0),_.push(w+4),_.push(w+2),_.push(1),_.push(w+6)}return{primitive:"triangles",positions:e,normals:s,uv:c,indices:_}}})}}();var SceneJS_vectorTextModule=new function(){function e(e){return t[e]}var t={" ":{width:16,points:[]},"!":{width:10,points:[[5,21],[5,7],[-1,-1],[5,2],[4,1],[5,0],[6,1],[5,2]]},'"':{width:16,points:[[4,21],[4,14],[-1,-1],[12,21],[12,14]]},"#":{width:21,points:[[11,25],[4,-7],[-1,-1],[17,25],[10,-7],[-1,-1],[4,12],[18,12],[-1,-1],[3,6],[17,6]]},$:{width:20,points:[[8,25],[8,-4],[-1,-1],[12,25],[12,-4],[-1,-1],[17,18],[15,20],[12,21],[8,21],[5,20],[3,18],[3,16],[4,14],[5,13],[7,12],[13,10],[15,9],[16,8],[17,6],[17,3],[15,1],[12,0],[8,0],[5,1],[3,3]]},"%":{width:24,points:[[21,21],[3,0],[-1,-1],[8,21],[10,19],[10,17],[9,15],[7,14],[5,14],[3,16],[3,18],[4,20],[6,21],[8,21],[10,20],[13,19],[16,19],[19,20],[21,21],[-1,-1],[17,7],[15,6],[14,4],[14,2],[16,0],[18,0],[20,1],[21,3],[21,5],[19,7],[17,7]]},"&":{width:26,points:[[23,12],[23,13],[22,14],[21,14],[20,13],[19,11],[17,6],[15,3],[13,1],[11,0],[7,0],[5,1],[4,2],[3,4],[3,6],[4,8],[5,9],[12,13],[13,14],[14,16],[14,18],[13,20],[11,21],[9,20],[8,18],[8,16],[9,13],[11,10],[16,3],[18,1],[20,0],[22,0],[23,1],[23,2]]},"'":{width:10,points:[[5,19],[4,20],[5,21],[6,20],[6,18],[5,16],[4,15]]},"(":{width:14,points:[[11,25],[9,23],[7,20],[5,16],[4,11],[4,7],[5,2],[7,-2],[9,-5],[11,-7]]},")":{width:14,points:[[3,25],[5,23],[7,20],[9,16],[10,11],[10,7],[9,2],[7,-2],[5,-5],[3,-7]]},"*":{width:16,points:[[8,21],[8,9],[-1,-1],[3,18],[13,12],[-1,-1],[13,18],[3,12]]},"+":{width:26,points:[[13,18],[13,0],[-1,-1],[4,9],[22,9]]},",":{width:10,points:[[6,1],[5,0],[4,1],[5,2],[6,1],[6,-1],[5,-3],[4,-4]]},"-":{width:26,points:[[4,9],[22,9]]},".":{width:10,points:[[5,2],[4,1],[5,0],[6,1],[5,2]]},"/":{width:22,points:[[20,25],[2,-7]]},0:{width:20,points:[[9,21],[6,20],[4,17],[3,12],[3,9],[4,4],[6,1],[9,0],[11,0],[14,1],[16,4],[17,9],[17,12],[16,17],[14,20],[11,21],[9,21]]},1:{width:20,points:[[6,17],[8,18],[11,21],[11,0]]},2:{width:20,points:[[4,16],[4,17],[5,19],[6,20],[8,21],[12,21],[14,20],[15,19],[16,17],[16,15],[15,13],[13,10],[3,0],[17,0]]},3:{width:20,points:[[5,21],[16,21],[10,13],[13,13],[15,12],[16,11],[17,8],[17,6],[16,3],[14,1],[11,0],[8,0],[5,1],[4,2],[3,4]]},4:{width:20,points:[[13,21],[3,7],[18,7],[-1,-1],[13,21],[13,0]]},5:{width:20,points:[[15,21],[5,21],[4,12],[5,13],[8,14],[11,14],[14,13],[16,11],[17,8],[17,6],[16,3],[14,1],[11,0],[8,0],[5,1],[4,2],[3,4]]},6:{width:20,points:[[16,18],[15,20],[12,21],[10,21],[7,20],[5,17],[4,12],[4,7],[5,3],[7,1],[10,0],[11,0],[14,1],[16,3],[17,6],[17,7],[16,10],[14,12],[11,13],[10,13],[7,12],[5,10],[4,7]]},7:{width:20,points:[[17,21],[7,0],[-1,-1],[3,21],[17,21]]},8:{width:20,points:[[8,21],[5,20],[4,18],[4,16],[5,14],[7,13],[11,12],[14,11],[16,9],[17,7],[17,4],[16,2],[15,1],[12,0],[8,0],[5,1],[4,2],[3,4],[3,7],[4,9],[6,11],[9,12],[13,13],[15,14],[16,16],[16,18],[15,20],[12,21],[8,21]]},9:{width:20,points:[[16,14],[15,11],[13,9],[10,8],[9,8],[6,9],[4,11],[3,14],[3,15],[4,18],[6,20],[9,21],[10,21],[13,20],[15,18],[16,14],[16,9],[15,4],[13,1],[10,0],[8,0],[5,1],[4,3]]},":":{width:10,points:[[5,14],[4,13],[5,12],[6,13],[5,14],[-1,-1],[5,2],[4,1],[5,0],[6,1],[5,2]]},";":{width:10,points:[[5,14],[4,13],[5,12],[6,13],[5,14],[-1,-1],[6,1],[5,0],[4,1],[5,2],[6,1],[6,-1],[5,-3],[4,-4]]},"<":{width:24,points:[[20,18],[4,9],[20,0]]},"=":{width:26,points:[[4,12],[22,12],[-1,-1],[4,6],[22,6]]},">":{width:24,points:[[4,18],[20,9],[4,0]]},"?":{width:18,points:[[3,16],[3,17],[4,19],[5,20],[7,21],[11,21],[13,20],[14,19],[15,17],[15,15],[14,13],[13,12],[9,10],[9,7],[-1,-1],[9,2],[8,1],[9,0],[10,1],[9,2]]},"@":{width:27,points:[[18,13],[17,15],[15,16],[12,16],[10,15],[9,14],[8,11],[8,8],[9,6],[11,5],[14,5],[16,6],[17,8],[-1,-1],[12,16],[10,14],[9,11],[9,8],[10,6],[11,5],[-1,-1],[18,16],[17,8],[17,6],[19,5],[21,5],[23,7],[24,10],[24,12],[23,15],[22,17],[20,19],[18,20],[15,21],[12,21],[9,20],[7,19],[5,17],[4,15],[3,12],[3,9],[4,6],[5,4],[7,2],[9,1],[12,0],[15,0],[18,1],[20,2],[21,3],[-1,-1],[19,16],[18,8],[18,6],[19,5]]},A:{width:18,points:[[9,21],[1,0],[-1,-1],[9,21],[17,0],[-1,-1],[4,7],[14,7]]},B:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,15],[17,13],[16,12],[13,11],[-1,-1],[4,11],[13,11],[16,10],[17,9],[18,7],[18,4],[17,2],[16,1],[13,0],[4,0]]},C:{width:21,points:[[18,16],[17,18],[15,20],[13,21],[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5]]},D:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[11,21],[14,20],[16,18],[17,16],[18,13],[18,8],[17,5],[16,3],[14,1],[11,0],[4,0]]},E:{width:19,points:[[4,21],[4,0],[-1,-1],[4,21],[17,21],[-1,-1],[4,11],[12,11],[-1,-1],[4,0],[17,0]]},F:{width:18,points:[[4,21],[4,0],[-1,-1],[4,21],[17,21],[-1,-1],[4,11],[12,11]]},G:{width:21,points:[[18,16],[17,18],[15,20],[13,21],[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[18,8],[-1,-1],[13,8],[18,8]]},H:{width:22,points:[[4,21],[4,0],[-1,-1],[18,21],[18,0],[-1,-1],[4,11],[18,11]]},I:{width:8,points:[[4,21],[4,0]]},J:{width:16,points:[[12,21],[12,5],[11,2],[10,1],[8,0],[6,0],[4,1],[3,2],[2,5],[2,7]]},K:{width:21,points:[[4,21],[4,0],[-1,-1],[18,21],[4,7],[-1,-1],[9,12],[18,0]]},L:{width:17,points:[[4,21],[4,0],[-1,-1],[4,0],[16,0]]},M:{width:24,points:[[4,21],[4,0],[-1,-1],[4,21],[12,0],[-1,-1],[20,21],[12,0],[-1,-1],[20,21],[20,0]]},N:{width:22,points:[[4,21],[4,0],[-1,-1],[4,21],[18,0],[-1,-1],[18,21],[18,0]]},O:{width:22,points:[[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[19,8],[19,13],[18,16],[17,18],[15,20],[13,21],[9,21]]},P:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,14],[17,12],[16,11],[13,10],[4,10]]},Q:{width:22,points:[[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[19,8],[19,13],[18,16],[17,18],[15,20],[13,21],[9,21],[-1,-1],[12,4],[18,-2]]},R:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,15],[17,13],[16,12],[13,11],[4,11],[-1,-1],[11,11],[18,0]]},S:{width:20,points:[[17,18],[15,20],[12,21],[8,21],[5,20],[3,18],[3,16],[4,14],[5,13],[7,12],[13,10],[15,9],[16,8],[17,6],[17,3],[15,1],[12,0],[8,0],[5,1],[3,3]]},T:{width:16,points:[[8,21],[8,0],[-1,-1],[1,21],[15,21]]},U:{width:22,points:[[4,21],[4,6],[5,3],[7,1],[10,0],[12,0],[15,1],[17,3],[18,6],[18,21]]},V:{width:18,points:[[1,21],[9,0],[-1,-1],[17,21],[9,0]]},W:{width:24,points:[[2,21],[7,0],[-1,-1],[12,21],[7,0],[-1,-1],[12,21],[17,0],[-1,-1],[22,21],[17,0]]},X:{width:20,points:[[3,21],[17,0],[-1,-1],[17,21],[3,0]]},Y:{width:18,points:[[1,21],[9,11],[9,0],[-1,-1],[17,21],[9,11]]},Z:{width:20,points:[[17,21],[3,0],[-1,-1],[3,21],[17,21],[-1,-1],[3,0],[17,0]]},"[":{width:14,points:[[4,25],[4,-7],[-1,-1],[5,25],[5,-7],[-1,-1],[4,25],[11,25],[-1,-1],[4,-7],[11,-7]]},"\\":{width:14,points:[[0,21],[14,-3]]},"]":{width:14,points:[[9,25],[9,-7],[-1,-1],[10,25],[10,-7],[-1,-1],[3,25],[10,25],[-1,-1],[3,-7],[10,-7]]},"^":{width:16,points:[[6,15],[8,18],[10,15],[-1,-1],[3,12],[8,17],[13,12],[-1,-1],[8,17],[8,0]]},_:{width:16,points:[[0,-2],[16,-2]]},"`":{width:10,points:[[6,21],[5,20],[4,18],[4,16],[5,15],[6,16],[5,17]]},a:{width:19,points:[[15,14],[15,0],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},b:{width:19,points:[[4,21],[4,0],[-1,-1],[4,11],[6,13],[8,14],[11,14],[13,13],[15,11],[16,8],[16,6],[15,3],[13,1],[11,0],[8,0],[6,1],[4,3]]},c:{width:18,points:[[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},d:{width:19,points:[[15,21],[15,0],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},e:{width:18,points:[[3,8],[15,8],[15,10],[14,12],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},f:{width:12,points:[[10,21],[8,21],[6,20],[5,17],[5,0],[-1,-1],[2,14],[9,14]]},g:{width:19,points:[[15,14],[15,-2],[14,-5],[13,-6],[11,-7],[8,-7],[6,-6],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},h:{width:19,points:[[4,21],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0]]},i:{width:8,points:[[3,21],[4,20],[5,21],[4,22],[3,21],[-1,-1],[4,14],[4,0]]},j:{width:10,points:[[5,21],[6,20],[7,21],[6,22],[5,21],[-1,-1],[6,14],[6,-3],[5,-6],[3,-7],[1,-7]]},k:{width:17,points:[[4,21],[4,0],[-1,-1],[14,14],[4,4],[-1,-1],[8,8],[15,0]]},l:{width:8,points:[[4,21],[4,0]]},m:{width:30,points:[[4,14],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0],[-1,-1],[15,10],[18,13],[20,14],[23,14],[25,13],[26,10],[26,0]]},n:{width:19,points:[[4,14],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0]]},o:{width:19,points:[[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3],[16,6],[16,8],[15,11],[13,13],[11,14],[8,14]]},p:{width:19,points:[[4,14],[4,-7],[-1,-1],[4,11],[6,13],[8,14],[11,14],[13,13],[15,11],[16,8],[16,6],[15,3],[13,1],[11,0],[8,0],[6,1],[4,3]]},q:{width:19,points:[[15,14],[15,-7],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},r:{width:13,points:[[4,14],[4,0],[-1,-1],[4,8],[5,11],[7,13],[9,14],[12,14]]},s:{width:17,points:[[14,11],[13,13],[10,14],[7,14],[4,13],[3,11],[4,9],[6,8],[11,7],[13,6],[14,4],[14,3],[13,1],[10,0],[7,0],[4,1],[3,3]]},t:{width:12,points:[[5,21],[5,4],[6,1],[8,0],[10,0],[-1,-1],[2,14],[9,14]]},u:{width:19,points:[[4,14],[4,4],[5,1],[7,0],[10,0],[12,1],[15,4],[-1,-1],[15,14],[15,0]]},v:{width:16,points:[[2,14],[8,0],[-1,-1],[14,14],[8,0]]},w:{width:22,points:[[3,14],[7,0],[-1,-1],[11,14],[7,0],[-1,-1],[11,14],[15,0],[-1,-1],[19,14],[15,0]]},x:{width:17,points:[[3,14],[14,0],[-1,-1],[14,14],[3,0]]},y:{width:16,points:[[2,14],[8,0],[-1,-1],[14,14],[8,0],[6,-4],[4,-6],[2,-7],[1,-7]]},z:{width:17,points:[[14,14],[3,0],[-1,-1],[3,14],[14,14],[-1,-1],[3,0],[14,0]]},"{":{width:14,points:[[9,25],[7,24],[6,23],[5,21],[5,19],[6,17],[7,16],[8,14],[8,12],[6,10],[-1,-1],[7,24],[6,22],[6,20],[7,18],[8,17],[9,15],[9,13],[8,11],[4,9],[8,7],[9,5],[9,3],[8,1],[7,0],[6,-2],[6,-4],[7,-6],[-1,-1],[6,8],[8,6],[8,4],[7,2],[6,1],[5,-1],[5,-3],[6,-5],[7,-6],[9,-7]]},"|":{width:8,points:[[4,25],[4,-7]]},"}":{width:14,points:[[5,25],[7,24],[8,23],[9,21],[9,19],[8,17],[7,16],[6,14],[6,12],[8,10],[-1,-1],[7,24],[8,22],[8,20],[7,18],[6,17],[5,15],[5,13],[6,11],[10,9],[6,7],[5,5],[5,3],[6,1],[7,0],[8,-2],[8,-4],[7,-6],[-1,-1],[8,8],[6,6],[6,4],[7,2],[8,1],[9,-1],[9,-3],[8,-5],[7,-6],[5,-7]]},"~":{width:24,points:[[3,6],[3,8],[4,11],[6,12],[8,12],[10,11],[14,8],[16,7],[18,7],[20,8],[21,10],[-1,-1],[3,8],[4,10],[6,11],[8,11],[10,10],[14,7],[16,6],[18,6],[20,7],[21,10],[21,12]]}};this.getGeometry=function(t,n,i,r){for(var o={positions:[],indices:[]},a=r.split("\n"),s=0,l=i,c=0;a.length>c;c++){for(var u=n,d=a[c],h=d.length,p=t/25,f=0;h>f;f++){var m=e(d.charAt(f));if("\n"==m&&alert("newline"),m){for(var g=1,v=-1,y=-1,b=!1,_=0;m.points.length>_;_++){var w=m.points[_];-1!=w[0]||-1!=w[1]?(o.positions.push(u+w[0]*p),o.positions.push(l+w[1]*p),o.positions.push(0),-1==v?v=s:-1==y?y=s:(v=y,y=s),s++,g?g=!1:(o.indices.push(v),o.indices.push(y)),b=!0):(g=1,b=!1)}u+=m.width*p}}l+=25*p}return o}},SceneJS_bitmapTextModule=new function(){function e(e){if(4!=e.length)return e;for(var t=0;e.length>t;t++)e[t]*=255;return"rgba("+e.join(",")+")"}SceneJS_eventModule.addListener(SceneJS_eventModule.INIT,function(){}),this.createText=function(t,n,i){var r=document.createElement("canvas"),o=r.getContext("2d");o.font=n+"px "+t;var a=o.measureText(i).width;r.width=a,r.height=n,o.font=n+"px "+t,o.textBaseline="middle",o.fillStyle=e([.5,10,30,.5]),o.fillStyle="#FFFF00";var s=0,l=n/2;return o.fillText(i,s,l),{image:r,width:r.width,height:r.height}}};SceneJS.Text=SceneJS.createNodeType("text"),SceneJS.Text.prototype._init=function(e){var t=e.mode||"bitmap";if("vector"!=t&&"bitmap"!=t)throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"SceneJS.Text unsupported mode - should be 'vector' or 'bitmap'");if(this._mode=t,"bitmap"==this._mode){var n=SceneJS_bitmapTextModule.createText("Helvetica",e.size||1,e.text||""),i=n.width/16,r=n.height/16,o=[i,r,.01,0,r,.1,0,0,.1,i,0,.01],a=[0,0,-1,0,0,-1,0,0,-1,0,0,-1],s=[1,1,0,1,0,0,1,0],l=[0,1,2,0,2,3];if(e.doubleSided){var c=.01;o=o.concat([i,0,-c,0,0,-c,0,r,-c,i,r,-c]),a=a.concat([0,0,1,0,0,1,0,0,1,0,0,1]),s=s.concat([0,0,1,0,1,1,0,1]),l=l.concat([4,5,6,4,6,7])}this.addNode({type:"texture",layers:[{image:n.image,minFilter:"linear",magFilter:"linear",wrapS:"repeat",wrapT:"repeat",isDepth:!1,depthMode:"luminance",depthCompareMode:"compareRToTexture",depthCompareFunc:"lequal",flipY:!1,width:1,height:1,internalFormat:"lequal",sourceFormat:"alpha",sourceType:"unsignedByte",applyTo:"baseColor",blendMode:"add"}],nodes:[{type:"material",emit:1,baseColor:{r:1,g:0,b:0},specularColor:{r:.9,g:.9,b:.9},specular:.9,shine:100,nodes:[{type:"geometry",primitive:"triangles",positions:o,normals:a,uv:s,indices:l}]}]})}else{var u=this;this.addNode({type:"geometry",create:function(){var t=SceneJS_vectorTextModule.getGeometry(3,0,0,e.text);return{resource:u.attr.id,primitive:"lines",positions:t.positions,normals:[],uv:[],indices:t.indices,colors:[]}}})}},SceneJS.Text.prototype._compile=function(){"bitmap"==this._mode&&this._compileNodes()};var SceneJS_modelTransformModule=new function(){var e,t={matrix:SceneJS_math_identityMat4(),fixed:!0,identity:!0},n=[],i=[],r=0;this.transform=t;var o,a=this;SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_COMPILING,function(){r=0,e=null,a.transform=t,o=!0}),SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_RENDERING,function(){if(o){if(r>0){var t=a.transform;t.matrixAsArray?(t.matrixAsArray.set(t.matrix),t.normalMatrixAsArray.set(SceneJS_math_transposeMat4(SceneJS_math_inverseMat4(t.matrix,SceneJS_math_mat4())))):(t.matrixAsArray=new Float32Array(t.matrix),t.normalMatrixAsArray=new Float32Array(SceneJS_math_transposeMat4(SceneJS_math_inverseMat4(t.matrix,SceneJS_math_mat4())))),SceneJS_DrawList.setModelTransform(e,t.matrixAsArray,t.normalMatrixAsArray)}else SceneJS_DrawList.setModelTransform();o=!1}}),this.pushTransform=function(t,a){n[r]=t,i[r]=a,r++,e=t,this.transform=a,o=!0},this.popTransform=function(){r--,r>0?(e=n[r-1],this.transform=i[r-1]):(e=null,this.transform=t),o=!0}};(function(){var e=SceneJS.createNodeType("rotate");e.prototype._init=function(e){1==this.core._nodeCount&&(this.setMultOrder(e.multOrder),this.setAngle(e.angle),this.setXYZ({x:e.x,y:e.y,z:e.z})),this._mat=null,this._xf={}},e.prototype.setMultOrder=function(e){if(e=e||"post","post"!=e&&"pre"!=e)throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Illegal rotate multOrder - '"+e+"' should be 'pre' or 'post'");this.core.multOrder=e,this._postMult="post"==e,this._compileMemoLevel=0},e.prototype.setAngle=function(e){this.core.angle=e||0,this._compileMemoLevel=0},e.prototype.getAngle=function(){return this.core.angle},e.prototype.setXYZ=function(e){e=e||{},this.core.x=e.x||0,this.core.y=e.y||0,this.core.z=e.z||0,this._compileMemoLevel=0},e.prototype.getXYZ=function(){return{x:this.core.x,y:this.core.y,z:this.core.z}},e.prototype.setX=function(e){this.core.x=e,this._compileMemoLevel=0},e.prototype.getX=function(){return this.core.x},e.prototype.setY=function(e){this.core.y=e,this._compileMemoLevel=0},e.prototype.getY=function(){return this.core.y},e.prototype.setZ=function(e){this.core.z=e,this._compileMemoLevel=0},e.prototype.getZ=function(){return this.core.z},e.prototype.incX=function(e){this.core.x+=e,this._compileMemoLevel=0},e.prototype.incY=function(e){this.core.y+=e},e.prototype.incZ=function(e){this.core.z+=e,this._compileMemoLevel=0},e.prototype.incAngle=function(e){this.core.angle+=e,this._compileMemoLevel=0},e.prototype.getMatrix=function(){return this._compileMemoLevel>0?this._mat.slice(0):SceneJS_math_rotationMat4v(this.core.angle*Math.PI/180,[this.core.x,this.core.y,this.core.z])},e.prototype.getAttributes=function(){return{x:this.core.x,y:this.core.y,z:this.core.z,angle:this.core.angle}},e.prototype._compile=function(){this._preCompile(),this._compileNodes(),this._postCompile()},e.prototype._preCompile=function(){var e=this._compileMemoLevel;if(0==this._compileMemoLevel)if(this._compileMemoLevel=1,0!=this.core.x||0!=this.core.y||0!=this.core.z){var t=this.core.angle;this._mat=SceneJS_math_rotationMat4v(t*Math.PI/180,[this.core.x,this.core.y,this.core.z])}else this._mat=SceneJS_math_identityMat4();var n=SceneJS_modelTransformModule.transform;if(2>e||!n.fixed){var i=SceneJS_math_mat4();this._postMult?SceneJS_math_mulMat4(n.matrix,this._mat,i):SceneJS_math_mulMat4(this._mat,n.matrix,i),this._xf.localMatrix=this._mat,this._xf.matrix=i,this._xf.fixed=2==e,1==this._compileMemoLevel&&n.fixed&&(this._compileMemoLevel=2)}SceneJS_modelTransformModule.pushTransform(this.attr.id,this._xf)},e.prototype._postCompile=function(){SceneJS_modelTransformModule.popTransform()}})(),function(){var e=SceneJS.createNodeType("translate");e.prototype._init=function(e){this._mat=null,this._xf={},1==this.core._nodeCount&&(this.setMultOrder(e.multOrder),this.setXyz({x:e.x,y:e.y,z:e.z}))},e.prototype.setMultOrder=function(e){if(e=e||"post","post"!=e&&"pre"!=e)throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Illegal translate multOrder - '"+e+"' should be 'pre' or 'post'");this.core.multOrder=e,this._postMult="post"==e,this._compileMemoLevel=0},e.prototype.setXyz=function(e){e=e||{};var t=e.x||0,n=e.y||0,i=e.z||0;this.core.x=t,this.core.y=n,this.core.z=i,this._compileMemoLevel=0},e.prototype.getXyz=function(){return{x:this.core.x,y:this.core.y,z:this.core.z}},e.prototype.setX=function(e){this.core.x=e,this._compileMemoLevel=0},e.prototype.getX=function(){return this.core.x},e.prototype.setY=function(e){this.core.y=e,this._compileMemoLevel=0},e.prototype.getY=function(){return this.core.y},e.prototype.setZ=function(e){this.core.z=e,this._compileMemoLevel=0},e.prototype.getZ=function(){return this.core.z},e.prototype.incX=function(e){this.core.x+=e,this._compileMemoLevel=0},e.prototype.incY=function(e){this.core.y+=e},e.prototype.incZ=function(e){this.core.z+=e,this._compileMemoLevel=0},e.prototype.getMatrix=function(){return this._compileMemoLevel>0?this._mat.slice(0):SceneJS_math_translationMat4v([this.core.x,this.core.y,this.core.z])},e.prototype.getAttributes=function(){return{x:this.core.x,y:this.core.y,z:this.core.z}},e.prototype._compile=function(){this._preCompile(),this._compileNodes(),this._postCompile()},e.prototype._preCompile=function(){var e=this._compileMemoLevel;0==this._compileMemoLevel&&(this._mat=SceneJS_math_translationMat4v([this.core.x,this.core.y,this.core.z]),this._compileMemoLevel=1);var t=SceneJS_modelTransformModule.transform;if(2>e||!t.fixed){var n=SceneJS_math_mat4();this._postMult?SceneJS_math_mulMat4(t.matrix,this._mat,n):SceneJS_math_mulMat4(this._mat,t.matrix,n),this._xf.localMatrix=this._mat,this._xf.matrix=n,this._xf.fixed=2==e,1==this._compileMemoLevel&&t.fixed&&(this._compileMemoLevel=2)}SceneJS_modelTransformModule.pushTransform(this.attr.id,this._xf)},e.prototype._postCompile=function(){SceneJS_modelTransformModule.popTransform()}}(),function(){var e=SceneJS.createNodeType("scale");e.prototype._init=function(e){1==this.core._nodeCount&&(this.setMultOrder(e.multOrder),this.setXYZ({x:e.x,y:e.y,z:e.z})),this._mat=null,this._xf={}},e.prototype.setMultOrder=function(e){if(e=e||"post","post"!=e&&"pre"!=e)throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Illegal scale multOrder - '"+e+"' should be 'pre' or 'post'");this.core.multOrder=e,this._postMult="post"==e,this._compileMemoLevel=0},e.prototype.setXYZ=function(e){return e=e||{},this.core.x=void 0!=e.x?e.x:1,this.core.y=void 0!=e.y?e.y:1,this.core.z=void 0!=e.z?e.z:1,this._resetCompilationMemos(),this},e.prototype.getXYZ=function(){return{x:this.core.x,y:this.core.y,z:this.core.z}},e.prototype.setX=function(e){return this.core.x=void 0!=e&&null!=e?e:1,this._resetCompilationMemos(),this},e.prototype.getX=function(){return this.core.x},e.prototype.setY=function(e){return this.core.y=void 0!=e&&null!=e?e:1,this._resetCompilationMemos(),this},e.prototype.getY=function(){return this.core.y},e.prototype.setZ=function(e){return this.core.z=void 0!=e&&null!=e?e:1,this._resetCompilationMemos(),this},e.prototype.getZ=function(){return this.core.z},e.prototype.incX=function(e){this.core.x+=e,this._compileMemoLevel=0},e.prototype.incY=function(e){this.core.y+=e},e.prototype.incZ=function(e){this.core.z+=e,this._compileMemoLevel=0},e.prototype.getMatrix=function(){return this._compileMemoLevel>0?this._mat.slice(0):SceneJS_math_scalingMat4v([this.core.x,this.core.y,this.core.z])},e.prototype.getAttributes=function(){return{x:this.core.x,y:this.core.y,z:this.core.z}},e.prototype._compile=function(){this._preCompile(),this._compileNodes(),this._postCompile()},e.prototype._preCompile=function(){var e=this._compileMemoLevel;0==this._compileMemoLevel&&(this._compileMemoLevel=1,this._mat=SceneJS_math_scalingMat4v([this.core.x,this.core.y,this.core.z]));var t=SceneJS_modelTransformModule.transform;if(2>e||!t.fixed){var n=SceneJS_math_mat4();this._postMult?SceneJS_math_mulMat4(t.matrix,this._mat,n):SceneJS_math_mulMat4(this._mat,t.matrix,n),this._xf.localMatrix=this._mat,this._xf.matrix=n,this._xf.fixed=2==e,1==this._compileMemoLevel&&t.fixed&&(this._compileMemoLevel=2)}SceneJS_modelTransformModule.pushTransform(this.attr.id,this._xf)},e.prototype._postCompile=function(){SceneJS_modelTransformModule.popTransform()}}(),function(){var e=SceneJS.createNodeType("matrix");e.prototype._init=function(e){this._xf={},1==this.core._nodeCount&&(this.setMultOrder(e.multOrder),this.setElements(e.elements))},e.prototype.setMultOrder=function(e){if(e=e||"post","post"!=e&&"pre"!=e)throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Illegal matrix multOrder - '"+e+"' should be 'pre' or 'post'");this.attr.multOrder=e,this._postMult="post"==e,this._compileMemoLevel=0},e.prototype.setElements=function(e){if(e=e||SceneJS_math_identityMat4(),!e)throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Matrix elements undefined");if(16!=e.length)throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Matrix elements should number 16");if(this.core.mat)for(var t=0;16>t;t++)this.core.mat[t]=e[t];else this.core.mat=e;return this._resetCompilationMemos(),this},e.prototype.getElements=function(){for(var e=new Array(16),t=0;16>t;t++)e[t]=this.core.mat[t];return e},e.prototype.getMatrix=function(){return this.core.mat.slice(0)},e.prototype._compile=function(){this._preCompile(),this._compileNodes(),this._postCompile()},e.prototype._preCompile=function(){var e=this._compileMemoLevel;0==this._compileMemoLevel&&(this._compileMemoLevel=1);var t=SceneJS_modelTransformModule.transform;if(2>e||!t.fixed){var n=SceneJS_math_mat4();this._postMult?SceneJS_math_mulMat4(t.matrix,this.core.mat,n):SceneJS_math_mulMat4(this.core.mat,t.matrix,n),this._xf.localMatrix=this.core.mat,this._xf.matrix=n,this._xf.fixed=2==e,1==this._compileMemoLevel&&t.fixed&&(this._compileMemoLevel=2)}SceneJS_modelTransformModule.pushTransform(this.attr.id,this._xf)},e.prototype._postCompile=function(){SceneJS_modelTransformModule.popTransform()}}(),function(){var e=SceneJS.createNodeType("quaternion");e.prototype._init=function(e){if(1==this.core._nodeCount&&(this.setMultOrder(e.multOrder),this.core.q=SceneJS_math_identityQuaternion(),(e.x||e.y||e.x||e.angle||e.w)&&this.setRotation(e),e.rotations))for(var t=0;e.rotations.length>t;t++)this.addRotation(e.rotations[t]);this._mat=null,this._xf={}},e.prototype.setMultOrder=function(e){if(e=e||"post","post"!=e&&"pre"!=e)throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Illegal quaternion multOrder - '"+e+"' should be 'pre' or 'post'");this.core.multOrder=e,this._postMult="post"==e,this._compileMemoLevel=0},e.prototype.setRotation=function(e){return e=e||{},this.core.q=SceneJS_math_angleAxisQuaternion(e.x||0,e.y||0,e.z||0,e.angle||0),this._resetCompilationMemos(),this},e.prototype.getRotation=function(){return SceneJS_math_angleAxisFromQuaternion(this.core.q)},e.prototype.addRotation=function(e){return this.core.q=SceneJS_math_mulQuaternions(SceneJS_math_angleAxisQuaternion(e.x||0,e.y||0,e.z||0,e.angle||0),this.core.q),this._resetCompilationMemos(),this},e.prototype.getMatrix=function(){return this._compileMemoLevel>0?this._mat.slice(0):SceneJS_math_newMat4FromQuaternion(this.core.q)},e.prototype.normalize=function(){return this.core.q=SceneJS_math_normalizeQuaternion(this.core.q),this._resetCompilationMemos(),this},e.prototype.getAttributes=function(){return{x:this.core.q[0],y:this.core.q[1],z:this.core.q[2],w:this.core.q[3]}},e.prototype._compile=function(){this._preCompile(),this._compileNodes(),this._postCompile()},e.prototype._preCompile=function(){var e=this._compileMemoLevel;0==this._compileMemoLevel&&(this._mat=SceneJS_math_newMat4FromQuaternion(this.core.q),this._compileMemoLevel=1);var t=SceneJS_modelTransformModule.transform;if(2>e||!t.fixed){var n=SceneJS_math_mat4();this._postMult?SceneJS_math_mulMat4(t.matrix,this._mat,n):SceneJS_math_mulMat4(this._mat,t.matrix,n),this._xf.localMatrix=this._mat,this._xf.matrix=n,this._xf.fixed=2==e,1==this._compileMemoLevel&&t.fixed&&(this._compileMemoLevel=2)
}SceneJS_modelTransformModule.pushTransform(this.attr.id,this._xf)},e.prototype._postCompile=function(){SceneJS_modelTransformModule.popTransform()}}();var SceneJS_viewTransformModule=new function(){function e(){if(a){if(o>0){var e=s.transform;e.matrixAsArray?(e.matrixAsArray.set(e.matrix),e.normalMatrixAsArray.set(SceneJS_math_transposeMat4(SceneJS_math_inverseMat4(e.matrix,SceneJS_math_mat4())))):(e.matrixAsArray=new Float32Array(e.matrix),e.normalMatrixAsArray=new Float32Array(SceneJS_math_transposeMat4(SceneJS_math_inverseMat4(e.matrix,SceneJS_math_mat4())))),SceneJS_DrawList.setViewTransform(t,e.matrixAsArray,e.normalMatrixAsArray,e.lookAt)}else SceneJS_DrawList.setViewTransform();a=!1}}var t,n={matrix:SceneJS_math_identityMat4(),fixed:!0,identity:!0,lookAt:SceneJS_math_LOOKAT_ARRAYS},i=[],r=[],o=0;this.transform=n;var a,s=this;SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_COMPILING,function(){o=0,t=null,s.transform=n,a=!0}),SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_RENDERING,function(){e()}),this.pushTransform=function(n,s){i[o]=n,r[o]=s,o++,t=n,this.transform=s,a=!0,SceneJS_eventModule.fireEvent(SceneJS_eventModule.VIEW_TRANSFORM_UPDATED,this.transform),e()},this.popTransform=function(){o--,o>0?(t=i[o-1],this.transform=r[o-1]):(t=null,this.transform=n),SceneJS_eventModule.fireEvent(SceneJS_eventModule.VIEW_TRANSFORM_UPDATED,this.transform),a=!0,e()}};(function(){var e=SceneJS.createNodeType("lookAt");e.prototype._init=function(e){this._mat=null,this._xf={type:"lookat"},1==this.core._nodeCount&&(e.eye||e.look||e.up?(this.setEye(e.eye),this.setLook(e.look),this.setUp(e.up)):(this.setEye({x:0,y:0,z:1}),this.setLook({x:0,y:0,z:0}),this.setUp({x:0,y:1,z:0})))},e.prototype.setEye=function(e){e=e||{},this.core.eyeX=void 0!=e.x&&null!=e.x?e.x:0,this.core.eyeY=void 0!=e.y&&null!=e.y?e.y:0,this.core.eyeZ=void 0!=e.z&&null!=e.z?e.z:0,this._compileMemoLevel=0},e.prototype.setEyeX=function(e){this.core.eyeX=e||0,this._compileMemoLevel=0},e.prototype.setEyeY=function(e){this.core.eyeY=e||0,this._compileMemoLevel=0},e.prototype.incEye=function(e){e=e||{},this.core.eyeX+=void 0!=e.x&&null!=e.x?e.x:0,this.core.eyeY+=void 0!=e.y&&null!=e.y?e.y:0,this.core.eyeZ+=void 0!=e.z&&null!=e.z?e.z:0,this._compileMemoLevel=0},e.prototype.incEyeX=function(e){this.core.eyeX+=e,this._compileMemoLevel=0},e.prototype.incEyeY=function(e){this.core.eyeY+=e,this._compileMemoLevel=0},e.prototype.incEyeZ=function(e){this.core.eyeZ+=e,this._compileMemoLevel=0},e.prototype.setEyeZ=function(e){this.core.eyeZ=e||0,this._compileMemoLevel=0},e.prototype.getEye=function(){return{x:this.core.eyeX,y:this.core.eyeY,z:this.core.eyeZ}},e.prototype.setLook=function(e){e=e||{},this.core.lookX=void 0!=e.x&&null!=e.x?e.x:0,this.core.lookY=void 0!=e.y&&null!=e.y?e.y:0,this.core.lookZ=void 0!=e.z&&null!=e.z?e.z:0,this._compileMemoLevel=0},e.prototype.setLookX=function(e){this.core.lookX=e||0,this._compileMemoLevel=0},e.prototype.setLookY=function(e){this.core.lookY=e||0,this._compileMemoLevel=0},e.prototype.setLookZ=function(e){this.core.lookZ=e||0,this._compileMemoLevel=0},e.prototype.incLook=function(e){e=e||{},this.core.lookX+=void 0!=e.x&&null!=e.x?e.x:0,this.core.lookY+=void 0!=e.y&&null!=e.y?e.y:0,this.core.lookZ+=void 0!=e.z&&null!=e.z?e.z:0,this._compileMemoLevel=0},e.prototype.getLook=function(){return{x:this.core.lookX,y:this.core.lookY,z:this.core.lookZ}},e.prototype.setUp=function(e){e=e||{y:1};var t=void 0!=e.x&&null!=e.x?e.x:0,n=void 0!=e.y&&null!=e.y?e.y:0,i=void 0!=e.z&&null!=e.z?e.z:0;if(0==t&&0==n&&0==i)throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Lookat up vector is zero length - at least one of its x,y and z components must be non-zero");this.core.upX=t,this.core.upY=n,this.core.upZ=i,this._compileMemoLevel=0},e.prototype.setUpX=function(e){this.core.upX=e||0,this._compileMemoLevel=0},e.prototype.setUpY=function(){this.core.upY=y||0,this._compileMemoLevel=0},e.prototype.setUpZ=function(){this.core.upZ=z||0,this._compileMemoLevel=0},e.prototype.getUp=function(){return{x:this.core.upX,y:this.core.upY,z:this.core.upZ}},e.prototype.incUp=function(e){e=e||{},this.core.upX+=void 0!=e.x&&null!=e.x?e.x:0,this.core.upY+=void 0!=e.y&&null!=e.y?e.y:0,this.core.upZ+=void 0!=e.z&&null!=e.z?e.z:0,this._compileMemoLevel=0},e.prototype.getMatrix=function(){return this._compileMemoLevel>0?this._mat.slice(0):SceneJS_math_lookAtMat4c(this.core.eyeX,this.core.eyeY,this.core.eyeZ,this.core.lookX,this.core.lookY,this.core.lookZ,this.core.upX,this.core.upY,this.core.upZ)},e.prototype.getAttributes=function(){return{look:{x:this.core.lookX,y:this.core.lookY,z:this.core.lookZ},eye:{x:this.core.eyeX,y:this.core.eyeY,z:this.core.eyeZ},up:{x:this.core.upX,y:this.core.upY,z:this.core.upZ}}},e.prototype._compile=function(){0==this._compileMemoLevel&&(this._mat=SceneJS_math_lookAtMat4c(this.core.eyeX,this.core.eyeY,this.core.eyeZ,this.core.lookX,this.core.lookY,this.core.lookZ,this.core.upX,this.core.upY,this.core.upZ),this._compileMemoLevel=1,this._xf.matrix=this._mat,this._xf.lookAt={eye:[this.core.eyeX,this.core.eyeY,this.core.eyeZ],look:[this.core.lookX,this.core.lookY,this.core.lookZ],up:[this.core.upX,this.core.upY,this.core.upZ]}),SceneJS_viewTransformModule.pushTransform(this.attr.id,this._xf),this._compileNodes(),SceneJS_viewTransformModule.popTransform()}})(),function(){var e=SceneJS.createNodeType("stationary");e.prototype._compile=function(){var e=this._compileMemoLevel,t=SceneJS_viewTransformModule.transform,n=t.lookAt;if(n){if(0==this._compileMemoLevel||!t.fixed){var i=SceneJS_math_mat4();SceneJS_math_mulMat4(t.matrix,SceneJS_math_translationMat4v(n.eye),i),this._xform={matrix:i,lookAt:n,fixed:1==e},t.fixed&&(this._compileMemoLevel=1)}SceneJS_viewTransformModule.pushTransform(this.attr.id,this._xform),this._compileNodes(),SceneJS_viewTransformModule.popTransform()}else this._compileNodes()}}(),function(){var e=SceneJS.createNodeType("billboard");e.prototype._compile=function(){this._preCompile(),this._compileNodes(),this._postCompile()},e.prototype._preCompile=function(){var e=SceneJS_viewTransformModule.transform,t=e.lookAt,n=SceneJS_modelTransformModule.transform,i=n.matrix.slice(0),r=[i[0],i[1],i[2],0,i[4],i[5],i[6],0,i[8],i[9],i[10],0,0,0,0,1];SceneJS_math_inverseMat4(r),SceneJS_math_mulMat4(i,r,i);var o=[];SceneJS_math_subVec3(t.eye,t.look,o),SceneJS_math_normalizeVec3(o);var a=[];SceneJS_math_cross3Vec3(t.up,o,a),SceneJS_math_normalizeVec3(a);var s=[];SceneJS_math_cross3Vec3(o,a,s),SceneJS_math_normalizeVec3(s),SceneJS_math_mulMat4(i,[a[0],a[1],a[2],0,s[0],s[1],s[2],0,o[0],o[1],o[2],0,0,0,0,1],i),SceneJS_modelTransformModule.pushTransform(this.attr.id,{matrix:i})},e.prototype._postCompile=function(){SceneJS_modelTransformModule.popTransform()}}(),function(){var e,t=[],n=[],i=0;SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_COMPILING,function(){i=0,e=!0}),SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_RENDERING,function(){e&&(i>0?SceneJS_DrawList.setProjectionTransform(t[i-1],n[i-1]):SceneJS_DrawList.setProjectionTransform(),e=!1)});var r=SceneJS.createNodeType("camera");r.prototype._init=function(e){1==this.core._nodeCount&&this.setOptics(e.optics)},r.prototype.setOptics=function(e){var t=this.core;if(e)if("ortho"==e.type)t.optics=SceneJS._applyIf(SceneJS_math_ORTHO_OBJ,{type:e.type,left:e.left,bottom:e.bottom,near:e.near,right:e.right,top:e.top,far:e.far});else if("frustum"==e.type)t.optics={type:e.type,left:e.left||-1,bottom:e.bottom||-1,near:e.near||.1,right:e.right||1,top:e.top||1,far:e.far||5e3};else{if("perspective"!=e.type)throw e.type?SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Camera configuration invalid: optics type not supported - supported types are 'perspective', 'frustum' and 'ortho'"):SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Camera configuration invalid: optics type not specified - supported types are 'perspective', 'frustum' and 'ortho'");t.optics={type:e.type,fovy:e.fovy||60,aspect:e.aspect||1,near:e.near||.1,far:e.far||5e3}}else t.optics={type:e.type,left:e.left||-1,bottom:e.bottom||-1,near:e.near||.1,right:e.right||1,top:e.top||1,far:e.far||5e3};this._rebuild()},r.prototype._rebuild=function(){var e=this.core.optics;"ortho"==e.type?this.core.matrix=SceneJS_math_orthoMat4c(e.left,e.right,e.bottom,e.top,e.near,e.far):"frustum"==e.type?this.core.matrix=SceneJS_math_frustumMatrix4(e.left,e.right,e.bottom,e.top,e.near,e.far):"perspective"==e.type&&(this.core.matrix=SceneJS_math_perspectiveMatrix4(e.fovy*Math.PI/180,e.aspect,e.near,e.far)),this.core.matrixAsArray?this.core.matrixAsArray.set(this.core.matrix):this.core.matrixAsArray=new Float32Array(this.core.matrix)},r.prototype.getOptics=function(){var e={};for(var t in this.core.optics)this.core.optics.hasOwnProperty(t)&&(e[t]=this.core.optics[t]);return e},r.prototype.getMatrix=function(){return 0==this._compileMemoLevel&&this._rebuild(),this.core.matrix.slice(0)},r.prototype._compile=function(){t[i]=this.attr.id,n[i]=this.core,i++,e=!0,this._compileNodes(),i--,e=!0}}(),function(){var e=SceneJS.createNodeType("xform");e.prototype._init=function(e){this._xf={},1==this.core._nodeCount&&this.setElements(e.elements)},e.prototype.setElements=function(e){if(e=e||SceneJS_math_identityMat4(),16!=e.length)throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Matrix elements should number 16");var t=this.core;if(t.matrix)for(var n=0;16>n;n++)t.matrix[n]=e[n];else t.matrix=e;return t.matrixAsArray?(t.matrixAsArray.set(e),t.normalMatrixAsArray.set(SceneJS_math_transposeMat4(SceneJS_math_inverseMat4(e,SceneJS_math_mat4())))):(t.matrixAsArray=new Float32Array(e),t.normalMatrixAsArray=new Float32Array(SceneJS_math_transposeMat4(SceneJS_math_inverseMat4(e,SceneJS_math_mat4())))),this},e.prototype._compile=function(){SceneJS_modelTransformModule.pushTransform(this.attr.id,this.core),this._compileNodes(),SceneJS_modelTransformModule.popTransform()}}(),new function(){var e,t=[],n=[],i=0;SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_COMPILING,function(){i=0,e=!0}),SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_RENDERING,function(){e&&(i>0?SceneJS_DrawList.setLights(t[i-1],n.slice(0,i)):SceneJS_DrawList.setLights(),e=!1)});var r=SceneJS.createNodeType("light");r.prototype._init=function(e){e=e||{},1==this.core._nodeCount&&(this.core.light={viewSpace:!!e.viewSpace},this.setMode(e.mode),this.setColor(e.color),this.setDiffuse(e.diffuse),this.setSpecular(e.specular),this.setPos(e.pos),this.setDir(e.dir),this.setConstantAttenuation(e.constantAttenuation),this.setLinearAttenuation(e.linearAttenuation),this.setQuadraticAttenuation(e.quadraticAttenuation))},r.prototype.setMode=function(e){if(e=e||"dir","dir"!=e&&"point"!=e)throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Light unsupported mode - should be 'dir' or 'point' or 'ambient'");this.core.light.mode=e},r.prototype.getMode=function(){return this.core.light.mode},r.prototype.setColor=function(e){e=e||{},this.core.light.color=[void 0!=e.r?e.r:1,void 0!=e.g?e.g:1,void 0!=e.b?e.b:1]},r.prototype.getColor=function(){return{r:this.core.light.color[0],g:this.core.light.color[1],b:this.core.light.color[2]}},r.prototype.setDiffuse=function(e){this.core.light.diffuse=void 0!=e?e:!0},r.prototype.getDiffuse=function(){return this.core.light.diffuse},r.prototype.setSpecular=function(e){this.core.light.specular=e||!0},r.prototype.getSpecular=function(){return this.core.light.specular},r.prototype.setPos=function(e){e=e||{},this.core.light.pos=[e.x||0,e.y||0,e.z||0]},r.prototype.getPos=function(){return{x:this.core.light.pos[0],y:this.core.light.pos[1],z:this.core.light.pos[2]}},r.prototype.setDir=function(e){e=e||{},this.core.light.dir=[e.x||0,e.y||0,void 0==e.z||null==e.z?-1:e.z]},r.prototype.getDir=function(){return{x:this.core.light.dir[0],y:this.core.light.dir[1],z:this.core.light.dir[2]}},r.prototype.setConstantAttenuation=function(e){this.core.light.constantAttenuation=void 0!=e?e:1},r.prototype.getConstantAttenuation=function(){return this.core.light.constantAttenuation},r.prototype.setLinearAttenuation=function(e){this.core.light.linearAttenuation=e||0},r.prototype.getLinearAttenuation=function(){return this.core.light.linearAttenuation},r.prototype.setQuadraticAttenuation=function(e){this.core.light.quadraticAttenuation=e||0},r.prototype.getQuadraticAttenuation=function(){return this.core.light.quadraticAttenuation},r.prototype._compile=function(){var r=SceneJS_modelTransformModule.transform.matrix;"point"==this.core.light.mode?this.core.light.worldPos=SceneJS_math_transformPoint3(r,this.core.light.pos):"dir"==this.core.light.mode&&(this.core.light.worldDir=SceneJS_math_transformVector3(r,this.core.light.dir)),t[i]=this.attr.id,n[i]=this.core.light,i++,e=!0,this._compileNodes()}},new function(){var e,t={baseColor:[0,0,0],specularColor:[0,0,0],specular:1,shine:10,reflect:.8,alpha:1,emit:0},n=[],i=[],r=0;SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_COMPILING,function(){r=0,e=!0}),SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_RENDERING,function(){e&&(r>0?SceneJS_DrawList.setMaterial(n[r-1],i[r-1]):SceneJS_DrawList.setMaterial(),e=!1)});var o=SceneJS.createNodeType("material");o.prototype._init=function(e){1==this.core._nodeCount&&(this.setBaseColor(e.baseColor),this.setSpecularColor(e.specularColor),this.setSpecular(e.specular),this.setShine(e.shine),this.setReflect(e.reflect),this.setEmit(e.emit),this.setAlpha(e.alpha),this.setOpacity(e.opacity))},o.prototype.setBaseColor=function(e){this.core.baseColor=e?[void 0!=e.r&&null!=e.r?e.r:0,void 0!=e.g&&null!=e.g?e.g:0,void 0!=e.b&&null!=e.b?e.b:0]:t.baseColor},o.prototype.getBaseColor=function(){return{r:this.core.baseColor[0],g:this.core.baseColor[1],b:this.core.baseColor[2]}},o.prototype.setSpecularColor=function(e){this.core.specularColor=e?[void 0!=e.r&&null!=e.r?e.r:0,void 0!=e.g&&null!=e.g?e.g:0,void 0!=e.b&&null!=e.b?e.b:0]:t.specularColor},o.prototype.getSpecularColor=function(){return{r:this.core.specularColor[0],g:this.core.specularColor[1],b:this.core.specularColor[2]}},o.prototype.setSpecular=function(e){this.core.specular=void 0!=e&&null!=e?e:t.specular},o.prototype.getSpecular=function(){return this.core.specular},o.prototype.setShine=function(e){this.core.shine=void 0!=e&&null!=e?e:t.shine},o.prototype.getShine=function(){return this.core.shine},o.prototype.setReflect=function(e){this.core.reflect=void 0!=e&&null!=e?e:t.reflect},o.prototype.getReflect=function(){return this.core.reflect},o.prototype.setEmit=function(e){this.core.emit=void 0!=e&&null!=e?e:t.emit},o.prototype.getEmit=function(){return this.core.emit},o.prototype.setAlpha=function(e){this.core.alpha=void 0!=e&&null!=e?e:t.alpha},o.prototype.getAlpha=function(){return this.core.alpha},o.prototype.setOpacity=function(e){this.core.opacity=void 0!=e&&null!=e?e:t.opacity},o.prototype.getOpacity=function(){return this.core.opacity},o.prototype._compile=function(){this._preCompile(),this._compileNodes(),this._postCompile()},o.prototype._preCompile=function(){n[r]=this.core._coreId,i[r]=this.core,r++,e=!0},o.prototype._postCompile=function(){r--,e=!0},o.prototype._destroy=function(){}},new function(){var e,t=[],n=[],i=0;SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_COMPILING,function(){i=0,e=!0}),SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_RENDERING,function(){e&&(i>0?SceneJS_DrawList.setColortrans(t[i-1],n[i-1]):SceneJS_DrawList.setColortrans(),e=!1)});var r=SceneJS.createNodeType("colortrans");r.prototype._init=function(e){1==this.core._nodeCount&&(this.setScale(e.scale),this.setAdd(e.add),this.setSaturation(e.saturation))},r.prototype.setSaturation=function(e){this.core.saturation=e},r.prototype.mulSaturation=function(e){this.core.saturation*=e},r.prototype.incSaturation=function(e){this.core.saturation+=e},r.prototype.getSaturation=function(){return this.core.saturation},r.prototype.setScale=function(e){e=e||{},this.core.scale={r:void 0!=e.r?e.r:1,g:void 0!=e.g?e.g:1,b:void 0!=e.b?e.b:1,a:void 0!=e.a?e.a:1}},r.prototype.incScale=function(e){e=e||{};var t=this.core.scale;e.r&&(t.r+=e.r),e.g&&(t.g+=e.g),e.b&&(t.b+=e.b),e.a&&(t.a+=e.a)},r.prototype.mulScale=function(e){e=e||{};var t=this.core.scale;e.r&&(t.r*=e.r),e.g&&(t.g*=e.g),e.b&&(t.b*=e.b),e.a&&(t.a*=e.a)},r.prototype.getScale=function(){return this.core.scale},r.prototype.setAdd=function(e){e=e||{},this.core.add={r:void 0!=e.r?e.r:0,g:void 0!=e.g?e.g:0,b:void 0!=e.b?e.b:0,a:void 0!=e.a?e.a:0}},r.prototype.incAdd=function(e){e=e||{};var t=this.core.add;e.r&&(t.r+=e.r),e.g&&(t.g+=e.g),e.b&&(t.b+=e.b),e.a&&(t.a+=e.a)},r.prototype.mulAdd=function(e){e=e||{};var t=this.core.add;e.r&&(t.r*=e.r),e.g&&(t.g*=e.g),e.b&&(t.b*=e.b),e.a&&(t.a*=e.a)},r.prototype.getAdd=function(){return this.core.add},r.prototype._compile=function(){t[i]=this.core._coreId,n[i]=this.core,i++,e=!0,this._compileNodes(),i--,e=!0}};var SceneJS_textureModule=new function(){function e(e,i,r){var o,a=e.canvas.context,s=SceneJS._createUUID();try{return i.autoUpdate&&(o=function(){try{a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,image)}catch(e){a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,image,null)}a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR)}),new SceneJS_webgl_Texture2D(a,{textureId:s,canvas:e.canvas,image:i.image,url:i.uri,texels:i.texels,minFilter:t("minFilter",a,i,a.NEAREST_MIPMAP_NEAREST),magFilter:t("magFilter",a,i,a.LINEAR),wrapS:t("wrapS",a,i,a.CLAMP_TO_EDGE),wrapT:t("wrapT",a,i,a.CLAMP_TO_EDGE),isDepth:n(i.isDepth,!1),depthMode:t("depthMode",a,i,a.LUMINANCE),depthCompareMode:t("depthCompareMode",a,i,a.COMPARE_R_TO_TEXTURE),depthCompareFunc:t("depthCompareFunc",a,i,a.LEQUAL),flipY:n(i.flipY,!0),width:n(i.width,1),height:n(i.height,1),internalFormat:t("internalFormat",a,i,a.LEQUAL),sourceFormat:t("sourceType",a,i,a.ALPHA),sourceType:t("sourceType",a,i,a.UNSIGNED_BYTE),logging:SceneJS_loggingModule,update:o},r)}catch(l){throw SceneJS_errorModule.fatalError(SceneJS.errors.ERROR,"Failed to create texture: "+l.message||l)}}function t(e,t,n,i){var r=n[e];if(void 0==r)return i;var o=SceneJS_webgl_enumMap[r];if(void 0==o)throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Unrecognised value for texture node property '"+e+"' value: '"+r+"'");var a=t[o];return a}function n(e,t){return void 0==e?t:e}function i(e){e.destroy()}var r,o=[],a=[],s=0;SceneJS_eventModule.addListener(SceneJS_eventModule.INIT,function(){}),SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_COMPILING,function(){s=0,r=!0}),SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_RENDERING,function(){r&&(s>0?SceneJS_DrawList.setTexture(o[s-1],a[s-1]):SceneJS_DrawList.setTexture(),r=!1)});var l=SceneJS.createNodeType("texture");l.prototype._init=function(t){if(1==this.core._nodeCount){this.core.layers=[],this.core.params={};var n=SceneJS_debugModule.getConfigs("texturing")||{},r=void 0!=n.waitForLoad&&null!=n.waitForLoad?n.waitForLoad:t.waitForLoad;if(!t.layers)throw SceneJS_errorModule.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture layers missing");if(!SceneJS._isArray(t.layers))throw SceneJS_errorModule.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture layers should be an array");for(var o=0;t.layers.length>o;o++){var a=t.layers[o];if(!(a.uri||a.frameBuf||a.video||a.image||a.canvasId))throw SceneJS_errorModule.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture layer "+o+"  has no uri, frameBuf, video or canvasId specified");if(a.applyFrom&&"uv"!=a.applyFrom&&"uv2"!=a.applyFrom&&"normal"!=a.applyFrom&&"geometry"!=a.applyFrom)throw SceneJS_errorModule.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture layer "+o+"  applyFrom value is unsupported - "+"should be either 'uv', 'uv2', 'normal' or 'geometry'");if(a.applyTo&&"baseColor"!=a.applyTo&&"specular"!=a.applyTo&&"emit"!=a.applyTo&&"alpha"!=a.applyTo&&"normals"!=a.applyTo)throw SceneJS_errorModule.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture layer "+o+" applyTo value is unsupported - "+"should be either 'baseColor', 'specular' or 'normals'");if(a.blendMode&&"add"!=a.blendMode&&"multiply"!=a.blendMode)throw SceneJS_errorModule.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture layer "+o+" blendMode value is unsupported - "+"should be either 'add' or 'multiply'");var s={image:null,creationParams:a,waitForLoad:r,texture:null,applyFrom:a.applyFrom||"uv",applyTo:a.applyTo||"baseColor",blendMode:a.blendMode||"add",blendFactor:void 0!=a.blendFactor&&null!=a.blendFactor?a.blendFactor:1,translate:{x:0,y:0},scale:{x:1,y:1},rotate:{z:0}};if(this.core.layers.push(s),this._setLayerTransform(a,s),s.creationParams.frameBuf)s.texture=SceneJS._compilationStates.getState("frameBuf",this.scene.attr.id,s.creationParams.frameBuf);else if(s.creationParams.video)s.texture=SceneJS._compilationStates.getState("video",this.scene.attr.id,s.creationParams.video);else{SceneJS_sceneStatusModule.nodeLoading(this);var l=this;s.texture=e(this.scene,s.creationParams,function(){SceneJS_sceneStatusModule.nodeLoaded(l),l._destroyed&&i(s.texture),SceneJS_compileModule.nodeUpdated(l,"loaded")})}}}},l.prototype.setLayer=function(e){if(void 0==e.index||null==e.index)throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Invalid texture set layer argument: index null or undefined");if(0>e.index||e.index>=this.core.layers.length)throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Invalid texture set layer argument: index out of range ("+this.core.layers.length+" layers defined)");this._setLayer(parseInt(e.index),e)},l.prototype.setLayers=function(e){var t;for(var n in e)if(e.hasOwnProperty(n)&&(void 0!=n||null!=n)){if(t=parseInt(n),0>t||t>=this.core.layers.length)throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Invalid texture set layer argument: index out of range ("+this.core.layers.length+" layers defined)");this._setLayer(t,e[n]||{})}},l.prototype._setLayer=function(e,t){t=t||{};var n=this.core.layers[e];void 0!=t.blendFactor&&null!=t.blendFactor&&(n.blendFactor=t.blendFactor),this._setLayerTransform(t,n)},l.prototype._setLayerTransform=function(e,t){var n,i;if(e.translate){var r=e.translate;void 0!=r.x&&(t.translate.x=r.x),void 0!=r.y&&(t.translate.y=r.y),n=SceneJS_math_translationMat4v([r.x||0,r.y||0,0])}if(e.scale){var o=e.scale;void 0!=o.x&&(t.scale.x=o.x),void 0!=o.y&&(t.scale.y=o.y),i=SceneJS_math_scalingMat4v([o.x||1,o.y||1,1]),n=n?SceneJS_math_mulMat4(n,i):i}if(e.rotate){var a=e.rotate;void 0!=a.z&&(t.rotate.z=a.z||0),i=SceneJS_math_rotationMat4v(.0174532925*a.z,[0,0,1]),n=n?SceneJS_math_mulMat4(n,i):i}n&&(t.matrix=n,t.matrixAsArray?t.matrixAsArray.set(t.matrix):t.matrixAsArray=new Float32Array(t.matrix),t.matrixAsArray=new Float32Array(t.matrix))},l.prototype._compile=function(){o[s]=this.core._coreId,a[s]=this.core,s++,r=!0,this._compileNodes(),s--,r=!0},l.prototype._destroy=function(){if(1==this.core._nodeCount)for(var e,t=0,n=this.core.layers.length;n>t;t++)e=this.core.layers[t],e.texture&&i(e.texture)}};new(function(){var e,t=[],n=[],i=0;SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_COMPILING,function(){i=0,e=!0}),SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_RENDERING,function(){e&&(i>0?SceneJS_DrawList.setClips(t[i-1],n.slice(0,i)):SceneJS_DrawList.setClips(),e=!1)});var r=SceneJS.createNodeType("clip");r.prototype._init=function(e){1==this.core._nodeCount&&(this.setMode(e.mode),this.setA(e.a),this.setB(e.b),this.setC(e.c))},r.prototype.setMode=function(e){if(e=e||"outside","disabled"!=e&&"inside"!=e&&"outside"!=e)throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"SceneJS.clip has a mode of unsupported type: '"+e+" - should be 'disabled', 'inside' or 'outside'");this.core.mode=e},r.prototype.getMode=function(){return this.core.mode},r.prototype.setAbc=function(e){e=e||{},this.setA(e.a),this.setB(e.b),this.setC(e.c)},r.prototype.getAbc=function(){return{a:this.getA(),b:this.getB(),c:this.getC()}},r.prototype.setA=function(e){e=e||{},this.core.a=[void 0!=e.x?e.x:0,void 0!=e.y?e.y:0,void 0!=e.z?e.z:0,1]},r.prototype.getA=function(){return{x:this.core.a[0],y:this.core.a[1],z:this.core.a[2]}},r.prototype.setB=function(e){e=e||{},this.core.b=[void 0!=e.x?e.x:0,void 0!=e.y?e.y:0,void 0!=e.z?e.z:0,1]},r.prototype.getB=function(){return{x:this.core.b[0],y:this.core.b[1],z:this.core.b[2]}},r.prototype.setC=function(e){e=e||{},this.core.c=[void 0!=e.x?e.x:0,void 0!=e.y?e.y:0,void 0!=e.z?e.z:0,1]},r.prototype.getC=function(){return{x:this.core.c[0],y:this.core.c[1],z:this.core.c[2]}},r.prototype.getAttributes=function(){return{mode:this.core.mode,a:this.getA(),b:this.getB(),c:this.getC()}},r.prototype._compile=function(){var r=this.core,o=SceneJS_modelTransformModule.transform.matrix,a=SceneJS_math_transformPoint3(o,r.a),s=SceneJS_math_transformPoint3(o,r.b),l=SceneJS_math_transformPoint3(o,r.c),c=SceneJS_math_normalizeVec3(SceneJS_math_cross3Vec4(SceneJS_math_normalizeVec3(SceneJS_math_subVec3(s,a,[0,0,0]),[0,0,0]),SceneJS_math_normalizeVec3(SceneJS_math_subVec3(s,l,[0,0,0]),[0,0,0]))),u=SceneJS_math_dotVector3(c,a);r.normalAndDist=[c[0],c[1],c[2],u],n[i]=r,t[i]=this.attr.id,i++,e=!0,this._compileNodes()}}),new function(){function e(e){if(document.getElementById(e.canvas.canvasId))for(var t,n=0,i=e.targets.length;i>n;n++)t=e.targets[n],t.vertexBuf&&t.vertexBuf.destroy(),t.normalBuf&&t.normalBuf.destroy(),t.uvBuf&&t.uvBuf.destroy(),t.uvBuf2&&t.uvBuf2.destroy()}function t(e,t,i,o){if("string"!=typeof t)return r(e,n(t),i);var a=SceneJS.Services.getService(SceneJS.Services.MORPH_GEO_LOADER_SERVICE_ID);a.loadMorphGeometry(t,function(t){o(r(e,t,i))})}function n(e){for(var t={keys:e.keys,targets:[]},n=0,r=e.targets.length;r>n;n++)t.targets.push(i(e.targets[n]));return t}function i(e){return{positions:e.positions?new Float32Array(e.positions):void 0,normals:e.normals?new Float32Array(e.normals):void 0,uv:e.uv?new Float32Array(e.uv):void 0,uv2:e.uv2?new Float32Array(e.uv2):void 0}}function r(e,t){var n=e.canvas.context,i={scene:e,canvas:e.canvas,keys:t.keys,targets:[],key1:0,key2:1};try{for(var r,o,a=n.STATIC_DRAW,s=0,l=t.targets.length;l>s;s++)r=t.targets[s],o={},i.targets.push(o),r.positions&&r.positions.length>0&&(o.vertexBuf=new SceneJS_webgl_ArrayBuffer(n,n.ARRAY_BUFFER,r.positions,r.positions.length,3,a)),r.normals&&r.normals.length>0&&(o.normalBuf=new SceneJS_webgl_ArrayBuffer(n,n.ARRAY_BUFFER,r.normals,r.normals.length,3,a)),r.uv&&r.uv.length>0&&(o.uvBuf=new SceneJS_webgl_ArrayBuffer(n,n.ARRAY_BUFFER,r.uv,r.uv.length,2,a)),r.uv2&&r.uv2.length>0&&(o.uvBuf2=new SceneJS_webgl_ArrayBuffer(n,n.ARRAY_BUFFER,r.uv2,r.uv2.length,2,a));return i}catch(c){for(var s=0,l=i.targets.length;l>s;s++)r=i.targets[s],r.vertexBuf&&r.vertexBuf.destroy(),r.normalBuf&&r.normalBuf.destroy(),r.uvBuf&&r.uvBuf.destroy(),r.uvBuf2&&r.uvBuf2.destroy();throw c.message="Error during WebGL allocation (scenejs _createMorph). Probable GPU resource problem. Original message: "+c.message,c}}var o,a=[],s=[],l=0;SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_COMPILING,function(){l=0}),SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_RENDERING,function(){o&&(l>0?SceneJS_DrawList.setMorph(a[l-1],s[l-1]):SceneJS_DrawList.setMorph(),o=!1)});var c=SceneJS.createNodeType("morphGeometry");c.prototype._init=function(e){if(1==this.core._nodeCount){if(e.create instanceof Function){var n=this._createMorphData(e.create());SceneJS._apply(t(this.scene,n,e.options),this.core)}else if(e.stream){this._stream=e.stream,this.core._loading=!0;var i=this;t(this.scene,this._stream,e.options,function(e){SceneJS._apply(e,i.core),i.core._loading=!1,SceneJS_compileModule.nodeUpdated(i,"loaded")})}else SceneJS._apply(t(this.scene,this._createMorphData(e),e.options),this.core);this.setFactor(e.factor)}this.core.factor=e.factor||0,this.core.clamp=!!e.clamp},c.prototype._createMorphData=function(e){var t=e.targets||[];if(2>t.length)throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"morphGeometry node should have at least two targets");var n=e.keys||[];if(n.length!=t.length)throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"morphGeometry node mismatch in number of keys and targets");for(var i,r,o,a,s,l=0,c=t.length;c>l;l++)s=t[l],!i&&s.positions&&(i=s.positions.slice(0)),!r&&s.normals&&(r=s.normals.slice(0)),!o&&s.uv&&(o=s.uv.slice(0)),!a&&s.uv2&&(a=s.uv2.slice(0));for(var l=0,c=t.length;c>l;l++)s=t[l],s.positions||(s.positions=i),s.normals||(s.normals=r),s.uv||(s.uv=o),s.uv2||(s.uv2=a);return{keys:n,targets:t,key1:0,key2:1,factor:0}},c.prototype.getState=function(){return this.core},c.prototype.getStream=function(){return this._stream},c.prototype.setFactor=function(e){e=e||0;var t=this.core,n=t.keys,i=t.key1,r=t.key2;if(n[0]>e)i=0,r=1;else if(e>n[n.length-1])i=n.length-2,r=i+1;else{for(;n[i]>e;)i--,r--;for(;e>n[r];)i++,r++}t.factor=(e-n[i])/(n[r]-n[i]),t.key1=i,t.key2=r},c.prototype.getFactor=function(){return this.core.factor},c.prototype._compile=function(){this._preCompile(),this._compileNodes(),this._postCompile()},c.prototype._preCompile=function(){this.core._loading||(a[l]=this.attr.id,s[l]=this.core,l++,o=!0)},c.prototype._postCompile=function(){this.core._loading||(l--,o=!0)},c.prototype._destroy=function(){1==this.core._nodeCount&&e(this.core)}},function(){var e,t=[],n=[],i=0;SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_COMPILING,function(){i=0,e=!0}),SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_RENDERING,function(){e&&(i>0?SceneJS_DrawList.setName(t[i-1],n[i-1]):SceneJS_DrawList.setName(),e=!1)});var r=SceneJS.createNodeType("name");r.prototype._init=function(e){1==this.core._nodeCount&&this.setName(e.name)},r.prototype.setName=function(e){this.core.name=e||"unnamed"},r.prototype._compile=function(){var r=this.attr.id;t[i]=r,n[i]=this.core.name,i++,e=!0,this._compileNodes(),i--,e=!0}}(),new function(){var e={};SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_IDLE,function(t){var n=e[t.sceneId];if(n){for(var i in n)n.hasOwnProperty(i)&&n[i].update();SceneJS_compileModule.redraw(t.sceneId)}}),SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_DESTROYED,function(t){e[t.sceneId]=null});var t=SceneJS.createNodeType("video");t.prototype._init=function(t){if(!t.src)throw SceneJS_errorModule.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"video node parameter expected: 'src'");var n=this._video=document.createElement("video");n.style.display="none",n.setAttribute("loop","loop"),n.autoplay=!0,n.addEventListener("ended",function(){this.play()},!0),document.getElementsByTagName("body")[0].appendChild(n),this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d"),n.src=t.src;var i=this._gl=this.scene.canvas.context;this._texture=i.createTexture();var r=this.attr.id,o=this,a={id:r,update:function(){var e=o._video,t=o._gl,n=o._canvas,i=o._texture,r=o._ctx;if(t.bindTexture(t.TEXTURE_2D,i),e.readyState>0){0>=e.height&&(e.style.display="",e.height=e.offsetHeight,e.width=e.offsetWidth,e.style.display="none"),n.height=e.height,n.width=e.width,r.drawImage(e,0,0);try{t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)}catch(a){t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n,null)}t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.generateMipmap(t.TEXTURE_2D)}},getTexture:function(){return{bind:function(e){var t=o._gl;t.activeTexture(t["TEXTURE"+e]),t.bindTexture(t.TEXTURE_2D,o._texture)},unbind:function(e){var t=o._gl;t.activeTexture(t["TEXTURE"+e]),t.bindTexture(t.TEXTURE_2D,null)}}}};a.update();var s=this.scene.attr.id,l=e[s];l||(l=e[s]={}),this._buf=l[r]=a},SceneJS._compilationStates.setSupplier("video",{get:function(t,n){var i=e[t];return{bind:function(e){var t=i[n];t&&t.getTexture().bind(e)},unbind:function(e){var t=i[n];t&&t.getTexture().unbind(e)}}}}),t.prototype._compile=function(){this._compileNodes()},t.prototype._destroy=function(){this._buf&&e[this.scene.attr.id]}},new function(){function e(e,t){var n=e.canvas,r=n.context,o=n.canvas.width,a=n.canvas.height,s=r.createFramebuffer(),l=r.createRenderbuffer(),c=r.createTexture(),u=!1;r.bindFramebuffer(r.FRAMEBUFFER,s),r.bindTexture(r.TEXTURE_2D,c),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);try{r.texImage2D(r.TEXTURE_2D,0,r.RGBA,o,a,0,r.RGBA,r.UNSIGNED_BYTE,null)
}catch(d){var h=new WebGLUnsignedByteArray(4*o*a);r.texImage2D(r.TEXTURE_2D,0,r.RGBA,o,a,0,r.RGBA,r.UNSIGNED_BYTE,h)}if(r.bindRenderbuffer(r.RENDERBUFFER,l),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,o,a),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,c,0),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,l),r.bindTexture(r.TEXTURE_2D,null),r.bindRenderbuffer(r.RENDERBUFFER,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.bindFramebuffer(r.FRAMEBUFFER,s),!r.isFramebuffer(s))throw SceneJS_errorModule.fatalError("Invalid framebuffer");var p=r.checkFramebufferStatus(r.FRAMEBUFFER);switch(p){case r.FRAMEBUFFER_COMPLETE:break;case r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw SceneJS_errorModule.fatalError("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");case r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw SceneJS_errorModule.fatalError("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");case r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw SceneJS_errorModule.fatalError("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");case r.FRAMEBUFFER_UNSUPPORTED:throw SceneJS_errorModule.fatalError("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");default:throw SceneJS_errorModule.fatalError("Incomplete framebuffer: "+p)}var f={id:t,bind:function(){r.bindFramebuffer(r.FRAMEBUFFER,s),r.clearColor(0,0,0,1),r.clearDepth(1),r.enable(r.DEPTH_TEST),r.disable(r.CULL_FACE),r.depthRange(0,1),r.disable(r.SCISSOR_TEST),r.disable(r.BLEND)},unbind:function(){r.bindFramebuffer(r.FRAMEBUFFER,null),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.bindRenderbuffer(r.RENDERBUFFER,l),u=!0},isRendered:function(){return u},getTexture:function(){return{bind:function(e){r.activeTexture(r["TEXTURE"+e]),r.bindTexture(r.TEXTURE_2D,c)},unbind:function(e){r.activeTexture(r["TEXTURE"+e]),r.bindTexture(r.TEXTURE_2D,null)}}}},m=i[e.attr.id];return m||(m=i[e.attr.id]={}),m[t]=f,f}function t(){}var n,i={},r=[],o=[],a=0;SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_COMPILING,function(){a=0,n=!0}),SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_RENDERING,function(){n&&(a>0?SceneJS_DrawList.setFrameBuf(r[a-1],o[a-1]):SceneJS_DrawList.setFrameBuf(),n=!1)}),SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_DESTROYED,function(e){i[e.sceneId]=null}),SceneJS._compilationStates.setSupplier("frameBuf",{get:function(e,t){var n=i[e];return{bind:function(e){var i=n[t];i&&i.isRendered()&&i.getTexture().bind(e)},unbind:function(e){var i=n[t];i&&i.isRendered()&&i.getTexture().unbind(e)}}}});var s=SceneJS.createNodeType("frameBuf");s.prototype._init=function(){this._buf=e(this.scene,this.attr.id)},s.prototype._compile=function(){r[a]=this.attr.id,o[a]=this._buf,a++,n=!0,this._compileNodes(),a--,n=!0},s.prototype._destroy=function(){this._buf&&t(this._buf)}},new function(){function e(e){for(var t,n,i={},r=0;l>r;r++){t=e[r];for(n in t)t.hasOwnProperty(n)&&(i[n]=t[n])}return i}var t,n=[],i=[],r=[],o=[],a=[],s=[],l=0;SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_COMPILING,function(){l=0,t=!0}),SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_RENDERING,function(){if(t){if(l>0){var c={shaders:{fragment:{code:o.slice(0,l).join("\n"),hooks:e(a)},vertex:{code:i.slice(0,l).join("\n"),hooks:e(r)}},paramsStack:s.slice(0,l),hash:n.slice(0,l).join(".")};SceneJS_DrawList.setShader(n[l-1],c)}else SceneJS_DrawList.setShader();t=!1}});var c=SceneJS.createNodeType("shader");c.prototype._init=function(e){1==this.core._nodeCount&&(this._setShaders(e.shaders),this.setParams(e.params))},c.prototype._setShaders=function(e){e=e||[],this.core.shaders={};for(var t,n=0,i=e.length;i>n;n++){if(t=e[n],!t.stage)throw SceneJS_errorModule.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"shader 'stage' attribute expected");var r;t.code&&(r=SceneJS._isArray(t.code)?t.code.join(""):t.code),this.core.shaders[t.stage]={code:r,hooks:t.hooks}}},c.prototype.setParams=function(e){e=e||{};var t=this.core.params;t||(t=this.core.params={});for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},c.prototype.getParams=function(){var e=this.core.params;if(!e)return{};var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},c.prototype._compile=function(){n[l]=this.core._coreId;var e=this.core.shaders,c=e.fragment||{},u=e.vertex||{};o[l]=c.code||"",a[l]=c.hooks||{},i[l]=u.code||"",r[l]=u.hooks||{},s[l]=this.core.params||{},l++,t=!0,this._compileNodes(),l--,t=!0}},new function(){var e,t=[],n=[],i=0;SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_COMPILING,function(){i=0,e=!0}),SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_RENDERING,function(){e&&(i>0?SceneJS_DrawList.setShaderParams(t[i-1],n.slice(0,i)):SceneJS_DrawList.setShaderParams(),e=!1)});var r=SceneJS.createNodeType("shaderParams");r.prototype._init=function(e){1==this.core._nodeCount&&this.setParams(e.params)},r.prototype.setParams=function(e){e=e||{};var t=this.core;t.params||(t.params={});for(var n in e)e.hasOwnProperty(n)&&(t.params[n]=e[n])},r.prototype._compile=function(){t[i]=this.core._coreId,n[i]=this.core.params,i++,e=!0,this._compileNodes(),i--,e=!0}};var SceneJS_nodeEventsModule=new function(){var e,t=[],n=[],i=0;SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_COMPILING,function(){i=0,e=!0}),SceneJS_eventModule.addListener(SceneJS_eventModule.SHADER_ACTIVATED,function(){e=!0}),SceneJS_eventModule.addListener(SceneJS_eventModule.SCENE_RENDERING,function(){e&&(i>0?SceneJS_DrawList.setRenderListeners(t[i-1],n.slice(0,i)):SceneJS_DrawList.setRenderListeners(),e=!1)}),this.preVisitNode=function(r){var o=r.listeners.rendered;o&&o.length>0&&(t[i]=r.attr.id,n[i]=function(e){r._fireEvent("rendered",e)},i++,e=!0)},this.postVisitNode=function(n){n.attr.id==t[i-1]&&(i--,e=!0)}};/*
Copyright DHTMLX LTD. http://www.dhtmlx.com
dhtmlxSlider is distributed under Free license
*/
dhtmlx=function(e){for(var t in e)dhtmlx[t]=e[t];return dhtmlx},dhtmlx.extend_api=function(e,t,n){var i=window[e];i&&(window[e]=function(e){if(e&&"object"==typeof e&&!e.tagName){var n,r=i.apply(this,t._init?t._init(e):arguments);for(n in dhtmlx)t[n]&&this[t[n]](dhtmlx[n]);for(n in e)t[n]?this[t[n]](e[n]):0==n.indexOf("on")&&this.attachEvent(n,e[n])}else r=i.apply(this,arguments);return t._patch&&t._patch(this),r||this},window[e].prototype=i.prototype,n&&dhtmlXHeir(window[e].prototype,n))},dhtmlxAjax={get:function(e,t){var n=new dtmlXMLLoaderObject(!0);return n.async=3>arguments.length,n.waitCall=t,n.loadXML(e),n},post:function(e,t,n){var i=new dtmlXMLLoaderObject(!0);return i.async=4>arguments.length,i.waitCall=n,i.loadXML(e,!0,t),i},getSync:function(e){return this.get(e,null,!0)},postSync:function(e,t){return this.post(e,t,null,!0)}},dtmlXMLLoaderObject.count=0,dtmlXMLLoaderObject.prototype.waitLoadFunction=function(e){var t=!0;return this.check=function(){!e||null==e.onloadAction||e.xmlDoc.readyState&&4!=e.xmlDoc.readyState||!t||(t=!1,dtmlXMLLoaderObject.count++,"function"==typeof e.onloadAction&&e.onloadAction(e.mainObject,null,null,null,e),e.waitCall&&(e.waitCall.call(this,e),e.waitCall=null))}},dtmlXMLLoaderObject.prototype.getXMLTopNode=function(e,t){if(this.xmlDoc.responseXML){var n=this.xmlDoc.responseXML.getElementsByTagName(e);0==n.length&&-1!=e.indexOf(":")&&(n=this.xmlDoc.responseXML.getElementsByTagName(e.split(":")[1]));var i=n[0]}else i=this.xmlDoc.documentElement;return i?(this._retry=!1,i):this._retry?(dhtmlxError.throwError("LoadXML","Incorrect XML",[t||this.xmlDoc,this.mainObject]),document.createElement("DIV")):(this._retry=!0,t=this.xmlDoc,this.loadXMLString(this.xmlDoc.responseText.replace(/^[\s]+/,""),!0),this.getXMLTopNode(e,t))},dtmlXMLLoaderObject.prototype.loadXMLString=function(e,t){if(_isIE)this.xmlDoc=new ActiveXObject("Microsoft.XMLDOM"),this.xmlDoc.async=this.async,this.xmlDoc.onreadystatechange=function(){},this.xmlDoc.loadXML(e);else{var n=new DOMParser;this.xmlDoc=n.parseFromString(e,"text/xml")}t||(this.onloadAction&&this.onloadAction(this.mainObject,null,null,null,this),this.waitCall&&(this.waitCall(),this.waitCall=null))},dtmlXMLLoaderObject.prototype.loadXML=function(e,t,n,i){this.rSeed&&(e+=(-1!=e.indexOf("?")?"&":"?")+"a_dhx_rSeed="+(new Date).valueOf()),this.filePath=e,this.xmlDoc=!_isIE&&window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),this.async&&(this.xmlDoc.onreadystatechange=new this.waitLoadFunction(this)),this.xmlDoc.open(t?"POST":"GET",e,this.async),i?(this.xmlDoc.setRequestHeader("User-Agent","dhtmlxRPC v0.1 ("+navigator.userAgent+")"),this.xmlDoc.setRequestHeader("Content-type","text/xml")):t&&this.xmlDoc.setRequestHeader("Content-type","application/x-www-form-urlencoded"),this.xmlDoc.setRequestHeader("X-Requested-With","XMLHttpRequest"),this.xmlDoc.send(n),this.async||new this.waitLoadFunction(this)()},dtmlXMLLoaderObject.prototype.destructor=function(){return this.setXSLParamValue=this.getXMLTopNode=this.xmlNodeToJSON=this.doSerialization=this.loadXMLString=this.loadXML=this.doXSLTransToString=this.doXSLTransToObject=this.doXPathOpera=this.doXPath=this.xmlDoc=this.mainObject=this.onloadAction=this.filePath=this.rSeed=this.async=this._retry=this._getAllNamedChilds=this._filterXPath=null},dtmlXMLLoaderObject.prototype.xmlNodeToJSON=function(e){for(var t={},n=0;e.attributes.length>n;n++)t[e.attributes[n].name]=e.attributes[n].value;for(t._tagvalue=e.firstChild?e.firstChild.nodeValue:"",n=0;e.childNodes.length>n;n++){var i=e.childNodes[n].tagName;i&&(t[i]||(t[i]=[]),t[i].push(this.xmlNodeToJSON(e.childNodes[n])))}return t},dhtmlDragAndDropObject.prototype.removeDraggableItem=function(e){e.onmousedown=null,e.dragStarter=null,e.dragLanding=null},dhtmlDragAndDropObject.prototype.addDraggableItem=function(e,t){e.onmousedown=this.preCreateDragCopy,e.dragStarter=t,this.addDragLanding(e,t)},dhtmlDragAndDropObject.prototype.addDragLanding=function(e,t){e.dragLanding=t},dhtmlDragAndDropObject.prototype.preCreateDragCopy=function(e){return!e&&!window.event||2!=(e||event).button?window.dhtmlDragAndDrop.waitDrag?(window.dhtmlDragAndDrop.waitDrag=0,document.body.onmouseup=window.dhtmlDragAndDrop.tempDOMU,document.body.onmousemove=window.dhtmlDragAndDrop.tempDOMM,!1):(window.dhtmlDragAndDrop.dragNode&&window.dhtmlDragAndDrop.stopDrag(e),window.dhtmlDragAndDrop.waitDrag=1,window.dhtmlDragAndDrop.tempDOMU=document.body.onmouseup,window.dhtmlDragAndDrop.tempDOMM=document.body.onmousemove,window.dhtmlDragAndDrop.dragStartNode=this,window.dhtmlDragAndDrop.dragStartObject=this.dragStarter,document.body.onmouseup=window.dhtmlDragAndDrop.preCreateDragCopy,document.body.onmousemove=window.dhtmlDragAndDrop.callDrag,window.dhtmlDragAndDrop.downtime=(new Date).valueOf(),e&&e.preventDefault&&e.preventDefault(),!1):void 0},dhtmlDragAndDropObject.prototype.callDrag=function(e){if(e||(e=window.event),dragger=window.dhtmlDragAndDrop,!(100>(new Date).valueOf()-dragger.downtime)){if(!dragger.dragNode){if(!dragger.waitDrag)return dragger.stopDrag(e,!0);if(dragger.dragNode=dragger.dragStartObject._createDragNode(dragger.dragStartNode,e),!dragger.dragNode)return dragger.stopDrag();dragger.dragNode.onselectstart=function(){return!1},dragger.gldragNode=dragger.dragNode,document.body.appendChild(dragger.dragNode),document.body.onmouseup=dragger.stopDrag,dragger.waitDrag=0,dragger.dragNode.pWindow=window,dragger.initFrameRoute()}if(dragger.dragNode.parentNode!=window.document.body&&dragger.gldragNode){var t=dragger.gldragNode;dragger.gldragNode.old&&(t=dragger.gldragNode.old),t.parentNode.removeChild(t);var n=dragger.dragNode.pWindow;if(t.pWindow&&t.pWindow.dhtmlDragAndDrop.lastLanding&&t.pWindow.dhtmlDragAndDrop.lastLanding.dragLanding._dragOut(t.pWindow.dhtmlDragAndDrop.lastLanding),_isIE){var i=document.createElement("Div");i.innerHTML=dragger.dragNode.outerHTML,dragger.dragNode=i.childNodes[0]}else dragger.dragNode=dragger.dragNode.cloneNode(!0);dragger.dragNode.pWindow=window,dragger.gldragNode.old=dragger.dragNode,document.body.appendChild(dragger.dragNode),n.dhtmlDragAndDrop.dragNode=dragger.dragNode}dragger.dragNode.style.left=e.clientX+15+(dragger.fx?-1*dragger.fx:0)+(document.body.scrollLeft||document.documentElement.scrollLeft)+"px",dragger.dragNode.style.top=e.clientY+3+(dragger.fy?-1*dragger.fy:0)+(document.body.scrollTop||document.documentElement.scrollTop)+"px";var r=e.srcElement?e.srcElement:e.target;dragger.checkLanding(r,e)}},dhtmlDragAndDropObject.prototype.calculateFramePosition=function(e){if(window.name){for(var t=parent.frames[window.name].frameElement.offsetParent,n=0,i=0;t;)n+=t.offsetLeft,i+=t.offsetTop,t=t.offsetParent;if(parent.dhtmlDragAndDrop){var r=parent.dhtmlDragAndDrop.calculateFramePosition(1);n+=1*r.split("_")[0],i+=1*r.split("_")[1]}if(e)return n+"_"+i;this.fx=n,this.fy=i}return"0_0"},dhtmlDragAndDropObject.prototype.checkLanding=function(e,t){e&&e.dragLanding?(this.lastLanding&&this.lastLanding.dragLanding._dragOut(this.lastLanding),this.lastLanding=e,this.lastLanding=this.lastLanding.dragLanding._dragIn(this.lastLanding,this.dragStartNode,t.clientX,t.clientY,t),this.lastLanding_scr=_isIE?t.srcElement:t.target):e&&"BODY"!=e.tagName?this.checkLanding(e.parentNode,t):(this.lastLanding&&this.lastLanding.dragLanding._dragOut(this.lastLanding,t.clientX,t.clientY,t),this.lastLanding=0,this._onNotFound&&this._onNotFound())},dhtmlDragAndDropObject.prototype.stopDrag=function(e,t){if(dragger=window.dhtmlDragAndDrop,!t){dragger.stopFrameRoute();var n=dragger.lastLanding;dragger.lastLanding=null,n&&n.dragLanding._drag(dragger.dragStartNode,dragger.dragStartObject,n,_isIE?event.srcElement:e.target)}dragger.lastLanding=null,dragger.dragNode&&dragger.dragNode.parentNode==document.body&&dragger.dragNode.parentNode.removeChild(dragger.dragNode),dragger.dragNode=0,dragger.gldragNode=0,dragger.fx=0,dragger.fy=0,dragger.dragStartNode=0,dragger.dragStartObject=0,document.body.onmouseup=dragger.tempDOMU,document.body.onmousemove=dragger.tempDOMM,dragger.tempDOMU=null,dragger.tempDOMM=null,dragger.waitDrag=0},dhtmlDragAndDropObject.prototype.stopFrameRoute=function(e){e&&window.dhtmlDragAndDrop.stopDrag(1,1);for(var t=0;window.frames.length>t;t++)try{window.frames[t]!=e&&window.frames[t].dhtmlDragAndDrop&&window.frames[t].dhtmlDragAndDrop.stopFrameRoute(window)}catch(n){}try{parent.dhtmlDragAndDrop&&parent!=window&&parent!=e&&parent.dhtmlDragAndDrop.stopFrameRoute(window)}catch(i){}},dhtmlDragAndDropObject.prototype.initFrameRoute=function(e,t){e&&(window.dhtmlDragAndDrop.preCreateDragCopy(),window.dhtmlDragAndDrop.dragStartNode=e.dhtmlDragAndDrop.dragStartNode,window.dhtmlDragAndDrop.dragStartObject=e.dhtmlDragAndDrop.dragStartObject,window.dhtmlDragAndDrop.dragNode=e.dhtmlDragAndDrop.dragNode,window.dhtmlDragAndDrop.gldragNode=e.dhtmlDragAndDrop.dragNode,window.document.body.onmouseup=window.dhtmlDragAndDrop.stopDrag,window.waitDrag=0,!_isIE&&t&&(!_isFF||1.8>_FFrv)&&window.dhtmlDragAndDrop.calculateFramePosition());try{parent.dhtmlDragAndDrop&&parent!=window&&parent!=e&&parent.dhtmlDragAndDrop.initFrameRoute(window)}catch(n){}for(var i=0;window.frames.length>i;i++)try{window.frames[i]!=e&&window.frames[i].dhtmlDragAndDrop&&window.frames[i].dhtmlDragAndDrop.initFrameRoute(window,!e||t?1:0)}catch(r){}},_OperaRv=_KHTMLrv=_FFrv=_isChrome=_isMacOS=_isKHTML=_isOpera=_isIE=_isFF=!1,-1!=navigator.userAgent.indexOf("Macintosh")&&(_isMacOS=!0),navigator.userAgent.toLowerCase().indexOf("chrome")>-1&&(_isChrome=!0),-1!=navigator.userAgent.indexOf("Safari")||-1!=navigator.userAgent.indexOf("Konqueror")?(_KHTMLrv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf("Safari")+7,5)),_KHTMLrv>525?(_isFF=!0,_FFrv=1.9):_isKHTML=!0):-1!=navigator.userAgent.indexOf("Opera")?(_isOpera=!0,_OperaRv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf("Opera")+6,3))):-1!=navigator.appName.indexOf("Microsoft")?(_isIE=!0,-1==navigator.appVersion.indexOf("MSIE 8.0")&&-1==navigator.appVersion.indexOf("MSIE 9.0")&&-1==navigator.appVersion.indexOf("MSIE 10.0")||"BackCompat"==document.compatMode||(_isIE=8)):(_isFF=!0,_FFrv=parseFloat(navigator.userAgent.split("rv:")[1])),dtmlXMLLoaderObject.prototype.doXPath=function(e,t,n,i){if(_isKHTML||!_isIE&&!window.XPathResult)return this.doXPathOpera(e,t);if(_isIE)return t||(t=this.xmlDoc.nodeName?this.xmlDoc:this.xmlDoc.responseXML),t||dhtmlxError.throwError("LoadXML","Incorrect XML",[t||this.xmlDoc,this.mainObject]),null!=n&&t.setProperty("SelectionNamespaces","xmlns:xsl='"+n+"'"),"single"==i?t.selectSingleNode(e):t.selectNodes(e)||[];var r=t;t||(t=this.xmlDoc.nodeName?this.xmlDoc:this.xmlDoc.responseXML),t||dhtmlxError.throwError("LoadXML","Incorrect XML",[t||this.xmlDoc,this.mainObject]),-1!=t.nodeName.indexOf("document")?r=t:(r=t,t=t.ownerDocument);var o=XPathResult.ANY_TYPE;"single"==i&&(o=XPathResult.FIRST_ORDERED_NODE_TYPE);var a=[],s=t.evaluate(e,r,function(){return n},o,null);if(o==XPathResult.FIRST_ORDERED_NODE_TYPE)return s.singleNodeValue;for(var l=s.iterateNext();l;)a[a.length]=l,l=s.iterateNext();return a},j.prototype.catchError=function(e,t){this.catches[e]=t},j.prototype.throwError=function(e,t,n){return this.catches[e]?this.catches[e](e,t,n):this.catches.ALL?this.catches.ALL(e,t,n):(alert("Error type: "+e+"\nDescription: "+t),null)},window.dhtmlxError=new j,dtmlXMLLoaderObject.prototype.doXPathOpera=function(e,t){var n=e.replace(/[\/]+/gi,"/").split("/"),i=null,r=1;if(!n.length)return[];if("."==n[0])i=[t];else{if(""!=n[0])return[];i=(this.xmlDoc.responseXML||this.xmlDoc).getElementsByTagName(n[r].replace(/\[[^\]]*\]/g,"")),r++}for(;n.length>r;r++)i=this._getAllNamedChilds(i,n[r]);return-1!=n[r-1].indexOf("[")&&(i=this._filterXPath(i,n[r-1])),i},dtmlXMLLoaderObject.prototype._filterXPath=function(e,t){for(var n=[],t=t.replace(/[^\[]*\[\@/g,"").replace(/[\[\]\@]*/g,""),i=0;e.length>i;i++)e[i].getAttribute(t)&&(n[n.length]=e[i]);return n},dtmlXMLLoaderObject.prototype._getAllNamedChilds=function(e,t){var n=[];_isKHTML&&(t=t.toUpperCase());for(var i=0;e.length>i;i++)for(var r=0;e[i].childNodes.length>r;r++)_isKHTML?e[i].childNodes[r].tagName&&e[i].childNodes[r].tagName.toUpperCase()==t&&(n[n.length]=e[i].childNodes[r]):e[i].childNodes[r].tagName==t&&(n[n.length]=e[i].childNodes[r]);return n},dtmlXMLLoaderObject.prototype.xslDoc=null,dtmlXMLLoaderObject.prototype.setXSLParamValue=function(e,t,n){n||(n=this.xslDoc),n.responseXML&&(n=n.responseXML);var i=this.doXPath("/xsl:stylesheet/xsl:variable[@name='"+e+"']",n,"http://www.w3.org/1999/XSL/Transform","single");null!=i&&(i.firstChild.nodeValue=t)},dtmlXMLLoaderObject.prototype.doXSLTransToObject=function(e,t){if(e||(e=this.xslDoc),e.responseXML&&(e=e.responseXML),t||(t=this.xmlDoc),t.responseXML&&(t=t.responseXML),_isIE){i=new ActiveXObject("Msxml2.DOMDocument.3.0");try{t.transformNodeToObject(e,i)}catch(n){i=t.transformNode(e)}}else{this.XSLProcessor||(this.XSLProcessor=new XSLTProcessor,this.XSLProcessor.importStylesheet(e));var i=this.XSLProcessor.transformToDocument(t)}return i},dtmlXMLLoaderObject.prototype.doXSLTransToString=function(e,t){var n=this.doXSLTransToObject(e,t);return"string"==typeof n?n:this.doSerialization(n)},dtmlXMLLoaderObject.prototype.doSerialization=function(e){if(e||(e=this.xmlDoc),e.responseXML&&(e=e.responseXML),_isIE)return e.xml;var t=new XMLSerializer;return t.serializeToString(e)},dhtmlxEventable=function(a){a.attachEvent=function(e,t,n){return e="ev_"+e.toLowerCase(),this[e]||(this[e]=new this.eventCatcher(n||this)),e+":"+this[e].addEvent(t)},a.callEvent=function(e,t){return e="ev_"+e.toLowerCase(),this[e]?this[e].apply(this,t):!0},a.checkEvent=function(e){return!!this["ev_"+e.toLowerCase()]},a.eventCatcher=function(a){var c=[],d=function(){for(var e=!0,t=0;c.length>t;t++)if(null!=c[t])var n=c[t].apply(a,arguments),e=e&&n;return e};return d.addEvent=function(a){return"function"!=typeof a&&(a=eval(a)),a?c.push(a)-1:!1},d.removeEvent=function(e){c[e]=null},d},a.detachEvent=function(e){if(e!=!1){var t=e.split(":");this[t[0]].removeEvent(t[1])}},a.detachAllEvents=function(){for(var e in this)0==e.indexOf("ev_")&&delete this[e]},a=null},dhtmlxSlider.prototype.createStructure=function(){if(this.con&&(this.con.parentNode.removeChild(this.con),this.con=null),this.vMode){this._sW="height",this._sH="width",this._sL="top",this._sT="left";var e=this.imgURL+"skins/"+this.skin+"/vertical/"}else this._sW="width",this._sH="height",this._sL="left",this._sT="top",e=this.imgURL+"skins/"+this.skin+"/";this.con=document.createElement("DIV"),this.con.onselectstart=function(){return!1},this.con._etype="slider",this.con.className="dhtmlxSlider"+("default"!=this.skin?"_"+this.skin:""),this._skinsImgs[this.skin].bg&&(this.con.style.backgroundImage="url("+e+"bg.gif)"),this.drag=document.createElement("DIV"),this.drag._etype="drag",this.drag.className="selector",this.drag.style.backgroundImage="url("+e+"selector.gif)";var t=document.createElement("DIV");t.className="leftSide",this._skinsImgs[this.skin].ls&&(t.style.background="url("+e+"leftside_bg.gif)"),this.leftZone=document.createElement("DIV"),this.leftZone.className="leftZone",this._skinsImgs[this.skin].lz&&(this.leftZone.style.background="url("+e+"leftzone_bg.gif)");var n=document.createElement("DIV");if(n.className="rightSide",this._skinsImgs[this.skin].rs&&(n.style.background="url("+e+"rightside_bg.gif)"),this.rightZone=document.createElement("DIV"),this.rightZone.className="rightZone",this._skinsImgs[this.skin].rz&&(this.rightZone.style.background="url("+e+"rightzone_bg.gif)"),this.con.appendChild(t),this.con.appendChild(this.leftZone),this.con.appendChild(this.rightZone),this.con.appendChild(n),this.con.appendChild(this.drag),this.parent.appendChild(this.con),(!this.parent.parentNode||!this.parent.parentNode.tagName)&&document.body.appendChild(this.parent),this.vMode){this._sW="height",this._sH="width",this._sL="top",this._sT="left",this.con.style.width=this.con.offsetHeight+"px";for(var i=0;this.con.childNodes.length>i;i++){this.con.childNodes[i].style.fontSize="0";var r=this.con.childNodes[i].offsetWidth;this.con.childNodes[i].style.width=this.con.childNodes[i].offsetHeight+"px",this.con.childNodes[i].style.height=r+"px",r=this.con.childNodes[i].offsetLeft,this.con.childNodes[i].style.left=this.con.childNodes[i].offsetTop+"px",this.con.childNodes[i].style.top=r+"px"}n.style.top=this.size-n.offsetHeight+"px",this.zoneSize=this.size-n.offsetHeight,this.dragLeft=this.drag.offsetTop,this.dragWidth=this.drag.offsetHeight,this.rightZone.style.height=this.zoneSize+"px"}else this.zoneSize=this.size-n.offsetWidth,this.dragLeft=this.drag.offsetLeft,this.dragWidth=this.drag.offsetWidth,this.rightZone.style.width=this.zoneSize+"px";this.con.style[this._sW]=this.size+"px",this.con.onmousedown=this._onMouseDown,this.con.onmouseup=this.con.onmouseout=function(){clearInterval(this.that._int)},this.con.that=this,this._aCalc(this._def)},dhtmlxSlider.prototype._aCalc=function(e){return this.isInit?(this.shift=e[0],this.limit=e[1]-this.shift,this._mod=(e[4]-2*this.dragLeft-this.dragWidth)/this.limit,this._step=e[2],this.step=this._step*this._mod,this._xlimit=e[4]-2*this.dragLeft-this.dragWidth,this.posX||(this.posX=this._xlimit*(e[3]-this.shift)/this.limit),this._applyPos(!0),this):void 0},dhtmlxSlider.prototype.setMin=function(e){this._def[0]=e-0,this._aCalc(this._def)},dhtmlxSlider.prototype.setMax=function(e){this._def[1]=e-0,this._aCalc(this._def)},dhtmlxSlider.prototype.setStep=function(e){this._def[2]=e-0,this._aCalc(this._def)},dhtmlxSlider.prototype._applyPos=function(e){if(this.isInit){1!=this.step&&this.step&&(this.posX=Math.round(this.posX/this.step)*this.step),0>this.posX&&(this.posX=0),this.value<(this._def[0]||0)&&(this.value=this._def[0]||0),this.value>this._def[1]&&(this.value=this._def[1]),this.posX>this._xlimit&&(this.posX=this._xlimit);var t=this.drag.style[this._sL];this.drag.style[this._sL]=this.posX+1*this.dragLeft+"px",this.leftZone.style[this._sW]=this.posX+1*this.dragLeft+"px",this.rightZone.style[this._sL]=this.posX+1*this.dragLeft+1+"px",this.rightZone.style[this._sW]=this.zoneSize-(this.posX+1*this.dragLeft)+"px";var n=this.getValue();this._link&&(this._linkBoth?this._link.value=n:this._link.innerHTML=n),!e&&t!=this.drag.style[this._sL]&&this.callEvent("onChange",[n,this]),this.value=this.getValue(),this._dttp||this._setTooltip(n)}},dhtmlxSlider.prototype._setTooltip=function(e){this.con.title=e},dhtmlxSlider.prototype.setSkin=function(e){this.skin=e||"default",this.isInit&&this.createStructure()},dhtmlxSlider.prototype.startDrag=function(e){if(!this._busy&&(0===e.button||1===e.button)){this.drag_mx=e.clientX,this.drag_my=e.clientY,this.drag_cx=this.posX,this.d_b_move=document.body.onmousemove,this.d_b_up=document.body.onmouseup;var t=this;document.body.onmouseup=function(e){t.stopDrag(e||event),t=null},document.body.onmousemove=function(e){t.onDrag(e||event)},this._busy=!0}},dhtmlxSlider.prototype.onDrag=function(e){this._busy&&(this.posX=this.vMode?this.drag_cx+e.clientY-this.drag_my:this.drag_cx+e.clientX-this.drag_mx,this._applyPos())},dhtmlxSlider.prototype.stopDrag=function(){document.body.onmousemove=this.d_b_move?this.d_b_move:null,document.body.onmouseup=this.d_b_up?this.d_b_up:null,this.d_b_move=this.d_b_up=null,this._busy=!1,this.callEvent("onSlideEnd",[this.getValue()])},dhtmlxSlider.prototype.getValue=function(){return!this._busy&&this.inputPriority?(Math.round(this.value/this._step)*this._step).toFixed(6)-0:Math.round(1e4*(Math.round(this.posX/this._mod/this._step)*this._step+1*this.shift))/1e4},dhtmlxSlider.prototype.setValue=function(e,t){isNaN(e)||(this._def[3]=this.value=e-0,this.posX=Math.round(((e||0)-this.shift)*this._mod),this._applyPos(null==t?!0:t))},dhtmlxSlider.prototype._getActionElement=function(e){return e._etype?e:e.parentNode?this._getActionElement(e.parentNode):null},dhtmlxSlider.prototype._onMouseDown=function(e){if(!this.that.disabled){var e=e||event,t=this.that,n=t._getActionElement(_isIE?e.srcElement:e.target);switch(n._etype){case"slider":var i=t.vMode?e.clientY-(getAbsoluteTop(t.con)-document.body.scrollTop):e.clientX-(getAbsoluteLeft(t.con)-document.body.scrollLeft),r=t.posX;t.posX=i-t.dragLeft-t.dragWidth/2,t.direction=t.posX>r?1:-1,t.stepping?(clearInterval(t._int),t.setValue(t.value+t._step*t.direction,!1),t._int=setInterval(function(){t.setValue(t.value+t._step*t.direction,!1)},600)):(t._busy=!0,t._applyPos(),t._busy=!1);break;case"drag":t.startDrag(e||event)}return!1}},dhtmlxSlider.prototype.setOnChangeHandler=function(e){this.attachEvent("onChange",e)},dhtmlxSlider.prototype._linkFrom=function(){this.disabled||this.setValue(parseFloat(this._link.value),!1)},dhtmlxSlider.prototype.linkTo=function(e){this._link=e="object"!=typeof e?document.getElementById(e):e;var t=e.tagName.toString().toLowerCase();if(this._linkBoth="input"==t||"select"==t||"textarea"==t?1:0){var n=this,i=function(){this._nextSlider&&window.clearTimeout(this._nextSlider),this._nextSlider=window.setTimeout(function(){n._linkFrom()},500)};e.onblur=e.onkeypress=e.onchange=i}this._applyPos()},dhtmlxSlider.prototype.enableTooltip=function(e){this._dttp=!convertStringToBoolean(e),this._setTooltip(this._dttp?"":this.getValue())},dhtmlxSlider.prototype.setImagePath=function(e){this.imgURL=e},dhtmlxSlider.prototype.init=function(){this.isInit=!0,this.createStructure()},dhtmlxSlider.prototype.setInputPriority=function(e){this.inputPriority=e},dhtmlxSlider.prototype.setSteppingMode=function(e){this.stepping=e},dhtmlxSlider.prototype.disable=function(e){this.disabled=e},function(){dhtmlx.extend_api("dhtmlxSlider",{_init:function(e){return[e.parent,e.size,e.skin,e.vertical,e.min,e.max,e.value,e.step]},link:"linkTo"},{})}();var GCDrag={BIG_Z_INDEX:1e4,LAST_Z_INDEX:10001,isDragging:!1,itemindrag:null,mouseXinit:null,mouseYinit:null,lastdragged:null,makeDraggable:function(e,t){t.draggableitem=e,t.onmousedown=GCDrag.onMouseDown,t.style.cursor="move"},setup:function(e){initPosition=GCDragUtils.findPos(e),e.initPositionX=initPosition.x,e.initPositionY=initPosition.y,e.style.position="absolute",e.style.left=initPosition.x+"px",e.style.top=initPosition.y+"px",e.width=parseInt(e.style.width),e.height=parseInt(e.style.height),e.originalZIndex=e.style.zIndex,e.originalOpacity=e.style.opacity,e.isSetupForGCDrag=!0},onMouseDown:function(e){if(e=GCDragUtils.fixEvent(e),targ=GCDragUtils.findTarget(e),ditem=targ.draggableitem){for(ditem.isSetupForGCDrag||GCDrag.setup(ditem);!targ.draggableitem&&null!=targ;)targ=targ.parentNode?targ.parentNode:targ.parentElement;if(null==targ)return!1;GCDrag.lastdragged&&(GCDrag.lastdragged.style.zIndex=GCDrag.lastdragged.originalZIndex),ditem.originalLeft=parseInt(ditem.style.left),ditem.originalTop=parseInt(ditem.style.top),document.onmousemove=GCDrag.onMouseMove,document.onmouseup=GCDrag.onMouseUp,GCDrag.itemindrag=ditem,GCDrag.isDragging=!0,GCDrag.mouseXinit=e.clientX,GCDrag.mouseYinit=e.clientY}return!1},onMouseMove:function(e){return e=GCDragUtils.fixEvent(e),GCDrag.isDragging&&(ditem=GCDrag.itemindrag,ditem.style.zIndex=GCDrag.BIG_Z_INDEX,ditem.style.opacity=.75,GCDragUtils.repositionItem(e,ditem)),!1},onMouseUp:function(e){return e=GCDragUtils.fixEvent(e),GCDrag.itemindrag&&(ditem=GCDrag.itemindrag,ditem.style.zIndex=GCDrag.LAST_Z_INDEX,ditem.style.opacity=ditem.originalOpacity,GCDrag.lastdragged=ditem),GCDrag.itemindrag=null,GCDrag.isDragging=!1,GCDrag.mouseXinit=null,GCDrag.mouseYinit=null,document.onmousemove=null,document.onmouseup=null,!1}},GCDragUtils={fixEvent:function(e){return e?e:window.event},findPos:function(e){var t=curtop=0;return e.offsetParent&&(t=e.offsetLeft,curtop=e.offsetTop),{x:t,y:curtop}},findTarget:function(e){return e.target?targ=e.target:e.srcElement&&(targ=e.srcElement),3==targ.nodeType&&(targ=targ.parentNode),targ},getDimensions:function(e){var t,n;return e.innerHeight?(t=e.innerWidth,n=e.innerHeight):e.clientHeight?(t=e.clientWidth,n=e.clientHeight):e.width&&(t=e.width,n=e.height),{width:t,height:n}},repositionItem:function(e,t){var n=this.getDimensions(t),i=this.getDimensions(t.parentElement);eventx=e.clientX,eventy=e.clientY,newleft=1*(t.originalLeft+eventx-GCDrag.mouseXinit),newtop=1*(t.originalTop+eventy-GCDrag.mouseYinit),0>newleft&&(newleft=0),0>newtop&&(newtop=0),console.log("newleft",newleft,"newtop",newtop),newbottom=newtop+n.height,newright=newleft+n.width,newright>i.width&&(newleft=i.width-n.width),newbottom>i.height&&(newtop=i.height-n.height),t.style.left=newleft+"px",t.style.top=newtop+"px"}};!function(e,t,n){function i(n,o){if(!t[n]){if(!e[n]){var a="function"==typeof require&&require;if(!o&&a)return a(n,!0);if(r)return r(n,!0);throw new Error("Cannot find module '"+n+"'")}var s=t[n]={exports:{}};e[n][0].call(s.exports,function(t){var r=e[n][1][t];return i(r?r:t)},s,s.exports)}return t[n].exports}for(var r="function"==typeof require&&require,o=0;n.length>o;o++)i(n[o]);return i}({1:[function(e){!function(t){function n(){var e=new l,t=new a;return new s(e,t)}function i(e){var t=e.getProject(),n=t[0],i=t[1],r=e.getEnvironmentName();return new c(n,i,r,"fallback+sourcemaps")}var r,o=e("./client"),a=e("./util/sourcemaps_obtainer"),s=e("./processors/sourcemaps_processor"),l=e("./processors/tracekit_processor"),c=e("./reporters/jsonp_reporter");r=new o(n,i,t.Airbrake),t.Airbrake=r,e("./util/slurp_project_from_dom")(r)}(window)},{"./client":2,"./processors/sourcemaps_processor":4,"./processors/tracekit_processor":5,"./reporters/jsonp_reporter":6,"./util/slurp_project_from_dom":7,"./util/sourcemaps_obtainer":3}],7:[function(e,t){!function(e){t.exports=function(t){for(var n,i,r,o,a=e.document.getElementsByTagName("script"),s=0,l=a.length;l>s;s++)n=a[s],i=n.getAttribute("data-airbrake-project-id"),r=n.getAttribute("data-airbrake-project-key"),o=n.getAttribute("data-airbrake-project-environment-name"),i&&r&&t.setProject(i,r),o&&t.setEnvironmentName(o)}}(window)},{}],2:[function(e,t){!function(){function n(e,t,n){function r(n){try{var r=e&&e(o),a=r&&t(o),s=n.error||n,l=n.context||{},p=n.env||{},f=n.params||{},m=n.session||{};r&&a&&r.process(s,function(e){var t={context:i({},l,c),environment:i({},p,u),params:i({},f,d),session:i({},m,h)};a.report(e,t)})}catch(g){}}var o=this,a="environment";o.setEnvironmentName=function(e){a=e},o.getEnvironmentName=function(){return a};var s,l;o.setProject=function(e,t){s=e,l=t},o.getProject=function(){return[s,l]};var c={};o.getContext=function(){return c},o.addContext=function(e){i(c,e)};var u={};o.getEnv=function(){return u},o.addEnv=function(e){i(u,e)};var d={};o.getParams=function(){return d},o.addParams=function(e){i(d,e)};var h={};o.getSession=function(){return h},o.addSession=function(e){i(h,e)},o.capture=r,o.push=r,o.try=function(e,t){try{return e.call(t)}catch(n){o.capture(n)}},o.wrap=function(e,t){return function(){return o.try(e,t)}},setTimeout(function(){if(n)for(var e=0,t=n.length;t>e;e++)o.push(n[e])})}var i=e("./util/merge");t.exports=n}()},{"./util/merge":8}],3:[function(e,t){!function(n){function i(e,t){var i=new n.XMLHttpRequest;i.open("GET",e,!0),i.send(),i.onreadystatechange=function(){4===i.readyState&&t(i.responseText)}}function r(e){var t=e.match(l);return t?t[1]:void 0}function o(e){var t=e.match(c);return t?s(t[1]):void 0}function a(){function e(e,t){var n=r(e);if(n){var a=o(n);a?t(a):i(n,function(e){t(e)})}else t(null)}this.obtain=function(t,n){i(t,function(t){e(t,n)})}}var s=e("../util/base64_decode").decode,l=/\/\/(?:@|#) sourceMappingURL=(.+)$/,c=/data:application\/json;base64,(.*)/;a.sourceMapUrl=r,a.dataUri=o,t.exports=a}(window)},{"../util/base64_decode":9}],4:[function(e,t){!function(){function n(e,t,n,i){function o(e,t){t.obtain(e,function(t){var o;t&&(o=new r(t),n[e]=o),--a||i(n)})}for(var a=e.length,s=a-1;s>=0;s--)o(e[s],t)}function i(e,t){function i(e,i,r){function o(t){for(var n,i,o,a=s.length-1;a>=0;a--)n=s[a],i=t[n.file],i&&(o=i.originalPositionFor({line:n.line,column:n.column}),n.file=o.source,n.line=o.line,n.column=o.column);r(e)}for(var a,s=e.backtrace,l=[],c={},u=s.length-1;u>=0;u--)a=s[u].file,c[a]||(c[a]=!0,l.push(a));n(l,t,i,o)}this._source_maps={},this.process=function(t,n){var r=this._source_maps;e.process(t,function(e){i(e,r,n)})}}var r=e("../lib/source-map/source-map-consumer").SourceMapConsumer;t.exports=i}()},{"../lib/source-map/source-map-consumer":10}],6:[function(e,t){!function(n){function i(e,t,i,a){this.report=function(s,l){function c(){h.removeChild(p)}var u=r.build(i,a,s,l),d=n.document,h=d.getElementsByTagName("head")[0],p=d.createElement("script"),f=JSON.stringify(u),m="airbrake_cb_"+o,g="https://api.airbrake.io",v=g+"/api/v3/projects/"+e+"/create-notice?key="+t+"&callback="+m+"&body="+encodeURIComponent(f);n[m]=function(){delete n[m]},o+=1,p.src=v,p.type="text/javascript",p.onload=c,p.onerror=c,h.appendChild(p)}}var r=e("../reporters/report_builder"),o=0;t.exports=i}(window)},{"../reporters/report_builder":11}],5:[function(e,t){!function(){function n(){this.process=function(e,t){i.report(e,t)}}var i=e("../shims/tracekit_browserify_shim");i.remoteFetching=!0,i.collectWindowErrors=!1,i.report.subscribe(function(e,t){var n,i,r=e.stack,o=[];for(n=r.length-1;n>=0;n--)i=r[n],o.unshift({file:i.url,line:parseInt(i.line,10),column:parseInt(i.column,10),"function":i.func});t({type:e.name,message:e.message,backtrace:o})}),t.exports=n}()},{"../shims/tracekit_browserify_shim":12}],8:[function(e,t){var n=function(){function e(e,t,n){n.hasOwnProperty(e)&&(t[e]=n[e])}return function(){var t,n,i,r=Array.prototype.slice.call(arguments),o=r.shift()||{},a=r.length;for(i=0;a>i;i++)if(t=r[i])for(n in t)e(n,o,t);return o}}();t.exports=n},{}],9:[function(e,t){var n={alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",lookup:null,decode:function(e){var t=n.fromUtf8(e),i=0,r=t.length;for(result="";r>i;)result+=128>t[i]?String.fromCharCode(t[i++]):t[i]>191&&224>t[i]?String.fromCharCode((31&t[i++])<<6|63&t[i++]):String.fromCharCode((15&t[i++])<<12|(63&t[i++])<<6|63&t[i++]);return result},fromUtf8:function(e){var t,i=-1,r=[],o=[,,];if(!n.lookup){for(t=n.alphabet.length,n.lookup={};t>++i;)n.lookup[n.alphabet[i]]=i;i=-1}for(t=e.length;t>i&&(o[0]=n.lookup[e.charAt(++i)],o[1]=n.lookup[e.charAt(++i)],r.push(o[0]<<2|o[1]>>4),o[2]=n.lookup[e.charAt(++i)],64!=o[2])&&(r.push((15&o[1])<<4|o[2]>>2),o[3]=n.lookup[e.charAt(++i)],64!=o[3]);)r.push((3&o[2])<<6|o[3]);return r}};t.exports=n},{}],11:[function(e,t){function n(){}var i=e("../util/merge");n.build=function(e,t,n,r){r||(r={});var o=r.context,a=r.environment,s=r.session,l=r.params,c={name:"Airbrake JS",version:"0.2.1+"+t,url:"http://airbrake.io"},u=i(o,{language:"JavaScript",environment:e}),d={notifier:c,context:u,errors:[n]};return a&&i(d,{environment:a}),s&&i(d,{session:s}),l&&i(d,{params:l}),d},t.exports=n},{"../util/merge":8}],12:[function(e,t){!function(n){e("../lib/tracekit"),t.exports=n.TraceKit.noConflict()}(window)},{"../lib/tracekit":13}],13:[function(){!function(){!function(e){function t(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function n(e){return"undefined"==typeof e}var i={},r=e.TraceKit,o=[].slice,a="?";i.noConflict=function(){return e.TraceKit=r,i},i.wrap=function(e){function t(){try{return e.apply(this,arguments)}catch(t){throw i.report(t),t}}return t},i.report=function(){function n(e){l(),h.push(e)}function r(e){for(var t=h.length-1;t>=0;--t)h[t]===e&&h.splice(t,1)}function a(e,n){var r=null;if(!n||i.collectWindowErrors){for(var a in h)if(t(h,a))try{h[a].apply(null,[e].concat(o.call(arguments,2)))}catch(s){r=s}if(r)throw r}}function s(e,t,n){var r=null;if(f)i.computeStackTrace.augmentStackTraceWithInitialElement(f,t,n,e),r=f,f=null,p=null;else{var o={url:t,line:n};o.func=i.computeStackTrace.guessFunctionName(o.url,o.line),o.context=i.computeStackTrace.gatherContext(o.url,o.line),r={mode:"onerror",message:e,url:document.location.href,stack:[o],useragent:navigator.userAgent}}return a(r,"from window.onerror"),u?u.apply(this,arguments):!1}function l(){d!==!0&&(u=e.onerror,e.onerror=s,d=!0)}function c(t){var n=o.call(arguments,1);if(f){if(p===t)return;var r=f;f=null,p=null,a.apply(null,[r,null].concat(n))}var s=i.computeStackTrace(t);throw f=s,p=t,e.setTimeout(function(){p===t&&(f=null,p=null,a.apply(null,[s,null].concat(n)))},s.incomplete?2e3:0),t}var u,d,h=[],p=null,f=null;return c.subscribe=n,c.unsubscribe=r,c}(),i.computeStackTrace=function(){function r(t){function n(){try{return new e.XMLHttpRequest}catch(t){return new e.ActiveXObject("Microsoft.XMLHTTP")}}if(!i.remoteFetching)return"";try{var r=n();return r.open("GET",t,!1),r.send(""),r.responseText}catch(o){return""}}function o(e){if(!t(S,e)){var n="";-1!==e.indexOf(document.domain)&&(n=r(e)),S[e]=n?n.split("\n"):[]}return S[e]}function s(e,t){var i,r=/function ([^(]*)\(([^)]*)\)/,s=/['"]?([0-9A-Za-z$_]+)['"]?\s*[:=]\s*(function|eval|new Function)/,l="",c=10,u=o(e);
if(!u.length)return a;for(var d=0;c>d;++d)if(l=u[t-d]+l,!n(l)){if(i=s.exec(l))return i[1];if(i=r.exec(l))return i[1]}return a}function l(e,t){var r=o(e);if(!r.length)return null;var a=[],s=Math.floor(i.linesOfContext/2),l=s+i.linesOfContext%2,c=Math.max(0,t-s-1),u=Math.min(r.length,t+l-1);t-=1;for(var d=c;u>d;++d)n(r[d])||a.push(r[d]);return a.length>0?a:null}function c(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#]/g,"\\$&")}function u(e){return c(e).replace("<","(?:<|&lt;)").replace(">","(?:>|&gt;)").replace("&","(?:&|&amp;)").replace('"','(?:"|&quot;)').replace(/\s+/g,"\\s+")}function d(e,t){for(var n,i,r=0,a=t.length;a>r;++r)if((n=o(t[r])).length&&(n=n.join("\n"),i=e.exec(n)))return{url:t[r],line:n.substring(0,i.index).split("\n").length,column:i.index-n.lastIndexOf("\n",i.index)-1};return null}function h(e,t,n){var i,r=o(t),a=new RegExp("\\b"+c(e)+"\\b");return n-=1,r&&r.length>n&&(i=a.exec(r[n]))?i.index:null}function p(t){for(var n,i,r,o,a=[e.location.href],s=document.getElementsByTagName("script"),l=""+t,h=/^function(?:\s+([\w$]+))?\s*\(([\w\s,]*)\)\s*\{\s*(\S[\s\S]*\S)\s*\}\s*$/,p=/^function on([\w$]+)\s*\(event\)\s*\{\s*(\S[\s\S]*\S)\s*\}\s*$/,f=0;s.length>f;++f){var m=s[f];m.src&&a.push(m.src)}if(r=h.exec(l)){var g=r[1]?"\\s+"+r[1]:"",v=r[2].split(",").join("\\s*,\\s*");n=c(r[3]).replace(/;$/,";?"),i=new RegExp("function"+g+"\\s*\\(\\s*"+v+"\\s*\\)\\s*{\\s*"+n+"\\s*}")}else i=new RegExp(c(l).replace(/\s+/g,"\\s+"));if(o=d(i,a))return o;if(r=p.exec(l)){var y=r[1];if(n=u(r[2]),i=new RegExp("on"+y+"=[\\'\"]\\s*"+n+"\\s*[\\'\"]","i"),o=d(i,a[0]))return o;if(i=new RegExp(n),o=d(i,a))return o}return null}function f(e){if(!e.stack)return null;for(var t,n,i=/^\s*at (?:((?:\[object object\])?\S+(?: \[as \S+\])?) )?\(?((?:file|http|https):.*?):(\d+)(?::(\d+))?\)?\s*$/i,r=/^\s*(\S*)(?:\((.*?)\))?@((?:file|http|https).*?):(\d+)(?::(\d+))?\s*$/i,o=e.stack.split("\n"),c=[],u=/^(.*) is undefined$/.exec(e.message),d=0,p=o.length;p>d;++d){if(t=r.exec(o[d]))n={url:t[3],func:t[1]||a,args:t[2]?t[2].split(","):"",line:+t[4],column:t[5]?+t[5]:null};else{if(!(t=i.exec(o[d])))continue;n={url:t[2],func:t[1]||a,line:+t[3],column:t[4]?+t[4]:null}}!n.func&&n.line&&(n.func=s(n.url,n.line)),n.line&&(n.context=l(n.url,n.line)),c.push(n)}return c[0]&&c[0].line&&!c[0].column&&u&&(c[0].column=h(u[1],c[0].url,c[0].line)),c.length?{mode:"stack",name:e.name,message:e.message,url:document.location.href,stack:c,useragent:navigator.userAgent}:null}function m(e){for(var t,n=e.stacktrace,i=/ line (\d+), column (\d+) in (?:<anonymous function: ([^>]+)>|([^\)]+))\((.*)\) in (.*):\s*$/i,r=n.split("\n"),o=[],a=0,c=r.length;c>a;a+=2)if(t=i.exec(r[a])){var u={line:+t[1],column:+t[2],func:t[3]||t[4],args:t[5]?t[5].split(","):[],url:t[6]};if(!u.func&&u.line&&(u.func=s(u.url,u.line)),u.line)try{u.context=l(u.url,u.line)}catch(d){}u.context||(u.context=[r[a+1]]),o.push(u)}return o.length?{mode:"stacktrace",name:e.name,message:e.message,url:document.location.href,stack:o,useragent:navigator.userAgent}:null}function g(n){var i=n.message.split("\n");if(4>i.length)return null;var r,a,c,h,p=/^\s*Line (\d+) of linked script ((?:file|http|https)\S+)(?:: in function (\S+))?\s*$/i,f=/^\s*Line (\d+) of inline#(\d+) script in ((?:file|http|https)\S+)(?:: in function (\S+))?\s*$/i,m=/^\s*Line (\d+) of function script\s*$/i,g=[],v=document.getElementsByTagName("script"),y=[];for(a in v)t(v,a)&&!v[a].src&&y.push(v[a]);for(a=2,c=i.length;c>a;a+=2){var b=null;if(r=p.exec(i[a]))b={url:r[2],func:r[3],line:+r[1]};else if(r=f.exec(i[a])){b={url:r[3],func:r[4]};var _=+r[1],w=y[r[2]-1];if(w&&(h=o(b.url))){h=h.join("\n");var S=h.indexOf(w.innerText);S>=0&&(b.line=_+h.substring(0,S).split("\n").length)}}else if(r=m.exec(i[a])){var x=e.location.href.replace(/#.*$/,""),C=r[1],$=new RegExp(u(i[a+1]));h=d($,[x]),b={url:x,line:h?h.line:C,func:""}}if(b){b.func||(b.func=s(b.url,b.line));var E=l(b.url,b.line),T=E?E[Math.floor(E.length/2)]:null;b.context=E&&T.replace(/^\s*/,"")===i[a+1].replace(/^\s*/,"")?E:[i[a+1]],g.push(b)}}return g.length?{mode:"multiline",name:n.name,message:i[0],url:document.location.href,stack:g,useragent:navigator.userAgent}:null}function v(e,t,n,i){var r={url:t,line:n};if(r.url&&r.line){e.incomplete=!1,r.func||(r.func=s(r.url,r.line)),r.context||(r.context=l(r.url,r.line));var o=/ '([^']+)' /.exec(i);if(o&&(r.column=h(o[1],r.url,r.line)),e.stack.length>0&&e.stack[0].url===r.url){if(e.stack[0].line===r.line)return!1;if(!e.stack[0].line&&e.stack[0].func===r.func)return e.stack[0].line=r.line,e.stack[0].context=r.context,!1}return e.stack.unshift(r),e.partial=!0,!0}return e.incomplete=!0,!1}function y(e,t){for(var n,r,o,l=/function\s+([_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*)?\s*\(/i,c=[],u={},d=!1,f=y.caller;f&&!d;f=f.caller)if(f!==b&&f!==i.report){if(r={url:null,func:a,line:null,column:null},f.name?r.func=f.name:(n=l.exec(f.toString()))&&(r.func=n[1]),o=p(f)){r.url=o.url,r.line=o.line,r.func===a&&(r.func=s(r.url,r.line));var m=/ '([^']+)' /.exec(e.message||e.description);m&&(r.column=h(m[1],o.url,o.line))}u[""+f]?d=!0:u[""+f]=!0,c.push(r)}t&&c.splice(0,t);var g={mode:"callers",name:e.name,message:e.message,url:document.location.href,stack:c,useragent:navigator.userAgent};return v(g,e.sourceURL||e.fileName,e.line||e.lineNumber,e.message||e.description),g}function b(e,t){var n=null;t=null==t?0:+t;try{if(n=m(e))return n}catch(i){if(w)throw i}try{if(n=f(e))return n}catch(i){if(w)throw i}try{if(n=g(e))return n}catch(i){if(w)throw i}try{if(n=y(e,t+1))return n}catch(i){if(w)throw i}return{mode:"failed"}}function _(e){e=(null==e?0:+e)+1;try{throw new Error}catch(t){return b(t,e+1)}return null}var w=!1,S={};return b.augmentStackTraceWithInitialElement=v,b.guessFunctionName=s,b.gatherContext=l,b.ofCaller=_,b}(),function(){var t=function(t){var n=e[t];e[t]=function(){var e=o.call(arguments),t=e[0];return"function"==typeof t&&(e[0]=i.wrap(t)),n.apply?n.apply(this,e):n(e[0],e[1])}};t("setTimeout"),t("setInterval")}(),i.remoteFetching||(i.remoteFetching=!0),i.collectWindowErrors||(i.collectWindowErrors=!0),(!i.linesOfContext||1>i.linesOfContext)&&(i.linesOfContext=11),e.TraceKit=i}(window)}()},{}],10:[function(e,t){if("function"!=typeof n)var n=e("amdefine")(t,e);n(function(e,t){function n(e){var t=e;"string"==typeof e&&(t=JSON.parse(e.replace(/^\)\]\}'/,"")));var n=i.getArg(t,"version"),r=i.getArg(t,"sources"),a=i.getArg(t,"names",[]),s=i.getArg(t,"sourceRoot",null),l=i.getArg(t,"sourcesContent",null),c=i.getArg(t,"mappings"),u=i.getArg(t,"file",null);if(n!=this._version)throw new Error("Unsupported version: "+n);this._names=o.fromArray(a,!0),this._sources=o.fromArray(r,!0),this.sourceRoot=s,this.sourcesContent=l,this._mappings=c,this.file=u}var i=e("./util"),r=e("./binary-search"),o=e("./array-set").ArraySet,a=e("./base64-vlq");n.fromSourceMap=function(e){var t=Object.create(n.prototype);return t._names=o.fromArray(e._names.toArray(),!0),t._sources=o.fromArray(e._sources.toArray(),!0),t.sourceRoot=e._sourceRoot,t.sourcesContent=e._generateSourcesContent(t._sources.toArray(),t.sourceRoot),t.file=e._file,t.__generatedMappings=e._mappings.slice().sort(i.compareByGeneratedPositions),t.__originalMappings=e._mappings.slice().sort(i.compareByOriginalPositions),t},n.prototype._version=3,Object.defineProperty(n.prototype,"sources",{get:function(){return this._sources.toArray().map(function(e){return this.sourceRoot?i.join(this.sourceRoot,e):e},this)}}),n.prototype.__generatedMappings=null,Object.defineProperty(n.prototype,"_generatedMappings",{get:function(){return this.__generatedMappings||(this.__generatedMappings=[],this.__originalMappings=[],this._parseMappings(this._mappings,this.sourceRoot)),this.__generatedMappings}}),n.prototype.__originalMappings=null,Object.defineProperty(n.prototype,"_originalMappings",{get:function(){return this.__originalMappings||(this.__generatedMappings=[],this.__originalMappings=[],this._parseMappings(this._mappings,this.sourceRoot)),this.__originalMappings}}),n.prototype._parseMappings=function(e){for(var t,n,r=1,o=0,s=0,l=0,c=0,u=0,d=/^[,;]/,h=e;h.length>0;)if(";"===h.charAt(0))r++,h=h.slice(1),o=0;else if(","===h.charAt(0))h=h.slice(1);else{if(t={},t.generatedLine=r,n=a.decode(h),t.generatedColumn=o+n.value,o=t.generatedColumn,h=n.rest,h.length>0&&!d.test(h.charAt(0))){if(n=a.decode(h),t.source=this._sources.at(c+n.value),c+=n.value,h=n.rest,0===h.length||d.test(h.charAt(0)))throw new Error("Found a source, but no line and column");if(n=a.decode(h),t.originalLine=s+n.value,s=t.originalLine,t.originalLine+=1,h=n.rest,0===h.length||d.test(h.charAt(0)))throw new Error("Found a source and line, but no column");n=a.decode(h),t.originalColumn=l+n.value,l=t.originalColumn,h=n.rest,h.length>0&&!d.test(h.charAt(0))&&(n=a.decode(h),t.name=this._names.at(u+n.value),u+=n.value,h=n.rest)}this.__generatedMappings.push(t),"number"==typeof t.originalLine&&this.__originalMappings.push(t)}this.__originalMappings.sort(i.compareByOriginalPositions)},n.prototype._findMapping=function(e,t,n,i,o){if(0>=e[n])throw new TypeError("Line must be greater than or equal to 1, got "+e[n]);if(0>e[i])throw new TypeError("Column must be greater than or equal to 0, got "+e[i]);return r.search(e,t,o)},n.prototype.originalPositionFor=function(e){var t={generatedLine:i.getArg(e,"line"),generatedColumn:i.getArg(e,"column")},n=this._findMapping(t,this._generatedMappings,"generatedLine","generatedColumn",i.compareByGeneratedPositions);if(n){var r=i.getArg(n,"source",null);return r&&this.sourceRoot&&(r=i.join(this.sourceRoot,r)),{source:r,line:i.getArg(n,"originalLine",null),column:i.getArg(n,"originalColumn",null),name:i.getArg(n,"name",null)}}return{source:null,line:null,column:null,name:null}},n.prototype.sourceContentFor=function(e){if(!this.sourcesContent)return null;if(this.sourceRoot&&(e=i.relative(this.sourceRoot,e)),this._sources.has(e))return this.sourcesContent[this._sources.indexOf(e)];var t;if(this.sourceRoot&&(t=i.urlParse(this.sourceRoot))){var n=e.replace(/^file:\/\//,"");if("file"==t.scheme&&this._sources.has(n))return this.sourcesContent[this._sources.indexOf(n)];if((!t.path||"/"==t.path)&&this._sources.has("/"+e))return this.sourcesContent[this._sources.indexOf("/"+e)]}throw new Error('"'+e+'" is not in the SourceMap.')},n.prototype.generatedPositionFor=function(e){var t={source:i.getArg(e,"source"),originalLine:i.getArg(e,"line"),originalColumn:i.getArg(e,"column")};this.sourceRoot&&(t.source=i.relative(this.sourceRoot,t.source));var n=this._findMapping(t,this._originalMappings,"originalLine","originalColumn",i.compareByOriginalPositions);return n?{line:i.getArg(n,"generatedLine",null),column:i.getArg(n,"generatedColumn",null)}:{line:null,column:null}},n.GENERATED_ORDER=1,n.ORIGINAL_ORDER=2,n.prototype.eachMapping=function(e,t,r){var o,a=t||null,s=r||n.GENERATED_ORDER;switch(s){case n.GENERATED_ORDER:o=this._generatedMappings;break;case n.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var l=this.sourceRoot;o.map(function(e){var t=e.source;return t&&l&&(t=i.join(l,t)),{source:t,generatedLine:e.generatedLine,generatedColumn:e.generatedColumn,originalLine:e.originalLine,originalColumn:e.originalColumn,name:e.name}}).forEach(e,a)},t.SourceMapConsumer=n})},{"./array-set":16,"./base64-vlq":17,"./binary-search":15,"./util":14,amdefine:18}],19:[function(e,t){var n=t.exports={};n.nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,t="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};if(t){var n=[];return window.addEventListener("message",function(e){if(e.source===window&&"process-tick"===e.data&&(e.stopPropagation(),n.length>0)){var t=n.shift();t()}},!0),function(e){n.push(e),window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}(),n.title="browser",n.browser=!0,n.env={},n.argv=[],n.binding=function(){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(){throw new Error("process.chdir is not supported")}},{}],18:[function(e,t){!function(n,i){"use strict";function r(e,t){function r(e){var t,n;for(t=0;e[t];t+=1)if(n=e[t],"."===n)e.splice(t,1),t-=1;else if(".."===n){if(1===t&&(".."===e[2]||".."===e[0]))break;t>0&&(e.splice(t-1,2),t-=2)}}function a(e,t){var n;return e&&"."===e.charAt(0)&&t&&(n=t.split("/"),n=n.slice(0,n.length-1),n=n.concat(e.split("/")),r(n),e=n.join("/")),e}function s(e){return function(t){return a(t,e)}}function l(e){function t(t){f[e]=t}return t.fromText=function(){throw new Error("amdefine does not implement load.fromText")},t}function c(n,r,o){var a,s,l,c;if(n)s=f[n]={},l={id:n,uri:i,exports:s},a=d(t,s,l,n);else{if(m)throw new Error("amdefine with no module ID cannot be called more than once per file.");m=!0,s=e.exports,l=e,a=d(t,s,l,e.id)}r&&(r=r.map(function(e){return a(e)})),c="function"==typeof o?o.apply(e.exports,r):o,void 0!==c&&(l.exports=c,n&&(f[n]=l.exports))}function u(e,t,n){Array.isArray(e)?(n=t,t=e,e=void 0):"string"!=typeof e&&(n=e,e=t=void 0),t&&!Array.isArray(t)&&(n=t,t=void 0),t||(t=["require","exports","module"]),e?p[e]=[e,t,n]:c(e,t,n)}var d,h,p={},f={},m=!1;return d=function(e,t,i,r){function s(o,a){return"string"==typeof o?h(e,t,i,o,r):(o=o.map(function(n){return h(e,t,i,n,r)}),n.nextTick(function(){a.apply(null,o)}),void 0)}return s.toUrl=function(e){return 0===e.indexOf(".")?a(e,o.dirname(i.filename)):e},s},t=t||function(){return e.require.apply(e,arguments)},h=function(e,t,n,i,r){var o,u,m=i.indexOf("!"),g=i;if(-1===m){if(i=a(i,r),"require"===i)return d(e,t,n,r);if("exports"===i)return t;if("module"===i)return n;if(f.hasOwnProperty(i))return f[i];if(p[i])return c.apply(null,p[i]),f[i];if(e)return e(g);throw new Error("No module with ID: "+i)}return o=i.substring(0,m),i=i.substring(m+1,i.length),u=h(e,t,n,o,r),i=u.normalize?u.normalize(i,s(r)):a(i,r),f[i]?f[i]:(u.load(i,d(e,t,n,r),l(i),{}),f[i])},u.require=function(e){return f[e]?f[e]:p[e]?(c.apply(null,p[e]),f[e]):void 0},u.amd={},u}var o=e("path");t.exports=r}(e("__browserify_process"),"/../../node_modules/amdefine/amdefine.js")},{__browserify_process:19,path:20}],20:[function(e,t,n){!function(e){function t(e,t){for(var n=[],i=0;e.length>i;i++)t(e[i],i,e)&&n.push(e[i]);return n}function i(e,t){for(var n=0,i=e.length;i>=0;i--){var r=e[i];"."==r?e.splice(i,1):".."===r?(e.splice(i,1),n++):n&&(e.splice(i,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}var r=/^(.+\/(?!$)|\/)?((?:.+?)?(\.[^.]*)?)$/;n.resolve=function(){for(var n="",r=!1,o=arguments.length;o>=-1&&!r;o--){var a=o>=0?arguments[o]:e.cwd();"string"==typeof a&&a&&(n=a+"/"+n,r="/"===a.charAt(0))}return n=i(t(n.split("/"),function(e){return!!e}),!r).join("/"),(r?"/":"")+n||"."},n.normalize=function(e){var n="/"===e.charAt(0),r="/"===e.slice(-1);return e=i(t(e.split("/"),function(e){return!!e}),!n).join("/"),e||n||(e="."),e&&r&&(e+="/"),(n?"/":"")+e},n.join=function(){var e=Array.prototype.slice.call(arguments,0);return n.normalize(t(e,function(e){return e&&"string"==typeof e}).join("/"))},n.dirname=function(e){var t=r.exec(e)[1]||"",n=!1;return t?1===t.length||n&&3>=t.length&&":"===t.charAt(1)?t:t.substring(0,t.length-1):"."},n.basename=function(e,t){var n=r.exec(e)[2]||"";return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n},n.extname=function(e){return r.exec(e)[3]||""},n.relative=function(e,t){function i(e){for(var t=0;e.length>t&&""===e[t];t++);for(var n=e.length-1;n>=0&&""===e[n];n--);return t>n?[]:e.slice(t,n-t+1)}e=n.resolve(e).substr(1),t=n.resolve(t).substr(1);for(var r=i(e.split("/")),o=i(t.split("/")),a=Math.min(r.length,o.length),s=a,l=0;a>l;l++)if(r[l]!==o[l]){s=l;break}for(var c=[],l=s;r.length>l;l++)c.push("..");return c=c.concat(o.slice(s)),c.join("/")},n.sep="/"}(e("__browserify_process"))},{__browserify_process:19}],14:[function(e,t){if("function"!=typeof n)var n=e("amdefine")(t,e);n(function(e,t){function n(e,t,n){if(t in e)return e[t];if(3===arguments.length)return n;throw new Error('"'+t+'" is a required argument.')}function i(e){var t=e.match(h);return t?{scheme:t[1],auth:t[3],host:t[4],port:t[6],path:t[7]}:null}function r(e){var t=e.scheme+"://";return e.auth&&(t+=e.auth+"@"),e.host&&(t+=e.host),e.port&&(t+=":"+e.port),e.path&&(t+=e.path),t}function o(e,t){var n;return t.match(h)||t.match(p)?t:"/"===t.charAt(0)&&(n=i(e))?(n.path=t,r(n)):e.replace(/\/$/,"")+"/"+t}function a(e){return"$"+e}function s(e){return e.substr(1)}function l(e,t){e=e.replace(/\/$/,"");var n=i(e);return"/"==t.charAt(0)&&n&&"/"==n.path?t.slice(1):0===t.indexOf(e+"/")?t.substr(e.length+1):t}function c(e,t){var n=e||"",i=t||"";return(n>i)-(i>n)}function u(e,t,n){var i;return(i=c(e.source,t.source))?i:(i=e.originalLine-t.originalLine)?i:(i=e.originalColumn-t.originalColumn,i||n?i:(i=c(e.name,t.name))?i:(i=e.generatedLine-t.generatedLine,i?i:e.generatedColumn-t.generatedColumn))}function d(e,t,n){var i;return(i=e.generatedLine-t.generatedLine)?i:(i=e.generatedColumn-t.generatedColumn,i||n?i:(i=c(e.source,t.source))?i:(i=e.originalLine-t.originalLine)?i:(i=e.originalColumn-t.originalColumn,i?i:c(e.name,t.name)))}t.getArg=n;var h=/([\w+\-.]+):\/\/((\w+:\w+)@)?([\w.]+)?(:(\d+))?(\S+)?/,p=/^data:.+\,.+/;t.urlParse=i,t.urlGenerate=r,t.join=o,t.toSetString=a,t.fromSetString=s,t.relative=l,t.compareByOriginalPositions=u,t.compareByGeneratedPositions=d})},{amdefine:18}],15:[function(e,t){if("function"!=typeof n)var n=e("amdefine")(t,e);n(function(e,t){function n(e,t,i,r,o){var a=Math.floor((t-e)/2)+e,s=o(i,r[a],!0);return 0===s?r[a]:s>0?t-a>1?n(a,t,i,r,o):r[a]:a-e>1?n(e,a,i,r,o):0>e?null:r[e]}t.search=function(e,t,i){return t.length>0?n(-1,t.length,e,t,i):null}})},{amdefine:18}],16:[function(e,t){if("function"!=typeof n)var n=e("amdefine")(t,e);n(function(e,t){function n(){this._array=[],this._set={}}var i=e("./util");n.fromArray=function(e,t){for(var i=new n,r=0,o=e.length;o>r;r++)i.add(e[r],t);return i},n.prototype.add=function(e,t){var n=this.has(e),r=this._array.length;(!n||t)&&this._array.push(e),n||(this._set[i.toSetString(e)]=r)},n.prototype.has=function(e){return Object.prototype.hasOwnProperty.call(this._set,i.toSetString(e))},n.prototype.indexOf=function(e){if(this.has(e))return this._set[i.toSetString(e)];throw new Error('"'+e+'" is not in the set.')},n.prototype.at=function(e){if(e>=0&&this._array.length>e)return this._array[e];throw new Error("No element indexed by "+e)},n.prototype.toArray=function(){return this._array.slice()},t.ArraySet=n})},{"./util":14,amdefine:18}],17:[function(e,t){if("function"!=typeof n)var n=e("amdefine")(t,e);n(function(e,t){function n(e){return 0>e?(-e<<1)+1:(e<<1)+0}function i(e){var t=1===(1&e),n=e>>1;return t?-n:n}var r=e("./base64"),o=5,a=1<<o,s=a-1,l=a;t.encode=function(e){var t,i="",a=n(e);do t=a&s,a>>>=o,a>0&&(t|=l),i+=r.encode(t);while(a>0);return i},t.decode=function(e){var t,n,a=0,c=e.length,u=0,d=0;do{if(a>=c)throw new Error("Expected more digits in base 64 VLQ value.");n=r.decode(e.charAt(a++)),t=!!(n&l),n&=s,u+=n<<d,d+=o}while(t);return{value:i(u),rest:e.slice(a)}}})},{"./base64":21,amdefine:18}],21:[function(e,t){if("function"!=typeof n)var n=e("amdefine")(t,e);n(function(e,t){var n={},i={};"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("").forEach(function(e,t){n[e]=t,i[t]=e}),t.encode=function(e){if(e in i)return i[e];throw new TypeError("Must be between 0 and 63: "+e)},t.decode=function(e){if(e in n)return n[e];throw new TypeError("Not a valid base 64 digit: "+e)}})},{amdefine:18}]},{},[1]),function(e,t,n,i){var r="gc_overlay",o=function(i,o){this.name=r,this.settings=n.extend({openingElem:"",closingElem:"",closeOnClick:!0,closeOnEsc:!0,showClose:!0,openOnInit:!1,speed:"fast",top:"center",dimmer:!0,dimmerCloses:!0},o);var a,s,l,c,u=this,d=i,h=this.settings,p=d.add(u),f=n(e),m=n("#dimmer"),g=Math.random().toString().slice(10),v=function(){if(l=d,s=n(h.openingElem),s&&-1==s.index(l)&&s.click(function(e){y(e),e.preventDefault()}),a=l.find(h.closingElem),h.showClose){var e=n('<a class="close"></a>');l.prepend(e),a=a.add(e)}a.click(function(e){b(e)}),h.dimmerCloses&&m.click(function(e){b(e)}),h.openOnInit&&y()},y=function(i){if(!c){if(i=i||n.Event(),i.type="overlay.onBeforeLoad",p.trigger(i),i.isDefaultPrevented())return u;c=!0,_(),l.fadeIn(h.speed,function(){c&&(i.type="overlay.onLoad",p.trigger(i))}),h.closeOnClick&&n(t).on("click."+g,function(e){!n(e.target).is(l)&&!n(l).find(e.target).length}),h.closeOnEsc&&n(t).on("keydown."+g,function(e){27==e.keyCode&&b(e)}),n(e).on("resize."+g,function(){_()}),h.dimmer&&m.show()}},b=function(i){return c?(i=i||n.Event(),i.type="overlay.onBeforeClose",p.trigger(i),i.isDefaultPrevented()?void 0:(c=!1,l.fadeOut(h.speed,function(){i.type="overlay.onClose",p.trigger(i)}),n(t).off("keydown."+g),n(t).off("click."+g),n(e).off("resize."+g),n("input",l).removeClass("error"),h.dimmer&&m.hide(),u)):u},_=function(){var e=h.top,t=h.left,n=l.outerWidth(!0),i=l.outerHeight(!0);"string"==typeof e&&(e="center"==e?Math.max((f.height()-i)/2,0):parseInt(e,10)/100*f.height()),t=Math.max((f.width()-n)/2,0);var r={top:e,left:t};r.position="fixed",l.css(r)};u.methods={open:function(){y()},close:function(){b()}},v()};n.fn[r]=function(e){var t,a=arguments;return this.each(function(){var s=n(this),l=s.data(r);if(l||(l=new o(n(this),e)),s.data(r,l),l.methods[e]){var c=l.methods[e].apply(this,Array.prototype.slice.call(a,1));t===i&&c!==i&&(t=c),t=t||c}else"object"!=typeof e&&e?n.error("Method "+e+" does not exist on "+r):n.extend(l.settings,e)}),t!==i?t:this}}(window,document,jQuery),function(e,t,n,i){var r="gc_viewer",o=function(o,a){this.name=r,this.settings=n.extend({annotatorOptions:{cameraX:0,cameraY:0,cameraZ:100,cameraRotationSpeed:1,cameraZoomSpeed:1,cameraPanSpeed:1,directionalLightColor:16777215,ambientLightColor:1118481},modelOptions:{solidVisible:!0,solidColor:11513775,solidAmbient:16777215,solidSpecular:4210752,solidShininess:128,solidOpacity:1,wireframeVisible:!1,wireframeColor:3355443,wireframeOpacity:1,boundingBoxVisible:!1,boundingBoxColor:4210752,boundingBoxOpacity:1,axisArrowVisible:!1},dropPinCallback:null,saveSketchCallback:null,pinActivatedCallback:null,pinDeactivatedCallback:null,modelLoadedCallback:null},a);var s=this;t.cancelFullScreen=t.webkitExitFullscreen||t.mozCancelFullScreen||t.msExitFullscreen||t.exitFullscreen;var l,c,u,d,h=!1,p=!1,f={file:""},m=!1,g=!1,v={FRONT:87,BACK:75,LEFT:76,RIGHT:82,BOTTOM:66,TOP:84,ISO:73,FIT:70,ESC:27},y=!1,b=!1,_=!1,w=!1,S=!1,x=!1,C=!1,$={INITIAL:"Initial",READY:"Ready",LOADING:"Loading",VIEWING:"Viewing",ERROR:"Error"},E=$.INITIAL,T=$.INITIAL,k=new Array;e.onbeforeunload=function(){h=!0};var A=function(){O(),W(),E=$.INITIAL,T=$.INITIAL},N=function(){if(Modernizr.webgl){var e=t.createElement("canvas");try{var n=e.getContext("webgl")||e.getContext("experimental-webgl");u=null===n?!1:!0}catch(i){u=!1}}else u=!1},M=function(){var t,n=/.*(Chrome)\/(\d+).*/,i=/.*(Firefox)\/(\d+).*/,r=/.*(Safari)\/(\d+).*/,o=/.*;\s*(MSIE (\d+)\.\d+);.*/,a=navigator.userAgent,s=a.match(n),l=a.match(i),c=a.match(r),u=a.match(o),d=e.chrome;return t=null==c||d?null!=s&&d?{msg:I.viewer_support_chrome,title:I.viewer_support_title,list_format:!1}:null!=l?{msg:I.viewer_support_firefox+"<br><br>"+I.viewer_support_moreinfo,title:I.viewer_support_title,list_format:!0}:null!=u?{msg:I.viewer_support_ie,title:I.viewer_support_title,list_format:!1}:{msg:I.viewer_support_generic}:{msg:I.viewer_support_safari+"<br><br>"+I.viewer_support_moreinfo,title:I.viewer_support_title,list_format:!0}},D=function(e){return e===!0?ANNOTATOR_MODES.AUTO_SAVE:ANNOTATOR_MODES.READ_ONLY},P=function(){if(!p){l=new Annotator("viewer_div","hvfwCanvas","xmlanchor","theCanvasSVG",f.mode,s.settings.dropPinCallback,s.settings.saveSketchCallback,s.settings.pinActivatedCallback,s.settings.pinDeactivatedCallback,s.settings.annotatorOptions),f.is_private&&n(".fullScreen",o).hide(),p=!0,F()||n(".fileComparison",o).hide(),l.setContext(F()?ANNOTATOR_CONTEXTS.WORKBENCH:ANNOTATOR_CONTEXTS.COMMUNITY),n(".viewerWidget").attr("tabindex",1),n(".viewerWidget").focus(),n(".viewerWidget").css("outline","none");var e=t.getElementsByName("csrf-token")[0];e&&l.setAdditionalHeaders({"X-CSRF-Token":e.content}),l.embedMode=!1,l.getUserIdMethod="/get_user",l.loadDesignMethod="/load_viewer",l.addPinMethod="/create_pin",l.deletePinMethod="/destroy_pin",l.updatePinMethod="/update_pin",l.loadPinViewerStateMethod="/load_pin_viewer_state",l.loadViewerStateMethod="/load_viewer_state",l.saveViewerStateMethod="/save_viewer_state",l.getPinCommentsMethod="/load_comments",l.addPinCommentMethod="/create_comment",l.putSketchBackground="/create_sketch_background",l.putSketchImage="/create_sketch_image",l.putSketchData="/create_sketch_data",l.putSketchThumbnail="/create_sketch_thumbnail",l.requestUsersUnitPreferenceMethod="/account/preferences/viewer_units_preference",l.setUsername(i),l.saveAnnotationsFilename="original",l.saveAnnotationsExtension="annotator"}},I={view_action:"View This Model In 3D",missing_title:"Working...",missing_queued:"Preparing 3D viewer for this file",missing_started:"Preparing 3D viewer for this file",missing_completed:"Preparing 3D viewer for this file",incomplete_message:"Viewable data for this file is typically created when the application that created it uploads data to GrabCAD. That data appears to be missing. Possible causes include an incomplete upload or data that was uploaded manually. To view the file, try opening the file in the original application and saving or publishing back to GrabCAD. <br><br>See <a href='http://www.grabcad.com/faq#3D-Viewing-FAQ' target='_blank'><strong>FAQ</strong></a> for more information.",download_error:"There was an error loading the model file",download_error_no_model_title:"This model does not appear to contain any geometry.",download_error_no_model_msg:"Common causes include assemblies uploaded without part files, designs that only include hidden or construction geometry, and designs that include unsupported objects.",on_error_feedback_text:"Please try uploading again with all dependent files. If you believe this issue is a bug, please ",on_error_feedback_link:"report an error",viewer_support_moreinfo:"For more information, visit our <a href='http://www.grabcad.com/faq#3D-Viewing-FAQ' target='_blank'><strong>FAQ</strong></a>",viewer_support_title:"Looks like our <strong>3D Viewer</strong> does not work with your browser settings...",viewer_support_generic:"Looks like our <strong>3D Viewer</strong> does not work with your browser settings. To see how to fix this, visit our <a href='http://www.grabcad.com/faq#3dviewer' target='_blank'><strong>FAQ</strong></a>",viewer_support_ie:"We recommend that users who wish to use Internet Explorer on Windows 7 or later upgrade to Internet Explorer 11.<br><br>If you wish to use Internet Explorer on earlier versions of Windows, please install the <a href ='http://www.google.com/chromeframe'> Google Chrome Frame for Internet Explorer</a> and restart your browser.<br><br>Alternatively, use another browser such as  <a href='www.google.com/chrome'> Google Chrome </a>",viewer_support_firefox:'To enable the <strong> 3D Viewer </strong> with your browser, please do the following:<br><br> <ol style="list-style-type: decimal"><li> Type <strong>about:config</strong> in the address bar.</li><li>  Type <strong>webgl</strong> in the search box.</li><li>  To enable WebGL, set <strong>webgl.force-enabled</strong> to <strong>true</strong>.</li>',viewer_support_chrome:'To enable the <strong> 3D Viewer </strong> with your browser, please ensure<br> that you have the latest version of Google Chrome.<br> Download it <a href="https://www.google.com/intl/en/chrome/browser/"> here</a>.',viewer_support_safari:'To enable the <strong> 3D Viewer </strong> with your browser, please do the following:<br><br> <ol style="list-style-type: decimal"><li> Open the <strong>Safari</strong> menu and select <strong>Preferences</strong>.</li><li> Open the <strong>Advanced</strong> tab, check <strong>Show Develop menu in menu bar</strong>.</li> <li> Open the <strong>Develop</strong> menu in the menu bar and select <strong>Enable WebGL</strong>.</li></ol>',not_displaying_correctly:"Not displaying correctly?",dependent_file_missing:" dependent file not found.",dependent_files_missing:" dependent files not found.",missing_components:"Missing Components",overlay_not_displaying_correctly:"Model not displaying correctly?",overlay_describe_issue_ie11:"There are known issues with the 3D viewer on Internet Explorer 11. Please check the <a href='http://blog.grabcad.com/faq/3d-viewer-working-internet-explorer/' target='_blank'><strong>FAQ</strong></a> before submitting. Otherwise, please describe the issue below:",overlay_describe_issue:"Please describe the issue below:",overlay_explanation:"Clicking Submit will send your file to a GrabCAD support engineer. GrabCAD will maintain complete security of your files and use them for debugging purposes only.",overlay_retry_conversion:"Retry",overlay_retry_conversion_text:"GrabCAD technology has improved since this file was uploaded. Clicking Retry may solve your issue. Alternatively, you may submit the issue to our support team.",overlay_retry_conversion_added_files_text:"Files have been added to the project since this file was uploaded. Clicking Retry may solve your issue. Alternatively, you may submit the issue to our support team.",email_me:"Email me when file is ready",failed_title:"GrabCAD is not able to view this model",failed_faq:"<br>See <a href='http://www.grabcad.com/faq#3D-Viewing-FAQ' target='_blank'><strong>FAQ</strong></a> for more information.",failed_logged:"<br>We have logged this issue for further study.<br><br>",failed_no_retry_message:"<br><br><strong>Your original file is not modified by this process. As a work-around for the viewer problem, try uploading a STEP file or a VRML file.</strong>",failed_code:"Failure reason: ",failed_unspecified:"Unknown",failed_unspecified_details:"Common causes of viewer failure include missing dependent files, corrupt or invalid files, and native CAD files containing unusual or unsupported objects.",failed_timeout:"Timeout",failed_timeout_details:"The file has exceeded the processing limit for an individual file on GrabCAD due to its size or complexity.",failed_dependent_file_missing:"Dependent File(s) Missing",failed_dependent_file_missing_details1:"The file references one or more dependent files. GrabCAD is unable to locate those dependent files listed below.",failed_dependent_file_missing_details2_vanilla:"Please upload the missing files in order to view the model.",failed_dependent_file_missing_details2_iam:"Please upload the missing files in order to view the model. You may find the <a href='http://blog.grabcad.com/faq/tips-using-inventors-pack-go/' target='_blank'><strong>Tips for using Inventor's Pack and Go</strong></a> helpful.",failed_dependent_file_missing_details3:"<br>Alternatively, if you cannot or do not wish to upload all the dependent parts, consider uploading a STEP or VRML file instead.",failed_dependent_file_missing_details4:"GrabCAD was unable to locate some of the files needed for this assembly in its folder or sub-folders.",failed_dependent_file_missing_details5:"GrabCAD was unable to locate some of the files needed for this assembly in its parent folder or sub-folders.",failed_dependent_file_missing_owner:"<br>Try looking in the following locations for the missing files (<strong>This information is only visible to project owners</strong>).",failed_no_geometry:"No Geometry",failed_no_geometry_details:"GrabCAD was unable to find any model geometry to display. This is most commonly caused by template files, or other files that genuinely do not have model geometry.<br>If you believe this to be a bug, please report the issue and consider uploading a STEP or VRML file instead.",failed_invalid_input:"Invalid Input",failed_invalid_input_details:"GrabCAD was unable to recognize this file. This is most commonly caused by files that are corrupted or currently not supported. <br>If you believe this to be a bug, please report the issue and consider uploading a STEP or VRML file instead.",failed_invalid_input_faq:"<br>See <a href='http://www.grabcad.com/faq#3D-Viewing-FAQ' target='_blank'><strong>FAQ</strong></a> for the list of supported file types."},F=function(){return"workbench"===e.location.pathname.substring(1).split("/")[0]?!0:!1},L={queued:"gearAnimationIcon",dummy:'"'+Grabcad.configuration.imagePath+"/_/dummy.png"+'"'},O=function(){var e=F(),t=e?'<div class="emailMeArea"><div class="link">'+I.email_me+"</div></div>":"",n=['<div class="viewerWrapper" id="full-screen-viewer">','<div class="load_model">','<div class="center_button">','<span class="button b32 red">','<span class="text">',I.view_action,"</span>","</span>","</div>","</div>",'<div class="error">','<div class="center_text">','<div class="title text"></div>','<img class="img no_border" src='+L.dummy+"></img>",'<div class="msg text"></div>','<div class="retryButton emailMeArea"><div class="link">Retry</div></div>',t,'<div class="listed text" style="width:460px; text-align:left; margin:0 auto; font-size:14px"></div>','<div class="viewerFeedbackOnErrorText">','<span class="viewerFeedback">',I.on_error_feedback_text,'<span class="text">','<a href="#">',I.on_error_feedback_link,"</a>","</span>","<span>","</div>","</div>",'<div class="bottom_image">','<img class="img2 no_border" src='+L.dummy+"></img>","</div>","</div>",'<span class="threeDLoader">','<span class="threeDLoadBar">','<span class="progress"></span>',"</span>","</span>",'<span class="loadingOverlayContainer">',"</span>",'<div class="viewerContainer">','<div id="viewer_div">','<canvas id="hvfwCanvas" style="width: 100%; height: 100%;"></canvas>','<div id="theCanvasSVG" class="theCanvasSVG" style="z-index: 100; pointer-events: none; height: 1px;">','<svg id = "xmlanchor" xmlns="http://www.w3.org/2000/svg" version="1.1" style = "width: 100%; height: 100%; background: none; border: 0; box-shadow: none; cursor: default">','<defs id = "xmlanchordefs"></defs>',"</svg>","</div>","</div>","</div>",'<div class="viewerFeedbackText">','<span class="viewerNotDisplayingCorrectly">','<span class="text">','<a href="#">',I.not_displaying_correctly,"</a>","</span>","</span>","</div>",'<div class="retryConversionText">','<span class="retryConversionNotDisplayingCorrectly">','<span class="text">','<a href="#">',I.not_displaying_correctly,"</a>","</span>","</span>","</div>",'<div class="missingDependentFilesText">','<span class="missingDependentFiles">','<span class="text">','<a href="#">',"</a>","</span>","</span>","</div>","</div>",'<div id="retryConversionOverlay" class="overlayWidget">','<form accept-charset="UTF-8"   style="max-width: 600px">','<div class="overlayHeader" style="">',"<h1>",I.overlay_retry_conversion,"</h1>","</div>",'<div class="overlayBody">','<div class="overlayDesc">','<p class="textAbove mt10 contentHilite">',"</p>","</div>","</div>",'<div class="overlayFooter" style="">','<span class="buttons">','<button type="submit" class="button b32 red">',"<span>Retry</span>","</button>",'<span class="viewerFeedback">','<button class="button b32 red ml8" style="" id="submitFeedback"><span>Submit</span></button>',"</span>",'<a class="button cancelButton" class="cancel">Cancel</a>',"</span>","</div>","</form>","</div>",'<div id="missingDependentFilesOverlay" class="overlayWidget">','<div class="overlayHeader" style="">',"<h1>",I.missing_components,"</h1>","</div>",'<div class="overlayBody">','<div class="overlayDesc">',"<ul>","</ul>","</div>","</div>","</div>",'<div id="viewerFeedbackOverlay" class="overlayWidget">','<form accept-charset="UTF-8"   style="max-width: 600px">','<div class="overlayHeader" style="">',"<h1>",I.overlay_not_displaying_correctly,"</h1>","</div>",'<div class="overlayBody">','<div class="overlayDesc">','<p class="textAbove mt10 contentHilite IE11">',I.overlay_describe_issue_ie11,"</p>",'<p class="textAbove mt10 contentHilite notIE11">',I.overlay_describe_issue,"</p>",'<span class="formSection noResize">','<textarea id="viewerFeedbackContent" name="message" class="noResize feedback mb20" style="width:95%"></textarea>',"</span>",'<p class="textBelow additionalContent mb10">',I.overlay_explanation,"</p>","</div>","</div>",'<div class="overlayFooter" style="">','<span class="buttons">','<button type="submit" class="button b32 red">',"<span>Submit</span>","</button>",'<a class="button cancelButton" class="cancel" style="">Cancel</a>',"</span>","</div>","</form>","</div>"];
o.append(n.join(""))},R=function(){n(".viewerWrapper",o).show(),d?(n(".emailMeArea",o).hide(),n(".viewerWrapper",o).addClass("grey"),n(".load_model",o).hide(),n(".threeDLoader",o).hide(),n(".loadingOverlayContainer",o).hide(),n(".viewerContainer",o).hide(),n(".viewerFeedbackText",o).hide(),n(".retryConversionText",o).hide(),n(".missingDependentFilesText",o).hide(),n(".error",o).show(),d.title?(n(".error .title",o).show(),n(".error .title",o).html(d.title)):n(".error .title",o).hide(),d.msg?d.list_format===!0?(n(".error .listed",o).show(),n(".error .listed",o).html(d.msg)):(n(".error .msg",o).show(),n(".error .msg",o).html(d.msg)):(n(".error .msg",o).hide(),n(".error .listed",o).hide()),d.showFeedbackMsg?n(".error .viewerFeedbackOnErrorText",o).show():n(".error .viewerFeedbackOnErrorText",o).hide(),d.img?(n(".error .img",o).show(),n(".error .img",o).addClass(d.img),n(".emailMeArea",o).show()):n(".error .img",o).hide(),d.img2?(n(".error .img2",o).show(),n(".error .img2",o).addClass(d.img2)):n(".error .img2",o).hide(),d.retry?n(".retryButton",o).show():n(".retryButton",o).hide()):(n(".viewerWrapper",o).removeClass("grey"),n(".load_model",o).show(),n(".error",o).hide(),n(".retryButton",o).hide(),n(".threeDLoader",o).hide(),n(".loadingOverlayContainer",o).hide(),n(".viewerContainer",o).show(),U(),B(),G())},U=function(){navigator.userAgent.match(".*Mozilla.*Trident.*rv:([0-9]{1,}[.0-9]{0,})")?(n(".overlayDesc .notIE11",o).hide(),n(".overlayDesc .IE11",o).show()):(n(".overlayDesc .notIE11",o).show(),n(".overlayDesc .IE11",o).hide()),g?w?(n(".viewerFeedbackText",o).hide(),n(".missingDependentFilesText",o).hide(),n(".retryConversionText",o).show()):C?(n(".viewerFeedbackText",o).hide(),n(".retryConversionText",o).hide(),n(".missingDependentFilesText",o).show()):(n(".viewerFeedbackText",o).show(),n(".missingDependentFilesText",o).hide(),n(".retryConversionText",o).hide()):(n(".viewerFeedbackText",o).hide(),n(".retryConversionText",o).hide(),n(".missingDependentFilesText",o).hide())},B=function(){p&&l.clearView()},j=function(){n(".viewerContainer",o).removeClass("viewerDimmer"),n(".annotator-button",o).attr("disabled",!1),l.view.unblockMouseEvents()},G=function(){n(".viewerContainer",o).addClass("viewerDimmer"),n(".annotator-button",o).attr("disabled",!0),l.view.blockMouseEvents()},z=function(e){e||n(".loadingOverlayContainer",o).show(),n(".threeDLoader",o).show(),n(".threeDLoader .progress",o).width("0%")},H=function(e){n(".threeDLoader .progress",o).width(e.percentage+"%")},V=function(){n(".threeDLoader .progress",o).width("100%"),n(".viewerContainer",o).show(),setTimeout(function(){n(".threeDLoader",o).hide(),n(".loadingOverlayContainer",o).hide()},500)},W=function(){rt(),Q(),X(),q(),J()},q=function(){n(".viewerWidget").on("mouseover",function(){l&&!l.getIsSketchMode()&&n(".viewerWidget").focus()})},J=function(){n(".viewerWidget").on("click",function(){l&&!l.getIsSketchMode()&&n(".viewerWidget").focus()}),n(".viewerWidget .overlayBody").on("click",function(e){n(".viewerFeedbackOverlay textarea").focus(),e.stopPropagation()})},X=function(){n(".viewerWidget").on("keyup",function(e){switch(e.keyCode){case v.FIT:l&&e.target==e.currentTarget&&l.view.fitWorld();break;case v.ESC:e.target!=e.currentTarget&&e.stopPropagation();break;default:}})},Q=function(){n(".viewerContainer",o).delegate(".toolbar-item","click",function(){gt()})},Y=function(e){var t=e.converter_data?e.converter_data.failure_code:null;if("DEPENDENT_FILE_MISSING"==t){C=!0;var i=e.converter_data.failure_data.length;i>1?n(".missingDependentFilesText .text a",o).text(i+I.dependent_files_missing):n(".missingDependentFilesText .text a",o).text(i+I.dependent_file_missing);var r=g&&e.member_is_project_owner;K(e.converter_data.failure_data,r)}else C=!1,n(".missingDependentFilesText .text a",o).text("")},K=function(e,t){var i=n("#missingDependentFilesOverlay",o);i.gc_overlay({openingElem:".missingDependentFiles",dimmer:!1});for(var r="",a=n(".overlayBody .overlayDesc ul",i),s=0;e.length>s;s++)r+=t?"<li>"+e[s]+"</li>":"<li>"+tt(e[s])+"</li>";a.html(r)},Z="\\",et="/",tt=function(e){if(e.split(Z).length>0){var t=e.split(Z);return t[t.length-1]}if(e.split(et).length>0){var t=e.split(et);return t[t.length-1]}return e},nt=function(e,t,i){var r=n("#retryConversionOverlay",o);r.gc_overlay({openingElem:".retryConversionNotDisplayingCorrectly",closingElem:".buttons .cancelButton",dimmer:!1});var a=n("form .overlayBody .overlayDesc p",r);x&&a.text(I.overlay_retry_conversion_added_files_text),S&&a.text(I.overlay_retry_conversion_text);var s=n("form",r),l=n("form .overlayFooter button:submit",r);r.on("overlay.onClose",function(){s.get(0).reset()});var c=n("form .overlayFooter #submitFeedback",r);c.click(function(){r.gc_overlay("close")}),s.on("submit",function(){return n.ajax({dataType:"json",url:t+"/convert",type:"GET",success:function(){c.removeAttr("disabled"),r.gc_overlay("close"),n("#body").gc_infomessage({content:"File submitted for conversion."}),n("#body").gc_infomessage("open"),ht(),n.ajax({dataType:"json",url:t,success:function(n){At(e,n.viewer_parameters,t,n.version,null,null,i)}})},error:function(){l.removeAttr("disabled"),c.removeAttr("disabled"),r.gc_overlay("close"),n("#body").gc_infomessage({content:"Failure submitting file for conversion. Please contact support@grabcad.com"}),n("#body").gc_infomessage("open")}}),!1})},it=function(){var t=n("#viewerFeedbackOverlay",o);t.gc_overlay({openingElem:w?".overlayFooter .viewerFeedback":".viewerNotDisplayingCorrectly",closingElem:".buttons .cancelButton",dimmer:!1});var i=n("form",t),r=n("form .overlayFooter button:submit",t);t.on("overlay.onClose",function(){i.get(0).reset()}),i.on("submit",function(){r.attr("disabled","disabled");var o=i.find('textarea[name="message"]').val();return n.ajax({url:"/wish",type:"post",dataType:"script",dataFilter:function(){return null},data:{wish_tag:"Viewer Problem",message:" Viewer problem:  \n "+o,page:e.location.origin+e.location.pathname+e.location.hash},success:function(){r.removeAttr("disabled"),t.gc_overlay("close");try{n("#body").gc_infomessage({content:"Thank you for reporting a problem with the viewer."}),n("#body").gc_infomessage("open")}catch(e){}c.submitEvent("PROBLEMS_WITH_VIEWER",f)},error:function(){}}),!1})},rt=function(){n(".viewerContainer",o).delegate(".toolbar-item","click",function(){var r=!1;n(".viewerContainer",o).mouseout(function(){i()}),n(".viewerContainer",o).mouseenter(function(){e()}),n(".viewerContainer",o).mousemove(function(){e()}),n(t).delegate("body","click",function(){r===!1&&(i(),r=!0)})});var e=function(){var e=n(".viewerContainer .annotator-note",o).length>0,t="checked"==n(".dropPin",o).attr("checked");!e&&t&&f.annotations&&n(".viewerContainer",o).css("cursor","url(/images/_/icon-pin.png),auto")},i=function(){n(".viewerContainer",o).css("cursor","default")}},ot=function(){d={title:I.missing_title,msg:I.missing_queued,img:L.queued}},at=function(){d={title:I.missing_title,msg:I.missing_started,img:L.queued}},st=function(e,i,r){var o="",a=!w,s=!0,l=!0,c=e.converter_failure_data?e.converter_failure_data.failure_code:null,u=i&&i.type?i.type:null;switch(c){case"TIMEOUT":o=I.failed_code+"<strong>"+I.failed_timeout+"</strong><br><br>"+I.failed_timeout_details;break;case"DEPENDENT_FILE_MISSING":var h=n(t.createElement("div"));o=I.failed_code+"<strong>"+I.failed_dependent_file_missing+"</strong><br><br>",o+=u&&"iam"===u?I.failed_dependent_file_missing_details5:I.failed_dependent_file_missing_details4,r&&(o+=I.failed_dependent_file_missing_owner),o+="<article class='missing_files'><ul>";for(var p=e.converter_failure_data.failure_data,f=0;p.length>f;f++)if(r){var m=h.text(p[f]).html();o+="<li>"+m+"</li>"}else{var m=h.text(tt(p[f])).html();o+="<li>"+m+"</li>"}o+="</ul></article>",o+=u&&"iam"===u?I.failed_dependent_file_missing_details2_iam:I.failed_dependent_file_missing_details2_vanilla,o+=I.failed_dependent_file_missing_details3,l=!1,a=!1;break;case"INVALID_INPUT":o=I.failed_code+"<strong>"+I.failed_invalid_input+"</strong><br><br>"+I.failed_invalid_input_details,o+=I.failed_invalid_input_faq,a=!1,l=!1,s=!1;break;case"NO_GEOMETRY":o=I.failed_code+"<strong>"+I.failed_no_geometry+"</strong><br><br>"+I.failed_no_geometry_details,a=!1,l=!1;break;default:o=I.failed_code+"<strong>"+I.failed_unspecified+"</strong><br><br>"+I.failed_unspecified_details}l&&(o+=I.failed_logged),s&&(o+=I.failed_faq),a&&(o+=I.failed_no_retry_message),d={title:I.failed_title,msg:o,retry:w}},lt=function(){var e="";e=I.failed_code+"<strong>"+I.failed_no_geometry+"</strong><br><br>"+I.failed_no_geometry_details,d={title:I.failed_title,msg:e,retry:!1}},ct=function(){d={title:I.failed_title,msg:I.incomplete_message}},ut=function(e,t,i){n(".retryButton .link",o).on("click",function(){n.ajax({dataType:"json",url:t+"/convert",type:"GET",success:function(){n("#body").gc_infomessage({content:"File submitted for conversion."}),n("#body").gc_infomessage("open"),ht(),n.ajax({dataType:"json",url:t,success:function(n){At(e,n.viewer_parameters,t,n.version,null,null,i)}})},error:function(){n("#body").gc_infomessage({content:"Failure submitting file for conversion. Please contact support@grabcad.com"}),n("#body").gc_infomessage("open")}})})},dt=function(e){this.viewable_source_file_id==e.id&&("hwf"==e.format?(ht(),n.ajax({dataType:"json",url:this.data_url,success:function(e){At(this.id,e.viewer_parameters,this.data_url,e.version,null,null,this.file_data)}})):e.preparation_failed?(st(e,this.file_data),ht(),ut(this.id,this.data_url,this.file_data),R()):e.preparation_incomplete&&(ct(),ht(),R()))},ht=function(){for(;k.length>0;)o.gc_pusher("unbind","viewable_update",k.pop())},pt=function(e,t,i,r){var a=dt.bind({id:e,viewable_source_file_id:t,data_url:i,file_data:r});k.push(a),o.gc_pusher("bind","viewable_update",a),n(".emailMeArea .link",o).one("click",function(){n.ajax({type:"POST",dataType:"json",data:{id:f.viewable_source_file_id},url:i+"/notify_conversion",success:function(){n("#body").gc_infomessage({content:"An email will be sent to you once your file is ready for viewing."}),n("#body").gc_infomessage("open")}})})},ft=function(){o.gc_pusher("unbind","viewable_update",dt)},mt=function(){var e=t.createElement("div");return e&&e.requestFullscreen?!0:e&&e.mozRequestFullScreen?!0:e&&e.webkitRequestFullScreen?!0:e&&e.msRequestFullscreen?!0:!1},gt=function(){var e="checked"==n(".fullScreen",o).attr("checked");if(e&&mt()&&!m){var i=t.querySelector("#full-screen-viewer");i.onwebkitfullscreenchange=vt,t.onmozfullscreenchange=vt,i.onfullscreenchange=vt,n(".viewerFeedbackText",o).hide(),n(".retryConversionText",o).hide(),n(".missingDependentFilesText",o).hide(),i.webkitRequestFullscreen?i.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):i.mozRequestFullScreen?i.mozRequestFullScreen():i.msRequestFullscreen?(t.removeEventListener("MSFullscreenChange",yt),t.addEventListener("MSFullscreenChange",vt),i.msRequestFullscreen()):i.requestFullScreen&&i.requestFullscreen(),m=!0}else m&&!e&&t.cancelFullScreen()},vt=function(){var e=t.querySelector("#full-screen-viewer");e.onwebkitfullscreenchange=yt,t.onmozfullscreenchange=yt,e.msRequestFullscreen&&(t.removeEventListener("MSFullscreenChange",vt),t.addEventListener("MSFullscreenChange",yt))},yt=function(){m=!1,n(".fullScreen",o).removeAttr("checked"),U(),E==$.VIEWING&&l.view.onResize()},bt=function(e,t,n,i){var r=null;return null!=i?n[t]&&n[t][i]&&(r=n[t][i].url):r=e[t],r},_t=function(e,t,i,r,a,c){var u=bt(e,t,i,r);u&&(n(".load_model",o).hide(),T=$.LOADING,b=!1,P(),z(!0),f.version=t,f.configuration=r,l.loadReferenceSource(u,e,t,i,r,a,c,function(e,t){T==$.LOADING&&("error"===e?(T=$.ERROR,Et("unspecified",u,t)):"readerror"===e?Et("readerror",file_to_view,t):"nomodel"===e?(T=$.ERROR,Et("nomodel")):"complete"===e?b||(b=!0,T=$.VIEWING,V(),$t()):H(t))},s.settings.modelOptions))},wt=function(e){l&&l.clearReference(e)},St=function(e,t){return e=e?e:f.version,t=null!=t?t:f.configuration,file_to_view=e&&f.is_private?null!=t&&f.viewable_configurations&&f.viewable_configurations[e]&&f.viewable_configurations[e][t]?f.viewable_configurations[e][t].url:f.viewable_versions[e]:f.viewable_url},xt=function(e,t){n(".load_model",o).hide(),E=$.LOADING,_=!1,y=!1,z(),l.setUsername(f.member);var i=St(e,t),r="hwf";l.setLoadedVersion(e?e:f.version),l.setLoadedConfiguration(null!=t?t:f.configuration),f.version=e?e:"latest",l.setModelFileName(f.model_name),l.setConverterData(f.converter_data),l.loadSource(i,r,D(f.annotations),f.is_stl_contentfile,f.view_configuration,f.viewable_versions,e,f.viewable_configurations,t,function(e,t){E==$.LOADING&&("error"===e?(E=$.ERROR,Et("unspecified",i,t)):"readerror"===e?Et("readerror",i,t):"nomodel"===e?(E=$.ERROR,Et("nomodel")):"complete"===e?y||(y=!0,V(),kt()):H(t))},s.settings.modelOptions)},Ct=function(){j(),l.view.markupManager.fileComparisonUI&&l.view.markupManager.fileComparisonUI.update(),s.settings.modelLoadedCallback&&s.settings.modelLoadedCallback();var t=e.location.search.match("sample=1");t&&l.showSamplePin(),o.trigger("viewer.loaded"),E==$.VIEWING&&c.submitEvent("LOAD_SUCCESSFUL",f)},$t=function(){l.view.markupManager.fileComparisonUI&&l.view.markupManager.fileComparisonUI.update()},Et=function(e,t,n){d={title:I.download_error};var i="undefined"!=typeof n&&"undefined"!=typeof n.status&&null!=n.status,r="undefined"!=typeof n&&"undefined"!=typeof n.error&&null!=n.error;switch(e){case"nomodel":d.title=I.download_error_no_model_title,d.msg=I.download_error_no_model_msg,d.showFeedbackMsg=!0,c.submitEvent("NO_GEOMETRY",f);break;case"readerror":if(!h){c.submitEvent("READ_ERROR",f);var o="Error reading model data from HWF file";r&&(o+=" : "+n.error),Tt({name:"ReadError",message:o})}break;default:if(!h){c.submitEvent("LOAD_ERROR",f);var o=i?"Error retrieving model file (http status code of "+n.status+")":"Error loading model file";r&&(o+=" : "+n.error),Tt({name:"LoadError",message:o})}}R()},Tt=function(n){if(Grabcad.configuration.airbrake_options.production){var i=Grabcad.configuration.airbrake_options.project_key,r=Grabcad.configuration.airbrake_options.project_id,o=Grabcad.configuration.airbrake_options.environment_name;Airbrake.setProject(r,i),Airbrake.setEnvironmentName(o);var a=f;delete a.rendering,delete a.viewable_versions,delete a.viewable_configurations,delete a.thirdptydata,Airbrake.addParams(a),Airbrake.addEnv({current_url:t.URL,browser_vendor:e.navigator.vendor,user_agent:e.navigator.userAgent}),Airbrake.push({error:n})}else try{console.log("--- Error caught. Logging to Airbrake is disabled in this environment, but if it was enabled the following information would be logged ---"),console.log(" > viewer_params.model_url: "+f.model_url),console.log(" > viewer_params.viewable_url: "+f.viewable_url),console.log(" > current_url: "+t.URL),console.log(" > browser_vendor: "+e.navigator.vendor),console.log(" > user_agent: "+e.navigator.userAgent),console.log(" > error.name: "+n.name),console.log(" > error.message: "+n.message)}catch(s){}},kt=function(){!_&&f.annotations_location?l.loadAnnotations(f.annotations_location,function(e){"complete"===e&&(E=$.VIEWING,_=!0,Ct())}):(E=$.VIEWING,Ct())},At=function(e,t,n,i,r,o,a){var s=null!=o;if(E==$.LOADING)return!1;if(c=new AnnotatorMetricsReporter,t.version=i?i:"latest",ft(),N(),u){var l=f.file;if(g=null!=t.member&&t.member.length>0,f=t,"undefined"==typeof n&&(w=!1),w&&!s&&nt(e,n,a),it(),E==$.VIEWING&&f.file&&f.file==l)return!1;var h=St(i,o),p=!h;s&&p?lt(a):p?(viewable_source_file_id=f.viewable_source_file_id,f.viewable_status?f.viewable_status.preparation_started?(c.submitEvent("CONVERSION_IN_PROGRESS",f),at(),pt(e,viewable_source_file_id,n)):f.viewable_status.preparation_failed?(c.submitEvent("CONVERSION_FAILED",f),st(f.viewable_status,a,f.member_is_project_owner),ut(e,n,a)):f.viewable_status.preparation_incomplete?ct():(ot(),pt(e,viewable_source_file_id,n)):(c.submitEvent("NO_VIEWABLE_FILE_AND_STATUS",f),ot(),pt(e,viewable_source_file_id,n)),E=$.ERROR):(Y(f),E=$.READY,d=null)}else E=$.ERROR,d=M(),c.submitEvent("UNSUPPORTED_BROWSER",t);P(),R(),E==$.READY&&xt(i,o)},Nt=function(e){return e.is_viewable};s.methods={load:function(e){return Nt(e)?(S=e.viewer_parameters.new_converter_deployed,x=e.viewer_parameters.files_updated,w=S||x,data_url="undefined"==typeof e.data_url||null==e.data_url?n(".filecontentWidget").data().url+e.id:e.data_url,At(e.id,e.viewer_parameters,data_url,e.version,e.name,e.configuration,e),!0):!1},loadReference:function(e){var t=e.viewer_parameters.compared_file_versions,n=e.viewer_parameters.compared_file_configurations,i=e.viewer_parameters.ref_version_ID,r=e.viewer_parameters.ref_configuration_ID,o=e.viewer_parameters.same_model_compare,a=e.viewer_parameters.compared_model_name;_t(t,i,n,r,o,a)},clearReferenceModel:function(e){wt(e)},close:function(){(E==$.LOADING||E==$.VIEWING)&&(E==$.LOADING?(h=!0,c.submitEvent("LOAD_INTERRUPTED",f)):h=!1,B(),l.abort(),E=$.INITIAL,T=$.INITIAL)},registerEvent:function(){},supports:function(){return!1},enterFullscreen:function(){l&&E==$.VIEWING&&l.view.onResize()},exitFullscreen:function(){l&&E==$.VIEWING&&l.view.onResize()},attachPinToComment:function(e){l&&l.attachPinToComment(e.pinName,e.comment_id,e.callback)},cancelPendingPin:function(){l&&l.cancelPendingPin()},updateSketchData:function(e){l&&l.updateSketchData(e.data,e.callback)},attachSketchToComment:function(e){l&&l.attachSketchToComment(e.commentId,e.callback)},updatePinColor:function(e){l&&l.updatePinColor(e.pinId,e.pinName,e.red,e.green,e.blue)},deletePin:function(e){l&&l.deletePin(e.pinId)},removePin:function(e){l&&l.removePin(e.pinId)},activatePin:function(e){l&&l.activatePin(e.pinId)},deactivateAllPins:function(){l&&l.hideAllNotes()}},A()};n.fn[r]=function(e){var t,a=arguments;return this.each(function(){var s=n(this),l=s.data(r);if(l||(l=new o(n(this),e)),s.data(r,l),l.methods[e]){var c=l.methods[e].apply(this,Array.prototype.slice.call(a,1));t===i&&c!==i&&(t=c),t=t||c}else"object"!=typeof e&&e?n.error("Method "+e+" does not exist on "+r):n.extend(l.settings,e)}),t!==i?t:this}}(window,document,jQuery),function(e,t,n,i){var r="gc_pdf_viewer",o=function(e,o){this.name=r,this.settings=n.extend({options:{}},o);var a=this,s=null,l=null,c=-1,u=[],d=!1,h=!1,p=0,f=0,m=1,g=null,v=function(){b()},y=function(){var e,t,r;return r===i&&(e=n('<div style="width:50px;height:50px;overflow:auto"><div/></div>').appendTo("body"),t=e.children(),r=t.innerWidth()-t.height(99).innerWidth(),e.remove()),r},b=function(){var t=['<div class="menuBar">','<div class="toolbar-item">','<div class="itemText">Zoom:</div>','<select class="zoomSelect">','<option value="FitPage">Fit Page</option>','<option value="FitWidth">Fit Width</option>','<option value="0.5">50%</option>','<option value="1.0" selected>100%</option>','<option value="1.5">150%</option>','<option value="2.0">200%</option>','<option value="2.5">250%</option>','<option value="3.0">300%</option>',"</select>","</div>",'<div class="toolbar-item fitPage">','<div class="itemIcon" fitPage="true"></div>','<div class="itemText">Fit Page</div>',"</div>",'<div class="toolbar-item fitWidth">','<div class="itemIcon" fitWidth="true"></div>','<div class="itemText">Fit Width</div>',"</div>",'<div class="toolbar-item flipVertical">','<div class="itemIcon" flipVertical="true"></div>','<div class="itemText">Flip Vertical</div>',"</div>",'<div class="toolbar-item flipHorizontal">','<div class="itemIcon" flipHorizontal="true"></div>','<div class="itemText">Flip Horizontal</div>',"</div>","</div>",'<div class="pdfWrapper">',"</div>"];e.append(t.join("")),s=n(".pdfWrapper",e),O(),x()},_=function(e){return"pdfCanvas"==e.target.className||"pdfPageContainer"==e.target.className?(p=e.clientX,f=e.clientY,n(t).on("mouseup",S),n(t).on("mousemove",w),n(t.body).css("cursor","crosshair"),e.preventDefault(),!1):!0},w=function(e){var t=e.clientX-p,n=e.clientY-f;return p=e.clientX,f=e.clientY,s.scrollLeft(s.scrollLeft()-t),s.scrollTop(s.scrollTop()-n),e.preventDefault(),!1},S=function(e){return n(t).off("mouseup",S),n(t).off("mousemove",w),n(t.body).css("cursor","default"),e.preventDefault(),!1},x=function(){s.on("mousedown",_)},C=function(e){var t=s.scrollLeft()/s[0].scrollWidth,n=s.scrollTop()/s[0].scrollHeight;m=e,U(),s.scrollLeft(Math.round(t*s[0].scrollWidth)),s.scrollTop(Math.round(n*s[0].scrollHeight))},$=function(){var e=n("#pageContainer1",s)[0],t=e.page,i=t.getViewport(1);return(s.width()-y())/i.width},E=function(){var e=n("#pageContainer1",s)[0],t=e.page,i=t.getViewport(1);return s.height()/i.height},T=function(){C(E())},k=function(){C($())},A=function(){"FitPage"==this.value?T():"FitWidth"==this.value?k():C(this.value)},N=function(){n(".zoomSelect",l).val("FitPage").attr("selected",!0),T()},M=function(){n(".zoomSelect",l).val("FitWidth").attr("selected",!0),k()},D=function(){n(".flipVertical",e).hasClass("checked")?(n(".flipVertical",e).removeClass("checked"),n(".pdfCanvas",e).removeClass("flipV"),h=!1):(n(".flipVertical",e).addClass("checked"),n(".pdfCanvas",e).addClass("flipV"),h=!0)},P=function(){n(".flipHorizontal",e).hasClass("checked")?(n(".flipHorizontal",e).removeClass("checked"),n(".pdfCanvasSpan",e).removeClass("flipH"),d=!1):(n(".flipHorizontal",e).addClass("checked"),n(".pdfCanvasSpan",e).addClass("flipH"),d=!0)},I=function(){n(".zoomSelect",l).on("change",A),n(".fitPage",e).on("click",N),n(".fitWidth",e).on("click",M),n(".flipVertical",e).on("click",D),n(".flipHorizontal",e).on("click",P)},F=function(){l.hide()},L=function(){l.show()},O=function(){l=n(".menuBar",e),I()},R=function(e){var t=e.getViewport(m),i=e.pageNumber,r=["<div class='pdfPageContainer' id='pageContainer"+i+"'>","<span class='pdfCanvasSpan'>","<canvas class='pdfCanvas'></canvas>","</span>","</div>"];s.append(r.join(""));var o=n("#pageContainer"+i,s);o[0].page=e;var a=n(".pdfCanvas",o)[0],l=a.getContext("2d");a.height=t.height,a.width=t.width,h&&n(".pdfCanvas",o).addClass("flipV"),d&&n(".pdfCanvasSpan",o).addClass("flipH"),e.render({canvasContext:l,viewport:t})},U=function(){s.empty();for(var e=g.numPages,t=1;e>=t;++t)g.getPage(t).then(R)},u=function(e,t){u[t]&&(u[t]=!1,L(),g=e,U())},B=function(t,i){z(),n(".error",e).show(),n(".error .title",e).show(),n(".error .title",e).html(t),n(".error .msg",e).show(),n(".error .msg",e).html(i)},j=function(e,t,n){u[n]&&(t&&"PasswordException"===t.name?B("Password Protected","PDF is protected by a password:"):t&&"InvalidPDFException"===t.name?B("Invalid File","Invalid PDF File"):t&&"MissingPDFException"===t.name?B("Missing File","Missing PDF file."):B("Loading Error","An error occurred while loading the PDF."))},G=function(e,t,n){return Math.min(Math.max(e,t),n)},z=function(){n(".pdfLoader",e).hide()},H=function(t,i){var r=Math.round(100*(t/i));n(".pdfLoader .progress",e).width(G(r,0,100)+"%")},V=function(e,t){u[t]&&H(e.loaded,e.total)},W=function(){-1==c?c=0:(u[c]&&(u[c]=!1),c++),u[c]=!0},q=function(){var e=['<div class="error">','<div class="center_text">','<div class="title text"></div>','<div class="msg text"></div>',"</div>","</div>"],t=['<span class="pdfLoader">','<span class="pdfLoadBar">','<span class="progress"></span>',"</span>","</span>"];s.empty(),s.append(e.join("")),s.append(t.join(""))},J=function(){q(),W(),F(),H(0,100)},X=function(){var e=/.*;\s*(MSIE (\d+)\.\d+);.*/,t=navigator.userAgent;return null==t.match(e)},Q=function(e){return function(t,n){j(t,n,e)}},Y=function(e){return function(t){V(t,e)}},K=function(e){J();var t=new XMLHttpRequest;t.open("GET",e.viewer_parameters.viewable_url),t.withCredentials=!0,t.responseType="arraybuffer",t.onload=function(){Z(t.response)},t.onprogress=Y(c),t.onerror=Q(c),t.onabort=Q(c),t.ontimeout=Q(c),t.send()},Z=function(e){if(X()){PDFJS.workerSrc="/static/vendor/pdf-worker-v4.js";var t=c,n=function(e){u(e,t)},i=Q(c),r=Y(c);PDFJS.getDocument(e,null,null,r).then(n,i)}else B("Internet Explorer Is Not Supported","Internet Explorer is not supported at this time. We recommend using another browser such as  <a href='www.google.com/chrome'> Google Chrome </a>")},et=function(){null!=g&&(g.destroy(),g=null),u[c]=!1},tt=function(e){return"pdf"==e.type.toLowerCase()};a.methods={load:function(e){return tt(e)?(K(e),!0):!1},close:function(){et()},registerEvent:function(){},supports:function(){return!1},enterFullscreen:function(){},exitFullscreen:function(){}},v()};n.fn[r]=function(e){var t,a=arguments;return this.each(function(){var s=n(this),l=s.data(r);if(l||(l=new o(n(this),e)),s.data(r,l),l.methods[e]){var c=l.methods[e].apply(this,Array.prototype.slice.call(a,1));t===i&&c!==i&&(t=c),t=t||c}else"object"!=typeof e&&e?n.error("Method "+e+" does not exist on "+r):n.extend(l.settings,e)}),t!==i?t:this}}(window,document,jQuery),function(e,t,n,i){var r="gc_txt_viewer",o=function(e,t){this.name=r,this.settings=n.extend({options:{}},t);var i=this,o=null,a=function(){s()},s=function(){var t=['<div class="txtWrapper">','<div class="txtFrame"></div>','<div class="spinnerDiv"></div>',"</div>"];e.append(t.join("")),o=n(".txtFrame",e),_spinner=n(".spinnerDiv",e)},l=function(e){_spinner.spin({lines:8,radius:10,width:5,color:"#fff",shadow:!0,trail:20}),o.text("");var t=new XMLHttpRequest;t.open("GET",e.viewer_parameters.viewable_url,!0),t.withCredentials=!0,t.onload=function(){200==this.status&&(o.text(this.response),_spinner.spin(!1))},t.send()},c=function(){},u=function(e){return"txt"==e.type.toLowerCase()};i.methods={load:function(e){return u(e)?(l(e),!0):!1},close:function(){c()},registerEvent:function(){},supports:function(){return!1},enterFullscreen:function(){},exitFullscreen:function(){}},a()};n.fn[r]=function(e){var t,a=arguments;return this.each(function(){var s=n(this),l=s.data(r);if(l||(l=new o(n(this),e)),s.data(r,l),l.methods[e]){var c=l.methods[e].apply(this,Array.prototype.slice.call(a,1));t===i&&c!==i&&(t=c),t=t||c}else"object"!=typeof e&&e?n.error("Method "+e+" does not exist on "+r):n.extend(l.settings,e)}),t!==i?t:this}}(window,document,jQuery),function(e,t,n,i){var r="gc_mov_viewer",o=function(e,o){this.name=r,this.settings=n.extend({options:{}},o);var a=this,s=null,l=null,c=function(){u()},u=function(){var t=['<div class="movWrapper">',"</div>"];e.append(t.join("")),l=n(".movWrapper",e)},d=function(){s.removeEventListener("play",d),n(".spinnerDiv",e).remove()},h=function(t){var i=['<video class="movVideo" autoplay controls>',"</video>",'<div class="spinnerDiv"></div>'];s=null,l.empty(),l.append(i.join("")),s=n(".movVideo",e)[0],s.src=t.url;var r=new Spinner({lines:8,radius:10,width:5,color:"#fff",shadow:!0,trail:20}).spin();n(".spinnerDiv",e).append(r.el),n(s).on("play",d)},p=function(){null!==s&&""!==s.src&&0!==s.readyState&&(s.pause(),s.currentTime=0)},f=function(e){var n=e.type.toLowerCase(),r=t.createElement("video");if(r!==i&&r.canPlayType)if("mov"===n||"m4v"===n||"qt"===n||"mp4"===n){if(r.canPlayType('video/mp4; codecs="mp4v.20.8"'))return!0;if(r.canPlayType('video/mp4; codecs="avc1.42E01E"')||r.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"'))return!0}else if("ogg"===n){if(r.canPlayType('video/ogg; codecs="theora"'))return!0}else if("webm"===n&&r.canPlayType('video/webm; codecs="vp8, vorbis"'))return!0;return!1};a.methods={load:function(e){return f(e)?(h(e),!0):!1},close:function(){p()},registerEvent:function(){},supports:function(){return!1},enterFullscreen:function(){},exitFullscreen:function(){}},c()};n.fn[r]=function(e){var t,a=arguments;return this.each(function(){var s=n(this),l=s.data(r);if(l||(l=new o(n(this),e)),s.data(r,l),l.methods[e]){var c=l.methods[e].apply(this,Array.prototype.slice.call(a,1));t===i&&c!==i&&(t=c),t=t||c}else"object"!=typeof e&&e?n.error("Method "+e+" does not exist on "+r):n.extend(l.settings,e)}),t!==i?t:this}}(window,document,jQuery),function(e,t,n,r){var o="gc_img_viewer",a=function(a,s){this.name=o,this.settings=n.extend({options:{}},s);var l=this,c=r,u=r,d=r,h=r,p="",f=0,m=/^(png|jpg|jpeg|gif|bmp)$/i,g="",v="",y=null,b=null,_="Best",w=function(){S()},S=function(){var e=['<div class="menuBar">','<div class="toolbar-item">','<div class="itemText">Zoom:</div>','<select class="zoomSelect">','<option value="Best" selected>Best</option>','<option value="0.5">50%</option>','<option value="1.0">100%</option>','<option value="1.5">150%</option>','<option value="2.0">200%</option>','<option value="2.5">250%</option>','<option value="3.0">300%</option>',"</select>","</div>",'<div class="toolbar-item rotateLeft">','<div class="itemIcon" rotateLeft="true"></div>','<div class="itemText">Rotate left</div>',"</div>",'<div class="toolbar-item rotateRight">','<div class="itemIcon" rotateRight="true"></div>','<div class="itemText">Rotate right</div>',"</div>","</div>",'<div class="imgWrapper">',"</div>"];a.append(e.join("")),u=n(".imgWrapper",a),R()},x=function(e,t,i,r){var o=t.getContext("2d"),a=d.width(),s=d.height(),l=e.naturalWidth,c=e.naturalHeight,u=Math.PI/180*i;if("Best"===r)if(90===i||270===i)if(c>l){var h=a>c?c:a,p=l*(h/c);p>s&&(h*=s/p,p=s),cw=h,ch=p}else{var f=s>l?l:s,m=c*(f/l);m>a&&(f*=cw/s,m=a),cw=m,ch=f}else if(c>l){var h=s>c?c:s,p=l*(h/c);p>a&&(h*=a/p,p=a),cw=p,ch=h}else{var f=a>l?l:a,m=c*(f/l);m>s&&(f*=s/m,m=s),cw=f,ch=m}else 90===i||270===i?(cw=c*r,ch=l*r):(cw=l*r,ch=c*r);t.width=cw,t.height=ch;var g=n(t);g.width(cw),g.height(ch),a>cw?g.css({"margin-left":(a-cw)/2}):g.css({"margin-left":0}),s>ch?g.css({"margin-top":(s-ch)/2}):g.css({"margin-top":0}),o.clearRect(0,0,cw,ch);var v=cw/2,y=ch/2;o.save(),o.translate(v,y),o.rotate(u),90===i||270===i?o.drawImage(e,-y,-v,ch,cw):o.drawImage(e,-v,-y,cw,ch),o.restore()},C=function(){if(c){var e=_canvas[0];x(c[0],e,f,_)}},$=function(e){f=e,null!==y&&y(P),C()},E=function(){n(h).children().hide()},T=function(){n(h).children().show()},k=function(e){e.stopPropagation(),e.preventDefault(),f-=90,0>f&&(f=270),$(f)},A=function(e){e.stopPropagation(),e.preventDefault(),f+=90,f>=360&&(f=0),$(f)},N=function(){_=this.value,C()},M=function(){n(".rotateLeft",h).on("click",k),n(".rotateRight",h).on("click",A),n(".zoomSelect",h).on("change",N)},D=function(e){var t=e.toDataURL(),n=atob(t.split(",")[1]),r=new ArrayBuffer(n.length),o=new Uint8Array(r);for(i=0;n.length>i;i+=1)o[i]=n.charCodeAt(i);var a=t.split(",")[0].split(":")[1].split(";")[0];return new Blob([o],{type:a})},P=function(){n(".save",a).hide();var e=angular.element(n(".teams")).scope(),t={activeFolder:e.workbench.activeFolder.id,filePath:e.workbench.activeFolder.path};B(),E();var i=f,r=n("<img>");r[0].gc_imageLoad("loadURL",U(g,"original"),function(){var e=n("<canvas>")[0];x(r[0],e,i,1);var o=D(e);o.name=p,o.lastModifiedDate=Date.now();var a=n(".uploaderWidget");a.gc_uploader("publishToFolder",o,t),j(),T()},function(){},function(){})},I=function(e){return"imageCanvas"==e.target.className?(_lastX=e.clientX,_lastY=e.clientY,n(t).on("mouseup",L),n(t).on("mousemove",F),n(t.body).css("cursor","crosshair"),e.preventDefault(),!1):!0},F=function(e){var t=e.clientX-_lastX,n=e.clientY-_lastY;return _lastX=e.clientX,_lastY=e.clientY,d.scrollLeft(d.scrollLeft()-t),d.scrollTop(d.scrollTop()-n),e.preventDefault(),!1},L=function(e){return n(t).off("mouseup",L),n(t).off("mousemove",F),n(t.body).css("cursor","default"),e.preventDefault(),!1},O=function(){d.on("mousedown",I)},R=function(){h=n(".menuBar",a),M()},U=function(e,t){return e+"&style="+t},B=function(){var e=new Spinner({lines:8,radius:10,width:5,color:"#fff",shadow:!0,trail:20}).spin();n(".spinnerDiv",a).append(e.el)},j=function(){n(".spinnerDiv",a).empty()},G=function(e){z(),B();var t=function(e){n(this).exifFromBlob(e,function(e){if(e!==r&&e.Orientation!==r){var t=e.Orientation;3===t?$(180):6===t?$(90):8===t?$(270):C()}else C()}),j()},i=function(){W()},o=function(){c.load(function(){C(),j()}),c.attr("src",g)};c.gc_imageLoad("loadURL",U(g,e),t,o,i)},z=function(){n(".imageLoadError").length&&n(".imageLoadError").remove()},H=function(){c&&G("original")},V=function(){c&&G("original")},W=function(){u.removeClass("imageBackground");var e=n(".imgWrapper",a).parent();1>e.children(".imageLoadError").length&&e.append("<div class='imageLoadError'><p class='rationale'>Processing image...</p><p class='instruction'></p></div>"),j(),n(".filecontentWidget").gc_pusher("bind","process_rendering",function(e){g.indexOf(e.secure_id)>=0&&(u.addClass("imageBackground"),n(".filecontentWidget").gc_pusher("unbind","process_rendering"),z(),G("original"))})},q=function(t){var i=['<img class="image"/>','<div class="imageDiv">','<canvas class="imageCanvas"/>',"</div>",'<div class="spinnerDiv"></div>'];u.empty(),u.append(i.join("")),d=n(".imageDiv",a),_canvas=n(".imageCanvas",a),u.addClass("imageBackground"),n(".zoomSelect",h).val("Best").attr("selected",!0),_="Best",O(),T(),y=null,f=0,n(".save",a).hide(),g=t.viewer_parameters.model_url,v=t.type.toLowerCase(),p=t.name,c=n(".image",a),c.hide(),G("original"),n(e).on("resize",C)
},J=function(e){return m.test(e.type.toLowerCase())},X=function(){n(e).off("resize",C),null!==b&&(b.abort(),b=null),u.empty(),c=r};l.methods={load:function(e){return J(e)?(q(e),!0):!1},close:function(){X()},registerEvent:function(){},supports:function(){return!1},enterFullscreen:function(){H()},exitFullscreen:function(){V()}},w()};n.fn[o]=function(e){var t,i=arguments;return this.each(function(){var s=n(this),l=s.data(o);if(l||(l=new a(n(this),e)),s.data(o,l),l.methods[e]){var c=l.methods[e].apply(this,Array.prototype.slice.call(i,1));t===r&&c!==r&&(t=c),t=t||c}else"object"!=typeof e&&e?n.error("Method "+e+" does not exist on "+o):n.extend(l.settings,e)}),t!==r?t:this}}(window,document,jQuery),function(e,t,n,i){var r="gc_thirdparty_viewer",o=function(t,i){this.name=r,this.settings=n.extend({options:{}},i);var o,a,s=this,l=null,c=null,u=!1,d=null,h=0,p="",f="",m=null,g=null,v=null,y="",b="",_=null,w=null,S=null,x=0,C="",$=null,E=!1,T=function(){k()},k=function(){var i=['<div class="thirdpartyWrapper">',"</div>"];t.append(i.join("")),l=n(".thirdpartyWrapper",t),e.addEventListener("message",L)},A=function(){u=!0,b=N();var t=_.getTime()+2e3-(new Date).getTime();100>=t?X():w.push(e.setTimeout(X,t))},N=function(){var e=n("<a>",{href:c[0].src})[0];return e.protocol+"//"+e.host},M=function(e){if(c&&e.source===c[0].contentWindow){if(e.origin===N())return b=e.origin,!0;var t,n=a.split(";");for(t=0;n.length>t;t++)if(e.origin===n[t])return b=e.origin,!0}return!1},D=function(e){if(u){var t={GrabCADMessage:"OpenFile",arrayBuffer:e};c[0].contentWindow.postMessage(t,b)}},P=function(){var e=new XMLHttpRequest;e.open("GET",f,!0),e.responseType="arraybuffer",e.withCredentials=!0,e.onload=function(){200==this.status&&D(this.response)},e.send(),S.push(e)},I=function(e){var t=new Blob([e.arrayBuffer]);t.name=p,t.lastModifiedDate=Date.now(),n(".uploaderWidget").gc_uploader("publish",t)},F=function(t){var i=t.message;t.should_upgrade&&(i+=', please contact <a target="_blank" href="mailto:lagoa-sales@grabcad.com?subject='+y+' upgrade ">GrabCAD Sales</a> for an upgrade.<br>They have already been notified and will be in contact soon.'),$body=n("body"),$body.gc_launchappmessage({headerText:y,textHtml:i,headerIcon:C,style:"red",visibleFor:0,closeButton:!0}),$body.gc_launchappmessage("open"),n.ajax({url:"/toolbox/send_app_over_limit",type:"put",dataType:"json",data:{app_id:$,sub_id:t.sub_id,offering_id:t.offering_id,message:t.message,project_id:t.project_id,project_url:""+e.location},success:function(){},error:function(){}})},L=function(e){try{if(M(e)){var t=e.data;"string"==typeof t&&(t=JSON.parse(e.data)),"object"==typeof t&&"string"==typeof t.GrabCADMessage&&("ModifyFile"===t.GrabCADMessage&&t.fileId===h?d(K):"GetFile"===t.GrabCADMessage&&t.fileId===h?P():"UploadFile"===t.GrabCADMessage&&t.fileId===h?I(t):"SubscriptionUpdate"===t.GrabCADMessage&&t.fileId===h&&F(t))}}catch(n){}},O=function(){null==_&&(m.attr("src","/client_applications/"+$+"/splash").show(),_=new Date)},R=function(){m.hide(),_=null},U=function(e){return"accepted"==e.tosResponse},B=function(e,t,i){G(),S.push(n.ajax({url:"/account/preferences/"+t.tosPrefKey,type:"put",dataType:"json",data:{value:"accepted"},async:!1,success:function(){H(e,t,i)}}))},j=function(e,t,i){var r=n("#tpdtosaccept",g.contents());r&&r.on("click",function(){B(e,t,i)})},G=function(){g.hide()},z=function(e,t,n){g.attr("src","/client_applications/"+t.id+"/tos").show(),g.on("load",function(){j(e,t,n)})},H=function(t,i,r){var o=!0,a=i.fileSizeLimit;if(a&&a>0){o=!1;var s=t.size_in_bytes;if(s||(O(),S.push(n.ajax({url:t.data_url,type:"get",async:!0,success:function(n){t.size_in_bytes=n.size_in_bytes,t.size_in_bytes?H(t,i,r):1e3>x++&&w.push(e.setTimeout(function(){H(t,i,r)},500))}}))),s)if(s>a){var l=(.49999+a/1048576).toFixed(0);V(t,i,"File size limit exceeded!",y+" does not support files larger than "+l+" MB"),o=!1}else o=!0}o&&q(t,i,r)},V=function(e,t,n,i){v.contents().find("head").append("<link href='/styles/third_party_error.css' media='screen' rel='stylesheet' type='text/css'>"),v.contents().find("body").html("<div class='tpdErrorContainer'><h1>"+n+"</h1><div class='content'>"+i+"</div></div>"),v.show()},W=function(){v.hide()},q=function(e,t,i){if(t.urlComplete)J(e,t,i);else{var r=angular.element(n(".teams")).scope().workbench.activeFolder,o=angular.copy(angular.element(".file_content_container").scope().file),a=o.id?o.version:-1,s=n(".teams").scope(),l=s.project.name,c=s.project.member.id,u=s.project.account.id;n.ajax({url:"/client_applications/"+t.id.toString()+"/get_url",dataType:API.dataType.json,type:API.httpMethod.get,async:!0,data:{method:"get",url:t.templateUrl,project_name:l,member_id:c,account_id:u,folder_id:r.id,file_version:a},success:function(n){t.subscription_status=n.subscription_status,t.url=n.url,t.urlSigned=n.signed,t.urlComplete=!0,J(e,t,i)},error:function(){alert("Unable to launch app")}})}},J=function(t,n,i){switch(n.subscription_status){case"free":case"subscribed":case"in-trial":break;case"pre-trial":break;case"post-trial":break;case"subscription-expired":}var r=n.url;if(!n.urlSigned){var o=encodeURIComponent(e.location.protocol+"//"+e.location.host),a=i?"&"+n.refresh_option:"";r+="&host="+o+a}O(),c.hide(),c.load(A),c.attr("src",r),h=parseInt(t.id),p=t.name,C=n.iconImageFile,y=n.displayName,f=t.viewer_parameters.model_url},X=function(){c.show(),R(),G(),W()},Q=function(e,t){for(var n=0;e.length>n;++n){var i=e[n];if(t(i))return i}return null},Y=function(e,t,i){var r=['<iframe class="thirdpartyFrame">',"</iframe>",'<iframe id="thirdpartySplash">',"</iframe>",'<iframe id="thirdpartyTos">',"</iframe>",'<iframe id="thirdpartyError">',"</iframe>"];u=!1,c=null,d=null,x=0,Z();var s=Q(e.viewer_parameters.thirdptydata.clients,i);return s?($=s.id,a=s.allowed_message_domains,o=s.canEdit&&!s.userViewOnly,E=s.canShareSession,y=s.displayName,l.empty(),l.append(r.join("")),c=n(".thirdpartyFrame",l),m=n("#thirdpartySplash",l),g=n("#thirdpartyTos",l),v=n("#thirdpartyError",l),R(),G(),W(),U(s)?H(e,s,t):z(e,s,t),!0):!1},K=function(){if(u){var e={GrabCADMessage:"SaveFile",fileId:h};c[0].contentWindow.postMessage(JSON.stringify(e),b)}},Z=function(){for(;w&&w.length>0;)e.clearTimeout(w.pop());for(;S&&S.length>0;)S.pop().abort();w=new Array,S=new Array},et=function(){Z(),l.empty()},tt=function(e){return"iframe"==e.launchMode.toLowerCase()&&(e.canView||e.canEdit&&!e.userViewOnly)},nt=function(e){return tt(e)&&e.canLoad};s.methods={load:function(e,t){return Y(e,t,nt)},open_with:function(e,t){return Y(e,t,tt)},close:function(){et()},registerEvent:function(e,t){"onModified"==e&&(d=t)},supports:function(e){return"save"==e?o:"sharedSession"==e?E:"detectSavedOutsideSession"==e?!0:!1},detectSavedOutsideSession:function(e){return e.app_id!=$},enterFullscreen:function(){},exitFullscreen:function(){}},T()};n.fn[r]=function(e){var t,a=arguments;return this.each(function(){var s=n(this),l=s.data(r);if(l||(l=new o(n(this),e)),s.data(r,l),l.methods[e]){var c=l.methods[e].apply(this,Array.prototype.slice.call(a,1));t===i&&c!==i&&(t=c),t=t||c}else"object"!=typeof e&&e?n.error("Method "+e+" does not exist on "+r):n.extend(l.settings,e)}),t!==i?t:this}}(window,document,jQuery),function(){function t(){return function(){}}function E(){return"x"+ ++aa+ +new Date}function G(){return+new Date}function ka(e,t){var n=e.join(da),i=[];return t?(M(t,function(e,t){i.push(e+"="+N(t))}),n+="?"+i.join(ea)):n}function la(e,t){function n(){r+t>G()?(clearTimeout(i),i=setTimeout(n,t)):(r=G(),e())}var i,r=0;return n}function ma(e,t){var n=[];return M(e||[],function(e){t(e)&&n.push(e)}),n}function na(e,t){return e.replace(ha,function(e,n){return t[n]||e})}function ja(e){var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=0|16*Math.random();return("x"==e?t:8|3&t).toString(16)});return e&&e(t),t}function M(e,t){if(e&&t)if("undefined"!=typeof e[0])for(var n=0,i=e.length;i>n;)t.call(e[n],e[n],n++);else for(n in e)e.hasOwnProperty&&e.hasOwnProperty(n)&&t.call(e[n],n,e[n])}function P(e,t){var n=[];return M(e||[],function(e,i){n.push(t(e,i))}),n}function N(e){return P(encodeURIComponent(e).split(""),function(e){return 0>"-_.!~*'()".indexOf(e)?e:"%"+e.charCodeAt(0).toString(16).toUpperCase()}).join("")}function oa(e){var t=[];return M(e,function(e,n){n.j&&t.push(e)}),t.sort()}function pa(){setTimeout(function(){v||(v=1,M(ba,function(e){e()}))},z)}var n=null,r=!1;window.JSON&&window.JSON.stringify||function(){function a(){try{return this.valueOf()}catch(e){return n}}function c(e){return d.lastIndex=0,d.test(e)?'"'+e.replace(d,function(e){var t=q[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function b(t,n){var i,r,o,l,u,d=e,h=n[t];switch(h&&"object"==typeof h&&(h=a.call(h)),"function"==typeof k&&(h=k.call(n,t,h)),typeof h){case"string":return c(h);case"number":return isFinite(h)?String(h):"null";case"boolean":case"null":return String(h);case"object":if(!h)return"null";if(e+=s,u=[],"[object Array]"===Object.prototype.toString.apply(h)){for(l=h.length,i=0;l>i;i+=1)u[i]=b(i,h)||"null";return o=0===u.length?"[]":e?"[\n"+e+u.join(",\n"+e)+"\n"+d+"]":"["+u.join(",")+"]",e=d,o}if(k&&"object"==typeof k)for(l=k.length,i=0;l>i;i+=1)r=k[i],"string"==typeof r&&(o=b(r,h))&&u.push(c(r)+(e?": ":":")+o);else for(r in h)Object.hasOwnProperty.call(h,r)&&(o=b(r,h))&&u.push(c(r)+(e?": ":":")+o);return o=0===u.length?"{}":e?"{\n"+e+u.join(",\n"+e)+"\n"+d+"}":"{"+u.join(",")+"}",e=d,o}}window.JSON||(window.JSON={});var d=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,e,s,q={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},k;"function"!=typeof JSON.stringify&&(JSON.stringify=function(t,n,i){var r;if(s=e="","number"==typeof i)for(r=0;i>r;r+=1)s+=" ";else"string"==typeof i&&(s=i);if((k=n)&&"function"!=typeof n&&("object"!=typeof n||"number"!=typeof n.length))throw Error("JSON.stringify");return b("",{"":t})}),"function"!=typeof JSON.parse&&(JSON.parse=function(a){return eval("("+a+")")})}();var aa=1,v=r,ba=[],w="-pnpres",z=1e3,da="/",ea="&",ha=/{([\w\-]+)}/g,I,ia=Math.floor(20*Math.random());if(I=function(e,t){return e.indexOf("pubsub.")>0&&e.replace("pubsub","ps"+(t?ja().split("-")[0]:20>++ia?ia:ia=1))||e},!window.PUBNUB){var Q=function(e){return document.getElementById(e)},qa=function(e){console.error(e)},ra=function(e,t){var n=[];return M(e.split(/\s+/),function(e){M((t||document).getElementsByTagName(e),function(e){n.push(e)})}),n},R=function(e,t,n){M(e.split(","),function(e){function i(e){e||(e=window.event),n(e)||(e.cancelBubble=!0,e.returnValue=r,e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation())}t.addEventListener?t.addEventListener(e,i,r):t.attachEvent?t.attachEvent("on"+e,i):t["on"+e]=i})},sa=function(){return ra("head")[0]},S=function(e,t,n){return n?(e.setAttribute(t,n),void 0):e&&e.getAttribute&&e.getAttribute(t)},ua=function(e,t){for(var n in t)if(t.hasOwnProperty(n))try{e.style[n]=t[n]+("|width|height|top|left|".indexOf(n)>0&&"number"==typeof t[n]?"px":"")}catch(i){}},va=function(e){return document.createElement(e)},wa=function(){return T||U()?0:E()},ya=function(e){function i(e,t){_||(_=1,y.onerror=n,clearTimeout(w),e||!t||C(t),setTimeout(function(){e&&x();var t=Q(b),n=t&&t.parentNode;n&&n.removeChild(t)},z))}if(T||U()){e:{var r,o,a=function(){if(!l){l=1,clearTimeout(u);try{o=JSON.parse(r.responseText)}catch(e){return m(1)}s=1,p(o)}},s=0,l=0,c=e.timeout||1e4,u=setTimeout(function(){m(1)},c),d=e.b||t(),h=e.data||{},p=e.c||t(),f="undefined"==typeof e.g,m=function(e){s||(s=1,clearTimeout(u),r&&(r.onerror=r.onload=n,r.abort&&r.abort(),r=n),e&&d())};try{r=U()||window.XDomainRequest&&new XDomainRequest||new XMLHttpRequest,r.onerror=r.onabort=function(){m(1)},r.onload=r.onloadend=a,f&&(r.timeout=c),h.pnsdk=xa;var g=ka(e.url,h);r.open("GET",g,f),r.send()}catch(v){m(0),T=0,e=ya(e);break e}e=m}return e}var y=va("script"),a=e.a,b=E(),_=0,w=setTimeout(function(){i(1)},e.timeout||1e4),x=e.b||t(),c=e.data||{},C=e.c||t();return window[a]=function(e){i(0,e)},e.g||(y[za]=za),y.onerror=function(){i(1)},c.pnsdk=xa,y.src=ka(e.url,c),S(y,"id",b),sa().appendChild(y),i},Aa=function(){return"onLine"in navigator?navigator.onLine:1},U=function(){if(!Ba||!Ba.get)return 0;var e={id:U.id++,send:t(),abort:function(){e.id={}},open:function(t,n){U[e.id]=e,Ba.get(e.id,n)}};return e},za="async",xa="PubNub-JS-Web/3.5.3",T=-1==navigator.userAgent.indexOf("MSIE 6");window.console||(window.console=window.console||{}),console.log||(console.log=console.error=(window.opera||{}).postError||t());var Ca,V=window.localStorage;Ca={get:function(e){try{return V?V.getItem(e):-1==document.cookie.indexOf(e)?n:((document.cookie||"").match(RegExp(e+"=([^;]+)"))||[])[1]||n}catch(t){}},set:function(e,t){try{if(V)return V.setItem(e,t)&&0;document.cookie=e+"="+t+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(n){}}};var W={list:{},unbind:function(e){W.list[e]=[]},bind:function(e,t){(W.list[e]=W.list[e]||[]).push(t)},fire:function(e,t){M(W.list[e]||[],function(e){e(t)})}},Z=Q("pubnub")||0,Da=function(e){function i(){}function r(e){A&&A(e),A=n}function o(){q.time(function(e){e||r(1),setTimeout(o,p)})}function a(){B()||r(1),setTimeout(a,z)}function s(e){var n=0;return M(oa(L),function(i){(i=L[i])&&(n++,(e||t())(i))}),n}function l(e){e&&(C.h=0),!C.h&&C.length&&(C.h=1,O(C.shift()))}e.jsonp&&(T=0);var c=e.subscribe_key||"";e.uuid||Ca.get(c+"uuid"),e.xdr=ya,e.db=Ca,e.error=qa,e._is_online=Aa,e.jsonp_cb=wa;var u,d=+e.windowing||10,h=(+e.timeout||310)*z,p=(+e.keepalive||60)*z,f=e.publish_key||"",m=e.subscribe_key||"",g=e.auth_key||"",y=e.ssl?"s":"",b="http"+y+"://"+(e.origin||"pubsub.pubnub.com"),_=I(b),x=I(b),C=[],$=0,k=0,A=0,D=0,F=0,L={},O=e.xdr,U=e.error||t(),B=e._is_online||function(){return 1},j=e.jsonp_cb||function(){return 0},H=e.db||{get:t(),set:t()},V=e.uuid||H&&H.get(m+"uuid")||"",q={LEAVE:function(e,t){var n={uuid:V,auth:g},i=I(b),r=j();e.indexOf(w)>0||("0"!=r&&(n.callback=r),O({g:t||y,timeout:2e3,a:r,data:n,url:[i,"v2","presence","sub_key",m,"channel",N(e),"leave"]}))},history:function(e,n){var n=e.callback||n,i=e.count||e.limit||100,r=e.reverse||"false",o=e.error||t(),a=e.channel,s=e.start,l=e.end,c={},u=j();return a?n?m?(c.stringtoken="true",c.count=i,c.reverse=r,c.auth=g,u&&(c.callback=u),s&&(c.start=s),l&&(c.end=l),O({a:u,data:c,c:function(e){n(e)},b:o,url:[_,"v2","history","sub-key",m,"channel",N(a)]}),void 0):U("Missing Subscribe Key"):U("Missing Callback"):U("Missing Channel")},replay:function(e){var n=n||e.callback||t(),i=e.source,r=e.destination,o=e.stop,a=e.start,s=e.end,l=e.reverse,e=e.limit,c=j(),u={};return i?r?f?m?("0"!=c&&(u.callback=c),o&&(u.stop="all"),l&&(u.reverse="true"),a&&(u.start=a),s&&(u.end=s),e&&(u.count=e),u.auth=g,O({a:c,c:function(e){n(e)},b:function(){n([0,"Disconnected"])},url:[_,"v1","replay",f,m,i,r],data:u}),void 0):U("Missing Subscribe Key"):U("Missing Publish Key"):U("Missing Destination Channel"):U("Missing Source Channel")},auth:function(e){g=e,i()},time:function(e){var t=j();O({a:t,data:{uuid:V,auth:g},timeout:5*z,url:[_,"time",t],c:function(t){e(t[0])},b:function(){e(0)}})},publish:function(e,n){var n=n||e.callback||t(),i=e.message,r=e.channel,o=j();return i?r?f?m?(i=JSON.stringify(i),r=[_,"publish",f,m,0,N(r),o,N(i)],C.push({a:o,timeout:5*z,url:r,data:{uuid:V,auth:g},c:function(e){n(e),l(1)},b:function(){n([0,"Failed",i]),l(1)}}),l(),void 0):U("Missing Subscribe Key"):U("Missing Publish Key"):U("Missing Channel"):U("Missing Message")},unsubscribe:function(e){e=e.channel,F=0,D=1,e=P((e.join?e.join(","):""+e).split(","),function(e){return e+","+e+w}).join(","),M(e.split(","),function(e){v&&q.LEAVE(e,0),L[e]=0}),i()},subscribe:function(e,o){function a(e){e?setTimeout(i,z):(_=I(b,1),x=I(b,1),setTimeout(function(){q.time(a)},z)),s(function(t){return e&&t.d?(t.d=0,t.m(t.name)):(!e&&!t.d&&(t.d=1,t.l(t.name)),void 0)})}function l(){var e=j(),t=oa(L).join(",");t&&(r(),A=O({timeout:R,a:e,b:function(){A=n,q.time(a)},data:{uuid:V,auth:g},url:[x,"subscribe",m,N(t),e,F],c:function(e){if(A=n,!e||"object"==typeof e&&"error"in e&&!e.error)return y(e),setTimeout(i,B);F=!F&&D&&H.get(m)||e[1],s(function(e){e.f||(e.f=1,e.k(e.name))}),E&&(F=1e4,E=0),H.set(m,e[1]);var t,r=(e.length>2?e[2]:P(L,function(t){return P(Array(e[0].length).join(",").split(","),function(){return t})}).join(",")).split(",");t=function(){var e=r.shift()||k;return[(L[e]||{}).a||$,e.split(w)[0]]},M(e[0],function(n){var i=t();i[0](n,e,i[1])}),setTimeout(l,B)}}))}var c=e.channel,o=(o=o||e.callback)||e.message,u=e.connect||t(),p=e.reconnect||t(),f=e.disconnect||t(),y=e.error||t(),S=e.presence||0,C=e.noheresync||0,E=e.backfill||0,T=e.timetoken||0,R=e.timeout||h,B=e.windowing||d;return D=e.restore,F=T,c?o?m?(M((c.join?c.join(","):""+c).split(","),function(e){var t=L[e]||{};L[k=e]={name:e,f:t.f,d:t.d,j:1,a:$=o,k:u,l:f,m:p},S&&(q.subscribe({channel:e+w,callback:S}),!t.j&&!C&&q.here_now({channel:e,callback:function(t){M("uuids"in t?t.uuids:[],function(n){S({action:"join",uuid:n,timestamp:G(),occupancy:t.occupancy||1},t,e)})}}))}),i=function(){r(),setTimeout(l,B)},v?(i(),void 0):ba.push(i)):U("Missing Subscribe Key"):U("Missing Callback"):U("Missing Channel")},here_now:function(e,n){var n=e.callback||n,i=e.error||t(),r=e.channel,o=j(),a={uuid:V,auth:g};return r?n?m?("0"!=o&&(a.callback=o),O({a:o,data:a,c:function(e){n(e,r)},b:i,url:[_,"v2","presence","sub_key",m,"channel",N(r)]}),void 0):U("Missing Subscribe Key"):U("Missing Callback"):U("Missing Channel")},xdr:O,ready:pa,db:H,uuid:ja,map:P,each:M,"each-channel":s,grep:ma,offline:function(){r(1)},supplant:na,now:G,unique:E,updater:la};return V||(V=q.uuid()),H.set(m+"uuid",V),setTimeout(a,z),setTimeout(o,p),q.time(t()),u=q,u.css=ua,u.$=Q,u.create=va,u.bind=R,u.head=sa,u.search=ra,u.attr=S,u.events=W,u.init=Da,R("beforeunload",window,function(){return u["each-channel"](function(e){u.LEAVE(e.name,0)}),!0}),e.notest?u:(R("offline",window,u.offline),R("offline",document,u.offline),u)};R("load",window,function(){setTimeout(pa,0)});var $=Z||{};PUBNUB=Da({notest:1,publish_key:S($,"pub-key"),subscribe_key:S($,"sub-key"),ssl:!document.location.href.indexOf("https")||"on"==S($,"ssl"),origin:S($,"origin"),uuid:S($,"uuid")}),window.jQuery&&(window.jQuery.PUBNUB=PUBNUB),"undefined"!=typeof module&&(module.exports=PUBNUB)&&pa();var Ba=Q("pubnubs")||0;Z&&(ua(Z,{position:"absolute",top:-z}),("opera"in window||S(Z,"flash"))&&(Z.innerHTML="<object id=pubnubs data=https://pubnub.a.ssl.fastly.net/pubnub.swf><param name=movie value=https://pubnub.a.ssl.fastly.net/pubnub.swf><param name=allowscriptaccess value=always></object>"),PUBNUB.rdx=function(e,t){return t?(U[e].responseText=unescape(t),U[e].onload(),void 0):U[e].onerror()},U.id=z)}var Ea=PUBNUB.ws=function(e,n){if(!(this instanceof Ea))return new Ea(e,n);var i=this,e=i.url=e||"";i.protocol=n||"Sec-WebSocket-Protocol";var o=e.split("/"),o={ssl:"wss:"===o[0],origin:o[2],publish_key:o[3],subscribe_key:o[4],channel:o[5]};return i.CONNECTING=0,i.OPEN=1,i.CLOSING=2,i.CLOSED=3,i.CLOSE_NORMAL=1e3,i.CLOSE_GOING_AWAY=1001,i.CLOSE_PROTOCOL_ERROR=1002,i.CLOSE_UNSUPPORTED=1003,i.CLOSE_TOO_LARGE=1004,i.CLOSE_NO_STATUS=1005,i.CLOSE_ABNORMAL=1006,i.onclose=i.onerror=i.onmessage=i.onopen=i.onsend=t(),i.binaryType="",i.extensions="",i.bufferedAmount=0,i.trasnmitting=r,i.buffer=[],i.readyState=i.CONNECTING,e?(i.e=PUBNUB.init(o),i.e.i=o,i.i=o,i.e.subscribe({restore:r,channel:o.channel,disconnect:i.onerror,reconnect:i.onopen,error:function(){i.onclose({code:i.CLOSE_ABNORMAL,reason:"Missing URL",wasClean:r})},callback:function(e){i.onmessage({data:e})},connect:function(){i.readyState=i.OPEN,i.onopen()}}),void 0):(i.readyState=i.CLOSED,i.onclose({code:i.CLOSE_ABNORMAL,reason:"Missing URL",wasClean:!0}),i)};Ea.prototype.send=function(e){var t=this;t.e.publish({channel:t.e.i.channel,message:e,callback:function(e){t.onsend({data:e})}})}}(),function(t,n,i,r){var o="gc_pusher",a=function(){function n(t){var n=null;if(Grabcad.configuration.pubnub_state&&(n=Grabcad.configuration.pubnub_state.bindings),n&&(e=t.event_type,p=t.payload,n[e]!==r))for(var i=n[e].slice(0),o=0;i.length>o;o++)i[o](p)}this.name=o;var a=this,s=null,l=function(){if(Grabcad.configuration.pubnub_state===r){if(Grabcad.configuration.pubnub_options!==r&&Grabcad.configuration.pubnub_options.enabled){if(t.angular!==r){var e=angular.element(i(".teams")).scope(),o={id:e.project.member.id,name:escape(e.project.member.name),avatar:escape(e.project.member.avatar)},a=escape(JSON.stringify(o));Grabcad.configuration.configure({pubnub_init_params:{subscribe_key:Grabcad.configuration.pubnub_options.subscribe_key,ssl:Grabcad.configuration.pubnub_options.use_ssl,uuid:a}})}else Grabcad.configuration.configure({pubnub_init_params:{subscribe_key:Grabcad.configuration.pubnub_options.subscribe_key,ssl:Grabcad.configuration.pubnub_options.use_ssl}});s=PUBNUB.init(Grabcad.configuration.pubnub_init_params),Grabcad.configuration.configure({pubnub_state:{connection:s}}),s.subscribe({channel:Grabcad.configuration.pubnub_options.channel_name,message:n,connect:function(){}}),Grabcad.configuration.pubnub_state.bindings===r&&(Grabcad.configuration.pubnub_state.bindings={})}}else s=Grabcad.configuration.pubnub_state?Grabcad.configuration.pubnub_state.connection:null};a.methods={bind:function(e,t){var n=null;Grabcad.configuration.pubnub_state&&(n=Grabcad.configuration.pubnub_state.bindings),n&&(n[e]===r&&(n[e]=[]),-1==n[e].indexOf(t)&&n[e].push(t))},unbind:function(e,t){var n=null;Grabcad.configuration.pubnub_state&&(n=Grabcad.configuration.pubnub_state.bindings),n&&n[e]&&(-1!=n[e].indexOf(t)?n[e].splice(n[e].indexOf(t),1):t==r&&(n[e]=[]))},enabled:function(){return null!==s}},l()};i.fn[o]=function(e){var t,n=arguments;return this.each(function(){var s=i(this),l=s.data(o);if(l||(l=new a(i(this),e)),s.data(o,l),l.methods[e]){var c=l.methods[e].apply(this,Array.prototype.slice.call(n,1));t===r&&c!==r&&(t=c),t=t||c}else"object"!=typeof e&&e?i.error("Method "+e+" does not exist on "+o):i.extend(l.settings,e)}),t!==r?t:this}}(window,document,jQuery),/*
 * Javascript EXIF Reader - jQuery plugin 0.1.3
 * Copyright (c) 2008 Jacob Seidelin, cupboy@gmail.com, http://blog.nihilogic.dk/
 * Licensed under the MPL License [http://www.nihilogic.dk/licenses/mpl-license.txt]
 */
function(){var e=function(e){var t=new Uint8Array(e);this.getByteAt=function(e){return t[e]},this.getLength=function(){return t.length},this.getSByteAt=function(e){var t=this.getByteAt(e);return t>127?t-256:t},this.getShortAt=function(e,t){var n=t?(this.getByteAt(e)<<8)+this.getByteAt(e+1):(this.getByteAt(e+1)<<8)+this.getByteAt(e);return 0>n&&(n+=65536),n},this.getSShortAt=function(e,t){var n=this.getShortAt(e,t);return n>32767?n-65536:n},this.getLongAt=function(e,t){var n=this.getByteAt(e),i=this.getByteAt(e+1),r=this.getByteAt(e+2),o=this.getByteAt(e+3),a=t?(((n<<8)+i<<8)+r<<8)+o:(((o<<8)+r<<8)+i<<8)+n;return 0>a&&(a+=4294967296),a},this.getSLongAt=function(e,t){var n=this.getLongAt(e,t);return n>2147483647?n-4294967296:n},this.getStringAt=function(e,t){for(var n=[],i=e,r=0;e+t>i;i++,r++)n[r]=String.fromCharCode(this.getByteAt(i));return n.join("")},this.getCharAt=function(e){return String.fromCharCode(this.getByteAt(e))}},t=function(e,t,n){var i=e,r=t||0,o=0;this.getRawData=function(){return i},"string"==typeof e?(o=n||i.length,this.getByteAt=function(e){return 255&i.charCodeAt(e+r)}):"unknown"==typeof e&&(o=n||IEBinary_getLength(i),this.getByteAt=function(e){return IEBinary_getByteAt(i,e+r)}),this.getLength=function(){return o},this.getSByteAt=function(e){var t=this.getByteAt(e);return t>127?t-256:t},this.getShortAt=function(e,t){var n=t?(this.getByteAt(e)<<8)+this.getByteAt(e+1):(this.getByteAt(e+1)<<8)+this.getByteAt(e);return 0>n&&(n+=65536),n},this.getSShortAt=function(e,t){var n=this.getShortAt(e,t);return n>32767?n-65536:n},this.getLongAt=function(e,t){var n=this.getByteAt(e),i=this.getByteAt(e+1),r=this.getByteAt(e+2),o=this.getByteAt(e+3),a=t?(((n<<8)+i<<8)+r<<8)+o:(((o<<8)+r<<8)+i<<8)+n;return 0>a&&(a+=4294967296),a},this.getSLongAt=function(e,t){var n=this.getLongAt(e,t);return n>2147483647?n-4294967296:n},this.getStringAt=function(e,t){for(var n=[],i=e,r=0;e+t>i;i++,r++)n[r]=String.fromCharCode(this.getByteAt(i));return n.join("")},this.getCharAt=function(e){return String.fromCharCode(this.getByteAt(e))},this.toBase64=function(){return window.btoa(i)},this.fromBase64=function(e){i=window.atob(e)}},n=function(){function e(){var e=null;return window.XMLHttpRequest?e=new XMLHttpRequest:window.ActiveXObject&&(e=new ActiveXObject("Microsoft.XMLHTTP")),e}function n(t,n,i){var r=e();r?(n&&("undefined"!=typeof r.onload?r.onload=function(){"200"==r.status?n(this):i&&i(),r=null}:r.onreadystatechange=function(){4==r.readyState&&("200"==r.status?n(this):i&&i(),r=null)}),r.open("HEAD",t,!0),r.send(null)):i&&i()}function i(n,i,r,o,a,s){var l=e();if(l){var c=0;o&&!a&&(c=o[0]);var u=0;o&&(u=o[1]-o[0]+1),i&&("undefined"!=typeof l.onload?l.onload=function(){"200"==l.status||"206"==l.status||"0"==l.status?(this.binaryResponse=new t(this.responseText,c,u),this.fileSize=s||this.getResponseHeader("Content-Length"),i(this)):r&&r(),l=null}:l.onreadystatechange=function(){4==l.readyState&&("200"==l.status||"206"==l.status||"0"==l.status?(this.binaryResponse=new t(l.responseBody,c,u),this.fileSize=s||this.getResponseHeader("Content-Length"),i(this)):r&&r(),l=null)}),l.open("GET",n,!0),l.overrideMimeType&&l.overrideMimeType("text/plain; charset=x-user-defined"),o&&a&&l.setRequestHeader("Range","bytes="+o[0]+"-"+o[1]),l.setRequestHeader("If-Modified-Since","Sat, 1 Jan 1970 00:00:00 GMT"),l.send(null)}else r&&r()}return function(e,t,r,o){o?n(e,function(n){var a,s,l=parseInt(n.getResponseHeader("Content-Length"),10),c=n.getResponseHeader("Accept-Ranges");a=o[0],0>o[0]&&(a+=l),s=a+o[1]-1,i(e,t,r,[a,s],"bytes"==c,l)}):i(e,t,r)}}();document.write("<script type='text/vbscript'>\r\nFunction IEBinary_getByteAt(strBinary, iOffset)\r\n	IEBinary_getByteAt = AscB(MidB(strBinary,iOffset+1,1))\r\nEnd Function\r\nFunction IEBinary_getLength(strBinary)\r\n	IEBinary_getLength = LenB(strBinary)\r\nEnd Function\r\n</script>\r\n");var i={};(function(){function t(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)}function r(e){return!!e.exifdata}function o(e,t){n(e.src,function(n){var i=a(n.binaryResponse);e.exifdata=i||{},t&&t()})}function a(e){if(255!=e.getByteAt(0)||216!=e.getByteAt(1))return!1;for(var t=2,n=e.getLength();n>t;){if(255!=e.getByteAt(t))return d&&console.log("Not a valid marker at offset "+t+", found: "+e.getByteAt(t)),!1;var i=e.getByteAt(t+1);if(22400==i)return d&&console.log("Found 0xFFE1 marker"),c(e,t+4,e.getShortAt(t+2,!0)-2);if(225==i)return d&&console.log("Found 0xFFE1 marker"),c(e,t+4,e.getShortAt(t+2,!0)-2);t+=2+e.getShortAt(t+2,!0)}}function s(e,t,n,i,r){for(var o=e.getShortAt(n,r),a={},s=0;o>s;s++){var c=n+12*s+2,u=i[e.getShortAt(c,r)];!u&&d&&console.log("Unknown tag: "+e.getShortAt(c,r)),a[u]=l(e,c,t,n,r)}return a}function l(e,t,n,i,r){var o=e.getShortAt(t+2,r),a=e.getLongAt(t+4,r),s=e.getLongAt(t+8,r)+n;switch(o){case 1:case 7:if(1==a)return e.getByteAt(t+8,r);for(var l=a>4?s:t+8,c=[],u=0;a>u;u++)c[u]=e.getByteAt(l+u);return c;case 2:var d=a>4?s:t+8;return e.getStringAt(d,a-1);case 3:if(1==a)return e.getShortAt(t+8,r);for(var l=a>2?s:t+8,c=[],u=0;a>u;u++)c[u]=e.getShortAt(l+2*u,r);return c;case 4:if(1==a)return e.getLongAt(t+8,r);for(var c=[],u=0;a>u;u++)c[u]=e.getLongAt(s+4*u,r);return c;case 5:if(1==a)return e.getLongAt(s,r)/e.getLongAt(s+4,r);for(var c=[],u=0;a>u;u++)c[u]=e.getLongAt(s+8*u,r)/e.getLongAt(s+4+8*u,r);return c;case 9:if(1==a)return e.getSLongAt(t+8,r);for(var c=[],u=0;a>u;u++)c[u]=e.getSLongAt(s+4*u,r);return c;case 10:if(1==a)return e.getSLongAt(s,r)/e.getSLongAt(s+4,r);for(var c=[],u=0;a>u;u++)c[u]=e.getSLongAt(s+8*u,r)/e.getSLongAt(s+4+8*u,r);return c}}function c(e,t){if("Exif"!=e.getStringAt(t,4))return d&&console.log("Not valid EXIF data! "+e.getStringAt(t,4)),!1;var n,r=t+6;if(18761==e.getShortAt(r))n=!1;else{if(19789!=e.getShortAt(r))return d&&console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)"),!1;n=!0}if(42!=e.getShortAt(r+2,n))return d&&console.log("Not valid TIFF data! (no 0x002A)"),!1;if(8!=e.getLongAt(r+4,n))return d&&console.log("Not valid TIFF data! (First offset not 8)",e.getShortAt(r+4,n)),!1;var o=s(e,r,r+8,i.TiffTags,n);if(o.ExifIFDPointer){var a=s(e,r,r+o.ExifIFDPointer,i.Tags,n);for(var l in a){switch(l){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":a[l]=i.StringValues[l][a[l]];break;case"ExifVersion":case"FlashpixVersion":a[l]=String.fromCharCode(a[l][0],a[l][1],a[l][2],a[l][3]);break;case"ComponentsConfiguration":a[l]=i.StringValues.Components[a[l][0]]+i.StringValues.Components[a[l][1]]+i.StringValues.Components[a[l][2]]+i.StringValues.Components[a[l][3]]}o[l]=a[l]}}if(o.GPSInfoIFDPointer){var c=s(e,r,r+o.GPSInfoIFDPointer,i.GPSTags,n);for(var l in c){switch(l){case"GPSVersionID":c[l]=c[l][0]+"."+c[l][1]+"."+c[l][2]+"."+c[l][3]}o[l]=c[l]}}return o}function u(){for(var e=document.getElementsByTagName("img"),n=0;e.length>n;n++)"true"==e[n].getAttribute("exif")&&(e[n].complete?i.getData(e[n]):t(e[n],"load",function(){i.getData(this)}))}var d=!1;i.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},i.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},i.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},i.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}},i.getData=function(e,t){return e.complete?(r(e)?t&&t():o(e,t),!0):!1},i.getTag=function(e,t){return r(e)?e.exifdata[t]:void 0},i.getAllTags=function(e){if(!r(e))return{};var t=e.exifdata,n={};for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);return n},i.pretty=function(e){if(!r(e))return"";var t=e.exifdata,n="";for(var i in t)t.hasOwnProperty(i)&&(n+="object"==typeof t[i]?i+" : ["+t[i].length+" values]\r\n":i+" : "+t[i]+"\r\n");return n},i.readFromBinaryFile=function(e){return a(e)},jQuery(document).ready(u),jQuery.fn.exifFromBlob=function(t,n){var i=new FileReader;i.readAsArrayBuffer(t),i.onload=function(){n(a(new e(i.result)))}},jQuery.fn.exifLoad=function(e){return this.each(function(){i.getData(this,e)})},jQuery.fn.exif=function(e){var t=[];return this.each(function(){t.push(i.getTag(this,e))}),t},jQuery.fn.exifAll=function(){var e=[];return this.each(function(){e.push(i.getAllTags(this))}),e},jQuery.fn.exifPretty=function(){var e=[];return this.each(function(){e.push(i.pretty(this))}),e}})()}(),function(){"use strict";function e(e){this.parentId=e,this._onMouseDown=this._onMouseDown.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onMouseClick=this._onMouseClick.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseOver=this._onMouseOver.bind(this),this._id=0}function t(e,t){window.setTimeout(e.bind(t),100)}Math.pow(10,-3),Math.pow(10,-2);var n=1,i={EXPORT_THUMBNAIL_SIZE:200,MIN_WIDTH:5,MIN_HEIGHT:5,MIN_FONT_SIZE:12,LINE:{ATTRIBUTES:{stroke:"rgb(255, 0, 0)","stroke-width":4,opacity:.85},DRAGGING:{"stroke-width":5,opacity:.35}},SHAPE:{ATTRIBUTES:{fill:"rgb(255, 255, 255)","fill-opacity":0,stroke:"rgb(255, 0, 0)","stroke-width":4,opacity:.85},DRAGGING:{"stroke-width":2,opacity:.35}},TEXT:{ATTRIBUTES:{fill:"rgb(255, 0, 0)",opacity:.85,"font-family":"sans-serif","font-size":19},DRAGGING:{opacity:.35},PLACEHOLDER:"§"},ARROW:{SRC:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAyAAAAFECAYAAADfiloNAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8AAgAC3q3JsQAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wKERQxAjhBM50AAAuSSURBVHja7d3dbiM3DIBR2u77v/GOe1P1B8i6sUNxJM4519tioaaAPpCaRAAA8Lbn/f583u9PJwHvuTsCAICfhYhTgO+7OQIAgJzwuB2HuxX8DxMQAICJUQIIEAAAEQICBABAhEB39hQBACZGhnch8F8mIAAAC4QKCBAAAEQIJDMSBAAojAorWVydCQgAwAbhAgIEAAARAgIEAECEwKrsIAIAnBwQ3oVwJSYgAACNYgYECAAAIgT+YtwHALBYMFjJojMTEACAC8UNCBAAAEQIAgQAABEC2ewXAgBsEAfehdCFCQgAgOABAQIAgAhBgAAA8K5fv0QICBAAgH0jRIggQAAAKIuQESIOFQECAMDrCLGShQABAKA8RBIjRIggQAAAKIuQESIOFQECAIAIAQECALBQhHgXggABAKA8RBIjRIggQAAAKIuQESIOFQECAIAIQYAAALBQhHgXggABAKA8RBIjRIggQAAAKIuQESIOFQECAMDrCLGShQABAKA8RBIjRIggQAAAKIuQESIOFQECAIAIQYAAALBQhHgXggABAKA8RBIjRIggQAAAKIuQESIOFQECAIAIYWs3RwAAMPlynhwG3/J45F4aj8O9kRQmIAAAHZmGIEAAABAhCBAAAHpHiE/1IkAAACgPkcQIESIIEAAAyiJkhIhDRYAAACBCECAAACwUId6FIEAAACgPkcQIESIIEAAAyiJkhIhDRYAAAPA6QqxkIUAAACgPkcQIESIIEAAAyiJkhIhDRYAAACBCECAAACwUId6FIEAAACgPkcQIESIIEAAAyiJkhIhDFSAAACBCmO7mCAAAJl+gky/vp3s8ci+kx+FOeiEmIAAAvMc0BAECAIAIQYAAANA7QnyqFwECAEB5iCRGiBARIAAAUBYhI0QcqgABAAARggABAGChCPEuBAECAEB5iCRGiBARIAAAUBYhI0QcqgABAIDXEWIlCwECAEB5iCRGiBARIAAAUBYhI0QcqgABAAARggABAGChCPEuRIAAAEB5iCRGiBARIAAAUBYhI0QcqgABAAARQkRE3BwBAMDkS27yBbu1xyP3snsc7ruLMQEBAGAdpiECBAAARAgCBACA3hHiU70CBAAAykMkMUKEiAABAICyCBkh4lAFCAAAiBABAgAAC0WIdyECBAAAykMkMUKEiAABAICyCBkh4lAFCAAAvI4QK1kCBAAAykMkMUKEiAABAICyCBkh4lAFCAAAiBABAgAAC0WIdyECBAAAykMkMUKEiAABAICyCBkh4lAFCAAAiJCN3BwBAMDki2jyJZgPPR65F+njcJf+gAkIAADXYBoiQAAAQIQIEAAA6B0hPtUrQAAAoDxEEiNEiAgQAAAoi5ARIg5VgAAAgAgRIAAAsFCEeBciQAAAoDxEEiNEiAgQAAAoi5ARIg5VgAAAwOsIsZIlQAAAoDxEEiNEiAgQAAAoi5ARIgIEAAAQIQIEAAAWihDvQgQIAACUh0hihFwtRAQIAACcGCEjRAQIAAAgQpLd/OQAAEy+LCZfVFnQ45F7ST+Otvd0ExAAAPgp0xABAgAAIkSAAABA7wjxqV4BAgAA5SGSGCGdQkSAAADA4hEyQkSAAAAAIkSAAADAQhHiXcjfblf71e8AAKdcQCHC7wsJExAAANg2RnccJggQAACojpALr2QJEAAAOCtEEiNklxARIAAA0CBCRogIEAAAF0wQIQIEAAAWipCLvAvxGV4AgJmXSnhX80/1moAAAIgPGv/srDZwECAAAOIDEVLGChYAgPBgZc1Wst4LEP9TAQCACPkBK1gAALC6RitZAgQAAHaJkAaf6hUgAACwW4gkRkh1iAgQAAC4cISMEBEgAABAuwgRIAAAsHOEbPYuRIAAAECHEEmMkJkhIkAAAECEfBkiAgQAAHgdIYuvZAkQAADoGCKJEZIZIgIEAABEyLdCRIAAAABbRYgAAQCA7hGy0LsQAQIAAFcJkcQI+TREBAgAAIiQj0NEgAAAAMtGyO2tfyD5LwsAAJzo8Uj9192O4/Z/f8YEBAAAruqEaYgAAQAAEVIWIQIEAABESNmnegUIAADwT4gkRshXISJAAACAKREyQkSAAAAAp0SIAAEAAL6OkAnvQgQIAADwOkQSI0SAAAAAZf5wBAAAwJcm/KZ0ExAAAKAkPiK8AQEAAIriI8IKFgAAMCk+/h0eAgQAAJgSHr+LjwgrWAAAQFF8RJiAAACA+CgIDwECAADCozQ+IqxgAQCA+CiKDwECAADioyw+IqxgAQCA+CgIDwECAADCozQ+IqxgAQCA+CiKDwECAADioyw+IqxgAQCA8CgIj8EEBAAAxEdJfAgQAAAQH2XxEWEFCwAAxEdBeAgQAAAQHqXxEWEFCwAAxEdRfAgQAAAQH2XxEWEFCwAALh0fVeEhQAAA4MLhcUZ8RFjBAgAA8VHo9rzfn/5rAgAk+PXLGbB8fJwVHgIEAECIcKHwWCE+IqxgAQAsf2nEz1GX+BAgAAAiBPFRygoWAMBM1rE4MT5WCo/BZ3gBAKBZeKwaHxFWsAAAtrpU4udk5/gQIAAAID5KWcECAADhUcYEBAAAxIcAAQAA8dErPiIibn4CAADe99avMvApXibEx27hMXgDAgAAG4XHzvERYQULAADEhwABAADx0S0+IqxgAQDA8vHRITwECAAALB4e3eIjwgoWAACIj0ImIAAAsFh8dAwPAQIAAIuFR/f4iLCCBQAA4kOAAACA+OjIChYAAJwYH1cJDwECAAAnhscV4yPCChYAAIgPAQIAAOKjIytYAAAgPMqYgAAAgPgQIAAAID76sYIFAACT4kN4CBAAAJgeHuLj96xgAQCA+BAgAAAgPvqxggUAgPgQHgIEAAB2CA/x8R4rWAAAiA/xUcYEBAAA8SE8BAgAAKwYHuLjZ6xgAQAgPsSHAAEAAPHRjxUsAADEh/AQIAAAcHZ4iI98VrAAABAf4kOAAACA+OjHChYAAOJDeAgQAACoDA/xUcMKFgAA4kN8lDEBAQDg0vEhPAQIAABMDw/xcQ4rWAAAiA8ECAAAiI9+rGABAHCZ+BAeAgQAAKaHh/hYhxUsAADEBwIEAADxIT76sYIFAIDwoIwJCAAA4gMBAgCA+BAf/VjBAgCgRXwIDwECAADTw0N87MUKFgAA4gMBAgCA+BAf/VjBAgBgu/gQHgIEAACmh4f42J8VLAAAxAdlTEAAAFg+PoSHAAEAgOnhIT76sYIFAID4QIAAACA+HGo/VrAAAFgqPoSHAAEAgOnhIT6uwQoWAADiAwECAID4oB8rWAAACA/KmIAAACA+ECAAAIgP+rGCBQBAWXwIDwQIAADTw0N8MFjBAgBAfCBAAAAQH/RjBQsAgCnxITwQIAAATA8P8cErVrAAAMSH+KCMCQgAgPgQHggQAAD2CA/xwTusYAEAiA/xgQABAEB80I8VLAAA8SE8ECAAAKwXHuKDn7KCBQAgPsQHAgQAAPFBP1awAACEh/CgjAkIAID4EB8IEAAAxAf9WMECABAfwgMBAgBAbXiIDypYwQIAEB/iAwECAID4oB8rWAAAF44P4YEAAQBgeniID85iBQsAQHxAGRMQAIALxYfwQIAAADA9PMQHq7CCBQAgPkCAAACID/FBP1awAACaxofwQIAAADA9PMQHK7OCBQAgPkCAAACID/FBP1awAACEB5QxAQEAEB8gQAAAxIf4oB8rWAAAG8aH8GBXfnABAD7wvN+fp13gxAcbs4IFALAR8YEAAQBAfMA3eQMCACA8oIwJCACA+AABAgAgPsQH/VjBAgAQHlDGBAQAQHyAAAEAEB8gQAAAEB/wMW9AAACEB5QxAQEAEB8gQAAAxAcIEAAAxAd8zBsQAADhAWVMQAAAxAcIEAAA8QH9WMECABAeUMYEBABAfIAAAQAQHyBAAAAQH/Axb0AAAIQHlDEBAQAQHyBAAADEB/TzJzfaUMLHqylRAAAAAElFTkSuQmCC"},IMAGE:{ATTRIBUTES:{opacity:.85},DRAGGING:{opacity:.35}},GRIP:{BOUNDS:{padding:-5,margin:3,r:5,stroke:"rgb(0, 0, 0)","stroke-width":1,"stroke-dasharray":"- "},BACK:{r:5,stroke:"none",fill:"rgb(255, 255, 255)","fill-opacity":"0.05"},RESIZER:{width:10,height:10,r:0,fill:"rgb(255, 255, 255)","fill-opacity":.85,stroke:"rgb(0, 0, 0)","stroke-width":1,ACTIVE:{r:10,fill:"rgb(255, 0, 0)"}},ROTATER:{rx:5,ry:5,fill:"rgb(255, 255, 255)","fill-opacity":.85,stroke:"rgb(0, 0, 0)","stroke-width":1,ACTIVE:{fill:"rgb(255, 0, 0)"}},PIVOT:{rx:5,ry:5,fill:"rgb(255, 255, 255)","fill-opacity":.5,stroke:"rgb(255, 255, 255)","stroke-opacity":.5,"stroke-width":1,ACTIVE:{fill:"rgb(255, 0, 0)"}},BRINT_TO_FRONT:{width:16,height:16,opacity:.9},SEND_TO_BACK:{width:16,height:16,opacity:.9},REMOVE:{width:16,height:16,opacity:1}}};e._cache=[],e.cacheImage=function(t,n){if(e._cache[t])return n instanceof Function&&n(e._cache[t],t),void 0;var i=document.createElement("img");i.src=t,i.onload=function(){e._cache[t]=i,n instanceof Function&&n(i,t)}},e.prototype={create:function(e){function n(e){e=e||window.event;var t=e.target||e.srcElement;return 8!=e.keyCode||/input|textarea/i.test(t.nodeName)?void 0:!1}var i=document.getElementById(this.parentId);i.setAttribute("buffering",""),i.setAttribute("tabindex","1"),i.style.outline="none",i.addEventListener("mousedown",this._onMouseDown,!1),i.addEventListener("mouseup",this._onMouseUp,!1),i.addEventListener("mousemove",this._onMouseMove,!1),i.addEventListener("click",this._onMouseClick,!1),i.addEventListener("mouseover",this._onMouseOver,!1),i.style.cursor="crosshair";var r=new Raphael(this.parentId,i.clientWidth,i.clientHeight);this.$parent=i,this.$paper=r,this.$tracker=this._buildTracker(this),this.$toolbars=this._buildUI(this),this.onDestroy=e,this._shapes=[],t(function(){i.removeAttribute("buffering")}),document.onkeydown=n,document.onkeypress=n},destroy:function(e){this._cleanupShapes(),this.$parent.style.cursor="default";var t=function(){this._unbindTrackerEvents instanceof Function&&this._unbindTrackerEvents(),this.$parent.removeEventListener("mousedown",this._onMouseDown,!1),this.$parent.removeEventListener("mouseup",this._onMouseUp,!1),this.$parent.removeEventListener("mousemove",this._onMouseMove,!1),this.$parent.removeEventListener("click",this._onMouseClick,!1),this.$parent.removeEventListener("mouseover",this._onMouseOver,!1),this.$parent.removeChild(this.$paper.canvas),this.$parent.removeChild(this.$toolbars.sketchToolbar),this.$parent.removeChild(this.$toolbars.controlToolbar),this.$toolbars=null,this.$sketchToolbar=null,this.$controlToolbar=null,this.$parent=null,this.$paper=null,this.onDestroy=null,this._shapes=null}.bind(this);return"cancel"===e?(this.onDestroy instanceof Function&&this.onDestroy(null),t()):(this.toThumbnailDataURL(function(e,n,i){this.onDestroy instanceof Function&&this.onDestroy({thumbnailData:e,imageData:i,json:this.toJSON()}),t()}.bind(this)),void 0)},setReadonly:function(e){e&&(this.$sketchToolbar.setAttribute("hidden",!0),this.$controlToolbar.$doneButton.set("hidden",!0),this.$parent.style.cursor="default",this.$paper.canvas.setAttribute("plain","true")),this._readonly=e},toArray:function(){return Array.prototype.slice.call(this.$paper.canvas.childNodes)},toSVG:function(){for(var e=this.$paper.bottom;null!==e;e=e.next)this.isIgnorable(e)&&e!==this._background&&e.hide();return this.$paper.toSVG()},toImageDataURL:function(){return"data:image/svg+xml;utf8,"+this.toSVG()},toImage:function(e){this.$tracker.hide();var n=document.createElement("canvas");t(function(){canvg(n,this.toSVG(),{ignoreMouse:!0,ignoreAnimation:!0,ignoreClear:!0,forceRedraw:!1,renderCallback:function(){e(n,n.toDataURL())}})}.bind(this))},toThumbnailDataURL:function(e){this.toThumbnail(function(t,n,i){e(t.toDataURL(),t,i,n)}.bind(this))},toThumbnail:function(e){this.toImage(function(t,n){var r=document.createElement("canvas"),o=this.$paper.width/this.$paper.height;r.width=i.EXPORT_THUMBNAIL_SIZE,r.height=r.width/o;var a=r.getContext("2d");a.drawImage(t,0,0,r.width,r.height),e(this._trimTransparentPixels(r),t,n)}.bind(this))},toJSON:function(){return this.$paper.toJSON(function(e,t){return this.isArrow(e)&&e.attr("src","arrow"),this.isIgnorable(e)?null:t}.bind(this))},fromJSON:function(e){var t=JSON.parse(e);this.$paper.fromJSON(t);for(var n=this.$paper.bottom;null!==n;n=n.next)if(!this.isIgnorable(n)){if(this.isArrow(n)&&n.attr("src",i.ARROW.SRC),this.isText(n)&&(n.node.querySelector("tspan").removeAttribute("dx"),n.node.querySelector("tspan").setAttribute("dy",i.MIN_FONT_SIZE)),this._background){var r=(this.$paper.width-this._background.node.width.baseVal.value)/2,o=(this.$paper.height-this._background.node.height.baseVal.value)/2;n.transform(n.attr("transform")+"T"+r+" "+o)}this._readonly||this._bindShape(n)}},background:function(e,t){var n=function(e){var t=window.parseInt((this.$paper.width-e.width)/2)+1,n=window.parseInt((this.$paper.height-e.height)/2)+1;return{width:e.width,height:e.height,offsetX:t,offsetY:n}}.bind(this);this._backgroundFromAttributes(e,n,t)},fitBackground:function(e,t){var n=function(e){var t=this.$paper.width/e.width,n=this.$paper.height/e.height,i=1,r=Math.min(t,n,i),o=e.width*r,a=e.height*r,s=window.parseInt((this.$paper.width-o)/2)+1,l=window.parseInt((this.$paper.height-a)/2)+1;return{width:o,height:a,offsetX:s,offsetY:l}}.bind(this);this._backgroundFromAttributes(e,n,t)},_backgroundFromAttributes:function(t,n,i){this._background&&this._background.remove(),e.cacheImage(t,function(e){if(this.$paper){var r=n(e);this._background=this.$paper.image(t,r.offsetX,r.offsetY,r.width,r.height),this._background.toBack().node.setAttribute("style","pointer-events: none"),i instanceof Function&&i()}}.bind(this))},createPath:function(){this._buildShape("path",["M"+this._mCurrentPos.join(" ")])},createRect:function(){this._buildShape("rect",this._mCurrentPos)},createEllipse:function(){this._buildShape("ellipse",this._mCurrentPos)},createLine:function(){this._buildShape("path",["M"+this._mCurrentPos.join(" ")],"line")},createText:function(){this._buildShape("text",this._mCurrentPos.concat(i.TEXT.PLACEHOLDER))},createArrow:function(){e.cacheImage(i.ARROW.SRC,function(e,t){this._buildShape("image",[t].concat(this._mCurrentPos),e.width/e.height)}.bind(this))},isText:function(e){return"text"===e.type},isArrow:function(e){return e.attrs&&("arrow"===e.attrs.src||e.attrs.src===i.ARROW.SRC)},isIgnorable:function(e){switch(e){case this._background:case this.$tracker.$bounds:case this.$tracker.$back:case this.$tracker.$resizeGrip:case this.$tracker.$rotateGrip:case this.$tracker.$pivot:case this.$tracker.$bringToFront:case this.$tracker.$sendToBack:case this.$tracker.$remove:return!0;default:return!1}},_storeShape:function(e){this._shapes.push(e)},_removeShape:function(e){e.remove(),this._shapes.splice(this._shapes.indexOf(e),1)},_cleanupShapes:function(){this._shapes.forEach(function(e){switch(e.type){case"text":0===e.attr("text").indexOf(i.TEXT.PLACEHOLDER)&&e.remove()}})},_buildShape:function(e,t,n){var r=this.$paper[e].apply(this.$paper,t);r._id=++this._id;var o=function(){this._storeShape(r),this._bindShape(r),r._selectShape()}.bind(this);switch(e){case"path":r.attr(i.LINE.ATTRIBUTES);break;case"rect":case"ellipse":r.attr(i.SHAPE.ATTRIBUTES);break;case"text":return r.attr(i.TEXT.ATTRIBUTES),r.hide(),o(),void 0;case"image":r.attr(i.IMAGE.ATTRIBUTES)}var a=function(){function i(){var e=s[0],t=s[1],n=l[0]-e,i=l[1]-t;return 0>n&&(e=l[0],n=Math.abs(n)),0>i&&(t=l[1],i=Math.abs(i)),[e,t,n,i]}function o(){return Math.sqrt(Math.pow(l[0]-s[0],2)+Math.pow(l[1]-s[1],2))}function a(){var e=l[0]-s[0],t=l[1]-s[1];return 180*Math.atan2(t,e)/Math.PI}var s=this._mDownPos,l=this._mCurrentPos;switch(e){case"path":"line"===n?r.attr({path:t+"L"+l[0]+" "+l[1]}):r.attr({path:r.attr("path")+"L"+l[0]+" "+l[1]});break;case"rect":var c=i();r.attr({x:c[0],y:c[1],width:c[2],height:c[3]});break;case"ellipse":var u=o();r.attr({rx:u,ry:u});break;case"image":var d=o(),h=a(),p=d,f=d/n;r.transform("R"+h+"t"+d/2+" 0"),r.attr({x:s[0]-p/2,y:s[1]-f/2,width:p,height:f})}}.bind(this),s=function(){this.$parent.removeEventListener("mousemove",a),this.$parent.removeEventListener("mouseup",s);var t,n;switch(e){case"path":var l=r.getBBox();t=l.width,n=l.height;break;case"rect":case"image":t=r.attr("width"),n=r.attr("height");break;case"ellipse":t=r.attr("rx"),n=r.attr("ry")}return i.MIN_WIDTH>t&&i.MIN_HEIGHT>n?(r.remove(),void 0):(o(),void 0)}.bind(this);this.$parent.addEventListener("mousemove",a,!1),this.$parent.addEventListener("mouseup",s,!1)},_bindShape:function(e){var t=e.type,n=function(){var t=this.$tracker.$bounds,n=this.$tracker.$back,r=this.$tracker.$resizeGrip,o=this.$tracker.$rotateGrip,a=this.$tracker.$pivot,s=this.$tracker.$bringToFront,l=this.$tracker.$sendToBack,c=this.$tracker.$remove,u=e.getBBox(!0),d=i.GRIP.BOUNDS.padding,h=i.GRIP.BOUNDS.margin,p=h+d,f=p+(i.GRIP.ROTATER.rx+i.GRIP.ROTATER.ry)/2;t.attr({x:u.x-h,y:u.y-h,width:u.width+2*h,height:u.height+2*h}),t.transform(e.matrix.toTransformString()),t.toFront(),n.attr({x:u.x-h,y:u.y-h,width:u.width+2*h,height:u.height+2*h}),n.transform(e.matrix.toTransformString()),r.attr({x:u.x2+p,y:u.y2+p}),r.transform(e.matrix.toTransformString()),r.toFront(),o.attr({cx:u.x+u.width/2,cy:u.y-f}),o.transform(e.matrix.toTransformString()),o.toFront(),a.attr({cx:u.x+u.width/2,cy:u.y+u.height/2}),a.transform(e.matrix.toTransformString()),a.toFront(),s.attr({x:u.x-i.GRIP.BRINT_TO_FRONT.width/2-h,y:u.y2-i.GRIP.BRINT_TO_FRONT.height/2+h}),s.transform(e.matrix.toTransformString()),s.toFront(),l.attr({x:u.x-i.GRIP.SEND_TO_BACK.width/2-h+24,y:u.y2-i.GRIP.SEND_TO_BACK.height/2+h}),l.transform(e.matrix.toTransformString()),l.toFront(),c.attr({x:u.x2-i.GRIP.REMOVE.width/2+h,y:u.y-i.GRIP.REMOVE.height/2-h}),c.transform(e.matrix.toTransformString()),c.toFront(),this.$tracker.show()}.bind(this),r=function(e,t){t.boundShape&&(t.boundShape.selected=!1),t.$bounds;var n=t.$back,i=t.$resizeGrip,o=t.$rotateGrip,a=t.$bringToFront,s=t.$sendToBack,l=t.$remove;n.undrag(),i.undrag(),o.undrag(),a._listener&&a.unclick(a._listener),s._listener&&s.unclick(s._listener),l._listener&&l.unmousedown(l._listener),e._listeners&&e.removeEventListener("keypress",e._listeners[0]),e._listeners&&e.removeEventListener("keyup",e._listeners[1]),this._unbindTrackerEvents=r}.bind(this,this.$parent,this.$tracker),o=function(n,i){r(),e.selected=!0,i.boundShape=e,i.$bounds;var o=i.$back,l=i.$resizeGrip,c=i.$rotateGrip,S=i.$bringToFront,x=i.$sendToBack,C=i.$remove;o._listeners=[b,v,y],l._listeners=[_,p,f],c._listeners=[w,m,g],S._listener=u,x._listener=d,C._listener=h,n._listeners=[a,s],o.drag.apply(o,o._listeners),l.drag.apply(l,l._listeners),c.drag.apply(c,c._listeners),C.mousedown.call(C,C._listener),S.click.call(S,S._listener),x.click.call(x,x._listener),"text"===t&&(n.addEventListener("keypress",n._listeners[0]),n.addEventListener("keyup",n._listeners[1]),n.focus())}.bind(this,this.$parent,this.$tracker),a=function(r){if(r.preventDefault(),r.stopPropagation(),"text"===t&&r.charCode){var o=String.fromCharCode(r.charCode),a=e.attr("text");0===a.indexOf(i.TEXT.PLACEHOLDER)&&(a=""),e.show(),e.attr({text:a+o}),n()}}.bind(this),s=function(r){if(r.preventDefault(),r.stopPropagation(),"text"===t&&r.keyCode){var o=r.keyCode,a=e.attr("text");switch(o){case 8:if(0===a.indexOf(i.TEXT.PLACEHOLDER))break;var s=a.slice(0,-1);s.length?e.attr({text:s}):(e.hide(),e.attr({text:i.TEXT.PLACEHOLDER}))}n()}}.bind(this),l=function(e){e instanceof Event&&(e.preventDefault(),e.stopPropagation()),null==this._activeTool&&c()}.bind(this),c=function(){n(),o()}.bind(this),u=function(t){t.preventDefault(),t.stopPropagation(),e.toFront();var n=this.toArray();this._shapes.sort(function(e,t){return n.indexOf(e.node)>n.indexOf(t.node)}),l(t)}.bind(this),d=function(t){t.preventDefault(),t.stopPropagation(),this._shapes.forEach(function(t){t._id!==e._id&&t.toFront()}),l(t)}.bind(this),h=function(t){t.preventDefault(),t.stopPropagation(),r(),this.$tracker.hide(),this._removeShape(e)}.bind(this),p=function(e,t,n){n.preventDefault(),n.stopPropagation();var r=this.$tracker.$resizeGrip;r.animate(i.GRIP.RESIZER.ACTIVE,500,">"),v()}.bind(this),f=function(){var e=this.$tracker.$resizeGrip;e.animate(i.GRIP.RESIZER,500,">"),y()}.bind(this),m=function(e,t,n){n.preventDefault(),n.stopPropagation();var r=this.$tracker.$rotateGrip;r.animate(i.GRIP.ROTATER.ACTIVE,500,">"),v()}.bind(this),g=function(){var e=this.$tracker.$rotateGrip;e.animate(i.GRIP.ROTATER,500,">"),y()}.bind(this),v=function(r,o,a){if(e.selected||null==this._activeTool){switch(a&&(a.cancelDrawing=!0),t){case"path":e.animate(i.LINE.DRAGGING,500,">");break;case"rect":case"ellipse":e.animate(i.SHAPE.DRAGGING,500,">");break;case"image":e.animate(i.IMAGE.DRAGGING,500,">");break;case"text":e.animate(i.TEXT.DRAGGING,500,">")}switch(t){case"path":e._originalPath=e.attr("path");break;case"text":e._startFontSize=e.attr("font-size");case"rect":case"image":e._startX=e.attr("x"),e._startY=e.attr("y"),e._startWidth=e.attr("width"),e._startHeight=e.attr("height");break;case"ellipse":e._startX=e.attr("cx"),e._startY=e.attr("cy"),e._startWidth=e.attr("rx"),e._startHeight=e.attr("ry")}e._originalMatrix=e.matrix.clone(),e._originalTransform=e.matrix.toTransformString(),e._orignialBounds=e.getBBox(),n()}}.bind(this),y=function(){if(e.selected||null==this._activeTool){switch(t){case"path":e.animate(i.LINE.ATTRIBUTES,500,">");break;case"rect":case"ellipse":e.animate(i.SHAPE.ATTRIBUTES,500,">");break;case"text":i.TEXT.ATTRIBUTES["font-size"]=e.attr("font-size"),e.animate(i.TEXT.ATTRIBUTES,500,">");break;case"image":e.animate(i.IMAGE.ATTRIBUTES,500,">")}n()}}.bind(this),b=function(i,r){if(e.selected||null==this._activeTool){var o=mat4.identity(mat4.create()),a=vec3.createFrom(i,r,0);switch(mat4.rotateZ(o,-e.matrix.split().rotate*(Math.PI/180)),mat4.multiplyVec3(o,a),t){case"path":var s=e._originalPath.map(function(e){return[e[0],e[1]+a[0],e[2]+a[1]]});e.attr({path:s});break;case"rect":case"text":case"image":e.attr({x:e._startX+a[0],y:e._startY+a[1]});break;case"ellipse":e.attr({cx:e._startX+a[0],cy:e._startY+a[1]})
}n()}}.bind(this),_=function(r,o){function a(e,t,n){return void 0!==t&&t>e?t:void 0!==n&&e>n?n:e}var s=mat4.identity(mat4.create()),l=vec3.createFrom(r,o,0);switch(mat4.rotateZ(s,-e.matrix.split().rotate*(Math.PI/180)),mat4.multiplyVec3(s,l),t){case"path":var c=e._originalPath.reduce(function(e,t){return["",Math.min(e[1],t[1]),Math.min(e[2],t[2])]}),u=e._orignialBounds,d=1+l[0]/u.width,h=1+l[1]/u.height,p=c[1],f=c[2],m=e._originalPath.map(function(e){return[e[0],(e[1]-p)*d+p,(e[2]-f)*h+f]});e.attr({path:m});break;case"rect":case"image":e.attr({width:a(e._startWidth+l[0],2*i.MIN_WIDTH),height:a(e._startHeight+l[1],2*i.MIN_HEIGHT)});break;case"ellipse":e.attr({rx:a(e._startWidth+l[0],i.MIN_WIDTH),ry:a(e._startHeight+l[1],i.MIN_HEIGHT)});break;case"text":var g=e._startFontSize,u=e._orignialBounds,d=1+l[0]/u.width,h=1+l[1]/u.height;e.attr({"font-size":a(g*(d+h)/2,i.MIN_FONT_SIZE)})}n()}.bind(this),w=function(){function i(){var e=o.x+o.width/2,t=o.y+o.height/2,n=r[0]-e,i=r[1]-t;return 180*Math.atan2(i,n)/Math.PI+90}var r=this._mCurrentPos,o=e._orignialBounds,a=e._originalMatrix,s=i(),l=a.split().rotate;switch(t){case"path":case"rect":case"ellipse":case"text":case"image":e.transform(e._originalTransform+"R"+(s-l))}n()}.bind(this);e._clickFunc=l,e._selectShape=c,e._dragFunc=[b,v,y],e.click.call(e,e._clickFunc),e.drag.apply(e,e._dragFunc)},_buildShapeFinished:function(){this._activeTool=null,this.$sketchToolbar.$cursor.uncheck(),this.$sketchToolbar.$draw.uncheck(),this.$sketchToolbar.$rect.uncheck(),this.$sketchToolbar.$ellipse.uncheck(),this.$sketchToolbar.$line.uncheck(),this.$sketchToolbar.$text.uncheck(),this.$sketchToolbar.$arrow.uncheck()},_selectTool:function(e){this.$sketchToolbar.$cursor.uncheck(),this.$sketchToolbar.$draw.uncheck(),this.$sketchToolbar.$rect.uncheck(),this.$sketchToolbar.$ellipse.uncheck(),this.$sketchToolbar.$line.uncheck(),this.$sketchToolbar.$text.uncheck(),this.$sketchToolbar.$arrow.uncheck(),this.$sketchToolbar["$"+e].check(),"cursor"===e?(e=null,this.$parent.style.cursor="default"):this.$parent.style.cursor="text"===e?"text":"crosshair",this._activeTool=e},_buildTracker:function(){var e=this.$paper.rect(0,0,1,1),t=this.$paper.rect(0,0,1,1),n=this.$paper.rect(0,0,1,1),r=this.$paper.ellipse(0,0,1,1),o=this.$paper.ellipse(0,0,1,1),a=this.$paper.image("../../../images/_/viewer/sketch_order_bring_to_front.png",0,0),s=this.$paper.image("../../../images/_/viewer/sketch_order_send_to_back.png",0,0),l=this.$paper.image("../../../images/_/viewer/sketch_delete.png",0,0);return e.attr(i.GRIP.BOUNDS).hide(),t.attr(i.GRIP.BACK).hide(),n.attr(i.GRIP.RESIZER).hide(),r.attr(i.GRIP.ROTATER).hide(),o.attr(i.GRIP.PIVOT).hide(),a.attr(i.GRIP.BRINT_TO_FRONT).hide(),s.attr(i.GRIP.SEND_TO_BACK).hide(),l.attr(i.GRIP.REMOVE).hide(),l.attr(),{hide:function(){e.hide(),t.hide(),n.hide(),r.hide(),o.hide(),a.hide(),s.hide(),l.hide()},show:function(){e.show(),t.show(),n.show(),r.show(),l.show()},$bounds:e,$back:t,$resizeGrip:n,$rotateGrip:r,$pivot:o,$bringToFront:a,$sendToBack:s,$remove:l,boundShape:void 0}},_buildUI:function(e){var t=document.createElement("div");t.className="sketch-toolbar";var n=document.createElement("div");n.className="control-toolbar";var i=new AnnotatorButton(t,"cursor");i.set("title","Select"),i.check(),i.addEventListener("click",function(){e._selectTool("cursor")});var r=new AnnotatorButton(t,"draw");r.set("title","Free draw"),r.addEventListener("click",function(){r.isChecked()?e._selectTool("cursor"):e._selectTool("draw")});var o=new AnnotatorButton(t,"rect");o.set("title","Create rectangle"),o.addEventListener("click",function(){o.isChecked()?e._selectTool("cursor"):e._selectTool("rect")});var a=new AnnotatorButton(t,"ellipse");a.set("title","Create ellipse"),a.addEventListener("click",function(){a.isChecked()?e._selectTool("cursor"):e._selectTool("ellipse")});var s=new AnnotatorButton(t,"line");s.set("title","Create line"),s.addEventListener("click",function(){s.isChecked()?e._selectTool("cursor"):e._selectTool("line")});var l=new AnnotatorButton(t,"text");l.set("title","Create text"),l.addEventListener("click",function(){l.isChecked()?e._selectTool("cursor"):e._selectTool("text")});var c=new AnnotatorButton(t,"arrow");c.set("title","Create arrow"),c.addEventListener("click",function(){c.isChecked()?e._selectTool("cursor"):e._selectTool("arrow")});var u=new AnnotatorButton(n,"done");u.set("value","Save"),u.set("ID","saveSketchButton"),u.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),e.destroy()});var d=new AnnotatorButton(n,"note-sketch-cancel");return d.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),e.destroy("cancel")}),this.$parent.appendChild(t),this.$parent.appendChild(n),this.$sketchToolbar=t,this.$sketchToolbar.$cursor=i,this.$sketchToolbar.$draw=r,this.$sketchToolbar.$rect=o,this.$sketchToolbar.$ellipse=a,this.$sketchToolbar.$line=s,this.$sketchToolbar.$text=l,this.$sketchToolbar.$arrow=c,this.$controlToolbar=n,this.$controlToolbar.$doneButton=u,this.$controlToolbar.$cancelButton=d,e._buildShapeFinished(),e._activeTool="draw",r.check(),{sketchToolbar:t,controlToolbar:n}},getMousePosition:function(e){var t=this.$parent;!t&&this._background&&(t=this._background);var n=t.getBoundingClientRect();return[e.clientX-n.left,e.clientY-n.top]},_onMouseDown:function(e){if(!this._readonly&&!e.cancelDrawing&&!this._readonly)switch(this._mDownPos=this.getMousePosition(e),this._mPressed=!0,this._activeTool){case"draw":this.createPath();break;case"rect":this.createRect();break;case"ellipse":this.createEllipse();break;case"line":this.createLine();break;case"text":this.createText();break;case"arrow":this.createArrow()}},_onMouseUp:function(){this._readonly||this._readonly||(this._mPressed=!1)},_onMouseClick:function(){this._readonly||this._readonly||this._mDownPos&&this._mUpPos&&n>Math.abs(this._mDownPos[0]-this._mUpPos[0])&&n>Math.abs(this._mDownPos[1]-this._mUpPos[1])&&"text"!=this._activeTool&&(this.$tracker.hide(),this.$tracker.boundShape&&(this.$tracker.boundShape.selected=!1),this.$tracker.boundShape=void 0)},_onMouseMove:function(e){this._readonly||this._readonly||(this._mCurrentPos=this.getMousePosition(e),this._mUpPos=this._mCurrentPos)},_onMouseOver:function(e){this.$parent.focus(),e.stopPropagation()},_getBoundingBox:function(e){var t=document.createElement("canvas"),n=t.getContext("2d"),i=e.width,r=e.height;n.width=i,n.height=r,n.drawImage(e,0,0,i,r);for(var o=n.getImageData(0,0,i,r).data,a=Number.MAX_VALUE,s=Number.MAX_VALUE,l=-1,c=-1,u=0;i>u;u++)for(var d=0;r>d;d++){var h=o[d*4*i+4*u+3];h&&(a>u&&(a=u),u>l&&(l=u),s>d&&(s=d),d>c&&(c=d))}var p=l-a,f=c-s;return{x:a,y:s,width:p,height:f}},_trimTransparentPixels:function(e){var t=this._getBoundingBox(e),n=document.createElement("canvas"),i=n.getContext("2d");return t.width,t.height,n.width=t.width,n.height=t.height,i.drawImage(e,-t.x,-t.y,e.width,e.height),n}},window.AnnotatorSketcher=e}(),function(){"use strict";function e(e,i,s,l,c,u,d,h,p,f){this.state=new t(this,s,c,null,u,d,h,p),this.view=new n(this,e,i,l,f,this.state.onFrame),this.toolbar=new o(this.state,this.view),this.trackball=new a(this.state,this.view),this.controller=new r(this.state,this.view),this.sketcher=new AnnotatorSketcher(e),this.idHelper=new AnnotatorIdHelper(this)}function t(e,t,n,i,r,o,a,s){this.annotator=e,this.user=null,this.type=bt.DEFAULT,this.__mode__=n||mt.DEFAULT,this.__stage__=i||_t.DEFAULT,this.isSketchMode=!1,this.dimColor="rgb(0,0,0)",this.dimColorParameters={r:0,g:0,b:0},this.backgroundStartColor=new Array(.99,.99,.99),this.backgroundEndColor=new Array(.88,.88,.88),this.showBackFaces=!1,this.initializedSVG=!1,t&&(this.svgAnchor=document.getElementById(t)),this.drop_pin_callback=r,this.save_sketch_callback=o,this.pin_activated_callback=a,this.pin_deactivated_callback=s,this.have_pending_pin=!1,this.sketchData=null,this.sketchThumbnail=null,this.sketchImageData=null,this.sketchBackgroundData=null,this.sketchIsReadOnly=!1,this.sketchThirdPartyData=null,this.sketchCommentId=null,this.sketchViewerState=null,this.unitPreference=null,this.radialMeasureType=0,this.distanceMeasureType=0,this.dontShowUpgradePopup=null,this.context=gt.COMMUNITY,this.reset(),this.bind()}function n(e,t,n,i,r,o){this.annotator=e,this.model=null,this.referenceModel=null,this.pendingState=null,this.pendingSketch=!1,this.parentId=t,this.hvfwCanvasId=n,this.hvfwSvgContainerId=i,this.$parent=null,this.$canvas=null,this.cameraSet=!1,this.drawingMode=!1,this.defaultCamera=null,this.currentOperator=new E(e),this.mouseEventsBlocked=!1,this.firstUpdate=!0,this.markupManager=new j(e),this.selectionManager=new AnnotatorSelectionManager(e),this.needsUpdate=!1,this.projectionMode=1,this.cuttingPlane=null,this.multiPassHelper=new AnnotatorMultiPassRenderingHelper(e),this.dropPinPopup=null,this.onResize=this.onResize.bind(this),this.loop=this.loop.bind(this,o),this.setup(r),this.loop()}function r(e,t){this.state=e,this.view=t,t.$canvas.addEventListener("mousemove",this.onMouseMove.bind(this),!0),t.$canvas.addEventListener("click",this.onMouseClick.bind(this),!0),t.$canvas.addEventListener("dblclick",this.onMouseDblClick.bind(this),!0),t.$canvas.addEventListener("mousedown",this.onMouseDown.bind(this),!0),t.$canvas.addEventListener("mouseup",this.onMouseUp.bind(this),!0),t.$canvas.addEventListener("mouseout",this.onMouseOut.bind(this),!0),this.referenceModelNode=null,Y()?t.$canvas.addEventListener("mousewheel",this.onMouseScroll.bind(this),!0):t.$canvas.addEventListener("DOMMouseScroll",this.onMouseScroll.bind(this),!0),this.assignedEventListeners=!1,this.clientW=this.view.$hvfwCanvas.clientWidth,this.clientH=this.view.$hvfwCanvas.clientHeight,this.firstSelectionRay=new O(0,0,0),this.secondSelectionRay=new O(0,0,0),this.viewMatrix=new Array(4),this.cameraMatrix=new Array(4),this.cameraViewMatrix=new Array(4),this.cameraViewMatrixInverse=new Array(4);for(var n=0;4>n;n++)this.viewMatrix[n]=new Array(4),this.cameraMatrix[n]=new Array(4),this.cameraViewMatrix[n]=new Array(4),this.cameraViewMatrixInverse[n]=new Array(4);this.worldClock=new D(e.annotator),this.utilities=new N(e,t)}function o(e,t){this.state=e,this.view=t,this.parentNode=t.$parent,this.width=0,this.height=0,this.div=document.createElement("div"),this.div.className="annotator-toolbar",this.createUI(this),this.show()}function a(e,t){this.state=e,this.view=t,this.parentNode=t.$parent,this.div=document.createElement("div"),this.div.className="annotator-trackball",this.createUI(this),this.show()}function s(e,t){this.annotator=e,this.modelTree=t,this.parentNode=e.view.$parent,this.scrollDiv=null,this.scrollContentDiv=null,this.scrollbarsInitialized=!0,this.treeCanFit=!0,this.listenForResizing=!1,this.treeWasResized=!1,this.treeWidth=0,this.treeHeight=0,this.treeMaxWidth=0,this.treeMaxHeight=0,this.treePadding=5,this.lastScrollNode=null,this.lastScrollWidth=null,this.blockHighlighting=!1,this.blockHighlightingInterval=-1,this.div=document.createElement("div"),this.div.className="annotator-modeltree",this.createUI()}function l(e,t,n,i,r,o){this.state=e,this.view=t,this.parentNode=t.$parent,this.pin=n,this.username=i,this.comments=[],this.isAttachedToViewer=o,this.div=document.createElement("div"),this.div.setAttribute("pin","true"),this.div.setAttribute("global-readonly",r),this.div.className=o?"annotator-note":"annotator-note attached-to-comment",this.div.setAttribute("tabindex",1),this.div.setAttribute("style","outline:none"),this.updateTimestamps=this.updateTimestamps.bind(this),this.createUI(this)}function c(e,t){this.state=e,this.view=t,this.parentNode=t.$parent,this.div=document.createElement("div"),this.div.setAttribute("measure","true"),this.div.className="annotator-note",this.createUI(this)}function u(e){this.annotator=e,this.parentNode=e.view.$parent,this.div=document.createElement("div"),this.div.setAttribute("cuttingplane","true"),this.div.className="annotator-popup",this.createUI(this)}function d(e){this.annotator=e,this.parentNode=e.view.$parent,this.div=document.createElement("div"),this.div.setAttribute("contextmenu","true"),this.div.className="annotator-popup",this.createUI(this)}function h(e){this.annotator=e,this.parentNode=e.view.$parent,this.div=document.createElement("div"),this.div.setAttribute("explodeassembly","true"),this.div.className="annotator-popup",this.createUI(this)}function p(e){this.annotator=e,this.parentNode=e.view.$parent,this.div=document.createElement("div"),this.div.setAttribute("measurement","true"),this.div.className="annotator-popup",this.activeMeasurement=$t.MEASURE_POINTS,this.uiWasCreated=!1,this.createUI(this)}function f(e){this.annotator=e,this.parentNode=e.view.$parent,this.div=document.createElement("div"),this.div.setAttribute("help","true"),this.div.className="annotator-popup",this.createUI(this)}function m(e){this.annotator=e,this.parentNode=e.view.$parent,this.div=document.createElement("div"),this.div.setAttribute("addpin","true"),this.div.className="annotator-popup",this.createUI(this)}function g(e,t){this.state=e,this.view=t,this.parentNode=t.$parent,this.div=document.createElement("div"),this.div.setAttribute("embed","true"),this.div.className="annotator-note",this.createUI(this)}function v(e,t,n,i,r){this.parentNode=e,this.div=document.createElement(i||"div"),"input"===i&&(this.div.setAttribute("type","submit"),this.div.setAttribute("value","")),n&&this.div.setAttribute(n,"true"),this.div.className=t||"annotator-widget",this.firstChild=r,this.show()}function y(e,t){v.call(this,e,"annotator-button",t,"input")}function b(e,t,n,i){var r,o=new v(e,"toolbar-item "+t);i?(r=new v(o.div,"itemIcon",t,"i"),$(r.div).addClass(i),$(r.div).addClass("icon-large")):r=new v(o.div,"itemIcon",t);var a=new v(o.div,"itemText",t);a.setTextContent(n),a.set("unselectable","on"),-1==navigator.userAgent.indexOf("Mac OS X")&&a.setStyle("margin","4px 6px 0 3px"),this.button=o}function _(e,t){v.call(this,e,"note-comment",t,"div")}function w(e,t,n,i,r){var o=new v(e,"annotatorRb-div","","div"),a=new v(o.div,"annotatorRb","","input"),s=new v(o.div,"radius-option-label","","label"),l=new v(s.div,"radius-labeltext","","text"),c=a.div;c.type="radio",c.id="id"+i,s.div.setAttribute("for","id"+i),c.value=n,c.name=t,l.div.textContent=i,r&&(c.checked=!0)}function S(e,t,n,i,r){var o=new v(e,"","","option");o.setValue(t),o.setTextContent(n),i&&o.set("selected","selected"),r&&o.set("disabled","disabled")}function x(e,t,n){this.uri=e,this.params=t,this.requestMethod="undefined"!=typeof n?n:"POST"}function C(e,t,n){this.uri=e,this.data=t,this.params=n,Mt.prototype.sendAsBinary=Mt.prototype.sendAsBinary||function(e){function t(e){return 255&e.charCodeAt(0)}var n=Array.prototype.map.call(e,t),i=new Uint8Array(n);this.send(i.buffer)}}function E(e){this.annotator=e,this.dragging=!1,this.firstAngle=0,this.secondAngle=0,this.thirdAngle=0,this.firstPoint=new O(0,0,0),this.newPoint=new O(0,0,0),this.realOldPoint=new O(0,0,0),this.realNewPoint=new O(0,0,0),this.rotateCenter=null,this.operator=-1,this.clickOperator=$t.SELECT,this.oldClickOperator=0,this.mouseMoveHappened=0,this.shiftPressed=!1,this.keyArray=new Array(4),this.stage=0}function T(e,t){this.annotator=e;var n=e.view.model,i=!n;if(this.hasHwfInstances=!0,this.hasBrepInfo=!1,this.nodecounter=n?n.nodecounter:0,this.processingIncludes=0,this.nodeIdSuffix=0,this.modelNode=this.annotator.controller.sceneNode.findNode("modelNode~"+this.nodeIdSuffix),this.currentTag=n?n.currentTag:0,this.imageResources={},this.textureResources={},this.segmentProperties=new Array,i){var r={type:"node",id:"tempNode"},o={type:"node",id:"infrontNode"};this.annotator.controller.sceneNode.findNode("lowest").add("node",r),this.annotator.controller.sceneNode.findNode("lowest").add("node",o)}this.tempNode=this.annotator.controller.sceneNode.findNode("tempNode"),this.infrontNode=this.annotator.controller.sceneNode.findNode("infrontNode"),this.libraryNode=this.annotator.controller.sceneNode.findNode("libraryNode"),this.modelTree=new A(this.annotator,t),this.explosionManager=null,this.cuttingPlaneManager=null,this.mapIdMapper=new Array,this.cadIdMapper=new Array,this.mapIdAssociativityMapper=new Array,this.mapIdAssociativityMapperInverse=new Array,this.idHelper=new AnnotatorIdHelper(this),this.segmentLevel=0,this.treeLevel=0,this.modelTreeExists=!1,this.firstNode=0,this.isPart=0,this.currentSegmentName="",this.coreCount=0,this.boundingHash=new Object,this.boundingMinimum=new O(0,0,0),this.boundingMaximum=new O(0,0,0),this.includeHash=new Object,this.tempIncludeList=new Array,this.tempIncludeListLength=0,this.parentStack=[null],this.activeSubnode=new Array,this.activeNode=new Array,this.treeClosure=new Array,this.treeChildset=new Array,this.currentColor=new Array,this.currentLightStatuses=new Array,this.currentTransparencyStatuses=new Array,this.colorsSet=new Array,this.openSegments=new Array,this.treeChildren=new Array,this.textureName=new Array,this.modelUnits=1,this.fileName="",this.extraShellData=new Array,this.segmentVisibilities={},this.defaultCaptureOnly=!1,this.captureManager=new G,this.edgeVisibility=!0,this.faceVisibility=!0;for(var a=0;100>a;a++)this.activeNode[a]=null,this.activeSubnode[a]=null,this.treeClosure[a]=!1,this.treeChildset[a]=!1,this.currentColor[a]=new Array,this.currentColor[a][0]=1,this.currentColor[a][1]=1,this.currentColor[a][2]=1,this.currentTransparencyStatuses[a]=0,this.currentLightStatuses[a]=!0,this.colorsSet[a]=0,this.openSegments[a]=!1,this.treeChildren[a]=0;this.shpereInserted=!1,this.sphereToggle=!1,this.geometryInfo=new U}function k(e,t,n,i,r,o,a){this.annotator=e,this.parent=t,this.title=n,this.id=i,this.icon=r,this.children=new Array,this.open=!1,this.createdNodeUI=!1,this.partiallyChecked=!1,this.nodeVisibility=o,this.emphasized=a,this.depth=this.parent?this.parent.depth+1:0}function A(e,t){this.annotator=e,this.tree=null,this.activeElement=null,this.treeUI=t?new s(this.annotator,this):null}function N(e,t){this.state=e,this.view=t}function M(e,t,n,i,r){this.annotator=e,this.delay=i||0,this.onRun=n,this.onKill=this.annotator.emptyFunction,this.timeCreated=(new Date).valueOf(),this._clock=t,this._life=kt,this._lastRan=this.timeCreated,this._prev=r._prev,this._next=r,r._prev._next=this,r._prev=this,null===this.annotator.controller.worldClock.intervalId&&(this.annotator.controller.worldClock.intervalId=setInterval(function(){t.run()},1))}function D(e){this.annotator=e,this._front={toString:function(){return"FRONT"}},this._back={toString:function(){return"BACK"}},this._front._next=this._back,this._back._prev=this._front,this.intervalId=null}function P(){0===arguments.length&&(this.x=0,this.y=0,this.z=0),1===arguments.length?(this.x=arguments[0].x,this.y=arguments[0].y,this.z=arguments[0].z):2===arguments.length?(this.x=arguments[1].x-arguments[0].x,this.y=arguments[1].y-arguments[0].y,this.z=arguments[1].z-arguments[0].z):3===arguments.length&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])}function I(){0===arguments.length?(this.x=0,this.y=0,this.z=0):1===arguments.length?(this.x=arguments[0].x,this.y=arguments[0].y,this.z=arguments[0].z):3===arguments.length&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])}function F(){if(0===arguments.length)this.pos=new I,this.tar=new I,this.up=new P,this.width=null,this.height=null,this.proj=null;else if(1===arguments.length){var e=arguments[0];this.pos=new I(e.pos),this.tar=new I(e.tar),this.up=new P(e.up),this.width=e.width,this.height=e.height,this.proj=e.proj}}function L(e){this._everything=null,this._geometry=null,this._faces=null,this._lines=null,this._text=null,void 0!==e&&(this[e]=!0)}function O(e,t,n){this.x=e,this.y=t,this.z=n}function R(){this.n=new O(0,0,0),this.V0=new O(0,0,0),this.d=0}function U(){}function B(e){this.annotator=e,this.name=null,this.segmentName=null,this.gravityCenter=null,this.surfaceArea=0,this.volume=0,this.visible=!0,this.baseVisibility=!0,this.baseVisibilitySet=!1,this.transparent=!1,this.polylineData=null,this.faceData=null,this.isConfiguration=!1}function j(e){this.annotator=e,this.noteArray=new Array,this.numNotes=0,this.dimensionArray=new Array,this.nextMarkupID=0,this.numDimensions=0,this.currentlySelectedMarkup="",this.cuttingPlaneUI=null,this.explodeAssemblyUI=null,this.contextMenuUI=null,this.fileComparisonUI=null}function G(){this._captureNames=[],this._defaultCapture="cad_default",this._activeCapture=null,this._toCamera={},this._toCaptureTag={},this._toStyleTags={},this._toStyleVisibility={},this._toStyleMatrix={},this._principleStyleSegments={},this._principleNonStyleSegments={},this._originalVisibility={},this._markupSegments={}}function z(e){this.annotator=e,this.visible=!1,this.orientation=2,this.position=.5,this.inverted=!1,this.planeGeometry=new R,this.delta=null,this.totalLength=null,this.isInvertedSet=!1,this.shaderNodes=[],this.matrixNode=null,this.translateNode=null,this.scaleNode=null,this.flagsNode=null,this.capFlagsNode=null,this.insertShaderNode(e.view.model),this.createGeometry(),this.updatePlane(),this.isInvertedSet=!1}function H(e){this.annotator=e,this.matrixNodeArray=new Array,this.matrixNodesGathered=!1,this.activeExplodeLevel=0,this.lastNonZeroExplodeAmount=0,this.explosionCenter=null}function V(e,t,n,i){this.annotator=e,this.position=new O(t.x,t.y,t.z),this.normal=new O(n.x,n.y,n.z),this.id=i,this.open=!1,this.readyToOpen=!1,this.cnode=null,this.cnodeRenderedListener=null,this.insertPin(),this.color=new O(255,255,255),this.canvasPosition={x:0,y:0}}function W(e,t,n){this.annotator=e,this.id=t,this.finalized=!1,this.visible=!0,this.polylineArray=null,this.selected=!1,this.noType=!1,this.measurementTextPrefix="",this.text="",this.measurementValue=0,this.firstClickPoint=new O(n.x,n.y,n.z),this.secondClickPoint=new O(0,0,0),this.secondOriginalClickPoint=new O(0,0,0),this.firstOriginalClickPoint=new O(n.x,n.y,n.z),this.textPosition=new O(0,0,0),this.arrowStart=new O(n.x,n.y,n.z),this.arrowEnd=new O(0,0,0),this.stage2Set=!1,this.removedPins=!1}function q(e,t,n,i){this.annotator=e,this.id=t,this.finalized=!1,this.visible=!0,this.polylineArray=null,this.selected=!1,this.noType=!1,this.measurementTextPrefix="",this.text="",this.measurementValue=0,this.firstPlane=new R,this.secondPlane=new R,this.pointOnLine=new O(0,0,0),this.firstPlane.setFromPlane(i),this.firstClickPoint=new O(n.x,n.y,n.z),this.secondClickPoint=new O(0,0,0),this.intermediatePoint=new O(0,0,0),this.planeIntersectionLine=new Array,this.secondOriginalClickPoint=new O(0,0,0),this.firstOriginalClickPoint=new O(n.x,n.y,n.z),this.textPosition=new O(0,0,0),this.arcArray=new Array,this.angle=0;for(var r=0;360>r;r++)this.arcArray[r]=new O(0,0,0);this.stage2Set=!1,this.facesWereHidden=!1}function J(e,t,n,i){if(this.annotator=e,this.id=n,this.finalized=!1,this.visible=!0,this.polylineArray=null,this.selected=!1,this.noType=!1,this.measurementTextPrefix="",this.text="",t){this.polylineArray=new Array;for(var r=0;t.length>r;r++)this.polylineArray[r]=t[r]}i||(this.noType=!0),this.firstArrowStart=new O(t[0].x,t[0].y,t[0].z),this.firstArrowEnd=new O(t[t.length-1].x,t[t.length-1].y,t[t.length-1].z),this.textPosition=new O(t[t.length-1].x,t[t.length-1].y,t[t.length-1].z);var o=new O(0,0,0);o.subtract(this.firstArrowEnd,this.firstArrowStart),this.measurementValue=o.length(),this.text=constructMeasurementResultString(this.annotator.state.worldToMM(this.measurementValue),this.annotator.state.unitPreference,this.measurementTextPrefix)}function X(e,t,n,i,r){if(this.annotator=e,this.id=n,this.finalized=!1,this.visible=!0,this.polylineArray=null,this.selected=!1,this.noType=!1,this.measurementType=null,this.text="",t){this.polylineArray=new Array;for(var o=0;t.length>o;o++)this.polylineArray[o]=t[o]}if(this.polylineData=i,this.firstArrowEnd=null,this.firstArrowStart=new O(t[0].x,t[0].y,t[0].z),this.secondArrowStart=new O(0,0,0),this.secondArrowEnd=new O(0,0,0),this.secondSurfaceCenter=new O(0,0,0),this.firstSurfaceAxis=null,this.secondSurfaceAxis=null,t[0].equals(t[t.length-1])){var a=Math.floor(t.length/2);this.firstArrowEnd=new O(t[a].x,t[a].y,t[a].z)}else this.firstArrowEnd=new O(t[t.length-1].x,t[t.length-1].y,t[t.length-1].z);this.textPosition=new O(t[t.length-1].x,t[t.length-1].y,t[t.length-1].z);var s=new O(0,0,0);s.subtract(this.firstArrowEnd,this.firstArrowStart),this.createCircleData(i,r);var l=this.annotator.state.radialMeasureType;switch(l){case yt.DIAMETER:this.secondArrowEnd=new O(t[0].x,t[0].y,t[0].z),this.measurementValue=2*this.diameter,this.measurementTextPrefix=String.fromCharCode(216),this.measurementType=yt.DIAMETER;break;case yt.RADIUS:this.measurementValue=this.diameter,this.measurementTextPrefix="R",this.measurementType=yt.RADIUS;break;default:this.measurementValue=this.diameter,this.measurementTextPrefix="R",this.measurementType=yt.RADIUS}this.text=constructMeasurementResultString(this.annotator.state.worldToMM(this.measurementValue),this.annotator.state.unitPreference,this.measurementTextPrefix),this.finalizeStage=0}function Q(e,t,n){this.annotator=e,this.id=t,this.finalized=!1,this.visible=!0,this.polylineArray=null,this.selected=!1,this.noType=!1,this.measurementTextPrefix="",this.text="",this.measurementValue=0,this.firstClickPoint=new O(n.x,n.y,n.z),this.secondClickPoint=new O(0,0,0),this.pointsOnSameRay=!1,this.textPosition=new O(0,0,0),this.stage=0,this.firstSelectionFace=null,this.secondSelectionFace=null,this.firstPoint=new O(0,0,0),this.secondPoint=new O(0,0,0),this.distance=0,this.cylindersHaveSameOrientation=!1,this.finalizeStage=0,this.textPosition=new O(0,0,0),this.faceData=new Array(2),this.faceData[0]=null,this.faceData[1]=null,this.cylinderPoints=new Array(2),this.surfaceCenter=new Array(2),this.firstSurfaceAxis=new Array(2),this.secondSurfaceAxis=new Array(2),this.firstCylinderAxisInfinite=new Array(2),this.secondCylinderAxisInfinite=new Array(2),this.parallelFaces=!1,this.facesWereHidden=!1}function Y(){return-1!==navigator.userAgent.indexOf("AppleWebKit/")}function K(e,t){window.setTimeout(e.bind(t),10)}function Z(e,t,n){window.setTimeout(e.bind(n),t)}function et(e){return"string"==typeof e?new Date(Date.parse(e.toString().replace(/GMT.*/,"GMT"))):e}function tt(e,t,n){var i,r,o,a,s;return null!==n||(n=!1),null!==t||(t=0),i=Math.round(Math.abs(t-e)/60/1e3),r=Math.round(Math.abs(t-e)/1e3),i>=0&&1>=i?n?r>=0&&4>=r?"less than 5 seconds ago":r>=5&&9>=r?"less than 10 seconds ago":r>=10&&19>=r?"less than 20 seconds ago":r>=20&&39>=r?"less than half a minute ago":r>=40&&59>=r?"less than a minute ago":"1 minute ago":0===i?"less than a minute ago":""+i+" minute ago":i>=2&&44>=i?""+i+" minutes ago":i>=45&&89>=i?"about 1 hour ago":i>=90&&1439>=i?"about "+Math.round(i/60)+" hours ago":i>=1440&&2529>=i?"1 day ago":i>=2530&&43199>=i?""+Math.round(i/1440)+" days ago":i>=43200&&86399>=i?"about 1 month ago":i>=86400&&525599>=i?""+Math.round(i/43200)+" months ago":(o=i/525600,a=1440*(o/4),s=(i-a)%525600,131400>s?"about "+Math.round(o)+" years ago":394200>s?"over "+Math.round(o)+" years ago":"almost "+Math.round(o+1)+" years ago")}function nt(e,t){var n={x:0,y:0};if(t){for(var i=t.target,r=0,o=0;i.offsetParent;)r+=i.offsetLeft-i.scrollLeft+i.clientLeft,o+=i.offsetTop-i.scrollTop+i.clientTop,i=i.offsetParent;r+=i.offsetLeft-i.scrollLeft+i.clientLeft+$(document).scrollLeft(),o+=i.offsetTop-i.scrollTop+i.clientTop+$(document).scrollTop(),n.x=t.pageX-r,n.y=t.pageY-o}else t=window.event,n.x=t.x,n.y=t.y;return n}function it(e){var t={x:0,y:0};if(e){for(var n=$("#hvfwCanvas")[0],i=0,r=0;n.offsetParent;)i+=n.offsetLeft-n.scrollLeft+n.clientLeft,r+=n.offsetTop-n.scrollTop+n.clientTop,n=n.offsetParent;i+=n.offsetLeft-n.scrollLeft+n.clientLeft+$(document).scrollLeft(),r+=n.offsetTop-n.scrollTop+n.clientTop+$(document).scrollTop(),t.x=e.pageX-i,t.y=e.pageY-r}else e=window.event,t.x=e.x,t.y=e.y;return t}function rt(e,t,n){var i=e.controller.clientH,r=new O(0,0,0),o=computeAlternativelyTransformedPoint(t,1,e.controller.cameraViewMatrix,r),a=.5*r.x/o*e.controller.clientW,s=.5*r.y/o*i;n.set(a+.5*e.controller.clientW,i-s-.5*i)}function ot(e,t,n,i){void 0===i&&(i="png"),i=i.toLowerCase(),"jpg"===i&&(i="jpeg");var r=1,o=e.controller.sceneNode;o.pause(!0);var a=o.findNode("camera"),s=a.get("optics"),l=s.aspect;s.aspect=(t+r)/n,a.set("optics",s);var c=e.view.$hvfwCanvas,u=c.cloneNode(!0);u.getContext("2d").drawImage(c,0,0),c.parentNode.replaceChild(u,c);var d=c.width,h=c.height;c.width=t+r,c.height=n,o.renderFrame({force:!0});var p=c.cloneNode(!0),f=p.getContext("2d");f.drawImage(c,0,0);var m=f.getImageData(0,0,t+r,n);p.width-=r,f.putImageData(m,-r,0);var g=p.toDataURL("image/"+i);if("png"!==i){var v=g.substring("data:image/".length,g.indexOf(";"));v=v.toLowerCase(),"png"===v&&(g=null)}return u.parentNode.replaceChild(c,u),c.width=d,c.height=h,s.aspect=l,a.set("optics",s),o.renderFrame({force:!0}),null===g&&alert("Unsupported offscreen render image type: "+i),o.pause(!1),g}function at(e,t,n){for(var i=e.controller.sceneNode.findNode("lookAt").get("eye"),r=e.controller.sceneNode.findNode("lookAt").get("look"),o=e.controller.sceneNode.findNode("lookAt").get("up"),a=new O(i.x,i.y,i.z),s=new O(r.x,r.y,r.z),l=new O(o.x,o.y,o.z),c=new Array(4),u=new Array(4),d=new Array(4),h=new Array(4),p=new Array(4),f=0;4>f;f+=1)c[f]=new Array(4),u[f]=new Array(4),d[f]=new Array(4),h[f]=new Array(4),p[f]=new Array(4);var m=new O(s.x-a.x,s.y-a.y,s.z-a.z),g=m.length(),v=new O(0,0,0);m.normalize(),computeCrossProduct(l,m,v),v.normalize();var y=new O(0,0,0);y.x=-computeDotProduct(v,s),y.y=-computeDotProduct(l,s),y.z=-computeDotProduct(m,s),0==s.x&&0==s.y&&0==s.z?setSimpleColumnBasis(c,v,l,m):setColumnBasis(c,v,l,m,y);var b=Math.tan(45)*g/2;setMatrixScale(u,2/b,2/b,g),u[2][3]=u[2][2],multiplyMatrices(c,u,d),orthogonalizeMatrix(d),setIdentity(h);var _=e.controller.clientH/e.controller.clientW,w=-_,S=1;w=1/w,h[0][0]*=w,h[1][0]*=w,h[2][0]*=w,h[3][0]*=w,h[0][1]*=S,h[1][1]*=S,h[2][1]*=S,h[3][1]*=S,computeInverseMatrix(u,p),multiplyMatrices(h,p,h),computeInverseMatrix(c,p),multiplyMatrices(h,p,h);var x=new O(0,0,0);x.x=t.x*h[0][0]+t.y*h[1][0]+t.z*h[2][0]+h[3][0],x.y=t.x*h[0][1]+t.y*h[1][1]+t.z*h[2][1]+h[3][1],x.z=t.x*h[0][2]+t.y*h[1][2]+t.z*h[2][2]+h[3][2],n.setFromHoopsPoint(x)}function st(e,t,n,i,r){var o={type:"geometry",primitive:"triangles",positions:[t[0].x,t[0].y,t[0].z,t[1].x,t[1].y,t[1].z,t[2].x,t[2].y,t[2].z],normals:[n[0].x,n[0].y,n[0].z,n[1].x,n[1].y,n[1].z,n[2].x,n[2].y,n[2].z],indices:[0,1,2],id:"g-"+r},a={type:"translate",x:0,y:0,z:0,nodes:[o]},s={type:"material",id:r,baseColor:{r:i.x,g:i.y,b:i.z},emit:.25,shine:1,specular:0,nodes:[a]};e.view.model.modelNode.add("node",s)}function lt(e,t,n,i,r,o,a){var s=0;t.eachNode(function(){var t=!1;if(s>0||0==o){if("node"==this.get("type")){var l=this.get("id");if(-1!=l.indexOf("s")){var c=l.split("s");if(e.hasSegmentProperties(parseInt(c[1]))){var u=e.getSegmentProperties(parseInt(c[1]));a&&"all_markup"==u.segmentName?t=!0:void 0!==i?u.visible=i:u.baseVisibilitySet&&(r=u.baseVisibility)}}}else if("flags"==this.get("type")){var d,h=this.get("flags");d=void 0!==i?i:r;var p=this.get("id");-1!=p.indexOf("ev")?e.edgeVisibility||(d=!1):-1!=p.indexOf("fv")&&(e.faceVisibility||(d=!1));var f=h.backfaces;0==f&&(f=n),this.set({flags:{enabled:d,transparent:h.transparent,backfaces:f}})}s>0&&!t&&lt(e,this,n,i,r,o+1,a)}s++},{andSelf:!0})}var ct="2.0.0",ut=4,dt=3,ht=4;Math.pow(10,-3),Math.pow(10,-2);var pt={SRC:"http://www.grabcad.com/embed_viewer",CODE:'<iframe src="{src}?id={design}" width="{width}" height="{height}" scrolling="no" frameborder="0"></iframe>',DEFAULT_WIDTH:"600",DEFAULT_HEIGHT:"400"},ft={CAMERA:{INITIAL_X:0,INITIAL_Y:0,INITIAL_Z:100,MOUSE_ROTATION_SPEED:1,MOUSE_ZOOM_SPEED:1,MOUSE_PAN_SPEED:.25,MOUSE_DBLCLICK_ZOOM_SPEED:25,MOUSE_SCROLL_DAMPING:.9,MOUSE_SCROLL_DELTA:.01,UI_ZOOM_IN_SPEED:1,UI_ZOOM_OUT_SPEED:1,UI_ROTATE_LEFT_SPEED:.025,UI_ROTATE_RIGHT_SPEED:.025,UI_ROTATE_UP_SPEED:.025,UI_ROTATE_DOWN_SPEED:.025,MAX_MESH_DISTANCE_FACTOR:.75,MAX_MESH_DISTANCE_CONSTANT:.25,UI_HWF_ZOOM_IN_SPEED:.1,UI_HWF_ZOOM_OUT_SPEED:-.1,UI_HWF_ROTATE_LEFT_SPEED:5,UI_HWF_ROTATE_RIGHT_SPEED:-5,UI_HWF_ROTATE_UP_SPEED:5,UI_HWF_ROTATE_DOWN_SPEED:-5},LIGHT:{DIRECTIONAL_COLOR:16777215,AMBIENT_COLOR:2236962},MESH:{SOLID:{VISIBLE:!0,COLOR:11513775,AMBIENT:16777215,SPECULAR:4210752,SHININESS:128,OPACITY:.9,SMOOTH_SHADING:!1,DOUBLE_SIDED:!0},WIREFRAME:{VISIBLE:!1,COLOR:1710618,OPACITY:1},BOUNDING_BOX:{VISIBLE:!1,COLOR:4210752,OPACITY:1},AXIS_ARROWS:{VISIBLE:!1,HEIGHT:8,LINE_WIDTH:2,TIP_RADIUS:.5,TIP_HEIGHT:2,COLOR_X:15538980,COLOR_Y:40270,COLOR_Z:38875,OPACITY:1,DETAIL:8}},PIN:{HEIGHT:4,SPHERE:{SIZE:1,COLOR:15538980,DETAIL:16},LINE:{LINE_WIDTH:1,COLOR:0}},MEASUREMENT:{VISIBLE:!0,PRECISION:2,LINE_WIDTH:3,COLOR:15538980,OPACITY:.5}},mt={READ_ONLY:1,MANUAL_SAVE:2,AUTO_SAVE:3},gt={COMMUNITY:1,WORKBENCH:2},vt={LINEAR:0,RADIAL:1},yt={RADIUS:0,DIAMETER:1};
mt.DEFAULT=mt.READ_ONLY;var bt={STL:1,HWF:2};bt.DEFAULT=bt.STL;var _t={VIEWING:1,DROPPING_PIN:2,EDITING_NOTE:3,MEASURING:4};_t.DEFAULT=_t.VIEWING;var wt={INPUT:"Annotator:input",OUTPUT:"Annotator:output"},St={MESH_SET:"Annotator:meshSet",PIN_ADDED:"Annotator:pinAdded",PIN_REMOVED:"Annotator:pinRemoved",NOTE_EDITED:"Annotator:noteEdited",NOTE_SHOW_REQUESTED:"Annotator:noteShowRequested",NOTE_HIDE_REQUESTED:"Annotator:noteHideRequested",NOTE_DELETE_REQUESTED:"Annotator:noteDeleteRequested",BUTTON_STATE_CHANGE:"Annotator:buttonStateChange"},xt={GC_DEFAULT:-1,FRONT:0,BACK:1,LEFT:2,RIGHT:3,BOTTOM:4,TOP:5,ISO:6},Ct={Y_UP:"Y_UP",Z_UP:"Z_UP"},$t={SELECT:0,NOTE:1,MEASURE:2,MEASURE_ANGLE:3,MEASURE_DISTANCE:4,MEASURE_POINTS:5,MEASURE_RADIUS:6},Et={UNDEFINED_TYPE:0,STRAIGHTLINE_TYPE:1,CIRCLE_TYPE:2,CYLINDER_TYPE:3,PLANE_TYPE:4,CONE_TYPE:5},Tt=2,kt={toString:function(){return"ALIVE"}},At={toString:function(){return"DYING"}},Nt={toString:function(){return"DEAD"}},Mt=XMLHttpRequest,Dt=function(e){if(!e)return e;var t=-1;for(var n in e)if(e.hasOwnProperty(n)){var i=parseInt(n);i>t&&(t=i)}return e.length=t+1,Array.prototype.slice.call(e)},Pt=function(e){if(!e)return e;var t,n,i=[];for(t in e)if(e.hasOwnProperty(t)&&(n=e[t],n&&n.url)){var r=parseInt(t);i[r]=n}return i},It=null;e.prototype={errorCallback:function(){},setUsername:function(e,t){this.getUserIdMethod&&this._schedule(wt.OUTPUT,function(n,i){n.state.user={name:e};var r=n.getUserIdMethod+"?username="+e;n._request("GET",r,!1,t,function(e){n._handleResponse(e,function(e){n.state.user.id=e.user_id,n.state.user.image=e.pic_url}),i()})},-1,-1)},getUsername:function(){return this.state.user.name},setAdditionalHeaders:function(e){this.state.additionalHeaders=e||{}},showToolbar:function(e){e?this.toolbar.show():this.toolbar.hide()},showModelTree:function(e){this.view.model&&this.view.model.modelTree&&this.view.model.modelTree.treeUI&&(e?(this.toolbar.$modelTree.isChecked()&&this.view.model.modelTree.treeUI.show(),this.view.model.modelTree.treeUI.updateTreeHeight()):this.view.model.modelTree.treeUI.hide())},isToolbarVisible:function(){return"true"===this.toolbar.div.getAttribute("visible")},showNavigationControls:function(e){e?this.trackball.show():this.trackball.hide()},isNavigationControlsVisible:function(){return"true"===this.trackball.div.getAttribute("visible")},showLogo:function(e){e?this.toolbar.$logo.show():this.toolbar.$logo.hide()},isLogoVisible:function(){return"true"===this.toolbar.$logo.getAttribute("visible")},getScreenshot:function(){var e,t=this.view.$hvfwCanvas,n=t.width,i=t.height,r=this.controller.sceneNode.findNode("lookAt").get("eye"),o=this.controller.sceneNode.findNode("lookAt").get("look"),a=this.controller.sceneNode.findNode("lookAt").get("up"),s=new O(a.x,a.y,a.z),l=new O(o.x-r.x,o.y-r.y,o.z-r.z),c=new O(0,0,0);l.normalize(),s.normalize(),computeCrossProduct(l,s,c);var r=this.controller.sceneNode.findNode("lookAt").get("eye"),o=this.controller.sceneNode.findNode("lookAt").get("look"),a=this.controller.sceneNode.findNode("lookAt").get("up"),u=new O(r.x,r.y,r.z),d=new O(o.x,o.y,o.z);new O(a.x,a.y,a.z);var h=new O(d.x-u.x,d.y-u.y,d.z-u.z),p=h.length(),f=p/3,m=new O(1.5*f*l.x,1.5*f*l.y,1.5*f*l.z),g=new O(m.x,m.y,m.z),v=new O(m.x,m.y,m.z),y=new O(m.x,m.y,m.z);m.x+=-f*s.x-f*c.x,m.y+=-f*s.y-f*c.y,m.z+=-f*s.z-f*c.z,g.x+=f*s.x-f*c.x,g.y+=f*s.y-f*c.y,g.z+=f*s.z-f*c.z,v.x+=f*s.x+f*c.x,v.y+=f*s.y+f*c.y,v.z+=f*s.z+f*c.z,y.x+=-f*s.x+f*c.x,y.y+=-f*s.y+f*c.y,y.z+=-f*s.z+f*c.z;var b=new Array(m,g,v),_=new Array(l,l,l),w=new Array(m,y,v),S=new O(.95,.95,.95);return st(this,b,_,S,"tempNodeBackground1"),st(this,w,_,S,"tempNodeBackground2"),e=ot(this,n,i,"png"),this.view.model.modelNode.remove("node","tempNodeBackground1"),this.view.model.modelNode.remove("node","tempNodeBackground2"),e},clearView:function(){this.view&&(this.view.selectionManager&&this.view.selectionManager.onClearView(),this.view.dropPinPopup&&(this.view.hideDropPinHint(),this.view.dropPinPopup.resetPos()),this.view.helpPopup&&(this.view.hideHelp(),this.view.helpPopup.resetPos()),this.view.markupManager&&(this.view.markupManager.hideCuttingPlanePopup(!0),this.view.markupManager.hideExplodeAssemblyPopup(!0),this.view.markupManager.hideFileComparisonPopup(!0),this.view.markupManager.hideMeasurementPopup(),this.view.markupManager.clearDimensionsSVG(),this.view.markupManager.cuttingPlaneUI&&this.view.markupManager.cuttingPlaneUI.resetPos(),this.view.markupManager.explodeAssemblyUI&&this.view.markupManager.explodeAssemblyUI.resetPos(),this.view.markupManager.fileComparisonUI&&this.view.markupManager.fileComparisonUI.resetPos(),this.view.markupManager.measurementUI&&(this.view.markupManager.measurementUI.reset(),this.view.markupManager.measurementUI.resetPos()),this.view.markupManager.clearNotes()),this.view.model&&(this.view.model.libraryNode&&this.view.model.libraryNode._targetNode&&this.view.model.libraryNode._targetNode.removeNodes(),this.view.model.modelTree&&this.view.model.modelTree.treeUI&&this.view.model.modelTree.treeUI.hide())),this.sketcher&&this.sketcher._shapes&&this.sketcher.destroy("cancel"),this.toolbar&&this.toolbar.reset()},setMode:function(e){this.state.mode=e},getIsSketchMode:function(){return this.state.isSketchMode},setModelFileName:function(e){this.modelFileName=e},setLoadedVersion:function(e){this.loadedVersion=e},setLoadedConfiguration:function(e){this.loadedConfiguration=e},setConverterData:function(e){this.converterData=e,this.externalIdToXMLIdMap=null},setContext:function(e){this.state.context=e},getContext:function(){return this.state.context},getXMLIdToExternalIdMap:function(){return this.converterData?this.converterData.id_map:null},getExternalIdToXMLIdMap:function(){if(!this.externalIdToXMLIdMap&&this.converterData&&this.converterData.id_map){this.externalIdToXMLIdMap={};for(var e in this.converterData.id_map)if(this.converterData.id_map.hasOwnProperty(e)){var t=this.converterData.id_map[e],n=t.content_file_id,i=this.externalIdToXMLIdMap[n];i||(i=new Array,this.externalIdToXMLIdMap[n]=i),i.push(e)}}return this.externalIdToXMLIdMap},abort:function(){if(null!==It&&It(),this.controller&&this.controller.sceneNode){var e=this.controller.sceneNode;this.clearView(),e.renderFrame({force:!0}),e.stop()}},loadSource:function(e,t,n,i,r,o,a,s,l,c){return e&&0!=e.length?(delete this.currentModelUri,delete this.currentAnnotationsFilename,this.state.reset(),this.setMode(n),this.state.is_stl_content_file=i,this.view.viewConfiguration=r,this.toolbar.reset(),this.showToolbar(!1),this.showNavigationControls(!1),this.showModelTree(!1),this._schedule(wt.INPUT,function(n,i){n.currentModelUri=e,o&&(n.viewableVersions=n.comparableVersions=Dt(o)),s&&(n.viewableConfigurations=n.comparableConfigurations=Pt(s[a])),"hwf"!=t&&c("error",{percentage:0}),n.embedMode&&(n.view.$parent.style.width="100%",n.view.$parent.style.height="100%"),n.view.$canvas.style.display="none",n.view.$hvfwCanvas.style.display="";var r=n.view.$parent.getBoundingClientRect(),l=r.width,u=r.height;n.view.$hvfwCanvas.width=l,n.view.$hvfwCanvas.height=u,n.view.$hvfwSvgContainer.style.width=l+"px",n.view.$hvfwSvgContainer.style.height=u+"px",n.controller.clientW=n.view.$hvfwCanvas.clientWidth,n.controller.clientH=n.view.$hvfwCanvas.clientHeight,n.toolbar.$togglePins.hide(),n.toolbar.$explodeAssembly.show(),n.toolbar.$cuttingPlane.show(),n.toolbar.$measurement.show(),n.toolbar.$fileComparison.show(),n.state.mode===mt.READ_ONLY?n.toolbar.$dropPin.hide():n.toolbar.$dropPin.show(),n.toolbar.$dropPin.set("lower"),n.toolbar.$modelTree.unset("hidden"),n.state.setBackgroundColor(.99,.99,.99,.88,.88,.88),n.state.setMeasurementColor(0,0,0),n.state.setShowBackFaces(!0),n.state.initializeSVG(),n.controller.startEventListenning();var d=null;It=function(){null!=d&&(d.abort(),d=null,delete n.currentModelUri,delete n.currentAnnotationsFilename,i()),It=null},d=n._request("GET",e,!0,c,function(e){try{d=null,It=null,n._handleArrayResponse(e,function(e){try{n.controller.readModelData(e)?(n.showToolbar(!0),n.showNavigationControls(!0),n.showModelTree(!0),c("complete",{percentage:100})):c("nomodel",{percentage:100})}catch(t){console.log(t.stack),c("readerror",{percentage:0,error:t.toString()})}i()},function(){d=null,It=null,i()})}catch(t){console.log(t.stack),c("error",{percentage:0,error:t.toString()})}},function(e){d=null,It=null,delete e.currentModelUri,delete e.currentAnnotationsFilename,i()})}),void 0):(c("readerror",{error:"loadSource() called with empty or null uri"}),void 0)},loadReferenceSource:function(e,t,n,i,r,o,a,s){return e&&0!=e.length?(this._schedule(wt.INPUT,function(r,l){var c=null;t&&(r.comparableVersions=Dt(t)),i&&(r.comparableConfigurations=Pt(i[n])),r.isSameModelCompared=o,r.comparedModelName=a?a:"no_name",c=r._request("GET",e,!0,s,function(e){try{c=null,It=null,r._handleArrayResponse(e,function(e){try{r.controller.readReferenceModelData(e)?s("complete",{percentage:100}):s("nomodel",{percentage:100})}catch(t){console.log(t.stack),s("readerror",{percentage:0,error:t.toString()})}l()},function(){c=null,It=null,l()})}catch(t){console.log(t.stack),s("error",{percentage:0,error:t.toString()})}},function(e){c=null,It=null,delete e.currentModelUri,delete e.currentAnnotationsFilename,l()})}),void 0):(s("readerror",{error:"loadReferenceSource() called with empty or null uri"}),void 0)},clearReference:function(e){var t=this.view.markupManager&&this.view.markupManager.fileComparisonUI&&this.view.markupManager.fileComparisonUI.isVisible();t&&this.view.markupManager.hideFileComparisonPopup(!0),this.controller.referenceModelNode&&(this.controller.referenceModelNode.destroy(),this.controller.referenceModelNode=null,this.view.referenceModel=null),this.isSameModelCompared=!0,this.comparedModelName=e.model_name,this.comparableVersions=e.viewer_parameters.compared_file_versions,this.comparableConfigurations=e.viewer_parameters.compared_file_configurations,t&&this.view.markupManager.showFileComparisonPopup(!0)},showSamplePin:function(){this.view.markupManager.activateNote(0)},loadAnnotations:function(e,t){this.loadDesignMethod&&this._schedule(wt.INPUT,function(n,i){n.currentAnnotationsFilename=e;var r=n.loadDesignMethod+"?user_id="+n.state.user.id+"&filename="+e,o=null;It=function(){null!=o&&(o.abort(),o=null,delete n.currentModelUri,delete n.currentAnnotationsFilename,i()),It=null},o=n._request("GET",r,!1,t,function(e){n._handleResponse(e,function(e){o=null,It=null;var t=n._importAnnotations(e);if(n.showWireframe(t.designWireframeVisible),n.showBoundingBox(t.designBoundingBoxVisible),n.showAxis(t.designAxisVisible),n.smoothShading(t.designSmoothShading),n.view.markupManager.clearNotes(),t.pins)for(var r=0,a=t.pins.length;a>r;r++){var s=t.pins[r];s.position=n.state.fixUpOldStateCoordinate(s.position,null,s.version),s.transformation.camPosition=n.state.fixUpOldStateCoordinate(s.transformation.camPosition,null,s.version),s.transformation.camTarget=n.state.fixUpOldStateCoordinate(s.transformation.camTarget,null,s.version),s.transformation.scenePosition=n.state.fixUpOldStateCoordinate(s.transformation.scenePosition,null,s.version),s.transformation.coordinatesInMM=!0;var l=s.position,c=s.normal,u=s.transformation;if(dt>s.version&&n.state.isContentfileSTL()){for(var d=new O((n.view.model.boundingMaximum.x+n.view.model.boundingMinimum.x)/2,(n.view.model.boundingMaximum.y+n.view.model.boundingMinimum.y)/2,(n.view.model.boundingMaximum.z+n.view.model.boundingMinimum.z)/2),h=new Array,p=0;4>p;p++)h[p]=new Array;setIdentity(h),h[3][0]=d.x,h[3][1]=d.y,h[3][2]=d.z,h[0][0]=0,h[0][2]=1,h[2][0]=-1,h[2][2]=0,applyTransformationToPoints(l,h);var f=new P(c[0],c[1],c[2]);f=f.normalize().scale(ft.PIN.HEIGHT),c=[f.x,f.y,f.z],applyTransformationToPoints(u.camPosition,h),applyTransformationToPoints(u.camRotation,h),applyTransformationToPoints(u.camUp,h),applyTransformationToPoints(u.camTarget,h)}var m=s.pin_id,g=n.state.addPin.execute(m,new O(l[0],l[1],l[2]),new O(c[0],c[1],c[2]),!0,"Viewer"==s.pinnableType);n.view.markupManager.addLoadedNote(g,l,c),s.version>=dt&&n._setPinVersion(g,s.version),n._setPinnableType(g,s.pinnableType),n._setPinnableID(g,s.pinnableID),n._setPinCameraTransformation(g,u),n.setNote(g,s.display_number,s.user,s.time,s.color,!0)}n.view.setPendingStateIfAny(),i()},function(){o=null,It=null,i()})},function(e){o=null,It=null,delete e.currentModelUri,delete e.currentAnnotationsFilename,i()})})},_requestAddPin:function(e,t){this.addPinMethod&&this._schedule(wt.OUTPUT,function(n,i){var r=n.getPinData(e,!0);if(!r)return i();r.transformation=n.getCurrentTransformation();var o=new x(n.addPinMethod,{user_id:n.state.user.id,filename:n.currentAnnotationsFilename,pin_data:n._serialize(r)});o.headers=n.state.additionalHeaders,o.send(function(e){n._handleResponse(e,function(e){"function"==typeof t&&t(e)}),i()})},-1)},cancelPendingPin:function(){this.state.have_pending_pin&&(this.state.addPin.undo(),this.state.have_pending_pin=!1,this.state.drop_pin_callback(null))},updateSketchData:function(e,t){this.state.sketchData=null==e?null:e.sketchData,this.state.sketchThumbnail=null==e?null:e.sketchThumbnail,this.state.sketchImageData=null==e?null:e.sketchImageData,this.state.sketchBackgroundData=null==e?null:e.sketchBackgroundData,this.state.sketchIsReadOnly=null==e?!1:e.sketchIsReadOnly,this.state.sketchThirdPartyData=null==e?null:e.sketchThirdPartyData,this.state.sketchCommentId=null==e?null:e.sketchCommentId,this.state.sketchViewerState=null==e?null:e.sketchViewerState,this.toolbar.startSketch(t)},_updateSketchCallback:function(e){this.state.save_sketch_callback&&this.state.save_sketch_callback({sketchData:this.state.sketchData,sketchThumbnail:this.state.sketchThumbnail,sketchImageData:this.state.sketchImageData,sketchBackgroundData:this.state.sketchBackgroundData,sketchIsReadOnly:this.state.sketchIsReadOnly,sketchThirdPartyData:this.state.sketchThirdPartyData,sketchCommentId:this.state.sketchCommentId,sketchViewerState:this.state.sketchViewerState,onSave:e})},attachPinToComment:function(e,t,n){this.addPinMethod&&(this._requestSaveViewerState(t),this._schedule(wt.OUTPUT,function(i,r){i.state.notes[e];var o=i.getPinData(e,!0);if(!o)return r();o.transformation=i.getCurrentTransformation();var a=new x(i.addPinMethod,{user_id:i.state.user.id,comment_id:t,pin_data:i._serialize(o)});a.headers=i.state.additionalHeaders,a.send(function(t){i._handleResponse(t,function(t){i.toolbar.$dropPin.uncheck(),i.view.hideDropPinHint(),i.state.stage=_t.VIEWING,i.state.have_pending_pin=!1,i.state.annotator._setPinId(e,t.pin.pin_id),i.state.annotator._setPinNumber(e,t.pin.display_number),i.state.annotator._setPinCameraTransformation(e,t.pin.transformation),i.state.annotator._setPinVersion(e,t.pin.version),i.state.annotator._setPinnableID(e,t.pin.pinnableID),i.state.annotator._setPinnableType(e,t.pin.pinnableType),i.state.annotator.view.currentOperator.clickOperator=$t.SELECT,"function"==typeof n&&n(t)}),r()})},-1))},attachSketchToComment:function(e,t){var n=this;n._requestAddCommentSketchData(null,e,n.state.sketchData,function(){n._requestAddCommentSketchThumbnail(null,e,n.state.sketchThumbnail,function(){n._requestAddCommentSketchImage(null,e,n.state.sketchImageData,function(){n._requestAddCommentSketchBackground(null,e,n.state.sketchBackgroundData,function(){n._requestSaveViewerState(e,n.state.sketchViewerState,t)})})})})},updatePinColor:function(e,t,n,i,r){var o=e?this._getPinById(e):this.state.pins[t];o.hvfwPin.setPinColor(n/255,i/255,r/255),this._requestUpdatePin(o.name)},deletePin:function(e){var t=this._getPinById(e);this.undropPin(t.name,!1)},removePin:function(e){var t=this._getPinById(e);this.state.remPin.execute(t.name,!1,!0)},activatePin:function(e){var t=this.view.markupManager.getNoteIdByPinId(e);if(-1==t){var n=this;this.loadAnnotations(this.currentAnnotationsFilename,function(i){"complete"===i&&(t=n.view.markupManager.getNoteIdByPinId(e),t>=0&&n.view.markupManager.activateNote(t))})}else this.view.markupManager.activateNote(t)},_requestDeletePin:function(e,t){this.deletePinMethod&&this._schedule(wt.OUTPUT,function(n,i){var r=n._getPinId(e);if(!r)return i();var o=new x(n.deletePinMethod,{user_id:n.state.user.id,filename:n.currentAnnotationsFilename,pin_id:r});o.headers=n.state.additionalHeaders,o.send(function(e){n._handleResponse(e,function(e){"function"==typeof t&&t(e)}),i()})},-1)},_requestUpdatePin:function(e,t){this.updatePinMethod&&this._schedule(wt.OUTPUT,function(n,i){var r=n._serialize(n.getPinData(e,!0)),o=n._getPinId(e);if(!r||!o)return i();var a=new x(n.updatePinMethod,{user_id:n.state.user.id,filename:n.currentAnnotationsFilename,pin_id:o,pin_data:r});a.headers=n.state.additionalHeaders,a.send(function(e){n._handleResponse(e,function(e){"function"==typeof t&&t(e)}),i()})},-1)},_requestGetPinViewerStateURI:function(e,t){this.loadPinViewerStateMethod&&this._schedule(wt.OUTPUT,function(n,i){var r=n._getPinId(e);if(!r)return i();var o=n.loadPinViewerStateMethod+"?pin_id="+r,a=new x(o,{user_id:n.state.user.id,filename:n.currentAnnotationsFilename});a.headers=n.state.additionalHeaders,a.send(function(e){n._handleResponse(e,function(e){"function"==typeof t&&t(e)}),i()})},-1)},_requestViewerStateURI:function(e,t){this.loadViewerStateMethod&&this._schedule(wt.OUTPUT,function(n,i){var r=n.loadViewerStateMethod+"?comment_id="+e,o=new x(r,{user_id:n.state.user.id,filename:n.currentAnnotationsFilename});o.headers=n.state.additionalHeaders,o.send(function(e){n._handleResponse(e,function(e){"function"==typeof t&&t(e)}),i()})},-1)},_requestLoadViewerState:function(e,t){this._schedule(wt.OUTPUT,function(n,i){var r=new x(e,{user_id:n.state.user.id,filename:n.currentAnnotationsFilename},"GET");r.headers=n.state.additionalHeaders,r.send(function(e){n._handleResponse(e,function(e){"function"==typeof t&&t(e)}),i()})},-1)},_requestSaveViewerState:function(e,t,n){this.saveViewerStateMethod&&this._schedule(wt.OUTPUT,function(i,r){var o=i.saveViewerStateMethod+"?comment_id="+e,a=t||i.state.getState(),s=new x(o,{user_id:i.state.user.id,viewer_state:i._serialize(a),filename:i.currentAnnotationsFilename});s.headers=i.state.additionalHeaders,s.send(function(e){i._handleResponse(e,function(e){"function"==typeof n&&n(e)}),r()})},-1)},_requestGetPinComments:function(e,t){this.getPinCommentsMethod&&this._schedule(wt.OUTPUT,function(n,i){var r=n._getPinId(e);if(!r)return i();var o=n.getPinCommentsMethod+"?pin_id="+r,a=new x(o,{user_id:n.state.user.id,filename:n.currentAnnotationsFilename});a.headers=n.state.additionalHeaders,a.send(function(e){n._handleResponse(e,function(e){"function"==typeof t&&t(e)}),i()})},-1)},_requestAddPinComment:function(e,t,n){this.addPinCommentMethod&&this._schedule(wt.OUTPUT,function(i,r){var o=i._getPinId(e);if(!o||!t)return r();var a=t.replace(/^\s+/,"").replace(/\s+$/,""),s=JSON.stringify({message_data:[{type:"text",value:a}]}),l=new x(i.addPinCommentMethod,{user_id:i.state.user.id,filename:i.currentAnnotationsFilename,pin_id:o,text:s});l.headers=i.state.additionalHeaders,l.send(function(e){i._handleResponse(e,function(e){"function"==typeof n&&n(e)}),r()})},-1)},_requestUpdateUsersUnitPreference:function(e,t){this.requestUsersUnitPreferenceMethod&&this._schedule(wt.OUTPUT,function(n,i){if(!e)return i();var r=new x(n.requestUsersUnitPreferenceMethod,{user_id:n.state.user.id,value:e},"PUT");r.headers=n.state.additionalHeaders,r.send(function(e){n._handleResponse(e,function(e){"function"==typeof t&&t(e)}),i()})},-1)},_requestGetUsersUnitPreference:function(e){this.requestUsersUnitPreferenceMethod&&this._schedule(wt.OUTPUT,function(t,n){var i=new x(t.requestUsersUnitPreferenceMethod,{user_id:t.state.user.id},"GET");i.headers=t.state.additionalHeaders,i.send(function(i){t._handleResponse(i,function(t){"function"==typeof e&&e(t)}),n()})},-1)},_startSketch:function(e){var t=this;t.state.sketchViewerState?t.state.setState(t.state.sketchViewerState,0,!1,function(){t._startSketchImpl(e)}):t.state.sketchCommentId?t._requestViewerStateURI(t.state.sketchCommentId,function(n){var i=n.viewer_state;i?t._request("GET",i,!1,null,function(n){t._handleResponse(n,function(n){t.state.setState(n,0,!1,function(){t._startSketchImpl(e)})})}):t._startSketchImpl(e)}):t._startSketchImpl(e)},_startSketchImpl:function(e){var t=this,n=t.sketcher;if(!t.state.isSketchMode){t.state.isSketchMode=!0,t.view.model.modelTree.treeUI.updateTreeVisibility();for(var i=function(e){e?(Lt.sendMouse("mouseup",{sender:t.view.$canvas}),e.json&&(t.state.sketchData=e.json,t.state.sketchThumbnail=e.thumbnailData,t.state.sketchImageData=e.imageData,t._updateSketchCallback(!0))):t._updateSketchCallback(!1);for(var n=0,i=t.state.pins.length;i>n;n++)t.showPin(t.state.pins[n].name);t.state.isSketchMode=!1,t.view.model.modelTree.treeUI.updateTreeVisibility(),t.view.model.fileComparisonManager.visible&&t.view.markupManager.showFileComparisonPopup(!0)},r=0,o=t.state.pins.length;o>r;r++)t.hidePin(t.state.pins[r].name);Z(function(){var r=t.state.sketchBackgroundData||t.getScreenshot(),o=t.state.sketchViewerState||t.state.getState(),a=t.state.sketchData,s=t.state.sketchImageData,l=!s&&!a;l?(n.create(i),n.background(r)):(n.create(i),s?n.fitBackground(s):n.background(r,function(){n.fromJSON(a)})),n.setReadonly(t.state.sketchIsReadOnly),t.state.sketchBackgroundData=r,t.state.sketchViewerState=o,e&&e()},250)}},_requestAddCommentSketchThumbnail:function(e,t,n,i){this.putSketchThumbnail&&this._schedule(wt.OUTPUT,function(r,o){if(e){var a=r.state.notes[e];if(!a)return o()}var s=r.putSketchThumbnail+"?user_id="+r.state.user.id+"&comment_id="+t,l=t+"-thumbnail",c=new C(s,n,{name:l,filename:l});c.headers=r.state.additionalHeaders,c.send(function(e){r._handleResponse(e,function(e){"function"==typeof i&&i(e)}),o()})},-1)},_requestAddCommentSketchBackground:function(e,t,n,i){this.putSketchBackground&&this._schedule(wt.OUTPUT,function(r,o){if(e){var a=r.state.notes[e];if(!a)return o()}var s=r.putSketchBackground+"?user_id="+r.state.user.id+"&comment_id="+t,l=t+"-background",c=new C(s,n,{name:l,filename:l});c.headers=r.state.additionalHeaders,c.send(function(e){r._handleResponse(e,function(e){"function"==typeof i&&i(e)}),o()})},-1)},_requestAddCommentSketchImage:function(e,t,n,i){this.putSketchImage&&this._schedule(wt.OUTPUT,function(r,o){if(e){var a=r.state.notes[e];if(!a)return o()}var s=r.putSketchImage+"?user_id="+r.state.user.id+"&comment_id="+t,l=t+"-image",c=new C(s,n,{name:l,filename:l});c.headers=r.state.additionalHeaders,c.send(function(e){r._handleResponse(e,function(e){"function"==typeof i&&i(e)}),o()})},-1)},_requestAddCommentSketchData:function(e,t,n,i){this.putSketchData&&this._schedule(wt.OUTPUT,function(r,o){if(e){var a=r.state.notes[e];if(!a)return o()}var s=new x(r.putSketchData,{user_id:r.state.user.id,comment_id:t,sketch_data:n});s.headers=r.state.additionalHeaders,s.send(function(e){r._handleResponse(e,function(e){"function"==typeof i&&i(e)}),o()})},-1)},getCurrentAnnotatorData:function(e){var t={};try{if(t.version=ut,t.transformation=this.getCurrentTransformation(),t.designAlpha=0,t.designWireframeVisible=0,t.designBoundingBoxVisible=0,t.designAxisVisible=0,t.designSmoothShading=0,e){t.pins=[];for(var n=0,i=this.state.pins.length;i>n;n++){var r=this.state.pins[n].name;t.pins.push(this.getPinData(r))}}}catch(o){return null}return t},getPinData:function(e,t,n,i){var r,o,a,s=this.state.pins[e],l=this.state.notes[e];r=[s.position.x,s.position.y,s.position.z],o=[s.normal.x,s.normal.y,s.normal.z],a=s.hvfwPin.getPinColor();var c={user:l.$titleUsername.getTextContent(),time:l.$titleTimestamp.actualDate,position:r,normal:o,color:a,version:ut,pinnableID:s.pinnableID,pinnableType:s.pinnableType};return t&&delete c.time,n&&delete c.title,i&&delete c.note,c},_getPinId:function(e){var t=this.state.pins[e];return t?t.id:void 0},_setPinId:function(e,t){var n=this.state.pins[e];n&&(n.id=t)},_getPinById:function(e){for(i=0;this.state.pins.length>i;i++)if(this.state.pins[i].id==e)return this.state.pins[i];return null},_getPinVersion:function(e){var t=this.state.pins[e];return t?void 0==t.version?0:t.version:0},_setPinVersion:function(e,t){var n=this.state.pins[e];n&&(n.version=t)},_getPinNumber:function(e){var t=this.state.pins[e];return t?t.number:void 0},_setPinNumber:function(e,t){var n=this.state.pins[e],i=this.state.notes[e];n&&(n.number=t,i.$titleDisplayNumber.setTextContent(t))},_getPinnableID:function(e){var t=this.state.pins[e];return t?t.pinnableID:void 0},_setPinnableID:function(e,t){var n=this.state.pins[e];n&&(n.pinnableID=t)},_getPinnableType:function(e){var t=this.state.pins[e];return t?t.pinnableType:void 0},_setPinnableType:function(e,t){var n=this.state.pins[e];this.state.notes[e],n&&(n.pinnableType=t)},_getPinCameraTransformation:function(e){var t=this.state.pins[e];return t?t.transformation:void 0},_setPinCameraTransformation:function(e,t){var n=this.state.pins[e];n&&(n.transformation=t)},getCurrentTransformation:function(){var e=this.controller.sceneNode.findNode("lookAt"),t=e.get("eye"),n=e.get("up"),i=e.get("look");return{camPosition:[t.x,t.y,t.z],camRotation:[0,0,0],camUp:[n.x,n.y,n.z],camTarget:[i.x,i.y,i.z],scenePosition:[0,0,0],sceneRotation:[0,0,0],sceneUp:[0,1,0]}},zoomIn:function(e){e=e||ft.CAMERA.UI_HWF_ZOOM_IN_SPEED,this.view.currentOperator.doZoom(e)},zoomOut:function(e){e=e||ft.CAMERA.UI_HWF_ZOOM_OUT_SPEED,this.view.currentOperator.doZoom(e)},rotateLeft:function(){this.view.currentOperator.rotateLeft()},rotateRight:function(){this.view.currentOperator.rotateRight()},rotateUp:function(){this.view.currentOperator.rotateUp()},rotateDown:function(){this.view.currentOperator.rotateDown()},showWireframe:function(e){e?this.toolbar.$showWireframe.check():this.toolbar.$showWireframe.uncheck()},showBoundingBox:function(e){e?this.toolbar.$showBoundingBox.check():this.toolbar.$showBoundingBox.uncheck()},showAxis:function(e){e?this.toolbar.$showAxis.check():this.toolbar.$showAxis.uncheck()},showEmbedNote:function(e){e?this.toolbar.$embed.check():this.toolbar.$embed.uncheck(),e?(this.view.embedNote=new g(this.state,this.view),this.view.embedNote.show()):this.view.embedNote&&(this.view.embedNote.hide(),this.view.embedNote=null)},smoothShading:function(e){e?this.trackball.$smoothShading.check():this.trackball.$smoothShading.uncheck()},dropPin:function(e){var t=null==this.state.drop_pin_callback;if(e){var n=e.point,i=e.face.normal;this.state.have_pending_pin&&(this.state.addPin.undo(),this.state.have_pending_pin=!1);var r=this.state.addPin.execute(0,n,i,!t,t);return this.state.notes[r].setViewMode("create"),t?this._requestAddPin(r,function(e){this._setPinId(r,e.pin.pin_id),this._setPinNumber(r,e.pin.display_number),this._setPinCameraTransformation(r,e.pin.transformation),this._setPinVersion(r,e.pin.version),this._setPinnableID(r,e.pin.pinnableID),this._setPinnableType(r,e.pin.pinnableType)}.bind(this)):(this.state.have_pending_pin=!0,this._setPinnableID(r,null),this._setPinnableType(r,null),this.state.annotator.hideAllNotes(),this.state.annotator.view.hideDropPinHint(),this.toolbar.$dropPin.uncheck(),this.state.stage=_t.VIEWING,this.state.annotator.view.currentOperator.clickOperator=$t.SELECT,this.state.drop_pin_callback(r)),r}},undropPin:function(e,t){return this._requestDeletePin(e,function(){this.state.remPin.execute(e,t,!0)}.bind(this)),e},setNote:function(e,t,n,i,r,o){return this.state.editNote.execute(e,t,n,i,r,o)},showNote:function(e){var t=this.state.notes[e];t&&Lt.sendCustom(St.NOTE_SHOW_REQUESTED,{data:e})},hideNote:function(e){var t=this.state.notes[e];t&&Lt.sendCustom(St.NOTE_HIDE_REQUESTED,{data:e})},showAllNotes:function(){for(var e=0,t=this.state.pins.length;t>e;e++)this.showNote(this.state.pins[e].name)},hideAllNotes:function(){for(var e=0,t=this.state.pins.length;t>e;e++)this.hideNote(this.state.pins[e].name)},toggleNotes:function(e){e?this.showAllNotes():this.hideAllNotes()},showPin:function(e){var t=this.state.notes[e];t&&(t.pin.parent?t.__pinParent__=t.pin.parent:t.__pinParent__&&t.__pinParent__.add(t.pin),t.pin.hvfwPin.show(),t.isVisible()&&t.pin.hvfwPin&&t.pin.hvfwPin.highlightPin(!0))},hidePin:function(e){var t=this.state.notes[e];t&&(t.__pinParent__=t.pin.parent,t.__pinParent__&&t.__pinParent__.remove(t.pin)),t.pin.hvfwPin.hide()},showAllPins:function(){for(var e=0,t=this.state.pins.length;t>e;e++)this.showPin(this.state.pins[e].name)},hideAllPins:function(){this.hideAllNotes();for(var e=0,t=this.state.pins.length;t>e;e++)this.hidePin(this.state.pins[e].name)},togglePins:function(e){e&&!this.view.model.explosionManager.hidePins?this.showAllPins():this.hideAllPins()},_importAnnotations:function(e){return e.version>=dt||e.version==ct?e:"1.49"==e.version?(delete e.transformation,e):null},_schedule:function(e,t,n,i){i=i||(e===wt.OUTPUT?wt.INPUT:e===wt.INPUT?wt.OUTPUT:void 0);var r=this,o=10,a=0,s=window.setInterval(function(){if(++a>(-1===n?Number.MAX_VALUE:n))return window.clearInterval(s),void 0;if(!r[e]){window.clearInterval(s),r[e]=!0;var l=window.setInterval(function(){r[i]||(window.clearInterval(l),t(r,function(){delete r[e]}))},o)}},o)},_request:function(e,t,n,i,r,o){var a=this,s=new XMLHttpRequest;s.open(e,t,!0),s.withCredentials=!0,n?s.responseType="arraybuffer":s.overrideMimeType("text/plain; charset=x-user-defined");var l={loaded:0,total:0,percentage:0,readyState:null,status:null,error:null};return s.onprogress=function(e){e.lengthComputable&&(l.loaded=e.loaded,l.total=e.total,l.percentage=Math.floor(100*(e.loaded/e.total)),"function"==typeof i&&i("working",l))},s.onreadystatechange=function(e){try{l.readyState=this.readyState,l.status=this.status}catch(e){l.error=e.toString()}switch(this.readyState){case 0:case 1:case 2:case 3:"function"==typeof i&&i("working",l);break;case 4:if(200===this.status){"function"==typeof r&&r(this),"function"==typeof i&&i("complete",l);break}default:"function"==typeof o&&o(a),"function"==typeof i&&i("error",l)}},s.send(null),s},_handleTextResponse:function(e,t,n){var i=function(e){n&&n(this),e&&e(this)}.bind(this,this.errorCallback),r=e.responseText;return r?(t(r),void 0):i()},_handleArrayResponse:function(e,t,n){var i=function(e){n&&n(this),e&&e(this)}.bind(this,this.errorCallback),r=e.response;return r?(t(r),void 0):i()},_handleResponse:function(e,t,n){var i=function(e){n&&n(this),this.errorCallback&&this.errorCallback(e)}.bind(this),r=e.responseText;if(!r)return i();var o,a;try{var s=r.indexOf("{");o=r.substring(0,s),a=JSON.parse(r.substring(s))}catch(l){return i()}return a?a.result&&"ok"!==a.result?i({result:a.result,error:a.error,info:o}):(t(a),void 0):i()},_serialize:function(e){var t;try{t=JSON.stringify(e)}catch(n){return null}return t},emptyFunction:function(){},sequence:function(){for(var e=[],t=0;arguments.length>t;++t){var n=arguments[t];n._sequenceArguments?Array.prototype.push.apply(e,n._sequenceArguments):e.push(n)}var i=function(){for(var t=0;e.length>t;++t)e[t].apply(this,arguments)};return i._sequenceArguments=e,i},stageKill:function(){this.stageKill()}},t.prototype={defaults:function(){this.mode=this.__mode__,this.stage=this.__stage__},isContentfileSTL:function(){return 1==this.is_stl},reset:function(){if(ft.CAMERA.X=ft.CAMERA.INITIAL_X,ft.CAMERA.Y=ft.CAMERA.INITIAL_Y,ft.CAMERA.Z=ft.CAMERA.INITIAL_Z,this.pins)for(var e=0,t=this.pins.length;t>e;e++){var n=this.pins[e],i=this.notes[n.name];n.parent&&n.parent.remove(n),i.hide()}this.pins=[],this.notes=[],this.defaults()},getState:function(){var e={};return e.annotatorVersion=ut,e.fileVersion=this.getFileVersion(),e.viewState=this.annotator.view.getState(),e},setState:function(e,t,n,i){var r={};e.viewState?r=e:(r.viewState=e,r.fileVersion=1.2,r.annotatorVersion=dt,r.viewState.modelState=e),this.annotator.view.setState(r.viewState,r,t,n,i)},fixUpOldStateCoordinateScale:function(e,t){if(!t&&e&&e.annotatorVersion&&(t=e.annotatorVersion),t&&ht>t){var n=this.getFileVersion();if(n>1.11)return this.annotator.view.model.modelUnits}return 1},fixUpOldStateCoordinate:function(e,t,n){var i=this.fixUpOldStateCoordinateScale(t,n);if(e.hasOwnProperty("x"))return new I(e.x*i,e.y*i,e.z*i);if(e instanceof Array){var r=new Array;return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r}return null},onFrame:function(){if(this.annotator.view&&this.pins&&this.notes)for(var e=0,t=this.pins.length;t>e;e++){var n=this.pins[e],i=this.notes[n.name];i.updateOwnership(),i.updatePosition()}},addPin:{execute:function(e,t,n,i,r){var o=this.annotator.view.createPinObject(t,n),a=o.name;o.id=e;var s=new l(this.annotator.state,this.annotator.view,o,this.user.name,this.mode===mt.READ_ONLY,r);return this.pins.push(o),this.pins[a]=o,this.notes.push(s),this.notes[a]=s,i||(s.show(),Lt.sendCustom(St.PIN_ADDED,{data:a})),a},undo:function(){var e=this.pins[this.pins.length-1];this.remPin.execute(e.name,!1,!1)}},remPin:{execute:function(e,t,n){var i=this.pins[e],r=this.notes[e];this.annotator.view.markupManager.deleteNote(this.pins[e].hvfwPin.id),(r.username===this.user.name||t)&&(i.hvfwPin&&i.hvfwPin.highlightPin(!1),i.parent&&i.parent.remove(i),r.hide(),this.pins.splice(this.pins.indexOf(i),1),this.notes.splice(this.notes.indexOf(r),1),delete this.pins[i.name],delete this.notes[i.name],n&&Lt.sendCustom(St.PIN_REMOVED,{data:e}))
},undo:function(){this.throwCommandNotSupportedException()}},editNote:{execute:function(e,t,n,i,r,o){var a=this.notes[e];if(a.username===this.user.name||o){a.$titleDisplayNumber.setTextContent(t),a.$titleUsername.setTextContent(n),a.$titleTimestamp.actualDate=i;var s=convertHexToRGB(""+r.toString(16));a.pin.hvfwPin.setPinColor(s.r/255,s.g/255,s.b/255),a.setDirty(),a.setUsername(n),a.updateTimestamps(),Lt.sendCustom(St.NOTE_EDITED,{data:e})}},undo:function(){this.throwCommandNotSupportedException()}},throwCommandNotSupportedException:function(){throw new Exception("Command not supported.")},bind:function(){var e=["addPin","remPin","editNote"],t=["execute","undo"];for(var n in this)if("object"==typeof this[n]&&-1!==e.indexOf(n))for(var i in this[n])"function"==typeof this[n][i]&&-1!==t.indexOf(i)&&(this[n][i]=this[n][i].bind(this));this.onFrame=this.onFrame.bind(this)},setBackgroundColor:function(e,t,n,i,r,o){this.backgroundStartColor[0]=e,this.backgroundStartColor[1]=t,this.backgroundStartColor[2]=n,this.backgroundEndColor[0]=i,this.backgroundEndColor[1]=r,this.backgroundEndColor[2]=o},setMeasurementColor:function(e,t,n){this.dimColor="rgb("+255*e+","+255*t+","+255*n+")",this.dimColorParameters={r:e,g:t,b:n}},worldToMM:function(e){return e},getFileVersion:function(){return this.annotator.view&&this.annotator.view.model?this.annotator.view.model.getFileVersion():0},setShowBackFaces:function(e){this.showBackFaces=e},initializeSVG:function(){if(!this.initializedSVG){var e=createSVG("marker",{id:"Triangle",viewBox:"0 0 30 30",refX:"10",refY:"5",markerUnits:"strokeWidth",markerWidth:"16",markerHeight:"12",stroke:this.dimColor,fill:this.dimColor,orient:"auto"});this.svgAnchor.appendChild(e);var t=createSVG("path",{d:"M 0 0 L 10 5 L 0 10 z"});document.getElementById("Triangle").appendChild(t),e=createSVG("marker",{id:"Triangle2",viewBox:"0 0 30 30",refX:"0",refY:"5",markerUnits:"strokeWidth",markerWidth:"16",markerHeight:"12",stroke:this.dimColor,fill:this.dimColor,orient:"auto"}),this.svgAnchor.appendChild(e),t=createSVG("path",{d:"M 10 0 L 0 5 L 10 10 z"}),document.getElementById("Triangle2").appendChild(t),e=createSVG("marker",{id:"Triangle3",viewBox:"0 0 30 30",refX:"0",refY:"5",markerUnits:"strokeWidth",markerWidth:"16",markerHeight:"12",stroke:this.dimColor,fill:this.dimColor,orient:"auto"}),this.svgAnchor.appendChild(e),t=createSVG("path",{d:"M 10 10 L 0 5 L 10 0 z M 10 5 L 20 5"}),document.getElementById("Triangle3").appendChild(t),e=createSVG("marker",{id:"Triangle4",viewBox:"-10 0 30 30",refX:"10",refY:"5",markerUnits:"strokeWidth",markerWidth:"16",markerHeight:"12",stroke:this.dimColor,fill:this.dimColor,orient:"auto"}),this.svgAnchor.appendChild(e),t=createSVG("path",{d:"M 10 5 L 0 10 L 0 0 z M 0 5 L -10 5"}),document.getElementById("Triangle4").appendChild(t),e=createSVG("marker",{id:"Triangle5",viewBox:"-30 0 40 30",refX:"10",refY:"5",markerUnits:"strokeWidth",markerWidth:"16",markerHeight:"12",stroke:this.dimColor,fill:this.dimColor,orient:"auto"}),this.svgAnchor.appendChild(e),t=createSVG("path",{d:"M 0 0 L 10 5 L 0 10 z M 0 5 L -30 5"}),document.getElementById("Triangle5").appendChild(t),this.initializedSVG=!0}}},n.prototype={setup:function(e){e=e||{};for(var t=document.createElement("canvas"),n=document.getElementById(this.parentId);n.lastChild&&n.lastChild.id!=this.hvfwCanvasId&&n.lastChild.id!=this.hvfwSvgContainerId;)n.removeChild(n.lastChild);var i=n.getBoundingClientRect();i.top,i.left,i.width,i.height,t.className="annotator-canvas",n.className+=" annotator-parent",n.appendChild(t),this.$parent=n,this.$canvas=t,this.$hvfwCanvas=document.getElementById(this.hvfwCanvasId),this.$hvfwSvgContainer=document.getElementById(this.hvfwSvgContainerId),window.addEventListener("resize",this.onResize)},blockMouseEvents:function(){this.mouseEventsBlocked=!0},unblockMouseEvents:function(){this.mouseEventsBlocked=!1},baseFileVersionInUrl:function(e){var t=e.split("version/");return t.length>1?t[1].split("/compare")[0]:null},urlChangeWillCauseReload:function(e){var t=this.baseFileVersionInUrl(location.hash),n=this.baseFileVersionInUrl(e);return null!=t&&null!=n&&t!==n},getState:function(){var e={};return e.modelState=this.model.getState(),e.viewTransformation=this.annotator.getCurrentTransformation(),e.modelBoundingMinimum=this.getModelBoundingMinimum(!1,!1),e.modelBoundingMaximum=this.getModelBoundingMaximum(!1,!1),e},setState:function(e,t,n,i,r){if(!i&&e&&e.modelState&&e.modelState.fileComparisonState&&e.modelState.fileComparisonState.comparisonUrl&&this.urlChangeWillCauseReload(e.modelState.fileComparisonState.comparisonUrl)){this.pendingState=t;var o=this.pendingState.viewState.modelState.fileComparisonState.comparisonUrl;return this.pendingCallback=r,location.hash=o,void 0}if(e){this.model.setState(e.modelState,t);var a=e.viewTransformation;if(a){var s=new I,l=new I,c=new I;s.x=a.camPosition[0],s.y=a.camPosition[1],s.z=a.camPosition[2],l.x=a.camTarget[0],l.y=a.camTarget[1],l.z=a.camTarget[2],c.x=a.camUp[0],c.y=a.camUp[1],c.z=a.camUp[2],a.coordinatesInMM||(s=this.annotator.state.fixUpOldStateCoordinate(s,t),l=this.annotator.state.fixUpOldStateCoordinate(l,t)),this.rotateToPosition({cameraPos:s,lookAt:l,upVector:c,duration:n?n:500})}}r&&r()},setPendingStateIfAny:function(){this.pendingState&&(this.setState(this.pendingState.viewState,this.pendingState,null,!0,this.pendingCallback),this.pendingState=null,this.pendingCallback=null)},onResize:function(){var e,t,n,i=this.$hvfwCanvas;e=this.annotator.view.$parent.getBoundingClientRect(),t=e.width,n=e.height,i.width=t,i.height=n,this.$hvfwSvgContainer.style.width=t+"px",this.$hvfwSvgContainer.style.height=n+"px",this.annotator.controller.clientW=this.$hvfwCanvas.clientWidth,this.annotator.controller.clientH=this.$hvfwCanvas.clientHeight,F.fromScene(this.annotator).applyToScene(this.annotator),this.annotator.view.model&&this.annotator.view.model.modelTree&&this.annotator.view.model.modelTree.treeUI&&this.annotator.view.model.modelTree.treeUI.updateTreeHeight(),this.annotator.view&&this.annotator.view.dropPinPopup&&this.annotator.view.dropPinPopup.resetPos(),this.annotator.view&&this.annotator.view.helpPopup&&this.annotator.view.helpPopup.resetPos(),this.annotator.view.markupManager&&this.annotator.view.markupManager.cuttingPlaneUI&&this.annotator.view.markupManager.cuttingPlaneUI.resetPos(),this.annotator.view.markupManager&&this.annotator.view.markupManager.explodeAssemblyUI&&this.annotator.view.markupManager.explodeAssemblyUI.resetPos(),this.annotator.view.markupManager&&this.annotator.view.markupManager.fileComparisonUI&&this.annotator.view.markupManager.fileComparisonUI.resetPos(),this.annotator.view.markupManager&&this.annotator.view.markupManager.measurementUI&&this.annotator.view.markupManager.measurementUI.resetPos()},loop:function(e){this.loop&&(window.requestAnimationFrame(this.loop),e())},createPinObject:function(e,t){var n={};return n.name="pin@"+e.x+","+e.y+","+e.z,n.hvfwPin=null,n.position=e,n.normal=t,n},initializeModel:function(){this.model?this.model.reset():this.model=new T(this.annotator,!0)},getModelBoundingMinimum:function(e,t){var n;if(e&&this.referenceModel){var i=this.model.boundingMinimum,r=this.referenceModel.boundingMinimum;n=new O(i.x<r.x?i.x:r.x,i.y<r.y?i.y:r.y,i.z<r.z?i.z:r.z)}else n=this.model.boundingMinimum;return t&&this.computeExplodedPosition(n),n},getModelBoundingMaximum:function(e,t){var n;if(e&&this.referenceModel){var i=this.model.boundingMaximum,r=this.referenceModel.boundingMaximum;n=new O(i.x>r.x?i.x:r.x,i.y>r.y?i.y:r.y,i.z>r.z?i.z:r.z)}else n=this.model.boundingMaximum;return t&&this.computeExplodedPosition(n),n},computeExplodedPosition:function(e){var t=1,n=new O(0,0,0);if(this.model.explosionManager){t+=this.model.explosionManager.activeExplodeLevel;var i=this.model.explosionManager.explosionCenter;if(i){var r=new O(0,0,0);r.subtract(e,i);var o=r.length();o>0&&r.normalize(),n.x=i.x+r.x*o*t,n.y=i.y+r.y*o*t,n.z=i.z+r.z*o*t}else n=e}else n=e;return n},showDropPinHint:function(){this.dropPinPopup||(this.dropPinPopup=new m(this.annotator)),this.dropPinPopup.setTextContent("Click on the model to place a new pin."),this.dropPinPopup.show()},hideDropPinHint:function(){this.dropPinPopup&&this.dropPinPopup.hide()},showHelp:function(){this.helpPopup||(this.helpPopup=new f(this.annotator)),this.helpPopup.show()},hideHelp:function(){this.helpPopup&&this.helpPopup.hide()},setProjection:function(e){e!=this.projectionMode&&(this.projectionMode=e,this.fitWorld({duration:0}))},setViewOrientation:function(e,t){var n=new O(0,0,0),i=new O(0,0,1),r=new O((this.model.boundingMaximum.x+this.model.boundingMinimum.x)/2,(this.model.boundingMaximum.y+this.model.boundingMinimum.y)/2,(this.model.boundingMaximum.z+this.model.boundingMinimum.z)/2);n.setFromHoopsPoint(r);var o=new O(0,0,0);switch(this.viewConfiguration){case Ct.Y_UP:switch(i.set(0,1,0),e){case xt.GC_DEFAULT:o.set(.8,.6,1),n.set(n.x+o.x,n.y+o.y,n.z+o.z),i.clean(o);break;case xt.FRONT:n.z+=1;break;case xt.BACK:n.z-=1;break;case xt.LEFT:n.x-=1;break;case xt.RIGHT:n.x+=1;break;case xt.BOTTOM:n.y-=1,i.set(0,0,1);break;case xt.TOP:n.y+=1,i.set(0,0,-1);break;case xt.ISO:o.set(1,1,1),n.set(n.x+o.x,n.y+o.y,n.z+o.z),i.clean(o)}break;case Ct.Z_UP:switch(i.set(0,0,1),e){case xt.GC_DEFAULT:o.set(1,-.8,.6),n.set(n.x+o.x,n.y+o.y,n.z+o.z),i.clean(o);break;case xt.FRONT:n.y-=1;break;case xt.BACK:n.y+=1;break;case xt.LEFT:n.x-=1;break;case xt.RIGHT:n.x+=1;break;case xt.BOTTOM:n.z-=1,i.set(0,-1,0);break;case xt.TOP:n.z+=1,i.set(0,1,0);break;case xt.ISO:o.set(1,-1,1),n.set(n.x+o.x,n.y+o.y,n.z+o.z),i.clean(o)}}var a=t?"far":F.fromScene(this.annotator);this.annotator.controller.sceneNode.findNode("lookAt").set("eye",{x:n.x,y:n.y,z:n.z}),this.annotator.controller.sceneNode.findNode("lookAt").set("look",{x:r.x,y:r.y,z:r.z}),this.annotator.controller.sceneNode.findNode("lookAt").set("up",{x:i.x,y:i.y,z:i.z}),this.fitWorld({beforeCamera:a})},rollCamera:function(e){var t=this.annotator.controller.sceneNode.findNode("lookAt").get("eye"),n=this.annotator.controller.sceneNode.findNode("lookAt").get("look"),i=this.annotator.controller.sceneNode.findNode("lookAt").get("up"),r=new O(t.x,t.y,t.z),o=new O(n.x,n.y,n.z),a=new O(i.x,i.y,i.z),s=new O(o.x-r.x,o.y-r.y,o.z-r.z);s.normalize(),0!=e&&(computeArbitaryRotatedPoint(s,a,e,a),a.normalize()),this.annotator.controller.sceneNode.findNode("lookAt").set("up",{x:a.x,y:a.y,z:a.z})},dollyCamera:function(e){var t=this.annotator.controller.sceneNode.findNode("lookAt").get("eye"),n=this.annotator.controller.sceneNode.findNode("lookAt").get("look"),i=this.annotator.controller.sceneNode.findNode("lookAt").get("up"),r=new O(t.x,t.y,t.z),o=new O(n.x,n.y,n.z);new O(i.x,i.y,i.z),o.set(o.x-e.x,o.y-e.y,o.z-e.z),r.set(r.x-e.x,r.y-e.y,r.z-e.z),this.annotator.controller.sceneNode.findNode("lookAt").set("eye",{x:r.x,y:r.y,z:r.z}),this.annotator.controller.sceneNode.findNode("lookAt").set("look",{x:o.x,y:o.y,z:o.z})},orbitCamera:function(e,t,n){var i=this.annotator.controller.sceneNode.findNode("lookAt").get("eye"),r=this.annotator.controller.sceneNode.findNode("lookAt").get("look"),o=this.annotator.controller.sceneNode.findNode("lookAt").get("up"),a=new O(i.x,i.y,i.z),s=new O(r.x,r.y,r.z),l=new O(o.x,o.y,o.z),c=e?e:new O(r.x,r.y,r.z),u=new O(s.x-a.x,s.y-a.y,s.z-a.z),d=u.length(),h=new O(c.x-a.x,c.y-a.y,c.z-a.z),p=h.length();if(h.normalize(),0!=t){computeArbitaryRotatedPoint(l,h,-t,h),h.normalize();var f=new O(0,0,0);computeCrossProduct(l,h,f)}if(0!=n){var f=new O(0,0,0);computeCrossProduct(l,h,f),computeArbitaryRotatedPoint(f,h,n,h),h.normalize(),computeCrossProduct(h,f,l)}a.set(c.x-h.x*p,c.y-h.y*p,c.z-h.z*p),s.set(a.x+h.x*d,a.y+h.y*d,a.z+h.z*d),this.annotator.controller.sceneNode.findNode("lookAt").set("eye",{x:a.x,y:a.y,z:a.z}),this.annotator.controller.sceneNode.findNode("lookAt").set("up",{x:l.x,y:l.y,z:l.z}),this.annotator.controller.sceneNode.findNode("lookAt").set("look",{x:s.x,y:s.y,z:s.z})},orientToFace:function(e,t){var n=this.annotator.controller.sceneNode.pick(e,t,{rayPick:!0});if(n){if(-1!=n.name.indexOf("note"))return!1;var i=this.annotator.controller.sceneNode,r=i.sceneNode.findNode(n.name),o=Number.POSITIVE_INFINITY,a=-1,s=null,l=null,c=null,u=0,d=n.name.split("s"),h=this.model.getSegmentProperties(parseInt(d[1])).faceData;if(r.eachNode(function(){var e=this.get("type");if("geometry"==e&&4==this._targetNode.core.primitive){for(var t=i.sceneNode.findNode("lookAt").get("eye"),n=this.get("positions"),r=this.get("indices"),d=new Array,h=0;n.length>h;h++)d[h]=n[h];var p=new Array,f=this.model.resolveMatrices(this,p);f&&applyTransformationToPoints(d,p);for(var m=this.get("normals"),g=new Array,h=0;m.length>h;h++)g[h]=m[h]+n[h];f&&applyTransformationToPoints(g,p);for(var h=0;m.length>h;h+=3){var v=new O(g[h]-d[h],g[h+1]-d[h+1],g[h+2]-d[h+2]);v.normalize(),g[h]=v.x,g[h+1]=v.y,g[h+2]=v.z}var y=new Array(2);y[0]=i.firstSelectionRay,y[1]=i.secondSelectionRay;var b=new Array(3);b[0]=new O(0,0,0),b[1]=new O(0,0,0),b[2]=new O(0,0,0);for(var h=0;r.length>h;h+=3){var _=new Array(3);_[0]=new O(d[3*r[h]],d[3*r[h]+1],d[3*r[h]+2]),_[1]=new O(d[3*r[h+1]],d[3*r[h+1]+1],d[3*r[h+1]+2]),_[2]=new O(d[3*r[h+2]],d[3*r[h+2]+1],d[3*r[h+2]+2]);var w=new O(0,0,0);if(result=computeIntersectionOfRayAndTriangle(this.annotator.controller.firstSelectionRay,this.annotator.controller.secondSelectionRay,_[0],_[1],_[2],w),1==result){var S=new O(w.x-t.x,w.y-t.y,w.z-t.z);o>S.length()&&(o=S.length(),a=h/3,s=d,l=r,c=g,u=parseInt(this.get("id").split("-")[1]))}}}},{andSelf:!0,depthFirst:!0}),null!=s){var p=l,f=s,m=c,g=0,v=this.model.extraShellData[u];void 0!=v&&(g=v[a]);var y=new Array(3);if(new Array(3),measureAdded=!0,void 0!=h[g]&&h[g].type==Et.PLANE_TYPE){for(var b=0;p.length>b;b+=3)if(void 0==v||v[b/3]==g){y[0]=new O(f[3*p[b]],f[3*p[b]+1],f[3*p[b]+2]),y[1]=new O(f[3*p[b+1]],f[3*p[b+1]+1],f[3*p[b+1]+2]),y[2]=new O(f[3*p[b+2]],f[3*p[b+2]+1],f[3*p[b+2]+2]);break}this.annotator.view.orientCameraToFace(v,a,p,f,m)}this.annotator.view.needsUpdate=!0}}},orientCameraToFace:function(e,t,n,i,r){var o=-1;void 0!=e&&(o=e[t]);for(var a=new O(1e6,1e6,1e6),s=new O(-1e6,-1e6,-1e6),l=new O(0,0,0),c=!0,u=0;n.length>u;u+=3)if(void 0==e||e[u/3]==o)for(var d=0;3>d;d++)c&&(c=!1,l.set(r[3*n[u+d]],r[3*n[u+d]+1],r[3*n[u+d]+2]),l.normalize()),a.x>i[3*n[u+d]]&&(a.x=i[3*n[u+d]]),s.x<i[3*n[u+d]]&&(s.x=i[3*n[u+d]]),a.y>i[3*n[u+d]+1]&&(a.y=i[3*n[u+d]+1]),s.y<i[3*n[u+d]+1]&&(s.y=i[3*n[u+d]+1]),a.z>i[3*n[u+d]+2]&&(a.z=i[3*n[u+d]+2]),s.z<i[3*n[u+d]+2]&&(s.z=i[3*n[u+d]+2]);var h,p=new O((s.x+a.x)/2,(s.y+a.y)/2,(s.z+a.z)/2),f=new O(s.x-a.x,s.y-a.y,s.z-a.z);h=0==this.projectionMode?1.3:585;var m=this.annotator.controller.sceneNode.findNode("lookAt").get("eye"),g=new O(m.x,m.y,m.z),v=new O(p.x-l.x*f.length()*h,p.y-l.y*f.length()*h,p.z-l.z*f.length()*h),y=new O(p.x+l.x*f.length()*h,p.y+l.y*f.length()*h,p.z+l.z*f.length()*h),b=new O(0,0,0),_=b.subtract(v,g),w=b.subtract(y,g),S=new O(0,0,0);w>_?S.setFromHoopsPoint(v):S.setFromHoopsPoint(y);var x=F.fromScene(this.annotator);this.annotator.controller.sceneNode.findNode("lookAt").set("eye",{x:S.x,y:S.y,z:S.z}),this.annotator.controller.sceneNode.findNode("lookAt").set("look",{x:p.x,y:p.y,z:p.z});var C=null;C=Math.abs(l.x)<=Math.abs(l.y)&&Math.abs(l.x)<=Math.abs(l.z)?new O(1,0,0):Math.abs(l.y)<=Math.abs(l.x)&&Math.abs(l.y)<=Math.abs(l.z)?new O(0,1,0):new O(0,0,1),this.annotator.controller.sceneNode.findNode("lookAt").set("up",{x:C.x,y:C.y,z:C.z});var $=F.fromScene(this.annotator);x.applyToScene(this.annotator),this.annotator.controller.utilities.smoothTransition($,500)},setDefaultCamera:function(){this.setViewOrientation(xt.GC_DEFAULT,!0),this.cameraSet=!0},computeEyeToTargetDistance:function(e,t,n,i){var r=Math.PI/180,o=n*r/2,a=Math.cos(o),s=Math.sin(o),l=new O(a*e.x-s*t.x,a*e.y-s*t.y,a*e.z-s*t.z),c=new O(-a*e.x-s*t.x,-a*e.y-s*t.y,-a*e.z-s*t.z),u=i.map(function(e){var t=e.dot(l),n=e.dot(c),i=Math.max(t,n);return i}),d=Math.max.apply(Math,u),h=d/Math.sin(o);return h},fitWorld:function(e){e=e||{};var t=e.beforeCamera||F.fromScene(this.annotator),n=void 0===e.duration?500:e.duration,i=this.annotator.controller.sceneNode.findNode("lookAt").get("eye"),r=this.annotator.controller.sceneNode.findNode("lookAt").get("look"),o=this.annotator.controller.sceneNode.findNode("lookAt").get("up"),a=new O(i.x,i.y,i.z),s=new O(r.x,r.y,r.z),l=new O(o.x,o.y,o.z);l.normalize(),new O(this.model.boundingMaximum.x-this.model.boundingMinimum.x,this.model.boundingMaximum.y-this.model.boundingMinimum.y,this.model.boundingMaximum.z-this.model.boundingMinimum.z);var c=new O(s.x-a.x,s.y-a.y,s.z-a.z);c.normalize();var u=new O(0,0,0);if(computeCrossProduct(l,c,u),u.normalize(),s=new O((this.model.boundingMaximum.x+this.model.boundingMinimum.x)/2,(this.model.boundingMaximum.y+this.model.boundingMinimum.y)/2,(this.model.boundingMaximum.z+this.model.boundingMinimum.z)/2),this.firstUpdate&&!this.cameraSet){var d=new O(0,1,0);this.annotator.controller.sceneNode.findNode("lookAt").set("up",{x:d.x,y:d.y,z:d.z}),c=new O(0,0,-1)}this.annotator.controller.sceneNode.findNode("lookAt").set("look",{x:s.x,y:s.y,z:s.z});var h=this.model.boundingMinimum,p=this.model.boundingMaximum,f=[];f.push(new O(h.x,h.y,h.z)),f.push(new O(h.x,h.y,p.z)),f.push(new O(h.x,p.y,h.z)),f.push(new O(h.x,p.y,p.z)),f.push(new O(p.x,h.y,h.z)),f.push(new O(p.x,h.y,p.z)),f.push(new O(p.x,p.y,h.z)),f.push(new O(p.x,p.y,p.z)),f=f.map(function(e){return e.sub(s),e});var m=this.annotator.controller.clientW/this.annotator.controller.clientH,g=.1,v=this.computeEyeToTargetDistance(l,c,g,f),y=m*g,b=this.computeEyeToTargetDistance(u,c,y,f),_=.85,w=Math.max(b,v)/_;a=new O(s.x-w*c.x,s.y-w*c.y,s.z-w*c.z),this.annotator.controller.sceneNode.findNode("lookAt").set("eye",{x:a.x,y:a.y,z:a.z}),this.annotator.controller.sceneNode.findNode("camera").set("optics",{type:"perspective",fovy:g,aspect:m,near:.1*w,far:1.9*w}),this.drawingMode||!this.firstUpdate||this.cameraSet||this.orbitCamera(null,45,45),this.firstUpdate=!1;var S=F.fromScene(this.annotator);if("far"==t){var x=new O(s.x-2*w*c.x,s.y-2*w*c.y,s.z-2*w*c.z);this.annotator.controller.sceneNode.findNode("lookAt").set("eye",{x:x.x,y:x.y,z:x.z})}else t.applyToScene(this.annotator);this.annotator.controller.utilities.smoothTransition(S,n),this.currentOperator.setRotateCenter(s)},rotateToPosition:function(e){e=e||{};var t=e.beforeCamera||F.fromScene(this.annotator),n=void 0===e.duration?500:e.duration,i=new O(e.lookAt.x,e.lookAt.y,e.lookAt.z),r=new O(e.cameraPos.x,e.cameraPos.y,e.cameraPos.z),o=new O(e.upVector.x,e.upVector.y,e.upVector.z);if(this.annotator.controller.sceneNode.findNode("lookAt").set("eye",{x:r.x,y:r.y,z:r.z}),this.annotator.controller.sceneNode.findNode("lookAt").set("look",{x:i.x,y:i.y,z:i.z}),this.annotator.controller.sceneNode.findNode("lookAt").set("up",{x:o.x,y:o.y,z:o.z}),n>0){var a=F.fromScene(this.annotator);t.applyToScene(this.annotator),this.annotator.controller.utilities.smoothTransition(a,n)}}},r.prototype={getMousePosition:function(e){var t=e.target.getBoundingClientRect();return[e.clientX-t.left,e.clientY-t.top]},onMouseMove:function(){},onMouseClick:function(){},onMouseDblClick:function(){},onMouseDown:function(e){this._mDownPos=this.getMousePosition(e),this._mPressed=!0},onMouseUp:function(){this._mPressed=!1},onMouseOut:function(){Lt.sendMouse("mouseup",{sender:this.view.$canvas})},onMouseScroll:function(){},addMouseEventListener:function(e,t){var n=this.view;n.$hvfwCanvas.addEventListener(e,function(e){!n.mouseEventsBlocked&&n.currentOperator[t]?n.currentOperator[t](e,this):e.preventDefault?e.preventDefault():e.returnValue=!1})},startEventListenning:function(){if(!this.assignedEventListeners){var e=this.view;this.addMouseEventListener("mousedown","onMouseDown"),this.addMouseEventListener("click","onMouseClick"),this.addMouseEventListener("dblclick","onMouseDblClick"),this.addMouseEventListener("mousemove","onMouseMove"),this.addMouseEventListener("mouseup","onMouseUp"),this.addMouseEventListener("touchstart","onTouchStart"),this.addMouseEventListener("touchmove","onTouchMove"),this.addMouseEventListener("touchend","onTouchEnd"),this.addMouseEventListener("DOMMouseScroll","onMouseWheel"),this.addMouseEventListener("contextmenu","onContextMenu"),this.addMouseEventListener("mousewheel","onMouseWheel"),e.$hvfwCanvas.onselectstart=function(){return!1},e.$parent.addEventListener("keydown",function(t){e.mouseEventsBlocked||e.currentOperator.onKeyDown(t)},!1),e.$parent.addEventListener("keyup",function(t){e.mouseEventsBlocked||e.currentOperator.onKeyUp(t)},!1),this.assignedEventListeners=!0}},getCuttingPlaneShader:function(){var e=["uniform bool clipEnabled;","uniform bool clipInside;","uniform vec4 clipNormalAndDist;","vec4 myWorldPosFunc(vec4 pos){","   if (clipEnabled) {","        float dist = dot(pos.xyz, clipNormalAndDist.xyz) - clipNormalAndDist.w;","        if (clipInside) {","            if (dist < 0.0) { discard; }","        } else {","            if (dist > 0.0) { discard; }","        }","   }","   return pos;","}"],t="myWorldPosFunc",n={type:"shader",coreId:"cuttingPlaneShader",shaders:[{stage:"fragment",code:e,hooks:{worldPos:t}}],params:{clipEnabled:!0,clipInside:!0,clipNormalAndDist:[0,0,.1,-3]}};return n},getMaterialTransformShader:function(){var e=["uniform bool   colorTransEnabled;","uniform bool   colorHighlightEnabled;","uniform bool   alphaTransEnabled;","uniform float  alphaTransValue;","uniform vec3    mixColor;","uniform float  mixColorValue;","const vec3 highlightColor = vec3(0.199,0.664,0.863);","const vec3 transColor = vec3(0.199,0.664,0.863);","vec3 materialBaseColor(vec3 color) {","   if (colorHighlightEnabled) {","   color = highlightColor;","   }else if (colorTransEnabled) {","   color = transColor;","   }","   color = mix(color, mixColor, mixColorValue);","   return color;","}","float transformAlpha(float alpha) {","   if (alphaTransEnabled) {","      alpha *= alphaTransValue;","   }","   return alpha;","}"],t={type:"shader",coreId:"colorTransShader",shaders:[{stage:"fragment",code:e,hooks:{materialBaseColor:"materialBaseColor",materialAlpha:"transformAlpha"}}],params:{colorTransEnabled:!0,colorHighlightEnabled:!0,mixColor:[0,0,0],mixColorValue:0,alphaTransEnabled:!1,alphaTransValue:1}};return t},setup3D:function(){var e="theScene",t=this.getCuttingPlaneShader(),n=this.getMaterialTransformShader();if(SceneJS.sceneExists(e)){var i,r;this.referenceModelNode&&(this.referenceModelNode.destroy(),this.referenceModelNode=null,this.view.referenceModel=null);var o=this.view.model.modelNode.parent();i=o._targetNode,i.removeNodes();var a={type:"node",id:"modelNode~"+ ++this.view.model.nodeIdSuffix};return o.add("node",a),this.view.model.modelNode=null,SceneJS_compileModule.nodeUpdated(this.sceneNode._targetNode),i=this.view.model.libraryNode._targetNode,i.removeNodes(),i=this.view.model.libraryNode,i.add("node",n),i.add("node",t),r={type:"shader",coreId:"lineShader",shaders:[{stage:"fragment",code:["uniform bool   colorTransEnabled;","uniform bool   colorHighlightEnabled;","vec3 materialBaseColor(vec3 color) {","   if (colorHighlightEnabled) {","   color.r = 1.0;","   color.g = 1.0;","   color.b = 0.0;","   }else if (colorTransEnabled) {","   color.r = 1.0;","   color.g = 0.0;","   color.b = 0.0;","   }","   return color;","}"],hooks:{materialBaseColor:"materialBaseColor"}}],params:{colorTransEnabled:!0,colorHighlightEnabled:!0}},i.add("node",r),void 0}var s=this.state.annotator;SceneJS.createScene({id:e,canvasId:this.view.hvfwCanvasId,contextAttr:{stencil:!0},nodes:[{type:"library",id:"libraryNode",nodes:[n,t,{type:"shader",coreId:"lineShader",shaders:[{stage:"fragment",code:["uniform bool   colorTransEnabled;","uniform bool   colorHighlightEnabled;","vec3 materialBaseColor(vec3 color) {","   if (colorHighlightEnabled) {","   color.r = 1.0;","   color.g = 1.0;","   color.b = 0.0;","   }else if (colorTransEnabled) {","   color.r = 1.0;","   color.g = 0.0;","   color.b = 0.0;","   }","   return color;","}"],hooks:{materialBaseColor:"materialBaseColor"}}],params:{colorTransEnabled:!0,colorHighlightEnabled:!0}}]},{type:"lookAt",id:"lookAt",eye:{x:1.069893,y:-.4171,z:.606092},look:{x:.0325,y:0,z:.062444},up:{x:-.405585,y:.16343,z:.899328},nodes:[{type:"camera",id:"camera",optics:{type:"perspective",fovy:45,aspect:1,near:0,far:300},nodes:[{type:"renderer",clearColor:{r:1,g:1,b:1},clear:{depth:!0,color:!0},nodes:[{type:"camera",id:"camera2",optics:{type:"ortho",left:-1,right:1,bottom:-1,top:1,near:0,far:33e3},nodes:[{type:"billboard",nodes:[{type:"stationary",nodes:[{type:"material",baseColor:{r:.95,g:.95,b:.95},emit:.84,specular:0,nodes:[{type:"translate",id:"backgroundPaneTranslate",z:-33e3,nodes:[{type:"scale",x:1.1,y:1.1,z:1,nodes:[{type:"flags",flags:{picking:!1},nodes:[{type:"geometry",id:"backgroundPane",primitive:"triangles",positions:[1,1,1,-1,1,1,-1,-1,1,1,-1,1],normals:[0,0,1,0,0,1,0,0,1,0,0,1],colors:[s.state.backgroundStartColor[0],s.state.backgroundStartColor[1],s.state.backgroundStartColor[2],1,s.state.backgroundStartColor[0],s.state.backgroundStartColor[1],s.state.backgroundStartColor[2],1,s.state.backgroundEndColor[0],s.state.backgroundEndColor[1],s.state.backgroundEndColor[2],1,s.state.backgroundEndColor[0],s.state.backgroundEndColor[1],s.state.backgroundEndColor[2],1],indices:[0,1,2,0,2,3]}]}]}]}]}]}]}]},{type:"light",id:"helmet1",mode:"dir",color:{r:.37,g:.37,b:.37},diffuse:!0,specular:!0,dir:{x:.7,y:-.27,z:-1},space:"view"},{type:"light",id:"helmet2",mode:"dir",color:{r:.35,g:.35,b:.35},diffuse:!0,specular:!0,dir:{x:-.7,y:-.27,z:-1},space:"view"},{type:"rotate",id:"pitch",angle:0,x:1,nodes:[{type:"scale",id:"initialscale",x:0,y:0,z:0,nodes:[{type:"material",id:"lowest",emit:0,baseColor:{r:.75,g:.75,b:.75},specular:0,shine:7,nodes:[{type:"node",id:"modelParent",nodes:[{type:"node",id:"modelNode~0"}]}]}]}]}]}]}]}]}),this.sceneNode=SceneJS.scene(e)},startScene:function(){var e=this.sceneNode,t=this.view.model,n=this.view;e.start({idleFunc:function(){if(n.needsUpdate){n.needsUpdate=!1;var i=e.findNode("lookAt"),r=i.get("eye");i.set("eye",{x:r.x,y:r.y,z:r.z})}t.tempNode.eachNode(function(){var n=this.get("type");if("translate"==n){var i=this.get("id").toString();if(-1!=i.indexOf("notea")||-1!=i.indexOf("measurea")){var r=new O(0,0,0);r.set(this.get("x"),this.get("y"),this.get("z"));var o,a=e.findNode("lookAt").get("eye"),s=new O(r.x-a.x,r.y-a.y,r.z-a.z);o=0==t.projectionMode?s.length()/100:s.length()/100/450;var l=this.node(0);l.set({x:o,y:o,z:o})}}},{andSelf:!0,depthFirst:!0})}})},getCurrentViewDirection:function(){var e=this.sceneNode.findNode("lookAt").get("eye"),t=this.sceneNode.findNode("lookAt").get("look"),n=new O(e.x,e.y,e.z),i=new O(t.x,t.y,t.z),r=new O(i.x-n.x,i.y-n.y,i.z-n.z);return r.normalize(),r},dumpSceneGraph:function(e,t,n){e=e||this.sceneNode._targetNode,t=t||"",n=n||0;var i=t+"("+n+")"+JSON.stringify(e.getJSON());e.core&&e.core.hasOwnProperty("flags")&&(i+=" : <"+JSON.stringify(e.core.flags)+">"),console.log(i);for(var r=e.children.length,o=0;r>o;o++)this.dumpSceneGraph(e.children[o],t+"  ",n+1)},readModelData:function(e){this.setup3D(),this.view.initializeModel();var t=new Uint8Array(e);this.state.annotator.view.model.parseHSF(t);var n=this.sceneNode.findNode("initialscale");n.set({x:1,y:1,z:1});var i=this.view,r=this.view.model,o=this.state.annotator,a=!0;return r.captureManager.applyDefaultCapture(this.state.annotator),r.explosionManager?r.explosionManager.reset():r.explosionManager=new H(o),r.cuttingPlaneManager?r.cuttingPlaneManager.reset():r.cuttingPlaneManager=new z(o),r.fileComparisonManager?r.fileComparisonManager.reset():r.fileComparisonManager=new AnnotatorFileComparisonManager(o),r.firstNode&&(r.boundingMinimum.set(1e6,1e6,1e6),r.boundingMaximum.set(-1e6,-1e6,-1e6),this.sceneNode.findNode("s"+r.firstNode).eachNode(function(){if(this.get("type"),"node"==this.get("type")){var e=this.get("id");if(-1!=e.indexOf("s")){var t=e.split("s");r.hasSegmentProperties(parseInt(t[1]))&&r.getSegmentProperties(parseInt(t[1])).visible&&r.accumulateBoundingBox(t[1],r.boundingMinimum,r.boundingMaximum)}}},{andSelf:!0,depthFirst:!0})),i.setDefaultCamera(),this.view.$hvfwCanvas.clientHeight,r.modelNode.bind("rendered",function(e){var t=e.params,n=t.getCameraMatrix();t.getModelMatrix();var r=t.getViewMatrix();t.getCanvasPos(),convertMatrix(n,o.controller.cameraMatrix),convertMatrix(r,o.controller.viewMatrix),multiplyMatrices(o.controller.viewMatrix,o.controller.cameraMatrix,o.controller.cameraViewMatrix),computeInverseMatrix(o.controller.cameraViewMatrix,o.controller.cameraViewMatrixInverse);var a=new O(0,0,0),s=new O(0,0,0),l=computeAlternativelyTransformedPoint(a,1,o.controller.cameraViewMatrix,s),c=.5*s.x/l*o.view.$hvfwCanvas.width,u=.5*s.y/l*o.view.$hvfwCanvas.height;c+.5*o.view.$hvfwCanvas.width,i.$hvfwCanvas.height-u-.5*i.$hvfwCanvas.height,i.markupManager.drawDimensions()}),null!=this.view.model.modelTree.tree&&this.view.model.modelTree.tree.fixupVisibilityAndChecking(),this.startScene(),a},readReferenceModelData:function(e){var t=this.view.model,n=new T(this.state.annotator,!1);this.view.referenceModel=n,this.state.annotator.view.model.fileComparisonManager.hide(),this.referenceModelNode&&(this.referenceModelNode.destroy(),this.referenceModelNode=null),n.nodeIdSuffix=++t.nodeIdSuffix;var i={type:"node",id:"modelNode~"+n.nodeIdSuffix};t.modelNode.parent().add("node",i),n.modelNode=this.sceneNode.findNode("modelNode~"+n.nodeIdSuffix);var r=new Uint8Array(e);return n.parseHSF(r),this.referenceModelNode=n.modelNode._targetNode.disconnect(),SceneJS_compileModule.nodeUpdated(this.sceneNode._targetNode),t.currentTag=n.currentTag,t.nodecounter=n.nodecounter,t.cuttingPlaneManager.insertShaderNode(n),t.cuttingPlaneManager.updateSceneGraph(),this.state.annotator.toolbar.startFileComparison(),!0}},o.prototype={show:function(e){if(this.div.parentNode)return"true"!==this.div.getAttribute("visible")&&this.div.setAttribute("visible","true"),this;this.parentNode.appendChild(this.div),K(function(){this.div.setAttribute("visible","true")},this);var t=this.div.getBoundingClientRect();return this.width=t.width,this.height=t.height,e&&e(),this},hide:function(){if(!this.div.parentNode)return this;if(this.div.removeAttribute("visible"),!this.__handleTransitions__){this.__handleTransitions__=!0;var e=function(){this.div.getAttribute("visible")||this.div.parentNode&&this.div.parentNode.removeChild(this.div)}.bind(this);this.div.addEventListener("transitionend",e,!0),this.div.addEventListener("webkitTransitionEnd",e,!0),this.div.addEventListener("OTransitionEnd",e,!0)}return this},isVisible:function(){return this.div.parentNode&&"true"===this.div.getAttribute("visible")},createUI:function(e){var t=new y(this.div,"togglePins");t.set("title","Toggle Pins"),t.addEventListener("click",function(){t.isChecked()?(t.uncheck(),a.set("hidden"),e.state.annotator.togglePins(!1)):(t.check(),a.unset("hidden"),e.state.annotator.togglePins(!0))}),t.check();var n=new b(this.div,"modelTree","Assembly tree"),i=n.button;i.set("title","Toggle Assembly Tree"),i.addEventListener("click",function(){var t=e.state.annotator.view.model.modelTree.treeUI;i.isChecked()?(t.stopResizeListening(),t.hide(),i.uncheck()):(t.show(),window.setTimeout(function(){t.updateScrollbars(),t.startResizeListening(),t.scrollToLastNode()},100),i.check())}),i.check();var r=new v(this.div,"toolbar-separator");new v(r.div,"dark"),new v(r.div,"light");var o=new b(this.div,"dropPin","Add pin"),a=o.button;e.state.drop_pin_callback&&a.setVisibility(!1),a.set("title","Add a pin to write comments and draw sketches"),a.addEventListener("click",function(){e.state.stage===_t.EDITING_NOTE&&(e.state.annotator.hideAllNotes(),e.state.stage=_t.VIEWING),e.state.stage===_t.VIEWING?(u.isChecked()&&u.uncheck(),d.isChecked()&&d.uncheck(),p.isChecked()&&e.state.annotator.view.markupManager.hideExplodeAssemblyPopup(!1),m.isChecked()&&e.state.annotator.view.markupManager.hideCuttingPlanePopup(!1),_.isChecked()&&(_.uncheck(),e.state.annotator.view.markupManager.hideMeasurementPopup()),A.isChecked()&&(A.uncheck(),e.state.annotator.view.hideHelp()),e.state.annotator.hideAllNotes(),S.isChecked()||e.state.annotator.view.showDropPinHint(),a.check(),e.state.stage=_t.DROPPING_PIN,e.state.annotator.view.currentOperator.clickOperator=$t.NOTE):e.state.stage===_t.DROPPING_PIN&&(e.state.annotator.hideAllNotes(),e.state.annotator.view.hideDropPinHint(),a.uncheck(),e.state.stage=_t.VIEWING,e.state.annotator.view.currentOperator.clickOperator=$t.SELECT)}),document.addEventListener(St.PIN_ADDED,function(){e.state.stage=_t.EDITING_NOTE}),document.addEventListener(St.NOTE_SHOW_REQUESTED,function(t){e.state.stage=_t.EDITING_NOTE;var n=t.detail,i=e.state.notes[n],r=e.state.annotator._getPinCameraTransformation(n),o=e.state.annotator._getPinVersion(n),a=null;
(o>=dt||!e.state.isContentfileSTL())&&r&&(a=r);var s=function(){e.state.setState(i.pin.viewerState,1e3,!1,function(){var t=e.state.notes[n];null!=t&&(t.updateTimestamps(),t.isAttachedToViewer&&t.show(function(){t.setViewMode("preview")}),t.pin.hvfwPin&&t.pin.hvfwPin.highlightPin(!0),e.state.pin_activated_callback&&e.state.pin_activated_callback(t.pin.id))})};"undefined"!=typeof i.pin.viewerState?s():e.state.annotator._requestGetPinViewerStateURI(n,function(t){var n=t.viewer_state;n?e.state.annotator._request("GET",n,!1,null,function(t){e.state.annotator._handleResponse(t,function(e){i.pin.viewerState=e,i.pin.viewerState.viewTransformation=a,s()})}):(i.pin.viewerState={},i.pin.viewerState.viewTransformation=a,s())}),i.__updateTimestamps__=window.setInterval(i.updateTimestamps,1e3)}),document.addEventListener(St.NOTE_HIDE_REQUESTED,function(t){e.state.annotator.view.hideDropPinHint(),a.uncheck(),e.state.stage=_t.VIEWING,e.state.annotator.view.currentOperator.clickOperator=$t.SELECT;var n=t.detail,i=e.state.notes[n];i.hide(),i.pin.hvfwPin&&i.pin.hvfwPin.highlightPin(!1),i.dirty&&(i.created||"create"!==i.viewMode)||!i.isAttachedToViewer||e.state.annotator.undropPin(n,!0),e.state.pin_deactivated_callback&&e.state.pin_deactivated_callback(i.pin.id),window.clearInterval(i.__updateTimestamps__,1e3)}),document.addEventListener(St.NOTE_DELETE_REQUESTED,function(t){e.state.annotator.view.hideDropPinHint(),a.uncheck(),e.state.stage=_t.VIEWING,e.state.annotator.view.currentOperator.clickOperator=$t.SELECT;var n=t.detail,i=e.state.notes[n];i.hide(),e.state.annotator.undropPin(n,!0)}),document.addEventListener(St.PIN_REMOVED,function(){e.state.annotator.view.hideDropPinHint(),a.uncheck()}),this.state.mode===mt.READ_ONLY&&a.set("hidden");var s=new y(this.div,"showWireframe");s.set("title","Toggle Wireframe"),s.addEventListener("click",function(){s.isChecked()?(s.uncheck(),e.state.annotator.showWireframe(!1)):(s.check(),e.state.annotator.showWireframe(!0))}),ft.MESH.WIREFRAME.VISIBLE&&s.check();var l=new y(this.div,"showBoundingBox");l.set("title","Toggle Bounding Box"),l.addEventListener("click",function(){l.isChecked()?(l.uncheck(),e.state.annotator.showBoundingBox(!1)):(l.check(),e.state.annotator.showBoundingBox(!0))}),ft.MESH.BOUNDING_BOX.VISIBLE&&l.check();var c=new y(this.div,"showAxis");c.set("title","Toggle Axes"),c.addEventListener("click",function(){c.isChecked()?(c.uncheck(),e.state.annotator.showAxis(!1)):(c.check(),e.state.annotator.showAxis(!0))}),ft.MESH.AXIS_ARROWS.VISIBLE&&c.check();var u=new y(this.div,"measure");u.set("title","Toggle Measuring"),u.addEventListener("click",function(){u.isChecked()?(e.state.annotator.view.currentOperator.clickOperator=$t.SELECT,u.uncheck()):(e.state.annotator.view.currentOperator.clickOperator=$t.MEASURE,u.check(),a.isChecked()&&(e.state.annotator.hideAllNotes(),e.state.annotator.view.hideDropPinHint(),a.uncheck(),e.state.stage=_t.VIEWING,e.state.annotator.view.currentOperator.clickOperator=$t.SELECT),A.isChecked()&&(A.uncheck(),e.state.annotator.view.hideHelp()),d.isChecked()&&d.uncheck())});var d=new y(this.div,"measureangle");d.set("title","Measure Angle Between Faces"),d.addEventListener("click",function(){d.isChecked()?d.uncheck():(d.check(),a.isChecked()&&(e.state.annotator.hideAllNotes(),e.state.annotator.view.hideDropPinHint(),a.uncheck(),e.state.stage=_t.VIEWING,e.state.annotator.view.currentOperator.clickOperator=$t.SELECT),u.isChecked()&&u.uncheck())});var h=new b(this.div,"explodeAssembly","Explode"),p=h.button;p.set("title","Explode Assembly"),p.addEventListener("click",function(){p.isChecked()?(e.state.annotator.view.markupManager.hideExplodeAssemblyPopup(!0),p.uncheck()):(a.isChecked()&&(e.state.annotator.hideAllNotes(),e.state.annotator.view.hideDropPinHint(),a.uncheck(),e.state.stage=_t.VIEWING,e.state.annotator.view.currentOperator.clickOperator=$t.SELECT),A.isChecked()&&(A.uncheck(),e.state.annotator.view.hideHelp()),m.isChecked()&&e.state.annotator.view.markupManager.hideCuttingPlanePopup(!1),_.isChecked()&&(_.uncheck(),e.state.annotator.view.markupManager.hideMeasurementPopup()),S.isChecked()&&(S.uncheck(),e.state.annotator.view.markupManager.hideFileComparisonPopup(!0)),e.state.annotator.view.markupManager.showExplodeAssemblyPopup(!0),p.check())});var f=new b(this.div,"cuttingPlane","Section"),m=f.button;m.set("title","Cutting Plane"),m.addEventListener("click",function(){m.isChecked()?(e.state.annotator.view.markupManager.hideCuttingPlanePopup(!0),m.uncheck()):(a.isChecked()&&(e.state.annotator.hideAllNotes(),e.state.annotator.view.hideDropPinHint(),a.uncheck(),e.state.stage=_t.VIEWING,e.state.annotator.view.currentOperator.clickOperator=$t.SELECT),A.isChecked()&&(A.uncheck(),e.state.annotator.view.hideHelp()),p.isChecked()&&e.state.annotator.view.markupManager.hideExplodeAssemblyPopup(!1),_.isChecked()&&(_.uncheck(),e.state.annotator.view.markupManager.hideMeasurementPopup()),S.isChecked()&&e.state.annotator.view.markupManager.hideFileComparisonPopup(!1),e.state.annotator.view.markupManager.showCuttingPlanePopup(!0),m.check())});var g=new b(this.div,"measurement","Measure"),_=g.button;_.set("title","Measure Tools"),_.addEventListener("click",function(){_.isChecked()?(e.state.annotator.view.markupManager.hideMeasurementPopup(),_.uncheck()):(a.isChecked()&&(e.state.annotator.hideAllNotes(),e.state.annotator.view.hideDropPinHint(),a.uncheck(),e.state.stage=_t.VIEWING,e.state.annotator.view.currentOperator.clickOperator=$t.SELECT),A.isChecked()&&(A.uncheck(),e.state.annotator.view.hideHelp()),p.isChecked()&&(p.uncheck(),e.state.annotator.view.markupManager.hideExplodeAssemblyPopup(!0)),m.isChecked()&&e.state.annotator.view.markupManager.hideCuttingPlanePopup(!1),S.isChecked()&&e.state.annotator.view.markupManager.hideFileComparisonPopup(!1),e.state.annotator.view.markupManager.showMeasurementPopup(),_.check())});var w=new b(this.div,"fileComparison","Compare"),S=w.button;S.set("title","File Comparison"),S.addEventListener("click",function(){if(canUseFeature("can_compare_versions")){var t=e.state.annotator.view.model.fileComparisonManager,n=t.getLocation();if(S.isChecked())e.state.annotator.view.markupManager.hideFileComparisonPopup(!0),S.uncheck(),n.reference=void 0,t.setLocation(n);else{var i=n.target,r=i.version;0==r&&(r=e.state.annotator.loadedVersion);var o=i.configuration;null==o&&(o=t.getDefaultConfiguration(t.availableConfigurations),o&&(o=o.index));var s=t.getNearestComparableModel(r,o),l=s.version,c=s.configuration;n.target.version=r,n.target.configuration=o,n.reference={file:i.file,space:i.space,link:i.link,version:l,configuration:c},t.setLocation(n);var u="select[referencedropdown]>option:eq("+(l-1)+")";$(u).attr("selected",!0);var d="select[targetdropdown]>option:eq("+(r-1)+")";$(d).attr("selected",!0),a.isChecked()&&(e.state.annotator.hideAllNotes(),e.state.annotator.view.hideDropPinHint(),a.uncheck(),e.state.stage=_t.VIEWING,e.state.annotator.view.currentOperator.clickOperator=$t.SELECT),A.isChecked()&&(A.uncheck(),e.state.annotator.view.hideHelp()),m.isChecked()&&e.state.annotator.view.markupManager.hideCuttingPlanePopup(!1),p.isChecked()&&(p.uncheck(),e.state.annotator.view.markupManager.hideExplodeAssemblyPopup(!0)),_.isChecked()&&(_.uncheck(),e.state.annotator.view.markupManager.hideMeasurementPopup()),e.state.annotator.view.markupManager.showFileComparisonPopup(!0),S.check()}}else displayUpgradeToProPopup()});var x=new b(this.div,"embed","EMBED"),C=x.button;C.set("title","Generate an Embed code"),C.addEventListener("click",function(){C.isChecked()?(C.uncheck(),e.state.annotator.showEmbedNote(!1)):(C.check(),e.state.annotator.hideAllNotes(),e.state.annotator.showEmbedNote(!0))});var E=new b(this.div,"fullScreen","Full screen"),T=E.button;T.set("title","View in full screen"),T.addEventListener("click",function(){T.isChecked()?T.uncheck():T.check()});var k=new b(this.div,"help","Help","icon-question"),A=k.button;A.set("title","Help"),A.addEventListener("click",function(){A.isChecked()?(A.uncheck(),e.state.annotator.view.hideHelp()):(e.state.annotator.view.hideDropPinHint(),e.state.annotator.view.markupManager.hideCuttingPlanePopup(!1),e.state.annotator.view.markupManager.hideExplodeAssemblyPopup(!1),e.state.annotator.view.markupManager.hideMeasurementPopup(),e.state.annotator.view.markupManager.hideFileComparisonPopup(!1),A.check(),e.state.annotator.view.showHelp())}),t.hide(),c.hide(),l.hide(),a.set("lower"),s.hide(),u.hide(),d.hide(),C.hide();var N=new v(this.view.$parent,"","logo");this.$dropPin=a,this.$showWireframe=s,this.$showBoundingBox=l,this.$modelTree=i,this.$cuttingPlane=m,this.$measureAngle=d,this.$explodeAssembly=p,this.$fileComparison=S,this.$measurement=_,this.$showAxis=c,this.$togglePins=t,this.$measure=u,this.$embed=C,this.$logo=N,this.$fullScreen=T,this.$help=A},startSketch:function(e){this.$dropPin.isChecked()&&(this.state.annotator.hideAllNotes(),this.state.annotator.view.hideDropPinHint(),this.$dropPin.uncheck(),this.state.stage=_t.VIEWING,this.state.annotator.view.currentOperator.clickOperator=$t.SELECT),this.$help.isChecked()&&(this.$help.uncheck(),this.state.annotator.view.hideHelp()),this.$cuttingPlane.isChecked()&&this.state.annotator.view.markupManager.hideCuttingPlanePopup(!1),this.$measurement.isChecked()&&(this.$measurement.uncheck(),this.state.annotator.view.markupManager.hideMeasurementPopup()),this.$explodeAssembly.isChecked()&&this.state.annotator.view.markupManager.hideExplodeAssemblyPopup(!1),this.$fileComparison.isChecked()&&(this.$fileComparison.uncheck(),this.state.annotator.view.markupManager.hideFileComparisonPopup(!1)),this.state.annotator._startSketch(e)},startFileComparison:function(){this.$fileComparison.show();var e=canUseFeature("can_compare_versions");this.state.dontShowUpgradePopup||e||displayUpgradeToProPopup(),this.state.annotator.view.markupManager.showFileComparisonPopup(e),this.$fileComparison.check()},reset:function(){this.$dropPin.set("hidden"),this.$modelTree.set("hidden"),this.state.annotator.view.hideDropPinHint(),this.state.annotator.view.hideHelp(),this.$dropPin.uncheck(),this.$cuttingPlane.uncheck(),this.$explodeAssembly.uncheck(),this.$fileComparison.uncheck(),this.$measurement.uncheck(),this.$help.uncheck(),this.state.annotator.hideAllNotes(),this.state.stage=_t.VIEWING,this.state.annotator.view.currentOperator.clickOperator=$t.SELECT}};var Ft=function(e){e.target.focus(),e.stopPropagation()};a.prototype={show:o.prototype.show,hide:o.prototype.hide,isVisible:o.prototype.isVisible,createUI:function(e){function t(t){function n(){e.__startMoveAnimation__=window.requestAnimationFrame(n),e.state.annotator[t]()}n()}function n(){window.cancelAnimationFrame(e.__startMoveAnimation__),e.__startMoveAnimation__=null}document.addEventListener("mousedown",n,!0);var i=new v(this.div,"trackball-move");(function(){var r=new y(i.div,"left");r.addEventListener("mousedown",t.bind({},"rotateLeft")),r.addEventListener("mouseup",n);var o=new y(i.div,"right");o.addEventListener("mousedown",t.bind({},"rotateRight")),o.addEventListener("mouseup",n);var a=new y(i.div,"up");a.addEventListener("mousedown",t.bind({},"rotateUp")),a.addEventListener("mouseup",n);var s=new y(i.div,"down");s.addEventListener("mousedown",t.bind({},"rotateDown")),s.addEventListener("mouseup",n);var l=new y(i.div,"home");l.addEventListener("mousedown",function(){e.state.annotator.view.currentOperator.resetCamera()}),new y(i.div,"footer"),e.$leftButton=r,e.$rightButton=o,e.$upButton=a,e.$downButton=s,e.$homeButton=l})();var r=new v(this.div,"trackball-zoom");(function(){var i=new y(r.div,"minus");i.addEventListener("mousedown",t.bind({},"zoomIn")),i.addEventListener("mouseup",n);var o=new y(r.div,"plus");o.addEventListener("mousedown",t.bind({},"zoomOut")),o.addEventListener("mouseup",n),e.$minusButton=i,e.$plusButton=o})();var a=new v(this.div,"trackball-views"),s=new v(this.div,"trackball-views-popup");s.show=o.prototype.show,s.hide=o.prototype.hide,s.hide(),function(){function t(){i.check(),s.show()}function n(){i.uncheck(),s.hide()}e.view.$canvas.addEventListener("click",n,!0);var i=new y(a.div,"views");i.addEventListener("click",function(){i.isChecked()?n():t()});var r=new y(s.div,"front-view");r.set("views-popup-button"),r.set("value","Front"),r.addEventListener("click",function(){n(),e.state.annotator.view.setViewOrientation(xt.FRONT)});var o=new y(s.div,"back-view");o.set("views-popup-button"),o.set("value","Back"),o.addEventListener("click",function(){n(),e.state.annotator.view.setViewOrientation(xt.BACK)});var l=new y(s.div,"top-view");l.set("views-popup-button"),l.set("value","Top"),l.addEventListener("click",function(){n(),e.state.annotator.view.setViewOrientation(xt.TOP)});var c=new y(s.div,"left-view");c.set("views-popup-button"),c.set("value","Left"),c.addEventListener("click",function(){n(),e.state.annotator.view.setViewOrientation(xt.LEFT)});var u=new y(s.div,"right-view");u.set("views-popup-button"),u.set("value","Right"),u.addEventListener("click",function(){n(),e.state.annotator.view.setViewOrientation(xt.RIGHT)});var d=new y(s.div,"bottom-view");d.set("views-popup-button"),d.set("value","Bottom"),d.addEventListener("click",function(){n(),e.state.annotator.view.setViewOrientation(xt.BOTTOM)});var h=new y(s.div,"isometric-view");h.set("views-popup-button"),h.set("value","Isometric"),h.addEventListener("click",function(){n(),e.state.annotator.view.setViewOrientation(xt.ISO)});var p=new y(s.div,"smooth-shading");p.hide(),p.set("views-popup-button"),p.set("value","Smooth surface"),p.addEventListener("click",function(){p.isChecked()?(p.uncheck(),p.set("value","Smooth surface"),e.state.annotator.smoothShading(!1)):(p.check(),p.set("value","Flat surface"),e.state.annotator.smoothShading(!0))}),ft.MESH.SOLID.SMOOTH_SHADING&&p.check(),e.$viewsButton=i,e.$frontViewButton=r,e.$backViewButton=o,e.$topViewButton=l,e.$leftViewButton=c,e.$rightViewButton=u,e.$bottomViewButton=d,e.$smoothShading=p}()}},s.prototype={show:o.prototype.show,hide:o.prototype.hide,isVisible:o.prototype.isVisible,getStyle:function(e){return this.div.style[e]},setStyle:function(e,t){this.div.style[e]=t},createUI:function(){this.setStyle("minHeight","60px"),this.setStyle("minWidth","120px");var e=new v(this.div);e.setStyle("width","245px"),e.setStyle("height","250px"),e.setStyle("resize","none"),e.setStyle("overflow","auto");var t=new v(e.div,"annotator-treeblock");e.div.addEventListener("DOMMouseScroll",this.temporaryBlockHighlighting.bind(this),!0),e.div.addEventListener("mousewheel",this.temporaryBlockHighlighting.bind(this),!0),this.div.addEventListener("mousewheel",function(e){e.stopPropagation()}),this.div.addEventListener("DOMMouseScroll",function(e){e.stopPropagation()}),this.scrollDiv=e,this.scrollContentDiv=t},temporaryBlockHighlighting:function(){var e=this;window.clearTimeout(e.blockHighlightingInterval),e.blockHighlighting=!0,e.blockHighlightingInterval=window.setTimeout(function(){e.blockHighlighting=!1,window.clearTimeout(e.blockHighlightingInterval)},300)},initializeScrollbars:function(){},reset:function(){for(;this.scrollContentDiv.div.firstChild;)this.scrollContentDiv.div.removeChild(this.scrollContentDiv.div.firstChild);this.lastScrollNode=null,this.lastScrollWidth=null},scrollToNode:function(e,t){if(!this.scrollbarsInitialized||!this.isVisible())return this.lastScrollNode=e,this.lastScrollWidth=t,void 0;this.lastScrollNode=null,this.lastScrollWidth=null;var n=e.div.offsetTop;this.scrollDiv.div.scrollLeft=t,this.scrollDiv.div.scrollTop=n},startResizeListening:function(){this.treeWidth=this.div.offsetWidth,this.treeHeight=this.div.offsetHeight,this.listenForResizing=!0,this.checkTreeSizes()},stopResizeListening:function(){this.listenForResizing=!1},checkTreeSizes:function(){function e(){t.listenForResizing&&((t.treeWidth!=t.div.offsetWidth||t.treeHeight!=t.div.offsetHeight)&&(t.treeWasResized=!0,t.treeWidth=t.div.offsetWidth,t.treeHeight=t.div.offsetHeight,t.treeMaxWidth<t.treeWidth-5&&(t.treeWidth=t.treeMaxWidth,t.setStyle("width",""+t.treeWidth+"px"),t.setStyle("minWidth","120px")),t.treeMaxHeight<t.treeHeight-5&&(t.treeHeight=t.treeMaxHeight,t.setStyle("height",""+t.treeHeight+"px"),t.setStyle("minHeight","60px")),t.scrollDiv.setStyle("width",""+(t.treeWidth-t.treePadding)+"px"),t.scrollDiv.setStyle("height",""+(t.treeHeight-t.treePadding)+"px"),t.updateScrollbars()),window.setTimeout(function(){e()},100))}if(this.listenForResizing){var t=this;e()}},scrollToLastNode:function(){this.lastScrollNode&&this.scrollToNode(this.lastScrollNode,this.lastScrollWidth)},updateTreeVisibility:function(){this.annotator.state.isSketchMode||!this.treeCanFit?(this.setStyle("display","none"),this.scrollDiv.setStyle("opacity","0")):(this.setStyle("display",""),this.scrollDiv.setStyle("opacity","1"))},updateTreeHeight:function(){var e=this.annotator.trackball.div,t=this.annotator.view.model.modelTree.treeUI.div,n=this.annotator.view.$parent.offsetHeight-t.offsetTop-(this.isVisible()?30:34);this.treeMaxWidth=e.offsetLeft-t.offsetLeft-15,this.treeMaxHeight=n,this.setStyle("maxWidth",""+this.treeMaxWidth+"px"),this.setStyle("maxHeight",""+this.treeMaxHeight+"px"),this.treeWasResized?(this.treeMaxWidth<this.treeWidth-5&&(this.treeWidth=this.treeMaxWidth,this.setStyle("width",""+this.treeWidth+"px"),this.scrollDiv.setStyle("width",""+(this.treeWidth-this.treePadding)+"px"),this.setStyle("minWidth","120px")),this.treeMaxHeight<this.treeHeight-5&&(this.treeHeight=this.treeMaxHeight,this.setStyle("height",""+this.treeHeight+"px"),this.scrollDiv.setStyle("height",""+(this.treeHeight-this.treePadding)+"px"),this.setStyle("minHeight","60px")),this.updateScrollbars()):50>n?(this.treeCanFit=!1,this.updateTreeVisibility()):(this.treeCanFit=!0,this.updateTreeVisibility(),this.setStyle("height",""+n+"px"),this.scrollDiv.setStyle("height",""+(n-this.treePadding)+"px"),this.setStyle("minHeight","60px"),this.updateScrollbars())},updateScrollbars:function(){this.calculateScrollWidth()},calculateScrollWidth:function(){if(!this.scrollContentDiv)return"";for(var e=this.scrollContentDiv.div.childNodes,t=0,n=0;e.length>n;n++)"none"!=e[n].style.display&&e[n].firstChild.offsetWidth>t&&(t=e[n].firstChild.offsetWidth);t>0&&this.scrollContentDiv.setStyle("width",t+"px")}},l.prototype={show:o.prototype.show,hide:o.prototype.hide,isVisible:o.prototype.isVisible,createUI:function(e){function t(){e.isAttachedToViewer&&e.state.annotator._requestGetPinComments(e.pin.name,function(e){e.comments.reverse().forEach(function(e){i(e)})})}function n(){var t=e.state.annotator,n=e.pin.name,r=e.$selfInput.getValue()+(e.sketchData?" ":"");(e.sketchData||r)&&(e.created=!0,e.setDirty(),e.$selfInput.set("disabled"),e.$selfSketchButton.set("disabled"),e.$selfPostButton.set("disabled"),e.$selfInput.getValue()&&e.$selfInput.setValue(""),e.$selfSketchButton.revertThumbnail instanceof Function&&e.$selfSketchButton.revertThumbnail(),t._requestAddPinComment(e.pin.name,r,function(r){var o=i(r);e.sketchData&&t._requestAddCommentSketchData(n,r.comment_id,e.sketchData),e.sketchThumbnail&&t._requestAddCommentSketchThumbnail(n,r.comment_id,e.sketchThumbnail),e.sketchBackground&&t._requestAddCommentSketchBackground(n,r.comment_id,e.sketchBackground),o&&t._requestSaveViewerState(r.comment_id),e.$selfInput.unset("disabled"),e.$selfSketchButton.unset("disabled"),e.$selfPostButton.unset("disabled"),e.sketchThumbnail=null,e.sketchBackground=null,e.sketchData=null}))}function i(t){var n=null==e.$commentsBox.div.firstChild,i=t.comment_id,r=t.sketch_thumbnail||e.sketchThumbnail,o=t.sketch_background||e.sketchBackground,a=t.sketch_data||e.sketchData,s=t.pic_url,l=t.username,c=t.text,u=t.created||new Date,d=new _(e.$commentsBox.div,n?"is_top_comment":null);return d.set(e.state,i,r,o,a,s,l,c,u),e.$commentsBox.div.scrollTop=e.$commentsBox.div.scrollHeight,e.$commentsBox.unset("empty"),e.comments.push(d),e.updateTimestamps(),o&&K(function(){AnnotatorSketcher.cacheImage(o)}),n}function r(){var t,n=e.state.annotator,i=n.sketcher;if(!n.state.isSketchMode){n.state.isSketchMode=!0,n.view.model.modelTree.treeUI.updateTreeVisibility();for(var r=function(i){if(i&&(Lt.sendMouse("mouseup",{sender:n.view.$canvas}),e.$selfInput.div.focus(),i.json&&JSON.parse(i.json).length)){var r=e.$selfSketchButton,o=e.$selfDeleteSketchButton;e.sketchData||(r._prevBackgroundImage=r.div.style.backgroundImage,r._prevBackgroundSize=r.div.style.backgroundSize,r.revertThumbnail=function(){r.div.style.backgroundImage=r._prevBackgroundImage,r.div.style.backgroundSize=r._prevBackgroundSize,r.set("value","Attach Sketch"),r.set("plain"),o.hide()}),K(function(){r.div.style.backgroundImage="url("+i.thumbnailData+")",r.div.style.backgroundSize="cover",r.unset("plain"),r.div.setAttribute("value",""),o.show()}),e.sketchThumbnail=i.thumbnailData,e.sketchBackground=t,e.sketchData=i.json}for(var a=0,s=e.state.pins.length;s>a;a++)n.showPin(e.state.pins[a].name);n.state.isSketchMode=!1,n.view.model.modelTree.treeUI.updateTreeVisibility()},o=0,a=e.state.pins.length;a>o;o++)n.hidePin(e.state.pins[o].name);Z(function(){t=n.getScreenshot();var o=e.sketchData;o?(i.create(r),i.background(t,function(){i.fromJSON(o)})):(i.create(r),i.background(t))},250)}}function o(){e.sketchThumbnail=null,e.sketchBackground=null,e.sketchData=null,e.$selfSketchButton.revertThumbnail(),e.$selfInput.div.focus()}this.div.addEventListener("keyup",function(t){switch(t.keyCode){case 27:e.dirty?Lt.sendCustom(St.NOTE_HIDE_REQUESTED,{data:e.pin.name}):Lt.sendCustom(St.NOTE_DELETE_REQUESTED,{data:e.pin.name}),t.stopPropagation();break;default:t.stopPropagation()}}),this.div.addEventListener("mouseover",Ft),this.div.addEventListener("click",Ft);var a=new v(this.div,"note-left");(function(){var t=new v(a.div,"note-title");(function(){var n=new v(t.div,"display-number","","span");n.setTextContent("");var i=new v(t.div,"username","","span");i.setTextContent(e.username);var r=new v(t.div,"timestamp","","span");r.setTextContent("Just a moment ago"),r.actualDate=new Date,e.$titleDisplayNumber=n,e.$titleUsername=i,e.$titleTimestamp=r})();var n=new y(a.div,"edit");n.set("plain"),n.set("value","Edit"),n.addEventListener("click",function(){e.setViewMode("edit")});var i=new v(a.div,"note-color-buttons");(function(){for(var t=0;5>t;t++){var n=new y(i.div,"color");n.set("note-pin-color-button"),n.set("color",t+""),n.addEventListener("click",function(){var t=getComputedStyle(this.div),n=t.getPropertyValue("background-color"),i=n.substring(4,n.length-1).split(","),r=window.parseInt(i[0]),o=window.parseInt(i[1]),a=window.parseInt(i[2]);e.pin.hvfwPin.setPinColor(r/255,o/255,a/255),e.state.annotator._requestUpdatePin(e.pin.name)}.bind(e["$colorButton"+t]=n))}})();var r=new y(a.div,"delete");r.set("plain"),r.set("value","Delete pin"),r.addEventListener("click",function(){Lt.sendCustom(St.NOTE_DELETE_REQUESTED,{data:e.pin.name})}),e.$editButton=n,e.$colorButtons=i,e.$deleteButton=r,e.isAttachedToViewer||n.hide()})();var s=new v(this.div,"note-right");(function(){var t=new y(s.div,"close");t.addEventListener("click",function(){e.dirty||!e.isAttachedToViewer?Lt.sendCustom(St.NOTE_HIDE_REQUESTED,{data:e.pin.name}):Lt.sendCustom(St.NOTE_DELETE_REQUESTED,{data:e.pin.name})}),e.$closeButton=t})();var l=new v(this.div,"note-comments");(function(){var i=new v(l.div,"comments-box");i.set("empty"),K(t);var a=new v(l.div,"self-comments-outer-group"),s=new v(a.div,"user-image","","img");s.div.src=e.state.user.image;var c=new v(a.div,"self-comments-group"),u=new v(c.div,"self-input","","textarea");u.set("type","text"),u.set("placeholder","Comment"),u.addEventListener("keyup",function(e){e.ctrlKey&&e.shiftKey&&(13===e.keyCode||14===e.keyCode)?n():70===e.keyCode&&e.stopPropagation()});var d=new y(c.div,"self-post");d.set("note-pin-button"),d.set("value","POST"),d.addEventListener("click",n);var h=new y(c.div,"self-sketch");h.set("plain"),h.set("value","Attach Sketch"),h.addEventListener("click",r);var p=new y(c.div,"self-delete-sketch");p.hide(),p.set("note-pin-button"),p.addEventListener("click",o),e.state.mode===mt.READ_ONLY&&(u.hide(),s.hide(),d.hide(),h.hide(),p.hide()),e.isAttachedToViewer||a.hide(),e.$commentsBox=i,e.$selfImage=s,e.$selfInput=u,e.$selfPostButton=d,e.$selfSketchButton=h,e.$selfDeleteSketchButton=p})()},setDirty:function(){this.dirty=!0,this.div.setAttribute("dirty","true")},unsetDirty:function(){this.dirty=!1,this.div.removeAttribute("dirty")},setUsername:function(e){this.username=e,this.updateOwnership()},setViewMode:function(e){if(this.viewMode!==e){switch(this.viewMode=e,this.div.removeAttribute("create"),this.div.removeAttribute("preview"),this.div.removeAttribute("edit"),this.div.setAttribute(e,"true"),e){case"create":case"edit":case"preview":}this.updatePosition()}},setOwned:function(e){this.owned!==e&&(this.owned=e,e?this.div.setAttribute("owned","true"):this.div.removeAttribute("owned"))},setReadonly:function(e){this.readonly!==e&&(this.readonly=e,e?this.div.setAttribute("readonly","true"):this.div.removeAttribute("readonly"),this.$colorButton0.div.disabled=e,this.$colorButton1.div.disabled=e,this.$colorButton2.div.disabled=e,this.$colorButton3.div.disabled=e,this.$colorButton4.div.disabled=e,this.$editButton.div.disabled=e,this.$deleteButton.div.disabled=e)},setCommentImage:function(e){this.$selfImage.div.src!==e&&(this.$selfImage.div.src=e)},updateOwnership:function(){var e=this.state.user.name===this.username;this.setOwned(e),this.setReadonly(!e),this.setCommentImage(this.state.user.image)},updateTimestamps:function(){var e=this.$titleTimestamp,t=et(e.actualDate);e.setTextContent(tt(t,Date.now())),this.comments.forEach(function(n){e=n.$timestamp,t=et(e.actualDate),e.setTextContent(tt(t,Date.now()))})},updatePosition:function(){var e=this.getNotePosition(),t=this.div;t.style.left=e.left+"px",t.style.top=e.top+"px"},getNotePosition:function(){var e,t,n=this.div.getBoundingClientRect(),i=n.width,r=n.height,o=20,a=-this.width/2,s=0,l=this.getPinScreenSpacePosition(),c=l.x+a,u=l.y+s;return e=this.view.$hvfwCanvas.width-i,t=this.view.$hvfwCanvas.height-r,o>c&&(c=o,this.width=i),o>u&&(u=o,this.height=r),c>e-o&&(c=e-o,this.width=i),u>t-o&&(u=t-o,this.height=r),{left:c,top:u}},getPinScreenSpacePosition:function(e,t,n){e=this.state||e,t=this.view||t,n=this.pin||n;var i={x:0,y:0};if(this.pin.hvfwPin){var r=this.pin.hvfwPin.canvasPosition;i.x=r.x,i.y=r.y}return i}},c.prototype={show:o.prototype.show,hide:o.prototype.hide,isVisible:o.prototype.isVisible,createUI:function(e){var t=new v(this.div,"note-left");(function(){var n=new v(t.div,"note-description");n.setTextContent("Select two points on the model to calculate the distance.");var i=new v(t.div,"points");(function(){var t=new v(i.div,"point");(function(){var n=new v(t.div,"point-title");n.setTextContent("Point 1");var i=new v(t.div,"point-coord","x");i.setTextContent("0");var r=new v(t.div,"point-coord","y");r.setTextContent("0");var o=new v(t.div,"point-coord","z");o.setTextContent("0"),e.$p1name=n,e.$x1=i,e.$y1=r,e.$z1=o})();var n=new v(i.div,"point");(function(){var t=new v(n.div,"point-title");t.setTextContent("Point 2");var i=new v(n.div,"point-coord","x");i.setTextContent("0");var r=new v(n.div,"point-coord","y");r.setTextContent("0");var o=new v(n.div,"point-coord","z");o.setTextContent("0"),e.$p2name=t,e.$x2=i,e.$y2=r,e.$z2=o})(),e.$p1=t,e.$p2=n})();var r=new v(t.div,"distance");(function(){var t=new v(r.div,"distance-title");t.setTextContent("Distance");var n=new v(r.div,"value");n.setTextContent("0"),e.$distanceName=t,e.$distanceValue=n})(),e.$description=n,e.$points=i,e.$distance=r})();var n=new v(this.div,"note-right");(function(){var t=new y(n.div,"close");t.addEventListener("click",function(){}),e.$closeButton=t})()},setActivePoint:function(e){switch(this.$p1.unset("active"),this.$p2.unset("active"),e){case 1:this.$p1.set("active");break;case 2:this.$p2.set("active")}}},u.prototype={show:o.prototype.show,hide:o.prototype.hide,isVisible:o.prototype.isVisible,createUI:function(e){var t=new v(this.div,"header"),n=new v(t.div,"title");GCDrag.makeDraggable(this.div,t.div),GCDrag.makeDraggable(this.div,n.div),n.setTextContent("CUTTING PLANE"),n.set("unselectable","on");var i=new v(t.div,"close");i.set("title","Close"),i.addEventListener("click",function(){e.hide()});var r=new v(this.div,"body"),o=new v(r.div,"planehint");o.setTextContent("Select the plane"),o.set("unselectable","on");var a=new y(r.div,"planex");a.set("title","Plane X"),a.addEventListener("click",function(){a.isChecked()||(e.sliderControl.setValue(50),e.annotator.view.model.cuttingPlaneManager.setPosition(.5),e.annotator.view.model.cuttingPlaneManager.switchToOrientation(0),s.isChecked()&&s.uncheck(),l.isChecked()&&l.uncheck(),a.check())});var s=new y(r.div,"planey");s.set("title","Plane Y"),s.addEventListener("click",function(){s.isChecked()||(e.sliderControl.setValue(50),e.annotator.view.model.cuttingPlaneManager.setPosition(.5),e.annotator.view.model.cuttingPlaneManager.switchToOrientation(1),a.isChecked()&&a.uncheck(),l.isChecked()&&l.uncheck(),s.check())});var l=new y(r.div,"planez");l.set("title","Plane Z"),l.addEventListener("click",function(){l.isChecked()||(e.sliderControl.setValue(50),e.annotator.view.model.cuttingPlaneManager.setPosition(.5),e.annotator.view.model.cuttingPlaneManager.switchToOrientation(2),a.isChecked()&&a.uncheck(),s.isChecked()&&s.uncheck(),l.check())}),l.check();var c=new v(r.div,"sliderhint");c.setTextContent("Slide to move the plane"),c.set("unselectable","on");var u=new v(r.div,"slider"),d=new v(u.div,"box");window.setTimeout(function(){var t=new dhtmlxSlider(d.div,170,"default",!1,0,100,50,1);t.attachEvent("onChange",e.annotator.view.model.cuttingPlaneManager.movePlane.bind(e.annotator.view.model.cuttingPlaneManager)),t.setImagePath("/images/_/viewer/"),t.init(),e.sliderControl=t},500),new v(d.div,"leftBlocker"),new v(d.div,"rightBlocker");var h=new v(u.div,"inverse");h.addEventListener("click",function(){e.annotator.view.model.cuttingPlaneManager.switchToOrientation(4)}),this.planeX=a,this.planeY=s,this.planeZ=l},reset:function(){this.planeX.uncheck(),this.planeY.uncheck(),this.planeZ.check(),this.sliderControl.setValue(50)},resetPos:function(){this.parentNode&&0!=this.parentNode.clientWidth&&(this.div.style.left=this.parentNode.clientWidth-315+"px"),this.div.style.top="40px"}},d.prototype={show:o.prototype.show,hide:o.prototype.hide,isVisible:o.prototype.isVisible,createUI:function(e){this.annotator.view.modelTree;var t=new v(this.div,"body"),n=new v(t.div,"open cell"),i=new v(n.div,"text");i.setTextContent("Open file");var r=new v(t.div,"isolate cell"),o=new v(r.div,"text");o.setTextContent("Isolate");var a=new v(t.div,"hide cell"),s=new v(a.div,"text");s.setTextContent("Hide");var l=new v(t.div,"showAll cell"),c=new v(l.div,"text");c.setTextContent("Show All"),r.addEventListener("click",function(){if(!this.classList.contains("inactive")){var t=e.annotator.view.model.modelTree;t.tree.updateVisibility(!1,!0,!0),t.tree.updateChecking(!1,!0),e.annotator.view.selectionManager.getFirstSelectedElement().updateVisibility(!0,!0,!0),e.annotator.view.selectionManager.getFirstSelectedElement().updateChecking(!0,!0,!0),e.annotator.view.markupManager.hideContextMenuPopup()}}),a.addEventListener("click",function(){if(!this.classList.contains("inactive")){e.annotator.view.model.modelTree;var t=!e.annotator.view.selectionManager.getFirstSelectedElement().nodeVisibility;e.annotator.view.selectionManager.getFirstSelectedElement().updateVisibility(t,!0,!0),e.annotator.view.selectionManager.getFirstSelectedElement().updateChecking(t,!0,!0),e.annotator.view.markupManager.hideContextMenuPopup()}}),l.addEventListener("click",function(){var t=e.annotator.view.model.modelTree.tree;this.classList.contains("inactive")||(t.updateVisibility(!0,!0,!0),t.updateChecking(!0,!0),e.annotator.view.markupManager.hideContextMenuPopup())}),n.addEventListener("click",function(){if(!this.classList.contains("inactive")){var t=e.annotator.idHelper.convertModelElementToExternalRef(e.annotator.view.selectionManager.getFirstSelectedElement()),n=t[0].content_file_id;location.hash="#/file/"+n}})},reset:function(){},resetPos:function(e){this.parentNode&&0!=this.parentNode.clientWidth&&(this.div.style.left=e.x+"px"),this.div.style.top=e.y+"px"}},h.prototype={show:o.prototype.show,hide:o.prototype.hide,isVisible:o.prototype.isVisible,createUI:function(e){var t=new v(this.div,"header"),n=new v(t.div,"title");GCDrag.makeDraggable(this.div,t.div),GCDrag.makeDraggable(this.div,n.div),n.setTextContent("EXPLODE ASSEMBLY"),n.set("unselectable","on");var i=new v(t.div,"close");i.set("title","Close"),i.addEventListener("click",function(){e.hide()});var r=new v(this.div,"body"),o=new v(r.div,"hint");o.setTextContent("Use the slider to explode an assembly"),o.set("unselectable","on");
var a=new v(r.div,"slider"),s=new v(a.div,"box");window.setTimeout(function(){var t=new dhtmlxSlider(s.div,200,"default",!1,0,100,0,1);t.attachEvent("onChange",e.annotator.view.model.explosionManager.explodeAssembly.bind(e.annotator.view.model.explosionManager)),t.setImagePath("/images/_/viewer/"),t.init(),e.sliderControl=t},500),new v(s.div,"leftBlocker"),new v(s.div,"rightBlocker")},goToLastPosition:function(){this.annotator.view.model.explosionManager.lastNonZeroExplodeAmount>0&&(this.sliderControl.setValue(this.annotator.view.model.explosionManager.lastNonZeroExplodeAmount),this.annotator.view.model.explosionManager.explodeAssembly(this.annotator.view.model.explosionManager.lastNonZeroExplodeAmount))},reset:function(){this.sliderControl&&this.sliderControl.setValue(0),0!=this.annotator.view.model.explosionManager.activeExplodeLevel&&this.annotator.view.model.explosionManager.explodeAssembly(0)},resetPos:function(){this.parentNode&&0!=this.parentNode.clientWidth&&(this.div.style.left=this.parentNode.clientWidth-315+"px"),this.div.style.top="40px"}},p.prototype={show:o.prototype.show,hide:o.prototype.hide,isVisible:o.prototype.isVisible,createUI:function(e){var t=new v(this.div,"header"),n=new v(t.div,"title");GCDrag.makeDraggable(this.div,t.div),GCDrag.makeDraggable(this.div,n.div),n.setTextContent("MEASURE"),n.set("unselectable","on");var i=new v(t.div,"close");i.set("title","Close"),i.addEventListener("click",function(){e.reset(),e.annotator.toolbar.$measurement.uncheck(),e.hide()});var r=new v(this.div,"body"),o=this,a=new v(r.div,"cell");a.div.addEventListener("click",function(){a.set("checked"),l.unset("checked"),h.unset("checked"),f.unset("checked"),g.unset("checked"),o.activeMeasurement=$t.MEASURE,o.update(),d.state.distanceMeasureType=vt.LINEAR,u.hideAndResize(o,15)}),new v(a.div,"icon","measure");var s=new v(a.div,"text");s.setTextContent("Length of edge"),s.set("unselectable","on");var l=new v(r.div,"cell");l.div.addEventListener("click",function(){a.unset("checked"),l.set("checked"),h.unset("checked"),f.unset("checked"),g.unset("checked"),o.activeMeasurement=$t.MEASURE_RADIUS,o.update(),d.state.distanceMeasureType=vt.RADIAL,u.showAndResize(o,15)}),new v(l.div,"icon","radius");var c=new v(l.div,"text"),u=new v(l.div,"radial-option");u.hideAndResize(o,15),c.setTextContent("Radius or diameter of edge"),c.set("unselectable","on"),new w(u.div,"radius-option",yt.RADIUS,"Radius",!0),new w(u.div,"radius-option",yt.DIAMETER,"Diameter",!1);var d=this.annotator;u.div.addEventListener("change",function(){d.state.radialMeasureType=parseInt($("input[name=radius-option]:checked").val())});var h=new v(r.div,"cell");h.div.addEventListener("click",function(){a.unset("checked"),l.unset("checked"),h.set("checked"),f.unset("checked"),g.unset("checked"),o.activeMeasurement=$t.MEASURE_DISTANCE,o.update(),u.hideAndResize(o,15)}),new v(h.div,"icon","distance");var p=new v(h.div,"text");p.setTextContent("Distance between faces"),p.set("unselectable","on");var f=new v(r.div,"cell");f.div.addEventListener("click",function(){a.unset("checked"),l.unset("checked"),h.unset("checked"),f.set("checked"),g.unset("checked"),o.activeMeasurement=$t.MEASURE_POINTS,o.update(),u.hideAndResize(o,15)}),new v(f.div,"icon","points");var m=new v(f.div,"text");m.setTextContent("Distance between points"),m.set("unselectable","on"),f.set("checked");var g=new v(r.div,"cell");g.div.addEventListener("click",function(){a.unset("checked"),l.unset("checked"),h.unset("checked"),f.unset("checked"),g.set("checked"),o.activeMeasurement=$t.MEASURE_ANGLE,o.update(),u.hideAndResize(o,15)}),new v(g.div,"icon","angle");var y=new v(g.div,"text");y.setTextContent("Angle between faces"),y.set("unselectable","on"),d._requestGetUsersUnitPreference(function(e){null==e.viewer_units_preference?(d.state.unitPreference=MILLIMETERS,d._requestUpdateUsersUnitPreference(MILLIMETERS)):d.state.unitPreference=e.viewer_units_preference;var t=new v(r.div,"annotator-separator"),n=new v(r.div,"annotator-dropdown");n.div.addEventListener("mouseover",function(e){e.stopPropagation()}),t.set("unselectable","on");var i=new v(n.div,"annotator-dropdown-label");i.setTextContent("Units: "),i.set("unselectable","on");var s=new v(n.div,"annotator-dropdown-menu","","select");new S(s.div,MILLIMETERS,MM_LABEL_TEXT,d.state.unitPreference==MILLIMETERS),new S(s.div,CENTIMETERS,CM_LABEL_TEXT,d.state.unitPreference==CENTIMETERS),new S(s.div,METERS,M_LABEL_TEXT,d.state.unitPreference==METERS),new S(s.div,INCHES,IN_LABEL_TEXT,d.state.unitPreference==INCHES),new S(s.div,FEET,FT_LABEL_TEXT,d.state.unitPreference==FEET),new S(s.div,FEET_INCHES,FT_IN_LABEL_TEXT,d.state.unitPreference==FEET_INCHES),s.div.addEventListener("change",function(){d.state.unitPreference=$(this).find(":selected").val(),d._requestUpdateUsersUnitPreference(d.state.unitPreference);var e=d.view.markupManager.dimensionArray;for(var t in e){var n=e[t];n.angle||(n.text=constructMeasurementResultString(d.state.worldToMM(n.measurementValue),d.state.unitPreference,n.measurementTextPrefix))}o.update()}),s.div.addEventListener("mouseout",function(e){e.stopPropagation()}),s.div.addEventListener("mousemove",function(e){e.stopPropagation()}),s.div.addEventListener("click",function(e){e.stopPropagation()}),s.div.addEventListener("mouseover",function(e){e.stopPropagation()}),o.uiWasCreated=!0,o.distanceCell=a,o.distanceAndRadiusCell=l,o.distanceBetweenFacesCell=h,o.distanceBetweenPointsCell=f,o.angleBetweenFacesCell=g,o.separator=t,o.dropDown=n,o.updateUI()})},updateUI:function(){this.uiWasCreated&&(!this.annotator.view.model.hasBrepInfo||this.annotator.view.model.cuttingPlaneManager&&this.annotator.view.model.cuttingPlaneManager.visible?(this.div.style.height="130px",this.distanceCell.hide(),this.distanceAndRadiusCell.hide(),this.distanceBetweenFacesCell.hide(),this.distanceBetweenPointsCell.hide(),this.angleBetweenFacesCell.hide(),this.separator.hide(),this.dropDown.hide(),this.distanceBetweenPointsCell.show(),this.separator.show(),this.dropDown.show()):(this.div.style.height="230px",this.distanceCell.hide(),this.distanceAndRadiusCell.hide(),this.distanceBetweenFacesCell.hide(),this.distanceBetweenPointsCell.hide(),this.angleBetweenFacesCell.hide(),this.separator.hide(),this.dropDown.hide(),this.distanceCell.show(),this.distanceAndRadiusCell.show(),this.distanceBetweenFacesCell.show(),this.distanceBetweenPointsCell.show(),this.angleBetweenFacesCell.show(),this.separator.show(),this.dropDown.show()))},reset:function(){this.annotator.view.currentOperator.clickOperator=$t.SELECT,this.annotator.view.currentOperator.stage=0,this.annotator.view.markupManager.removePreviousMeasurements(),this.annotator.view.needsUpdate=!0},resetPos:function(){this.parentNode&&0!=this.parentNode.clientWidth&&(this.div.style.left=this.parentNode.clientWidth-315+"px"),this.div.style.top="40px"},update:function(){this.annotator.view.currentOperator.stage>0&&(this.annotator.view.currentOperator.stage=0,this.annotator.state.annotator.view.markupManager.dimensionArray.length>0&&this.annotator.state.annotator.view.markupManager.dimensionArray[this.annotator.state.annotator.view.markupManager.dimensionArray.length-1].hide()),this.annotator.view.currentOperator.clickOperator=this.activeMeasurement}},f.prototype={show:o.prototype.show,hide:o.prototype.hide,isVisible:o.prototype.isVisible,_appendHelpString:function(e,t,n,i,r){e.cell=new v(e.div,"cell"),e.cell.label=new v(e.cell.div,"label"),e.cell.label.setTextContent(t),e.cell.content=new v(e.cell.div,"content"),e.cell.content.setTextContent(n),(i||r)&&(e.cell.tip=new v(e.cell.div,"tip")),i&&(e.cell.tip.label=new v(e.cell.tip.div,"label"),e.cell.tip.label.setTextContent(i)),r&&(e.cell.tip.content=new v(e.cell.tip.div,"content"),e.cell.tip.content.setTextContent(r))},createUI:function(e){var t=new v(this.div,"header"),n=new v(t.div,"title");GCDrag.makeDraggable(this.div,t.div),GCDrag.makeDraggable(this.div,n.div),n.setTextContent("HELP"),n.set("unselectable","on");var i=new v(t.div,"close");i.set("title","Close"),i.addEventListener("click",function(){e.annotator.view.hideHelp(),e.annotator.toolbar.$help.uncheck()});var r=new v(this.div,"body");r.hint=new v(r.div,"hint"),this._appendHelpString(r.hint,"Rotate: ","use left mouse button to rotate."),this._appendHelpString(r.hint,"Pan: ","use right mouse button (or Ctrl + left mouse) to move side-to-side."),this._appendHelpString(r.hint,"Zoom: ","use scroll wheel (or two-finger scroll on a touchpad) to zoom in and out.","Tip: ","double-click (or press 'F' key) to \"fit\" model to screen."),this._appendHelpString(r.hint,"Right-click ","on a component to isolate or hide it, or to show all hidden components.")},resetPos:function(){this.parentNode&&0!=this.parentNode.clientWidth&&(this.div.style.left=this.parentNode.clientWidth-325+"px"),this.div.style.top="40px"}},m.prototype={show:o.prototype.show,hide:o.prototype.hide,isVisible:o.prototype.isVisible,createUI:function(e){var t=new v(this.div,"header"),n=new v(t.div,"title");GCDrag.makeDraggable(this.div,t.div),GCDrag.makeDraggable(this.div,n.div),n.setTextContent("ADD PIN"),n.set("unselectable","on");var i=new v(t.div,"close");i.set("title","Close"),i.addEventListener("click",function(){e.annotator.hideAllNotes(),e.annotator.view.hideDropPinHint(),e.annotator.toolbar.$dropPin.uncheck(),e.annotator.state.stage=_t.VIEWING,e.annotator.state.annotator.view.currentOperator.clickOperator=$t.SELECT});var r=new v(this.div,"body");e.hint=new v(r.div,"hint"),e.hint.setTextContent("Click on the model to place a new pin."),e.hint.set("unselectable","on")},resetPos:function(){this.parentNode&&0!=this.parentNode.clientWidth&&(this.div.style.left=this.parentNode.clientWidth-315+"px"),this.div.style.top="40px"},setTextContent:function(e){this.hint.setTextContent(e)}},g.prototype={show:o.prototype.show,hide:o.prototype.hide,isVisible:o.prototype.isVisible,createUI:function(e){var t=new v(this.div,"note-left");(function(){var n=new v(t.div,"note-title");n.setTextContent("Embed code");var i=new v(t.div,"note-description");i.setTextContent("Copy this code to embed the 3D view to your blog or webpage. You can also customize the size of the embedded viewer.");var r=new v(t.div,"note-embed-code","","textarea");r.set("spellcheck","false"),r.setTextContent(pt.CODE.replace("{src}",pt.SRC).replace("{username}",e.state.user.name).replace("{model}",e.state.annotator.currentModelUri).replace("{design}",e.state.annotator.currentAnnotationsFilename).replace("{mode}",e.state.mode).replace("{width}",pt.DEFAULT_WIDTH).replace("{height}",pt.DEFAULT_HEIGHT)),e.$title=n,e.$description=i,e.$code=r})();var n=new v(this.div,"note-right");(function(){var t=new y(n.div,"close");t.addEventListener("click",function(){e.state.annotator.showEmbedNote(!1)}),e.$closeButton=t})()}},v.prototype={show:function(){this.parentNode&&!this.div.parentNode&&(this.firstChild?this.parentNode.insertBefore(this.div,this.parentNode.firstChild):this.parentNode.appendChild(this.div))},hide:function(){this.div.parentNode&&this.div.parentNode.removeChild(this.div)},hideAndResize:function(e,t){if(!this.div.hidden){var n=parseInt(e.div.style.height),i=n-t;e.div.style.height=i+"px",this.div.hidden=!0}},showAndResize:function(e,t){if(this.div.hidden){var n=parseInt(e.div.style.height),i=n+t;e.div.style.height=i+"px",this.div.hidden=!1}},setVisibility:function(e){this.div.style.display=e?"block":"none"},showAfter:function(e){this.parentNode&&!this.div.parentNode&&e.div&&this.parentNode.contains(e.div)&&(e.div.nextSibling?this.parentNode.insertBefore(this.div,e.div.nextSibling):this.parentNode.appendChild(this.div))},get:function(e){return this.div.getAttribute(e)},set:function(e,t){this.div.setAttribute(e,t||"true")},getStyle:function(e){return this.div.style[e]},setStyle:function(e,t){this.div.style[e]=t||"true"},unset:function(e){this.div.removeAttribute(e)},isSet:function(e){return this.div.getAttribute(e)?!0:!1},check:function(){this.set("checked"),Lt.sendCustom(St.BUTTON_STATE_CHANGE,{data:{element:this.div,state:"checked"}})},uncheck:function(){this.unset("checked"),Lt.sendCustom(St.BUTTON_STATE_CHANGE,{data:{element:this.div,state:"unchecked"}})},isChecked:function(){return this.isSet("checked")},getValue:function(){return this.div.value},setValue:function(e){this.div.value=e},getTextContent:function(){return this.div.textContent},setTextContent:function(e){this.div.textContent=e},addEventListener:function(e,t,n){this.div.addEventListener(e,t,n)},removeEventListener:function(e,t,n){this.div.removeEventListener(e,t,n)}},y.constructor=y,y.prototype=new v,b.constructor=b,b.prototype=new v,_.constructor=_,_.prototype=new v,w.constructor=w,w.prototype=new v,S.constructor=S,S.prototype=new v,_.prototype.set=function(e,t,n,i,r,o,a,s,l){for(;this.div.firstChild;)this.div.removeChild(this.div.firstChild);var c=new v(this.div,"user-image","","img");c.div.src=o;var u=new v(this.div,"user-content"),d=new v(u.div,"user-name");d.setTextContent(a);var h=new v(u.div,"timestamp");h.actualDate=l,h.setTextContent(l);var p=new v(u.div,"user-comment");if(p.setTextContent(s),n){var f=e.annotator.sketcher,m=new v(u.div,"sketch-thumbnail","","img");m.set("src",n),m.addEventListener("click",function(){f.create(),f.setReadonly(),f.background(i,function(){f.fromJSON(r)})})}return this.id=t,this.$image=c,this.$name=d,this.$comment=p,this.$timestamp=h,this.$sketchThumbnailImage=m,this.$sketchThumbnail=n,this.$sketchData=r,this};var Lt={sendMouse:function(e,t){this.sendCustom(e,t,"MouseEvents")},sendKey:function(e,t){this.sendCustom(e,t,"KeyboardEvent")},sendCustom:function(e,t,n){if(e){t=t||{};var i;n?(i=document.createEvent(n),i.initEvent(e,t.notes||!1,t.cancelable||!1)):(i=document.createEvent("CustomEvent"),i.initCustomEvent(e,t.notes||!1,t.cancelable||!1,t.data||null)),(t.sender||document).dispatchEvent(i)}}};x.prototype={headers:{},buildMessage:function(){var e=[];for(var t in this.params)e.push(t+"="+encodeURIComponent(this.params[t]));return e.join("&")},send:function(e){var t=new Mt;t.open(this.requestMethod,this.uri,!0),t.onreadystatechange=function(){4===t.readyState&&"function"==typeof e&&e(t)};var n="application/x-www-form-urlencoded; charset=UTF-8";if(t.setRequestHeader("Content-Type",n),this.headers)for(var i in this.headers)t.setRequestHeader(i,this.headers[i]);t.send(this.buildMessage())}},C.prototype={headers:{},generateBoundary:function(){return"---------------------------"+(new Date).getTime()},buildMessage:function(e){var t="\r\n",n=[],i="";i+="Content-Disposition: form-data; ",i+='name="'+this.params.name+'"; ',i+='filename="'+this.params.filename+'"'+t,i+="Content-Type: application/octet-stream"+t+t,i+=this.data+t,n.push(i);var r="--"+e+t;return r+=n.join("--"+e+t),r+="--"+e+"--"+t},send:function(e){var t=new Mt;t.open("POST",this.uri,!0),t.onreadystatechange=function(){4===t.readyState&&"function"==typeof e&&e(t)};var n=this.generateBoundary(),i="multipart/form-data; boundary="+n;if(t.setRequestHeader("Content-Type",i),this.headers)for(var r in this.headers)t.setRequestHeader(r,this.headers[r]);t.sendAsBinary(this.buildMessage(n))}},E.prototype={onMouseDown:function(e,t){this.annotator.view.markupManager.hideContextMenuPopup(),this.operator=e.button,1==e.ctrlKey&&(this.operator=2),1==e.shiftKey&&(this.operator=1),this.mouseMoveHappened=0;var n=nt(this.annotator,e);if(this.annotator.view.drawingMode&&(2==this.operator?this.operator=0:0==this.operator&&(this.operator=2)),0==this.dragging){switch(this.operator){case 0:this.firstPoint.set(n.x,n.y,0),this.firstPoint.toWindowPosition(t),this.realOldPoint.setFromHoopsPoint(this.firstPoint);var i=this.firstPoint.x*this.firstPoint.x+this.firstPoint.y*this.firstPoint.y,r=Math.sqrt(i),o=new O(this.firstPoint.x,this.firstPoint.y,this.firstPoint.z);r>1?(o.x/=r,o.y/=r,o.z=0):o.z=Math.sqrt(1-i),this.firstPoint.setFromHoopsPoint(o),this.rotateCenter||this.computeRotateCenter();break;case 2:this.firstPoint.set(n.x,n.y,0),this.firstPoint.toWindowPosition(t),at(this.annotator,this.firstPoint,this.firstPoint),this.newPoint.setFromHoopsPoint(this.firstPoint);break;case 1:this.newPoint.set(n.x,n.y,0),this.newPoint.toWindowPosition(t)}this.dragging=!0}},onMouseMove:function(e,t){var n=nt(this.annotator,e);this.clickOperator!=$t.MEASURE&&this.clickOperator!=$t.MEASURE_RADIUS||1!=this.stage||!this.annotator.state.annotator.view.currentOperator.dragging&&this.annotator.state.annotator.view.markupManager.dimensionArray.length>0&&this.annotator.state.annotator.view.markupManager.dimensionArray[this.annotator.state.annotator.view.markupManager.dimensionArray.length-1].update(n.x,n.y),(this.clickOperator==$t.MEASURE_POINTS||this.clickOperator==$t.MEASURE_ANGLE||this.clickOperator==$t.MEASURE_DISTANCE)&&this.stage>=2&&!this.annotator.state.annotator.view.currentOperator.dragging&&this.annotator.state.annotator.view.markupManager.dimensionArray.length>0&&this.annotator.state.annotator.view.markupManager.dimensionArray[this.annotator.state.annotator.view.markupManager.dimensionArray.length-1].update(n.x,n.y);var i=n.x,r=n.y;this.mouseMoveHappened++,this.actionMove(i,r,t),e.preventDefault?e.preventDefault():e.returnValue=!1},onTouchStart:function(){this.dragging=!0},onMouseUp:function(e){var t=nt(this.annotator,e);if(this.dragging=!1,5>this.mouseMoveHappened)if(2==e.button&&this.onRightMouseButtonUp(e),0!=e.button);else if(this.clickOperator==$t.SELECT)this.annotator.view.markupManager.pick(t.x,t.y);else if(this.clickOperator==$t.NOTE)this.annotator.view.markupManager.newNote(t.x,t.y);else if(this.clickOperator==$t.MEASURE_POINTS)2>this.stage?this.annotator.view.markupManager.newPointsMeasure(t.x,t.y)&&this.stage++:(this.annotator.view.markupManager.numDimensions>0&&this.annotator.view.markupManager.dimensionArray[this.annotator.view.markupManager.dimensionArray.length-1].finalize(),this.stage=0);else if(this.clickOperator==$t.MEASURE_ANGLE)2>this.stage?this.annotator.view.markupManager.newAngleMeasure(t.x,t.y)&&this.stage++:(this.annotator.view.markupManager.numDimensions>0&&this.annotator.view.markupManager.dimensionArray[this.annotator.view.markupManager.dimensionArray.length-1].finalize(),this.stage=0);else if(this.clickOperator==$t.MEASURE_DISTANCE)if(2>this.stage)this.annotator.view.markupManager.newFaceDistanceMeasure(t.x,t.y)&&this.stage++;else if(this.annotator.view.markupManager.numDimensions>0){var n=this.annotator.view.markupManager.dimensionArray[this.annotator.view.markupManager.dimensionArray.length-1];(n.cylindersHaveSameOrientation||n.parallelFaces&&n.secondPointHelper)&&0==n.finalizeStage?n.finalizeStage++:(n.finalize(),this.stage=0)}else this.stage=0;else if(this.clickOperator==$t.MEASURE||this.clickOperator==$t.MEASURE_RADIUS)if(0==this.stage)this.annotator.view.markupManager.newMeasure(t.x,t.y)&&(this.annotator.view.markupManager.dimensionArray[this.annotator.view.markupManager.dimensionArray.length-1].noType?this.stage=0:this.stage++);else if(1==this.stage){var n=this.annotator.view.markupManager.dimensionArray[this.annotator.view.markupManager.dimensionArray.length-1];this.stage=0}},onRightMouseButtonUp:function(e){if(e.ctrlKey)return!1;if(this.annotator.view.model.tree_children.every(function(e){return!(parseInt(e)>1)}))return!1;this.annotator.view.markupManager.showContextMenuPopup(e);var t=nt(this.annotator,e);this.annotator.view.markupManager.contextMenuUI.resetPos(t),this.annotator.view.markupManager.checkContextMenuItems()},onContextMenu:function(e){e.preventDefault()},onTouchMove:function(e,t){this.mouseMoveHappened=!0;var n=e.targetTouches[0].clientX,i=e.targetTouches[0].clientY;this.actionMove(n,i,t)},onTouchEnd:function(){this.dragging=!1},onMouseClick:function(e){2==e.detail&&this.annotator.view.fitWorld()},onMouseDblClick:function(){this.annotator.view.fitWorld()},onMouseWheel:function(e){var t=0;e||(e=window.event),e.wheelDelta?(t=e.wheelDelta/360,window.opera&&(t=-t)):e.detail&&(t=-e.detail/3),e.preventDefault&&e.preventDefault(),e.returnValue=!1,this.panFromEventToCanvasCenter(e),this.doZoom(t),this.panFromCanvasCenterToEvent(e)},panFromEventToCanvasCenter:function(e){var t=this.annotator.view.$hvfwCanvas,n=nt(this.annotator,e);this.firstPoint.set(n.x,n.y,0),this.firstPoint.toWindowPosition(t),at(this.annotator,this.firstPoint,this.firstPoint),this.newPoint.setFromHoopsPoint(this.firstPoint),this.dragging=!0,this.operator=2,this.actionMove(t.clientWidth/2,t.clientHeight/2,t),this.dragging=!1},panFromCanvasCenterToEvent:function(e){var t=this.annotator.view.$hvfwCanvas,n=nt(this.annotator,e);this.firstPoint.set(t.clientWidth/2,t.clientHeight/2,0),this.firstPoint.toWindowPosition(t),at(this.annotator,this.firstPoint,this.firstPoint),this.newPoint.setFromHoopsPoint(this.firstPoint),this.dragging=!0,this.operator=2,this.actionMove(n.x,n.y,t),this.dragging=!1},doZoom:function(e){var t=this.annotator.controller.sceneNode.findNode("lookAt").get("eye"),n=this.annotator.controller.sceneNode.findNode("lookAt").get("look"),i=this.annotator.controller.sceneNode.findNode("lookAt").get("up"),r=new O(t.x,t.y,t.z),o=new O(n.x,n.y,n.z);new O(i.x,i.y,i.z);var a=new O(o.x-r.x,o.y-r.y,o.z-r.z),s=Math.min(.2*e,.9);r.set(r.x+a.x*s,r.y+a.y*s,r.z+a.z*s);var l=new O(this.annotator.view.model.boundingMaximum.x-this.annotator.view.model.boundingMinimum.x,this.annotator.view.model.boundingMaximum.y-this.annotator.view.model.boundingMinimum.y,this.annotator.view.model.boundingMaximum.z-this.annotator.view.model.boundingMinimum.z),c=0;c=l.length()<a.length()?a.length():l.length();var u=new O(o.x-r.x,o.y-r.y,o.z-r.z);if(!(u.length()<l.length()/3&&e>0)||this.annotator.view.drawingMode){var d=this.annotator.controller.clientW/this.annotator.controller.clientH;this.annotator.controller.sceneNode.findNode("lookAt").set("eye",{x:r.x,y:r.y,z:r.z}),1==this.annotator.view.projectionMode?this.annotator.controller.sceneNode.findNode("camera").set("optics",{type:"perspective",fovy:.1,aspect:d,near:.1*c,far:1.9*c}):this.annotator.controller.sceneNode.findNode("camera").set("optics",{type:"perspective",fovy:45,aspect:d,near:.01*c,far:1.9*c}),this.setRotateCenter(null)}},onKeyDown:function(e){27==e.keyCode&&this.clickOperator!=$t.SELECT&&(this.stage=0),e.shiftKey&&(this.shiftPressed=!0)},onKeyUp:function(e){e.shiftKey||(this.shiftPressed=!1)},resetCamera:function(){return this.annotator.view.setViewOrientation(xt.GC_DEFAULT),!1},setRotateCenter:function(e){this.rotateCenter=e},computeRotateCenter:function(){var e=this.annotator.view.$hvfwCanvas,t=this.annotator.controller.sceneNode,n=t.pick(e.clientWidth/2,e.clientHeight/2,{rayPick:!0,averageDepth:!0});this.rotateCenter=n&&n.worldPos?new O(n.worldPos[0],n.worldPos[1],n.worldPos[2]):null},rotateLeft:function(e){e=e||ft.CAMERA.UI_HWF_ROTATE_LEFT_SPEED,this.dragging=!0,this.operator=0;var t=this.annotator.view.$hvfwCanvas;this.setFirstPointForRotating(t),this.actionMove(t.clientWidth/2+e,t.clientHeight/2,t),this.dragging=!1},rotateRight:function(e){e=e||ft.CAMERA.UI_HWF_ROTATE_RIGHT_SPEED,this.dragging=!0,this.operator=0;var t=this.annotator.view.$hvfwCanvas;this.setFirstPointForRotating(t),this.actionMove(t.clientWidth/2+e,t.clientHeight/2,t),this.dragging=!1},rotateUp:function(e){e=e||ft.CAMERA.UI_HWF_ROTATE_UP_SPEED,this.dragging=!0,this.operator=0;var t=this.annotator.view.$hvfwCanvas;this.setFirstPointForRotating(t),this.actionMove(t.clientWidth/2,t.clientHeight/2+e,t),this.dragging=!1},rotateDown:function(e){e=e||ft.CAMERA.UI_HWF_ROTATE_DOWN_SPEED,this.dragging=!0,this.operator=0;var t=this.annotator.view.$hvfwCanvas;this.setFirstPointForRotating(t),this.actionMove(t.clientWidth/2,t.clientHeight/2+e,t),this.dragging=!1},setFirstPointForRotating:function(e){this.firstPoint.set(e.clientWidth/2,e.clientHeight/2,0),this.firstPoint.toWindowPosition(e),this.realOldPoint.setFromHoopsPoint(this.firstPoint);var t=this.firstPoint.x*this.firstPoint.x+this.firstPoint.y*this.firstPoint.y,n=Math.sqrt(t),i=new O(this.firstPoint.x,this.firstPoint.y,this.firstPoint.z);n>1?(i.x/=n,i.y/=n,i.z=0):i.z=Math.sqrt(1-t),this.firstPoint.setFromHoopsPoint(i)},actionMove:function(e,t,n){if(this.dragging)switch(this.annotator.view.drawingMode&&(2==this.operator?this.operator=0:0==this.operator&&(this.operator=2)),this.operator){case 0:if(!this.annotator.view.drawingMode){this.newPoint.set(e,t,0),this.newPoint.toWindowPosition(n),this.realNewPoint.set(this.newPoint.x,this.newPoint.y,0);var i=this.newPoint.x*this.newPoint.x+this.newPoint.y*this.newPoint.y,r=Math.sqrt(i),o=new O(this.newPoint.x,this.newPoint.y,this.newPoint.z);r>1?(o.x/=r,o.y/=r,o.z=0):o.z=Math.sqrt(1-i),this.newPoint.setFromHoopsPoint(o);var a=new O(0,0,0),s=new O(this.firstPoint.x,this.firstPoint.y,this.firstPoint.z);computeCrossProduct(s,o,a);var l=new O(0,0,0);l.x=this.realNewPoint.x-this.realOldPoint.x,l.y=this.realNewPoint.y-this.realOldPoint.y;var c=90*Math.sqrt(l.x*l.x+l.y*l.y);if(0!=a.x||0!=a.y||0!=a.z){a.normalize(),l.x=0,l.y=a.y,l.z=a.z;var u=computeDotProduct(a,l),d=0;d=Math.abs(u)>1.001||.999>Math.abs(u)?arcCosine(u):0,this.secondAngle=0>a.x?-d*c:d*c,l.x=a.x,l.y=0,l.z=a.z,u=computeDotProduct(a,l),d=Math.abs(u)>1.001||.999>Math.abs(u)?arcCosine(u):0,this.firstAngle=0>a.y?d*c:-d*c,l.x=a.x,l.y=a.y,l.z=0,u=computeDotProduct(a,l),d=Math.abs(u)>1.001||.999>Math.abs(u)?arcCosine(u):0,this.thirdAngle=0>a.z?d*c:-d*c,this.annotator.view.orbitCamera(this.rotateCenter,-this.firstAngle/30,0),this.annotator.view.orbitCamera(this.rotateCenter,0,this.secondAngle/30),this.annotator.view.rollCamera(-this.thirdAngle/30)}this.firstPoint.setFromHoopsPoint(this.newPoint),this.realOldPoint.x=this.realNewPoint.x,this.realOldPoint.y=this.realNewPoint.y}break;case 1:var h=new O(this.newPoint.x,this.newPoint.y,this.newPoint.z);this.newPoint.set(e,t,0),this.newPoint.toWindowPosition(n),this.doZoom(5*(h.y-this.newPoint.y)),this.setRotateCenter(null);break;case 2:this.newPoint.set(e,t,0),this.newPoint.toWindowPosition(n),at(this.annotator,this.newPoint,this.newPoint);var p;p=0==this.annotator.view.projectionMode?1:450;var f=new O(this.newPoint.x-this.firstPoint.x,this.newPoint.y-this.firstPoint.y,this.newPoint.z-this.firstPoint.z);f.set((this.newPoint.x-this.firstPoint.x)/1/p,(this.newPoint.y-this.firstPoint.y)/1/p,(this.newPoint.z-this.firstPoint.z)/1/p),this.annotator.view.dollyCamera(f),this.setRotateCenter(null),this.firstPoint.set(e,t,0),this.firstPoint.toWindowPosition(n),at(this.annotator,this.firstPoint,this.firstPoint)}}},T.prototype={reset:function(){this.modelTree.reset();var e=!1;this.hasHwfInstances||(this.hasHwfInstances=!0,e=!0),this.hasBrepInfo=!1,this.processingIncludes=0,this.modelNode=this.annotator.controller.sceneNode.findNode("modelNode~"+this.nodeIdSuffix);var t={type:"node",id:"tempNode"},n={type:"node",id:"infrontNode"};this.segmentProperties=new Array,e&&(this.annotator.controller.sceneNode.findNode("lowest").add("node",t),this.annotator.controller.sceneNode.findNode("lowest").add("node",n),this.tempNode=this.annotator.controller.sceneNode.findNode("tempNode"),this.infrontNode=this.annotator.controller.sceneNode.findNode("infrontNode"),this.libraryNode=this.annotator.controller.sceneNode.findNode("libraryNode")),this.segmentLevel=0,this.treeLevel=0,this.modelTreeExists=!1,this.firstNode=0,this.isPart=0,this.currentSegmentName="",this.coreCount=0,this.mapIdMapper=new Array,this.cadIdMapper=new Array,this.mapIdAssociativityMapper=new Array,this.mapIdAssociativityMapperInverse=new Array,this.boundingHash=new Object,this.boundingMinimum=new O(0,0,0),this.boundingMaximum=new O(0,0,0),this.includeHash=new Object,this.tempIncludeList=new Array,this.tempIncludeListLength=0,this.activeSubnode=new Array,this.activeNode=new Array,this.treeClosure=new Array,this.treeChildset=new Array,this.currentColor=new Array,this.currentLightStatuses=new Array,this.currentTransparencyStatuses=new Array,this.colorsSet=new Array,this.openSegments=new Array,this.treeChildren=new Array,this.modelUnits=1,this.fileName="",this.currentBytePosition=0,this.extraShellData=new Array,this.segmentVisibilities={},e?this.captureManager=new G:this.captureManager.reset(),this.edgeVisibility=!0,this.faceVisibility=!0;for(var i=0;100>i;i++)this.activeNode[i]=null,this.activeSubnode[i]=null,this.treeClosure[i]=!1,this.treeChildset[i]=!1,this.currentColor[i]=new Array,this.currentColor[i][0]=1,this.currentColor[i][1]=1,this.currentColor[i][2]=1,this.currentTransparencyStatuses[i]=0,this.currentLightStatuses[i]=!0,this.colorsSet[i]=0,this.openSegments[i]=!1,this.treeChildren[i]=0;this.shpereInserted=!1,this.sphereToggle=!1,e?this.geometryInfo=new U:this.geometryInfo.reset()},setState:function(e,t){e&&(this.explosionManager.setState(e.explosionManagerState,t),this.cuttingPlaneManager.setState(e.cuttingPlaneManagerState,t),this.modelTree.tree.setState(e.modelElementState,t),this.fileComparisonManager.setState(e.fileComparisonState,t))},getState:function(){return{modelUnits:this.modelUnits,cuttingPlaneManagerState:this.cuttingPlaneManager.getState(),explosionManagerState:this.explosionManager.getState(),modelElementState:this.modelTree.tree.getState(),fileComparisonState:this.fileComparisonManager.getState()}},getFileVersion:function(){return this.m_fileVersion?Number(this.m_fileVersion):0},toggleEdgeVisibilityRecursive:function(e){e.eachNode(function(){var e=!1,t="a"+this.get("id");if(-1!=t.indexOf("s")){var n=t.split("s");this.hasSegmentProperties(parseInt(n[1]))&&(e=this.getSegmentProperties(parseInt(n[1])).baseVisibilitySet?!0:!1)}var i=this.get("type"),r=!1;if("flags"==i){var o=this.node(0);if("geometry"==o.get("type")&&o._targetNode&&o._targetNode.core&&4!=o._targetNode.core.primitive?r=!0:"material"==o.get("type")&&(o=o.node(0),o&&"geometry"==o.get("type")&&o._targetNode&&o._targetNode.core&&4!=o._targetNode.core.primitive&&(r=!0)),r){var a=this.get("flags");this.set({flags:{enabled:this.edgeVisibility,transparent:a.transparent,backfaces:this.annotator.state.showBackFaces}})}}e||this.toggleEdgeVisibilityRecursive(this)},{andSelf:!1})},getSegmentProperties:function(e){return null==this.segmentProperties[e]&&(this.segmentProperties[e]=new B(this.annotator)),this.segmentProperties[e]},hasSegmentProperties:function(e){return null==this.segmentProperties[e]?!1:!0},resolveMatrices:function(e,t,n){for(var i=0;4>i;i++)t[i]=new Array(4);for(var r=new Array,o=e;;){if(o=o.parent(),!o)break;var a=o.get("type");"matrix"==a&&(r[r.length]=o)}for(var i=r.length-1;i>=0;i--){var s=r[i].get("elements");if(i==r.length-1)setMatrixFromArray(s,t);else{for(var l=new Array(4),c=0;4>c;c++)l[c]=new Array(4);setMatrixFromArray(s,l),multiplyMatrices(l,t,t)}}if(void 0!=n)if(r.length>0){for(var l=new Array(4),c=0;4>c;c++)l[c]=new Array(4);setMatrixFromArray(n,l),multiplyMatrices(l,t,t)}else setMatrixFromArray(n,t);return r.length>0||n?!0:!1},extractOption:function(e,t){var n=e.indexOf(t+"=");if(n>=0){var i=e.substr(n+t.length+1);return n=i.indexOf(","),n>=0&&(i=i.substr(0,n)),i}return null},applyCurrentColorToNode:function(e,t){var n=t?0:1,i={r:this.currentColor[this.segmentLevel][0],g:this.currentColor[this.segmentLevel][1],b:this.currentColor[this.segmentLevel][2]},r=null;r=this.colorsSet[this.segmentLevel]&Tt?{type:"material",emit:n,specular:1,baseColor:i,alpha:this.currentTransparencyStatuses[this.segmentLevel]}:{type:"material",emit:n,baseColor:i},e.insert("node",r)}},k.prototype={addChild:function(e){this.children.push(e)},getState:function(){var e={};if(e.title=this.title,e.id=this.id,e.nodeVisibility=this.nodeVisibility,this.children.length>0){e.children=new Array;for(var t=0;this.children.length>t;t++)e.children.push(this.children[t].getState())}return e},setState:function(e){e&&(this.applyState(e),this.fixupVisibilityAndChecking(),this.updateGlobalBoundingBox())},applyState:function(e){if(e.children)for(var t=0;e.children.length>t;t++){for(var n=e.children[t],i=null,r=null,o=0,a=0,s=0;this.children.length>s;s++){var l=this.children[s];l.id==n.id&&(i=l,a++),l.title===n.title&&(r=l,o++)}var c=null;c=!r||o>1?i:r,c&&c.applyState(n)}else this.updateVisibility(e.nodeVisibility,!0)},fixupVisibilityAndChecking:function(){if(this.children&&this.children.length>0){this.nodeVisibility=!0;for(var e=0;this.children.length>e;e++)this.children[e].fixupVisibilityAndChecking()||(this.nodeVisibility=!1)}return this.updateChecking(this.nodeVisibility,!1),this.nodeVisibility},showRootNode:function(){for(var e=this.annotator,t=[/(.*sldprt)$/,/(.*sldasm)$/],n=e.modelFileName.toLowerCase(),i=0;t.length>i;i++)if(t[i].test(n))return!1;return!0},createNodeUI:function(e){var t,n,i,r,o,a,s,l,c,u,d,h,p,f=this.showRootNode(),m=f?0:1,g=!f&&0==this.depth;for(p=this.annotator,d=this.children,h=this,t=new v(e,"treenode"),g&&t.setStyle("display","none"),n=new v(t.div,"treenode-container"),c=0,s=m;this.depth>s;s++)i=new y(n.div,"whiteSpace"),c+=13;
this.children.length>0?(r=new y(n.div,"expandItem"),g&&(r.check(),r.set("title","Collapse")),r.set("title","Expand"),r.addEventListener("click",function(){for(r.isChecked()?(r.uncheck(),r.set("title","Expand")):(r.check(),r.set("title","Collapse")),l=0;d.length>l;l++)u=d[l],u.updateExpanding();for(l=0;d.length>l;l++)u=d[l],u.updateChildrenExpanding(l==d.length-1)})):r=new y(n.div,"whiteSpace"),o=new y(n.div,"checkItem"),o.set("title","Hide");var b=h.nodeVisibility;for(b?o.check():o.uncheck(),o.addEventListener("click",function(){var e=!o.isChecked();h.updateChecking(e,!0);for(var t=h.parent;t;){for(var n=!0,i=0;t.children.length>i;i++)t.children[i].checkItem.isChecked()||(n=!1);t.updateChecking(n,!1),t=t.parent}h.updateVisibility(e,!0),h.annotator.view.markupManager.contextMenuUI&&h.annotator.view.markupManager.checkContextMenuItems(),h.updateGlobalBoundingBox()}),a=new v(n.div,"nodetext"),a.setTextContent(this.title),a.set("unselectable","on"),h.emphasized&&a.set("emphasized","true"),a.addEventListener("click",function(){p.view.selectionManager.setSelectionByModelElement(h,!1)}),a.addEventListener("mouseup",function(e){p.view.selectionManager.setSelectionByModelElement(h,!1),p.view.markupManager.showContextMenuPopup(e,!0);var t=it(e);p.view.markupManager.contextMenuUI.resetPos(t),p.view.markupManager.checkContextMenuItems()}),a.addEventListener("contextmenu",function(e){e.preventDefault()}),a.addEventListener("mouseover",function(){p.view.model.modelTree.treeUI.blockHighlighting||p.view.selectionManager.setDynamicHighlightByModelElement(h)}),a.addEventListener("mouseout",function(){p.view.selectionManager.setDynamicHighlightByModelElement(null)}),this.treeNode=t,this.treeNodeContainer=n,this.expandItem=r,this.checkItem=o,this.nodeText=a,this.whiteSpaceWidth=c,s=0;d.length>s;s++)u=d[s],u.createNodeUI(e);if(this.createdNodeUI=!0,this.previouseNode=null,this.parent&&(this.previouseNode=this.parent.treeNode,0!=this.parent.children.indexOf(this)&&(this.previouseNode=this.parent.children[this.parent.children.indexOf(this)-1].treeNode)),this.isTree()){for(s=0;d.length>s;s++)u=d[s],u.updateExpanding();for(s=0;d.length>s;s++)u=d[s],u.updateChildrenExpanding(s==d.length-1)}},select:function(e){if(this.nodeText.check(),e){for(var t=this.parent,n=t;t;)t.expandItem.isChecked()||(t.expandItem.check(),t.expandItem.set("title","Collapse")),n=t,t=t.parent;n.updateExpanding(),n.updateChildrenExpanding(!0)}},deselect:function(){this.nodeText.uncheck()},highlight:function(){this.nodeText.set("highlighted")},unhighlight:function(){this.nodeText.unset("highlighted")},updateExpanding:function(){for(var e=this.parent,t=e?e.expandItem.isChecked():!0;e&&t;)e=e.parent,t=e?e.expandItem.isChecked():!0;t?this.previouseNode?this.treeNode.showAfter(this.previouseNode):this.treeNode.show():this.treeNode.hide()},updateChildrenExpanding:function(e){if(this.children.length>0){var t,n;for(t=0;this.children.length>t;t++)n=this.children[t],n.updateExpanding();for(t=0;this.children.length>t;t++)n=this.children[t],n.updateChildrenExpanding(t==this.children.length-1&&e)}else e&&this.annotator.view.model&&this.annotator.view.model.modelTree.treeUI.updateScrollbars()},updateChecking:function(e,t,n){if(e?(this.checkItem.check(),this.checkItem.set("title","Hide")):(this.checkItem.uncheck(),this.checkItem.set("title","Show")),t)for(var i=0;this.children.length>i;i++){var r=this.children[i];r.updateChecking(e,!0)}if(!e&&!t&&this.children.length>0){for(var o=!1,a=0;this.children.length>a;a++)(this.children[a].checkItem.isChecked()||this.children[a].partiallyChecked)&&(o=!0);o?(this.partiallyChecked=!0,this.checkItem.set("partially-checked")):(this.partiallyChecked=!1,this.checkItem.unset("partially-checked"))}else this.partiallyChecked=!1,this.checkItem.unset("partially-checked");if(n)for(var s=this.parent;s;){for(var l=!0,a=0;s.children.length>a;a++)s.children[a].checkItem.isChecked()||(l=!1);s.updateChecking(l,!1),s=s.parent}},updateNodeVisibility:function(e){this.nodeVisibility=e;for(var t=0;this.children.length>t;t++){var n=this.children[t];n.updateNodeVisibility(e)}},updateVisibility:function(e,t,n){this.parent;var i=this.annotator;if(n=t?e:n,t||this.nodeVisibility!=n){this.updateNodeVisibility(n);var r=i.view.model,o=i.controller.sceneNode.findNode(this.id);r.getSegmentProperties(r.firstNode).setVisibilityFromNode(this.annotator.view.model,o,i.state.showBackFaces,!1,n)}for(var a=0;this.children.length>a;a++){var s=this.children[a];s.updateVisibility(e,!1,n)}},updateGlobalBoundingBox:function(){var e=this.annotator.view.model;e.modelNode.eachNode(function(){if("node"==this.get("type")){var t=this.get("id");if(-1!=t.indexOf("s")){var n=t.split("s");e.hasSegmentProperties(parseInt(n[1]))&&e.getSegmentProperties(parseInt(n[1])).visible&&e.accumulateBoundingBox(n[1],e.boundingMinimum,e.boundingMaximum)}}},{andSelf:!0,depthFirst:!0})},isTree:function(){return this.parent?!1:!0},getNodeById:function(e){if(this.id==e)return this;if(this.children.length>0)for(var t=0;this.children.length>t;t++){var n=this.children[t].getNodeById(e);if(n)return n}return!1},deserialize:function(e){var t=e||"";t+="	";var n="\n"+t+"{";n+="\n"+t+'"data": {"title": "'+this.title+'", "icon": '+this.icon+', "open": '+this.open+"},",n+="\n"+t+'"attr": {"id": "'+this.id+'"},',n+="\n"+t+'"metadata": {"id": "'+this.id+'"},',n+="\n"+t+'"children": [';for(var i=0;this.children.length>i;i++){var r=this.children[i];n+=r.deserialize(t)}return n+="\n"+t+"]}"}},A.prototype={reset:function(){this.tree=null,this.activeElement=null,this.treeUI&&this.treeUI.reset()},updateTree:function(){},addElement:function(e,t,n,i,r){var o=null;this.activeElement?this.activeElement.open?(o=new k(this.annotator,this.activeElement,e,t,n,i,r),this.activeElement.addChild(o),this.activeElement=o):alert("Done parsing model tree with problem: "+this.activeElement.isTree()):(o=new k(this.annotator,null,e,t,n,i,r),this.tree=o,this.activeElement=o)},openChildren:function(){this.activeElement&&(this.activeElement.open=!0)},closeChildren:function(){if(this.activeElement)if(this.activeElement.open=!1,this.activeElement.isTree()){if(this.activeElement=null,this.treeUI&&(this.tree.createNodeUI(this.treeUI.scrollContentDiv.div),this.treeUI.treeWasResized=!0,this.treeUI.setStyle("height","160px"),this.treeUI.scrollDiv.setStyle("height","155px"),this.treeUI.setStyle("minHeight","60px"),this.treeUI.updateTreeHeight(),this.annotator.toolbar.$modelTree.isChecked())){var e=this.treeUI;e.show(),window.setTimeout(function(){e.updateScrollbars(),e.startResizeListening(),e.scrollToLastNode()},100)}}else this.activeElement=this.activeElement.parent},selectNodeById:function(e,t,n){if(this.tree){var i=this.tree.getNodeById(e);i&&(t?i.select(n):i.deselect(),this.treeUI&&n&&this.treeUI.scrollToNode(i.treeNode,i.whiteSpaceWidth))}},highlightNodeById:function(e,t){if(e){var n=this.tree.getNodeById(e);n&&(t?n.highlight(!1):n.unhighlight(!1))}},areAllChildrenVisible:function(e){for(var t=0;e.children.length>t;t++){if(1!=e.children[t].nodeVisibility)return!1;if(1!=this.areAllChildrenVisible(e.children[t]))return!1}return!0},areOtherBranchesShowing:function(e,t){if(e.cumulativeVisibility=0,e.children.length>0)for(var n=0;e.children.length>n;n++){var i=e.children[n];this.areOtherBranchesShowing(i),e.cumulativeVisibility+=i.cumulativeVisibility}else e.cumulativeVisibility=e.nodeVisibility?1:0;if(t){for(var r=t.parent;null!=r&&1==r.children.length;)r=r.parent;return null==r?!1:e.cumulativeVisibility>t.cumulativeVisibility?!0:!1}}},N.prototype={getEpsilon:function(){return 1e-5},arcCosine:function(e){return-1>e?Math.PI:e>1?0:Math.acos(e)},easeInEaseOutSimpleCase:function(e,t,n){return.5*e*e*t/n},easeInEaseOutMiddleCase:function(e,t,n){return this.state.annotator.controller.utilities.easeInEaseOutSimpleCase(n,t,n)+(e-n)*t},easeInEaseOutComplicatedCase:function(e,t,n,i,r){return this.state.annotator.controller.utilities.easeInEaseOutMiddleCase(n+i,t,n)+(e-(n+i))*t*(1-.5*(e-(n+i))/r)},easeInEaseOut:function(e,t,n,i){var r,o=2/(t+2*n+i);return r=t>=e?this.state.annotator.controller.utilities.easeInEaseOutSimpleCase(e,o,t):e>=t&&t+n>=e?this.state.annotator.controller.utilities.easeInEaseOutSimpleCase(e,o,t):this.state.annotator.controller.utilities.easeInEaseOutComplicatedCase(e,o,t,n,i),r=Math.min(r,1)},getMatrixFromCamera:function(e,t,n,i,r){var o=new P(t,e).normalize();n=n.normalize();var a=n.cross(o);r[0]=a.x,r[1]=a.y,r[2]=a.z,r[3]=0;var s=o.cross(a);r[4]=s.x,r[5]=s.y,r[6]=s.z,r[7]=0,r[8]=o.x,r[9]=o.y,r[10]=o.z,r[11]=0,r[12]=i.x,r[13]=i.y,r[14]=i.z,r[15]=0},matrixToQuaternion:function(e,t){var n=0,i=1,r=2,o=3,a=e[0]+e[5]+e[10];if(a>0){var s=Math.sqrt(a+1);t[o]=.5*s,s=.5/s,t[n]=(e[6]-e[9])*s,t[i]=(e[8]-e[2])*s,t[r]=(e[1]-e[4])*s}else{var l=n;e[4*i+i]>e[4*n+n]&&(l=i),e[4*r+r]>e[4*l+l]&&(l=r);var c=[i,r,n],u=c[l],d=c[u],s=Math.sqrt(e[4*l+l]-(e[4*u+u]+e[4*d+d])+1);t[l]=.5*s,s=.5/s,t[o]=(e[4*u+d]-e[4*d+u])*s,t[u]=(e[4*l+u]+e[4*u+l])*s,t[d]=(e[4*l+d]+e[4*d+l])*s}},quaternionToMatrix:function(e,t){var n=0,i=1,r=2,o=3,a=e[n]*e[n]+e[i]*e[i]+e[r]*e[r]+e[o]*e[o];a=2/a;var s=e[n]*a,l=e[i]*a,c=e[r]*a,u=e[o]*s,d=e[o]*l,h=e[o]*c,p=e[n]*s,f=e[n]*l,m=e[n]*c,g=e[i]*l,v=e[i]*c,y=e[r]*c;t[0]=1-(g+y),t[1]=f+h,t[2]=m-d,t[3]=0,t[4]=f-h,t[5]=1-(p+y),t[6]=v+u,t[7]=0,t[8]=m+d,t[9]=v-u,t[10]=1-(p+g),t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1},transitionQuaternion:function(e,t,n,i){var r,o,a=0,s=1,l=2,c=3,u=e[a]*t[a]+e[s]*t[s]+e[l]*t[l]+e[c]*t[c];if(1+u>this.state.annotator.controller.utilities.getEpsilon()){if(1-u>this.state.annotator.controller.utilities.getEpsilon()){var d=this.state.annotator.controller.utilities.arcCosine(u),h=Math.sin(d);r=Math.sin((1-n)*d)/h,o=Math.sin(n*d)/h}else r=1-n,o=n;for(var p=0;4>p;++p)i[p]=r*e[p]+o*t[p]}else{i[a]=-e[s],i[s]=e[a],i[l]=-e[c],i[c]=e[l],r=Math.sin((1-n)*Math.PI/2),o=Math.sin(n*Math.PI/2);for(var p=0;3>p;++p)i[p]=r*e[p]+o*i[p]}},smoothTransitionInternal:function(e,t,n,i,r,o,a,s,l,c,u,d){var h=new F;h.pos=e,h.tar=t,h.up=n,h.height=r,h.width=i;var p=new F;if(p.pos=o,p.tar=a,p.up=s,p.height=c,p.width=l,h.equals(p))return null;this.state.annotator.controller.sceneNode.findNode("lookAt");var f=this.state.annotator.controller.sceneNode.findNode("camera"),m=f.get("optics").type;"ortho"===m&&(m="orthographic");var g=[],v=[],y=new P(e,t),b=new P(o,a),_=y.magnitude(),w=b.magnitude()-_;y=y.normalize(),b=b.normalize();var S=new P(b,y),x=new P(n,s),C=!0;1e-4>S.magnitude()&&1e-4>x.magnitude()&&(C=!1);var $=new P,E=new P;C?(this.state.annotator.controller.utilities.getMatrixFromCamera(t,e,n,$,g),this.state.annotator.controller.utilities.getMatrixFromCamera(a,o,s,$,v)):E=new P(o.x-e.x,o.y-e.y,o.z-e.z);var T=[],k=[],A=[],N=[];C&&(this.state.annotator.controller.utilities.matrixToQuaternion(g,k),this.state.annotator.controller.utilities.matrixToQuaternion(v,A));var M=new P(t,a),D=l-i,L=c-r;if(C){var O=(k[0]-A[0])*(k[0]-A[0])+(k[1]-A[1])*(k[1]-A[1])+(k[2]-A[2])*(k[2]-A[2])+(k[3]-A[3])*(k[3]-A[3]),R=(k[0]+A[0])*(k[0]+A[0])+(k[1]+A[1])*(k[1]+A[1])+(k[2]+A[2])*(k[2]+A[2])+(k[3]+A[3])*(k[3]+A[3]);O>R&&(A[0]=-A[0],A[1]=-A[1],A[2]=-A[2],A[3]=-A[3])}var U,B=new I,j=new P(n),G=i,z=i,H=this.state.annotator.controller.utilities,V=this.state.annotator,W=this.state.annotator.controller.worldClock.createTask(function(n){if(U=(n-this.timeCreated)/u,U=Math.min(U,1),U=H.easeInEaseOut(U,.49,.02,.49),U=Math.max(U,0),C){var o=t.add(M.scale(U));H.transitionQuaternion(k,A,U,N),H.quaternionToMatrix(N,T),B.x=o.x-T[8]*(_+w*U),B.y=o.y-T[9]*(_+w*U),B.z=o.z-T[10]*(_+w*U),j.x=T[4],j.y=T[5],j.z=T[6]}else B=e.add(E.scale(U));var a=t.add(M.scale(U)),s=i+U*D,l=r+U*L;s>1e-5&&l>1e-5&&(G=s,z=l);var c=new F;c.pos=B,c.tar=a,c.up=j,c.width=G,c.height=z,c.proj=m,c.applyToScene(V),U>=1-H.getEpsilon()&&this.stageKill()});return W.onKill=function(){var e=new F;e.pos=o,e.tar=a,e.up=s,e.width=l,e.height=c,e.proj=m,e.applyToScene(V),d&&d()},W},smoothTransition:function(e,t,n){e=new F(e);var i=this.state.annotator,r=F.fromScene(i);e.applyToScene(i);var o=F.fromScene(i);return r.applyToScene(i),i.controller.utilities.smoothTransitionInternal(r.pos,r.tar,r.up,r.width,r.height,o.pos,o.tar,o.up,o.width,o.height,t,function(){var t="orthographic"===e.proj||e.isFakeOrthographic();i.view.projectionMode=t?1:0,n&&n()})}},M.prototype={isAlive:function(){return this._life!==Nt},kill:function(){this._life!==Nt&&(this._life=Nt,this.onKill())},stageKill:function(){if(this._life===kt){this._life=At;var e=this,t=this._clock.createTaskBefore(this,function(){e.kill(),t.kill()})}},setDebugMemo:function(e){return this._debugMemo=e,this}},D.prototype={run:function(){for(var e=this._front._next;e!==this._back;){if(e.isAlive()){var t=(new Date).valueOf();t-e._lastRan>=e.delay&&(e.onRun.call(e,t),e._lastRan=t)}else e._prev._next=e._next,e._next._prev=e._prev;e=e._next}this._front._next===this._back&&(clearInterval(this.annotator.controller.worldClock.intervalId),this.annotator.controller.worldClock.intervalId=null)},createTaskBefore:function(e,t,n){return new M(this.annotator,this,t,n,e)},createTaskAfter:function(e,t,n){return this.createTaskBefore(e._next,t,n)},createTaskFront:function(e,t){return this.createTaskBefore(this._front._next,e,t)},createTaskBack:function(e,t){return this.createTaskAfter(this._back._prev,e,t)},createTask:function(e,t){return this.createTaskAfter(this._back._prev,e,t)}},P.prototype={equals:function(e){return this.x===e.x&&this.y===e.y&&this.z===e.z},magnitude:function(){var e=this.x,t=this.y,n=this.z;return Math.sqrt(e*e+t*t+n*n)},scale:function(e){var t=new P(this);return t.x*=e,t.y*=e,t.z*=e,t},normalize:function(){var e=new P(this),t=e.magnitude();return e.x/=t,e.y/=t,e.z/=t,e},cross:function(e){return new P(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)},constructor:P},I.prototype={add:function(e){var t=new I(this);return t.x+=e.x,t.y+=e.y,t.z+=e.z,t},distance:function(e){return new P(this,e).magnitude()},equals:function(e){return this.x===e.x&&this.y===e.y&&this.z===e.z},constructor:I},I.origin=function(){return new I(0,0,0)},F.prototype={equals:function(e){return this.pos.equals(e.pos)&&this.tar.equals(e.tar)&&this.up.equals(e.up)&&this.width===e.width&&this.height===e.height&&this.proj===e.proj},canonicalizeUpVector:function(){var e=new P(this.pos,this.tar);this.up=e.cross(this.up).cross(e).normalize()},applyToScene:function(e){var t=this.getSceneJsProperties(e);e.controller.sceneNode.findNode("lookAt").set(t.lookAt),e.controller.sceneNode.findNode("camera").set(t.camera)},isFakeOrthographic:function(){var e=1e-5,t=this.width/2,n=new P(this.pos,this.tar).magnitude(),i=Math.PI/2-Math.atan2(n,t),r=180*i/Math.PI;return e>Math.abs(r-.05)},getPerspectiveProperties:function(e){var t=e.controller.clientW/e.controller.clientH,n=new I(this.pos),i=new I(this.tar),r=new P(this.up),o=i.add(new P(n,i).cross(r).normalize().scale(this.width/2)),a=new P(n,o).magnitude(),s=new P(n,i).magnitude(),l=Math.acos(s/a),c=l*(180/Math.PI),u=Math.max(I.origin().distance(n),new P(e.view.model.boundingMinimum,e.view.model.boundingMaximum).magnitude()),d=.1*u,h=1.9*u;return{lookAt:{eye:n,look:i,up:r},camera:{optics:{aspect:t,fovy:2*c,near:d,far:h,type:"perspective"}}}},getOrthographicProperties:function(e){var t=e.controller.clientW/e.controller.clientH,n=new I(this.pos),i=new I(this.tar),r=new P(this.up),o=.05,a=o*Math.PI/180,s=this.width/2,l=s/Math.tan(a),c=i.add(new P(i,n).normalize().scale(l)),u=Math.max(I.origin().distance(c),new P(e.view.model.boundingMinimum,e.view.model.boundingMaximum).magnitude()),d=.1*u,h=1.9*u;return{lookAt:{eye:c,look:i,up:r},camera:{optics:{aspect:t,fovy:2*o,near:d,far:h,type:"perspective"}}}},getSceneJsProperties:function(e){return this.canonicalizeUpVector(),"perspective"===this.proj?this.getPerspectiveProperties(e):"orthographic"===this.proj?this.getOrthographicProperties(e):!1},constructor:F},F.fromScene=function(e){var t=e.controller.sceneNode.findNode("lookAt"),n=e.controller.sceneNode.findNode("camera"),i=new I(t.get("eye")),r=new I(t.get("look")),o=new P(t.get("up")),a=n.get("optics"),s=a.type;if("perspective"!==s)throw new Error("projection should've been encoded as perspective");var l=a.fovy/2,c=l*Math.PI/180,u=new P(i,r).magnitude(),d=u*Math.tan(c),h=2*d,p=h,f=new F;return f.pos=i,f.tar=r,f.up=o,f.width=h,f.height=p,f.proj=s,f},L.prototype={everythingOn:function(){return this.equals(L.EVERYTHING())},everythingOff:function(){return this.equals(L.EVERYTHING().not())},empty:function(){return this.equals(L.EMPTY())},inverseSetting:function(e){return e===!0?!1:e===!1?!0:null},not:function(){for(var e=["_everything","_geometry"],t=["_faces","_lines","_text"],n=e.concat(t),i=new L,r=0;n.length>r;++r){var o=n[r];i[o]=this.inverseSetting(this[o])}return i},equals:function(e){for(var t=["_everything","_geometry"],n=["_faces","_lines","_text"],i=t.concat(n),r=0;i.length>r;++r){var o=i[r];if(this[o]!==e[o])return!1}return!0},deserializeSetting:function(e){var t=e.shift();return"1"==t?!0:"0"==t?!1:null},skipToNextGrouping:function(e){for(var t="-";e[0]!=t;)e.shift();e.shift()}},L.EMPTY=function(){return new L},L.EVERYTHING=function(){return new L("_everything")},L.GEOMETRY=function(){return new L("_geometry")},L.FACES=function(){return new L("_faces")},L.LINES=function(){return new L("_lines")},L.TEXT=function(){return new L("_text")},L.deserialize=function(e){var t=new L,n=e.split("");return t._everything=t.deserializeSetting(n),t._geometry=t.deserializeSetting(n),t.skipToNextGrouping(n),t._faces=t.deserializeSetting(n),t._lines=t.deserializeSetting(n),t._text=t.deserializeSetting(n),t},O.prototype={set:function(e,t,n){this.x=e,this.y=t,this.z=n},equals:function(e){return this.x==e.x&&this.y==e.y&&this.z==e.z?!0:!1},equalsWithTolerance:function(e,t){return t>this.x-e.x&&this.x-e.x>-t&&t>this.y-e.y&&this.y-e.y>-t&&t>this.z-e.z&&this.z-e.z>-t?!0:!1},sub:function(e){this.x-=e.x,this.y-=e.y,this.z-=e.z},subtract:function(e,t){this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z},setFromHoopsPoint:function(e){this.x=e.x,this.y=e.y,this.z=e.z},toWindowPosition:function(e){this.x=2*(this.x/e.clientWidth)-1,this.y=1-2*(this.y/e.clientHeight),this.z=0},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var e=this.length();this.x=this.x/e,this.y=this.y/e,this.z=this.z/e},dot:function(e){return computeDotProduct(this,e)},oneVectorCross:function(e){var t=new O(0,0,0);t=Math.abs(this.x)<=Math.abs(this.y)&&Math.abs(this.x)<=Math.abs(this.z)?new O(1,0,0):Math.abs(this.y)<=Math.abs(this.x)&&Math.abs(this.y)<=Math.abs(this.z)?new O(0,1,0):new O(0,0,1),computeCrossProduct(t,this,e)},clean:function(e){e.normalize();var t=this.dot(e);this.x-=t*e.x,this.y-=t*e.y,this.z-=t*e.z,this.normalize()}},R.prototype={set:function(e,t,n,i){this.n.set(e,t,n),this.d=i},setFromPlane:function(e){this.n.setFromHoopsPoint(e.n),this.V0.setFromHoopsPoint(e.V0),this.d=e.d},setFromPointAndNormal:function(e,t){this.n.setFromHoopsPoint(t),this.V0.setFromHoopsPoint(e),this.d=-(e.x*t.x+e.y*t.y+e.z*t.z)},calculateFromTriangleArray:function(e){this.n.x=(e[1].y-e[0].y)*(e[2].z-e[0].z)-(e[1].z-e[0].z)*(e[2].y-e[0].y),this.n.y=(e[1].z-e[0].z)*(e[2].x-e[0].x)-(e[1].x-e[0].x)*(e[2].z-e[0].z),this.n.z=(e[1].x-e[0].x)*(e[2].y-e[0].y)-(e[1].y-e[0].y)*(e[2].x-e[0].x),this.n.normalize(),this.V0.setFromHoopsPoint(e[0]),this.d=-this.n.x*e[0].x-this.n.y*e[0].y-this.n.z*e[0].z},calculateFromTriangle:function(e,t,n){this.n.x=(t.y-e.y)*(n.z-e.z)-(t.z-e.z)*(n.y-e.y),this.n.y=(t.z-e.z)*(n.x-e.x)-(t.x-e.x)*(n.z-e.z),this.n.z=(t.x-e.x)*(n.y-e.y)-(t.y-e.y)*(n.x-e.x),this.n.normalize(),this.V0.setFromHoopsPoint(e),this.d=-this.n.x*e.x-this.n.y*e.y-this.n.z*e.z},sideOfPlane:function(e){return this.n.x*e.x+this.n.y*e.y+this.n.z*e.z+this.d>0?!0:!1},toWhichSide:function(e){var t=e.x*this.n.x+e.y*this.n.y+e.z*this.n.z+this.d;return-1e-6>t?-1:t>1e-6?1:0},computeIntersectionWithLine:function(e,t,n){var i=(this.n.x*e.x+this.n.y*e.y+this.n.z*e.z+this.d)/(this.n.x*(e.x-t.x)+this.n.y*(e.y-t.y)+this.n.z*(e.z-t.z));n.set(e.x+i*(t.x-e.x),e.y+i*(t.y-e.y),e.z+i*(t.z-e.z))}},U.prototype={reset:function(){},getCircleBrepInfo:function(e,t,n,i,r,o,a,s){var l={type:e,radius:t,origin:new O(n,i,r),axis:new O(o,a,s)};return l},getCylinderBrepInfo:function(e,t,n,i,r,o,a,s,l){var c={type:e,radius:t,origin:new O(n,i,r),axis:new O(o,a,s),angle:l};return c},getPlaneBrepInfo:function(e,t,n,i,r,o,a){var s={type:e,origin:new O(t,n,i),axis:new O(r,o,a)};return s}},B.prototype={fixupNodes:function(e,t,n){e.eachNode(function(){if("flags"==this.get("type")){var e,i,r=this.get("flags");e=t?!0:r.transparent,i=n?!0:r.backfaces,this.set({flags:{enabled:r.enabled,transparent:e,backfaces:i}})}},{andSelf:!0,depthFirst:!0})},setVisibilityFromNode:function(e,t,n,i,r){lt(e,t,n,r,!0,0,i)},setVisibility:function(e,t){var n=this.annotator.controller.sceneNode.findNode("s"+e);void 0!==t?this.setVisibilityFromNode(this.annotator.view.model,n,this.annotator.state.showBackFaces,!1,t):this.setVisibilityFromNode(this.annotator.view.model,n,this.annotator.state.showBackFaces,!1)}},j.prototype={showCuttingPlanePopup:function(e){this.cuttingPlaneUI||(this.cuttingPlaneUI=new u(this.annotator)),e&&this.cuttingPlaneUI.show(),this.annotator.view.model.cuttingPlaneManager.show()},hideCuttingPlanePopup:function(e){this.cuttingPlaneUI&&(this.cuttingPlaneUI.hide(),e&&this.annotator.view.model.cuttingPlaneManager.hide())},showContextMenuPopup:function(e,t){if(this.contextMenuUI||(this.contextMenuUI=new d(this.annotator)),this.contextMenuUI.show(),$("html").bind("click",function(){$(".annotator-popup[contextmenu]").hide()}),$(".annotator-popup[contextmenu]").bind("contextmenu",function(e){e.preventDefault()}),$(".annotator-popup[contextmenu]").show(),!t){var n=nt(this.annotator,e);this.annotator.view.markupManager.pick(n.x,n.y)}this.annotator.view.currentOperator.dragging=!1},checkContextMenuItems:function(){var e=!this.annotator.view.model.modelTree.areAllChildrenVisible(this.annotator.view.model.modelTree.tree),t=this.annotator.view.model.modelTree.areOtherBranchesShowing(this.annotator.view.model.modelTree.tree,this.annotator.view.selectionManager.getFirstSelectedElement()),n=null!=this.annotator.view.selectionManager.getFirstSelectedElement(),i=this.annotator.getContext()==gt.WORKBENCH&&this.annotator.idHelper.isConversionAvailable(),r=this.annotator.idHelper.convertModelElementToExternalRef(this.annotator.view.selectionManager.getFirstSelectedElement()),o=r.length>0&&-1==location.hash.indexOf("#/file/"+r[0].content_file_id);e?this.annotator.view.markupManager.enableContextMenuItem("showAll"):this.annotator.view.markupManager.disableContextMenuItem("showAll"),t?this.annotator.view.markupManager.enableContextMenuItem("isolate"):this.annotator.view.markupManager.disableContextMenuItem("isolate"),n?this.annotator.view.selectionManager.getFirstSelectedElement().nodeVisibility?(this.annotator.view.markupManager.modifyContextMenuItem("hide","Hide"),this.annotator.view.markupManager.enableContextMenuItem("hide")):(this.annotator.view.markupManager.modifyContextMenuItem("hide","Show"),this.annotator.view.markupManager.enableContextMenuItem("hide")):this.annotator.view.markupManager.disableContextMenuItem("hide"),this.annotator.view.markupManager.setContextMenuItemVisibility("open",i),o?this.annotator.view.markupManager.enableContextMenuItem("open"):this.annotator.view.markupManager.disableContextMenuItem("open")},hideContextMenuPopup:function(){this.contextMenuUI&&this.contextMenuUI.hide()},disableContextMenuItem:function(e){e&&$(".annotator-popup[contextmenu] ."+e).addClass("inactive")},modifyContextMenuItem:function(e,t){e&&$(".annotator-popup[contextmenu] ."+e+" > .text").text(t)},enableContextMenuItem:function(e){e&&$(".annotator-popup[contextmenu] ."+e).removeClass("inactive")},setContextMenuItemVisibility:function(e,t){e&&(t?$(".annotator-popup[contextmenu] ."+e).show():$(".annotator-popup[contextmenu] ."+e).hide())},showExplodeAssemblyPopup:function(e){this.explodeAssemblyUI||(this.explodeAssemblyUI=new h(this.annotator)),e&&(this.explodeAssemblyUI.show(),this.explodeAssemblyUI.goToLastPosition())},hideExplodeAssemblyPopup:function(e){this.explodeAssemblyUI&&(this.explodeAssemblyUI.hide(),e&&this.explodeAssemblyUI.reset())},ensureFileComparisonPopup:function(){this.fileComparisonUI||(this.fileComparisonUI=new AnnotatorFileComparisonUI(this.annotator))},showFileComparisonPopup:function(e){this.fileComparisonUI||(this.fileComparisonUI=new AnnotatorFileComparisonUI(this.annotator)),e&&(this.fileComparisonUI.show(),this.annotator.view.model.fileComparisonManager.show(),this.fileComparisonUI.update())},hideFileComparisonPopup:function(e){this.fileComparisonUI&&(this.fileComparisonUI.hide(),e&&this.fileComparisonUI.reset())},showMeasurementPopup:function(){this.measurementUI||(this.measurementUI=new p(this.annotator)),this.measurementUI.updateUI(),this.measurementUI.show(),this.measurementUI.update()},hideMeasurementPopup:function(){this.measurementUI&&(this.measurementUI.hide(),this.measurementUI.reset())},updateMeasurementPopup:function(){this.measurementUI&&this.measurementUI.updateUI()},clearNotes:function(){for(var e in this.noteArray)if(this.noteArray.hasOwnProperty(e)){var t=this.noteArray[e];1==t.open&&t.cnode.unbind("rendered",t.cnodeRenderedListener),t.open=!1,t.remove()}this.noteArray=new Array,this.numNotes=0,this.dimensionArray=new Array,this.nextMarkupID=0,this.numDimensions=0,this.currentlySelectedMarkup=""},getNoteIdByPinId:function(e){for(var t=0;this.noteArray.length>t;t++)if(this.noteArray[t]&&this.noteArray[t].targetPin.id==e)return t;return-1},setNoteVisibility:function(e,t){t||this.activateNote(-1);var n=this.noteArray[e];t?n.show():n.hide()},addNote:function(e,t){this.activateNote(-1);var n=new V(this.annotator,e,t,this.nextMarkupID);n.open=!0,this.noteArray[this.nextMarkupID++]=n;var i=this.annotator.dropPin({point:{x:e.x,y:e.y,z:e.z},face:{normal:{x:t.x,y:t.y,z:t.z}}});this.annotator.state.notes[i].pin.hvfwPin=n,n.setPinColor(1,0,0),n.targetPin=this.annotator.state.notes[i].pin},addLoadedNote:function(e,t,n){var i=new O(t[0],t[1],t[2]),r=new O(n[0],n[1],n[2]),o=new V(this.annotator,i,r,this.nextMarkupID);this.noteArray[this.nextMarkupID++]=o,this.annotator.state.notes[e].pin.hvfwPin=o,o.targetPin=this.annotator.state.notes[e].pin},deleteNote:function(e){this.noteArray[e].remove(),this.activateNote(-1),delete this.noteArray[e]},activateNote:function(e){for(var t in this.noteArray)if(this.noteArray.hasOwnProperty(t)){var n=this.noteArray[t];1==n.open&&n.cnode.unbind("rendered",n.cnodeRenderedListener),n.open=!1}if(-1!=e){switch(this.noteArray[e].open=!0,this.annotator.state.stage){case _t.EDITING_NOTE:this.annotator.hideAllNotes()}this.annotator,this.noteArray[e].cnode.bind("rendered",this.noteArray[e].cnodeRenderedListener),this.annotator.showNote(this.noteArray[e].targetPin.name)}},removePreviousMeasurements:function(){for(var e in this.dimensionArray)this.dimensionArray.hasOwnProperty(e)&&this.dimensionArray[e].hide()},newNote:function(e,t){var n=this.annotator.controller.sceneNode.pick(e,t,{rayPick:!0});if(n){if(this.annotator.state.stage===_t.EDITING_NOTE)return this.annotator.state.annotator.hideAllNotes(),this.annotator.state.stage=_t.VIEWING,this.annotator.state.annotator.view.currentOperator.clickOperator=$t.SELECT,-1!=n.name.indexOf("note")&&this.annotator.view.markupManager.pick(e,t),void 0;var i=this.annotator.view.model,r=this.annotator.controller;if(this.calculateSelectionRay(e,t),"cuttingPlaneCap"==n.name){var o=new O(0,0,0),a=this.annotator.view.model.cuttingPlaneManager.planeGeometry,s=this.annotator.view.model.cuttingPlaneManager.inverted?-3:3,l=new O(s*a.n.x,s*a.n.y,s*a.n.z),c=r.firstSelectionRay,u=new O(c.x+100*r.secondSelectionRay.x,c.y+100*r.secondSelectionRay.y,c.z+100*r.secondSelectionRay.z);a.computeIntersectionWithLine(c,u,o),this.annotator.view.markupManager.addNote(o,l)}else{var d=this.annotator.controller.sceneNode.findNode(n.name),h=Number.POSITIVE_INFINITY,p=new Array(3),f=new O(0,0,0);p[0]=new O(0,0,0),p[1]=new O(0,0,0),p[2]=new O(0,0,0);var m=this.annotator.view.model.cuttingPlaneManager.visible?this.annotator.view.model.cuttingPlaneManager.planeGeometry:null,g=this.annotator.view.model.cuttingPlaneManager.inverted?-1:1;if(d.eachNode(function(){var e=this.get("type");if("geometry"==e&&4==this._targetNode.core.primitive){var t,n=new Array,o=i.resolveMatrices(this,n),a=r.sceneNode.findNode("lookAt").get("eye"),s=this.get("positions"),l=new Array;for(t=0;s.length>t;t++)l[t]=s[t];var c=this.get("indices");for(o&&applyTransformationToPoints(l,n),t=0;c.length>t;t+=3){var u=new Array(3);u[0]=new O(l[3*c[t]],l[3*c[t]+1],l[3*c[t]+2]),u[1]=new O(l[3*c[t+1]],l[3*c[t+1]+1],l[3*c[t+1]+2]),u[2]=new O(l[3*c[t+2]],l[3*c[t+2]+1],l[3*c[t+2]+2]);var d=new O(0,0,0),v=computeIntersectionOfRayAndTriangle(r.firstSelectionRay,r.secondSelectionRay,u[0],u[1],u[2],d);if(v&&m&&(v=m.toWhichSide(d)!=g),1==v){var y=new O(d.x-a.x,d.y-a.y,d.z-a.z);h>y.length()&&(h=y.length(),p[0].setFromHoopsPoint(u[0]),p[1].setFromHoopsPoint(u[1]),p[2].setFromHoopsPoint(u[2]),f.set(d.x,d.y,d.z))}}}},{andSelf:!0,depthFirst:!0}),Number.POSITIVE_INFINITY>h){var v=new O(0,0,0);calculateTriangleNormal(p,v),v.normalize(),v.set(3*v.x,3*v.y,3*v.z);var y=computeAngleBetweenVectors(v,this.annotator.controller.firstSelectionRay);90>Math.abs(y)?this.annotator.view.markupManager.addNote(f,v):(v.set(-v.x,-v.y,-v.z),this.annotator.view.markupManager.addNote(f,v))}}}else this.activateNote(-1)},doPick:function(e,t){var n=this.annotator.controller.sceneNode,i=this.annotator.controller,r=this.annotator.view.model,o=null,a=n.pick(e,t,{rayPick:!0});if(a){if(-1!=a.name.indexOf("note"))return null;this.calculateSelectionRay(e,t);var s=n.findNode(a.name),l=Number.POSITIVE_INFINITY;o=new O(0,0,0);var c=-1,u=null,d=null,h=null,p=0;if("cuttingPlaneCap"==a.name){var f=i.firstSelectionRay,m=new O(f.x+100*i.secondSelectionRay.x,f.y+100*i.secondSelectionRay.y,f.z+100*i.secondSelectionRay.z);this.annotator.view.model.cuttingPlaneManager.planeGeometry.computeIntersectionWithLine(f,m,o),u=!0}else{var g=this.annotator.view.model.cuttingPlaneManager.visible?this.annotator.view.model.cuttingPlaneManager.planeGeometry:null,v=this.annotator.view.model.cuttingPlaneManager.inverted?-1:1;s.eachNode(function(){var e=this.get("type");if("geometry"==e&&4==this._targetNode.core.primitive){for(var t=n.findNode("lookAt").get("eye"),a=this.get("positions"),s=this.get("indices"),f=new Array,m=0;a.length>m;m++)f[m]=a[m];var y=new Array,b=r.resolveMatrices(this,y);b&&applyTransformationToPoints(f,y);var _=this.get("normals"),w=new Array;for(m=0;_.length>m;m++)w[m]=_[m]+a[m];for(b&&applyTransformationToPoints(w,y),m=0;_.length>m;m+=3){var S=new O(w[m]-f[m],w[m+1]-f[m+1],w[m+2]-f[m+2]);S.normalize(),w[m]=S.x,w[m+1]=S.y,w[m+2]=S.z}var x=new Array(2);x[0]=i.firstSelectionRay,x[1]=i.secondSelectionRay;var C=new Array(3);for(C[0]=new O(0,0,0),C[1]=new O(0,0,0),C[2]=new O(0,0,0),m=0;s.length>m;m+=3){var $=new Array(3);$[0]=new O(f[3*s[m]],f[3*s[m]+1],f[3*s[m]+2]),$[1]=new O(f[3*s[m+1]],f[3*s[m+1]+1],f[3*s[m+1]+2]),$[2]=new O(f[3*s[m+2]],f[3*s[m+2]+1],f[3*s[m+2]+2]);var E=new O(0,0,0),T=computeIntersectionOfRayAndTriangle(i.firstSelectionRay,i.secondSelectionRay,$[0],$[1],$[2],E);if(T&&g&&(T=g.toWhichSide(E)!=v),1==T){var k=new O(E.x-t.x,E.y-t.y,E.z-t.z);l>k.length()&&(l=k.length(),c=m/3,o.set(E.x,E.y,E.z),u=f,d=s,h=w,p=parseInt(this.get("id").split("-")[1]))}}}},{andSelf:!0,depthFirst:!0})}}return u?o:null},newPointsMeasure:function(e,t){var n=!1,i=this.annotator.view,r=this.doPick(e,t);if(null!=r){i.needsUpdate=!0,n=!0;var o=null;if(0==i.currentOperator.stage)o=new W(this.annotator,this.nextMarkupID,r),i.markupManager.dimensionArray[this.nextMarkupID++]=o,this.numDimensions++;else{if(o=i.markupManager.dimensionArray[this.nextMarkupID-1],!o.setSecondStage(r))return!1;o.update(e,t)}}else this.activateNote(-1);return n},newFaceDistanceMeasure:function(e,t){var n=!1,i=this.annotator.controller.sceneNode,r=this.annotator.controller,o=this.annotator.view.model,a=this.annotator.view,s=i.pick(e,t,{rayPick:!0});if(s){if(-1!=s.name.indexOf("note"))return!1;this.calculateSelectionRay(e,t);var l=i.findNode(s.name),c=Number.POSITIVE_INFINITY,u=new O(0,0,0),d=-1,h=null,p=null,f=null,m=null,g=null,v=0,y=s.name.split("s"),b=o.getSegmentProperties(parseInt(y[1])).faceData;if(!b)return!1;if(l.eachNode(function(){var e=this.get("type");if("geometry"==e&&4==this._targetNode.core.primitive){for(var t=i.findNode("lookAt").get("eye"),n=this.get("positions"),a=this.get("indices"),s=new Array,l=0;n.length>l;l++)s[l]=n[l];var y=new Array,b=o.resolveMatrices(this,y);b?applyTransformationToPoints(s,y):y=null;var _=this.get("normals"),w=new Array;for(l=0;_.length>l;l++)w[l]=_[l]+n[l];
for(b&&applyTransformationToPoints(w,y),l=0;_.length>l;l+=3){var S=new O(w[l]-s[l],w[l+1]-s[l+1],w[l+2]-s[l+2]);S.normalize(),w[l]=S.x,w[l+1]=S.y,w[l+2]=S.z}var x=new Array(2);x[0]=r.firstSelectionRay,x[1]=r.secondSelectionRay;var C=new Array(3);for(C[0]=new O(0,0,0),C[1]=new O(0,0,0),C[2]=new O(0,0,0),l=0;a.length>l;l+=3){var $=new Array(3);$[0]=new O(s[3*a[l]],s[3*a[l]+1],s[3*a[l]+2]),$[1]=new O(s[3*a[l+1]],s[3*a[l+1]+1],s[3*a[l+1]+2]),$[2]=new O(s[3*a[l+2]],s[3*a[l+2]+1],s[3*a[l+2]+2]);var E=new O(0,0,0),T=computeIntersectionOfRayAndTriangle(r.firstSelectionRay,r.secondSelectionRay,$[0],$[1],$[2],E);if(1==T){var k=new O(E.x-t.x,E.y-t.y,E.z-t.z);c>k.length()&&(c=k.length(),d=l/3,u.set(E.x,E.y,E.z),h=s,p=n,f=a,m=w,g=y,v=parseInt(this.get("id").split("-")[1]))}}}},{andSelf:!0,depthFirst:!0}),null!=h){var _=f,w=h,S=m,x=-1,C=o.extraShellData[v];void 0!=C&&(x=C[d]);var $=new Array(3);n=!0;for(var E=0;_.length>E;E+=3)if(void 0==C||C[E/3]==x){$[0]=new O(w[3*_[E]],w[3*_[E]+1],w[3*_[E]+2]),$[1]=new O(w[3*_[E+1]],w[3*_[E+1]+1],w[3*_[E+1]+2]),$[2]=new O(w[3*_[E+2]],w[3*_[E+2]+1],w[3*_[E+2]+2]);break}if(a.needsUpdate=!0,!b[x])return!1;var T=new R;T.calculateFromTriangleArray($);var k=null;0==a.currentOperator.stage?(k=new Q(this.annotator,this.nextMarkupID,u,T),a.markupManager.dimensionArray[this.nextMarkupID++]=k,this.numDimensions++):(k=this.dimensionArray[this.nextMarkupID-1],k.setSecondStage(u,T)),k.insertSelectionFace(b,C,d,_,w,S,g,p),a.needsUpdate=!0}}else this.activateNote(-1);return n},newAngleMeasure:function(e,t){var n=!1,i=this.annotator.controller.sceneNode,r=this.annotator.controller,o=this.annotator.view.model,a=this.annotator.view,s=i.pick(e,t,{rayPick:!0});if(s){if(-1!=s.name.indexOf("note"))return!1;this.calculateSelectionRay(e,t);var l=i.findNode(s.name),c=Number.POSITIVE_INFINITY,u=new O(0,0,0),d=-1,h=null,p=null,f=null,m=0,g=s.name.split("s"),v=o.getSegmentProperties(parseInt(g[1])).faceData;if(!v)return!1;if(l.eachNode(function(){var e=this.get("type");if("geometry"==e&&4==this._targetNode.core.primitive){for(var t=i.findNode("lookAt").get("eye"),n=this.get("positions"),a=this.get("indices"),s=new Array,l=0;n.length>l;l++)s[l]=n[l];var g=new Array,v=o.resolveMatrices(this,g);v&&applyTransformationToPoints(s,g);var y=this.get("normals"),b=new Array;for(l=0;y.length>l;l++)b[l]=y[l]+n[l];for(v&&applyTransformationToPoints(b,g),l=0;y.length>l;l+=3){var _=new O(b[l]-s[l],b[l+1]-s[l+1],b[l+2]-s[l+2]);_.normalize(),b[l]=_.x,b[l+1]=_.y,b[l+2]=_.z}var w=new Array(2);w[0]=r.firstSelectionRay,w[1]=r.secondSelectionRay;var S=new Array(3);for(S[0]=new O(0,0,0),S[1]=new O(0,0,0),S[2]=new O(0,0,0),l=0;a.length>l;l+=3){var x=new Array(3);x[0]=new O(s[3*a[l]],s[3*a[l]+1],s[3*a[l]+2]),x[1]=new O(s[3*a[l+1]],s[3*a[l+1]+1],s[3*a[l+1]+2]),x[2]=new O(s[3*a[l+2]],s[3*a[l+2]+1],s[3*a[l+2]+2]);var C=new O(0,0,0),$=computeIntersectionOfRayAndTriangle(r.firstSelectionRay,r.secondSelectionRay,x[0],x[1],x[2],C);if(1==$){var E=new O(C.x-t.x,C.y-t.y,C.z-t.z);c>E.length()&&(c=E.length(),d=l/3,u.set(C.x,C.y,C.z),h=s,p=a,f=b,m=parseInt(this.get("id").split("-")[1]))}}}},{andSelf:!0,depthFirst:!0}),null!=h){var y=p,b=h,_=f,w=-1,S=o.extraShellData[m];if(void 0!=S&&(w=S[d]),a.needsUpdate=!0,!v[w]||v[w].type!=Et.PLANE_TYPE)return!1;var x=new Array(3);n=!0;for(var C=0;y.length>C;C+=3)if(-1==w||S[C/3]==w){x[0]=new O(b[3*y[C]],b[3*y[C]+1],b[3*y[C]+2]),x[1]=new O(b[3*y[C+1]],b[3*y[C+1]+1],b[3*y[C+1]+2]),x[2]=new O(b[3*y[C+2]],b[3*y[C+2]+1],b[3*y[C+2]+2]);break}var $=new R;$.calculateFromTriangleArray(x);var E=null,T=!0;if(0==a.currentOperator.stage)E=new q(this.annotator,this.nextMarkupID,u,$),a.markupManager.dimensionArray[this.nextMarkupID++]=E,this.numDimensions++;else if(E=a.markupManager.dimensionArray[this.nextMarkupID-1],!E.setSecondStage(u,$))return!1;E.insertSelectionFace(S,d,y,b,_),T||(a.markupManager.cancelDimension(),n=!1,a.currentOperator.stage=0)}}else this.activateNote(-1);return n},cancelDimension:function(){var e=this.dimensionArray.pop();e&&(this.numDimensions--,e.finalize(),this.clearDimensionsSVG(),this.drawDimensions(),e.remove())},clearDimensionsSVG:function(){for(var e=document.getElementById("xmlanchor");e.lastChild;)"polyline"==e.lastChild.localName||"text"==e.lastChild.localName||"circle"==e.lastChild.localName||"rect"==e.lastChild.localName?(e.removeChild(e.lastChild),e=document.getElementById("xmlanchor")):e=e.lastChild},drawDimensions:function(){if(this.numDimensions>0){this.clearDimensionsSVG();for(var e in this.dimensionArray)this.dimensionArray.hasOwnProperty(e)&&this.dimensionArray[e].draw()}},newMeasure:function(e,t){var n=this.annotator.controller.sceneNode.pick(e,t,{rayPick:!0});if(n){if(-1!=n.name.indexOf("note"))return!1;this.calculateSelectionRay(e,t);var i=this.annotator.controller.sceneNode.findNode(n.name),r=!1;this.annotator.view;var o=this.annotator.view.model,a=this.annotator.controller,s=this.annotator,l=null,c=null,u=1e7,d=-1,h=-1,p=n.name.split("s"),f=o.getSegmentProperties(parseInt(p[1])).polylineData;if(!f)return!1;var m=null,s=this.annotator;if(i.eachNode(function(){var n=this.get("type");if("geometry"==n&&1==this._targetNode.core.primitive){for(var i=this.get("positions"),r=this.get("indices"),p=new Array,f=0;i.length>f;f++)p[f]=i[f];var g=new Array,v=o.resolveMatrices(this,g);v&&applyTransformationToPoints(p,g);var y=0,b=0,_=new O(0,0,0),w=new O(0,0,0),S=new O(a.firstSelectionRay.x+1e6*a.secondSelectionRay.x,a.firstSelectionRay.y+1e6*a.secondSelectionRay.y,a.firstSelectionRay.z+1e6*a.secondSelectionRay.z);for(f=0;r.length>f;f+=2){f>0&&r[f]!=r[f-1]&&(y++,b=f);var x=new O(p[3*r[f]],p[3*r[f]+1],p[3*r[f]+2]),C=new O(p[3*r[f+1]],p[3*r[f+1]+1],p[3*r[f+1]+2]);computeDistanceBetweenFourLines(x,C,a.firstSelectionRay,S,_,w);var $=new O(0,0,0);rt(s,_,$);var E=new O($.x-e,$.y-t,0);if(10>E.length()){E.subtract(_,a.firstSelectionRay);var T=E.length();u>T&&(l=p,c=r,u=T,m=g,d=y,h=b)}}}},{andSelf:!0,depthFirst:!0}),null!=l){for(var g=c,v=l,y=new Array,b=0,_=new O(0,0,0),w=h;g.length>w;w+=2){if(w>h&&g[w]!=g[w-1]){this.annotator.view.needsUpdate=!0;break}w==h&&(_.set(v[3*g[w]],v[3*g[w]+1],v[3*g[w]+2]),y[b++]=new O(_.x,_.y,_.z)),_.set(v[3*g[w+1]],v[3*g[w+1]+1],v[3*g[w+1]+2]),y[b++]=new O(_.x,_.y,_.z)}if(y[0].equals(y[b-1]))this.annotator.view.markupManager.addDimension(y,f[d],m,e,t);else{var S=new O((y[0].x+y[b-1].x)/2,(y[0].y+y[b-1].y)/2,(y[0].z+y[b-1].z)/2),x=new O(0,0,0);x.subtract(y[0],S),x.length();var C=Math.floor(b/2);x.subtract(y[C],S),x.length(),this.annotator.view.markupManager.addDimension(y,f[d],m,e,t)}r=!0}return r}return this.activateNote(-1),!1},addDimension:function(e,t,n,i,r){var o=null;if(t&&t.type==Et.CIRCLE_TYPE&&this.annotator.state.distanceMeasureType==vt.RADIAL)o=new X(this.annotator,e,this.nextMarkupID,t,n);else{if(this.annotator.state.distanceMeasureType!=vt.LINEAR||t.type==Et.CIRCLE_TYPE)return o.update(i,r),void 0;o=new J(this.annotator,e,this.nextMarkupID,t)}this.dimensionArray[this.nextMarkupID++]=o,this.numDimensions++,o.update(i,r)},pick:function(e,t){var n=this.annotator.controller.sceneNode.pick(e,t,{rayPick:!0});if(n)if(-1!=n.name.indexOf("note")){var i=parseInt(n.name.split("-")[1]);this.activateNote(i)}else this.annotator.view.selectionManager.setSelectionByModelElement(this.annotator.view.model.modelTree.tree.getNodeById(n.name),!0);else this.activateNote(-1),this.pickAllSubnodes(this.annotator.view.model.modelNode,!1),this.annotator.view.selectionManager.setSelectionByModelElement(null,!0),this.annotator.controller.sceneNode.renderFrame({force:!0})},calculateSelectionRay:function(e,t){var n=this.annotator.controller.sceneNode.findNode("lookAt").get("eye"),i=(e-this.annotator.controller.clientW/2)/(this.annotator.controller.clientW/2),r=-(t-this.annotator.controller.clientH/2)/(this.annotator.controller.clientH/2),o=new O(i,r,-1),a=new O(0,0,0),s=computeAlternativelyTransformedPoint(o,1,this.annotator.controller.cameraViewMatrixInverse,a);a.set(a.x*(1/s),a.y*(1/s),a.z*(1/s));var l=new O(a.x-n.x,a.y-n.y,a.z-n.z);l.normalize(),this.annotator.controller.firstSelectionRay.set(n.x,n.y,n.z),this.annotator.controller.secondSelectionRay.set(l.x,l.y,l.z)},selectByTreeNodeId:function(e,t){var n;if(-1!=e.indexOf("capture-")){n=e.split("-");var i=this.annotator.view.model.captureManager.captureNames();this.annotator.view.model.captureManager.applyCapture(i[parseInt(n[1])])}else-1!=e.indexOf("note-")||-1!=e.indexOf("measure-")?(this.currentlySelectedMarkup=e,n=this.currentlySelectedMarkup.split("-"),-1!=this.currentlySelectedMarkup.indexOf("note-")?this.activateNote(parseInt(n[1])):this.selectDimension(parseInt(n[1]))):-1!=e.indexOf("notes")||-1!=e.indexOf("measurements")||-1!=e.indexOf("captures")?(this.currentlySelectedMarkup="",this.selectDimension(-1)):(this.pickNode(e,t),this.currentlySelectedMarkup="",this.selectDimension(-1))},highlightByTreeNodeId:function(e,t){(!e||-1==e.indexOf("capture-")&&-1==e.indexOf("note-")&&-1==e.indexOf("measure-")&&-1==e.indexOf("notes")&&-1==e.indexOf("measurements")&&-1==e.indexOf("captures"))&&this.highlightNode(e,t)},selectDimension:function(e){for(var t in this.dimensionArray)this.dimensionArray.hasOwnProperty(t)&&(this.dimensionArray[t].selected=!1);-1!=e&&(this.dimensionArray[e].selected=!0)},pickNode:function(e,t){var n=this.annotator.controller.sceneNode.findNode(e);return this.pickAllSubnodes(this.annotator.view.model.modelNode,!1),t&&this.pickAllSubnodes(n,!0),this.annotator.controller.sceneNode.renderFrame({force:!0}),n},highlightNode:function(e,t){var n=null;return e&&(n=this.annotator.controller.sceneNode.findNode(e),n&&this.highlightAllSubnodes(n,t)),n},pickAllSubnodes:function(e,t){e.eachNode(function(){"shaderParams"==this.get("type")&&this.set({params:{colorTransEnabled:t}})},{andSelf:!0,depthFirst:!0})},highlightAllSubnodes:function(e,t){e.eachNode(function(){"shaderParams"==this.get("type")&&this.set({params:{colorHighlightEnabled:t}})},{andSelf:!0,depthFirst:!0})}},G.prototype={reset:function(){this._captureNames=[],this._defaultCapture="cad_default",this._activeCapture=null,this._toCamera={},this._toCaptureTag={},this._toStyleTags={},this._toStyleVisibility={},this._toStyleMatrix={},this._principleStyleSegments={},this._principleNonStyleSegments={},this._originalVisibility={},this._markupSegments={}},captureNames:function(){return this._captureNames.slice()},defaultCaptureName:function(){return this._defaultCapture},applyDefaultCapture:function(e){return this.applyCapture(e,this.defaultCaptureName())},parseDefaultCapture:function(e){this._defaultCapture=e},parseCaptureStyles:function(e,t){for(var n=L.EMPTY(),i=e.split(";"),r=0;i.length>r;++r){var o=i[r];this._principleStyleSegments.hasOwnProperty(o)||(this._principleStyleSegments[o]=[]),this._principleStyleSegments[o].push(t);var a=this._toStyleVisibility[o];if(!a.empty()){var s;if(s=a.everythingOff()?L.EVERYTHING():L.EVERYTHING().not(),!n.equals(s)&&!n.empty())throw new Error("Incompatible style visibilities");n=s}}return n},parseCaptureNonStyles:function(e,t){for(var n=e.split(";"),i=0;n.length>i;++i){var r=n[i];this._principleNonStyleSegments.hasOwnProperty(r)||(this._principleNonStyleSegments[r]=[]),this._principleNonStyleSegments[r].push(t)}},parseMatrix:function(e){if("?"===e)return null;for(var t=e.split("_"),n=0;t.length>n;++n)t[n]-=0;return t},parseCaptureStyleDefinitions:function(e){for(var t=e.split(";"),n=0;t.length>n;n+=3){var i=t[n],r=L.deserialize(t[n+1]);this._toStyleVisibility[i]=r;var o=this.parseMatrix(t[n+2]);this._toStyleMatrix[i]=o}},parseCameraString:function(e){if("?"==e)return null;var t=e.split(" "),n=new F,i=0;return n.pos.x=t[i++]-0,n.pos.y=t[i++]-0,n.pos.z=t[i++]-0,n.tar.x=t[i++]-0,n.tar.y=t[i++]-0,n.tar.z=t[i++]-0,n.up.x=t[i++]-0,n.up.y=t[i++]-0,n.up.z=t[i++]-0,n.width=t[i++]-0,n.height=t[i++]-0,n.proj=t[i++],n},parseCaptureDefinitions:function(e,t){var n,i=e.split(";");n=t>1.91?5:4;for(var r=0;i.length>r;r+=n){var o=i[r],a=this.parseCameraString(i[r+1]),s=i[r+2],l=i[r+3].split("&");this._captureNames.push(o),this._toCaptureTag[o]=s,this._toCamera[s]=a,this._toStyleTags[s]=l}return i.length/n},parseCaptureMarkup:function(e,t){this._markupSegments[t]=!0},storeOriginalVisibility:function(e){var t=e.get("id");if(!this._originalVisibility.hasOwnProperty(t)){var n=e.get("flags").enabled;this._originalVisibility[t]=n}},restoreOriginalVisibility:function(e,t){var n=t.get("id"),i=this._originalVisibility[n];t.set({flags:{enabled:i,backfaces:e.state.showBackFaces}})},applyCaptureInternal:function(e,t,n,i){var r,o,a,s=this._principleNonStyleSegments[n]||[];for(r=0;s.length>r;++r)o=s[r],a=function(t,n){return function(){e.view.model.getSegmentProperties(t).setVisibility(t,n)}}(o,i),i&&this._markupSegments.hasOwnProperty(o)||a(),t.onKill=e.sequence(t.onKill,a);var l=this._toStyleTags[n]||[];for(r=0;l.length>r;++r)for(var c=l[r],u=this._toStyleVisibility[c]||L.EVERYTHING(),d=this._toStyleMatrix[c],s=this._principleStyleSegments[c]||[],h=0;s.length>h;++h){if(o=s[h],!u.empty()){var p=!u.everythingOff();a=function(t,n,i){return function(){n?e.view.model.getSegmentProperties(t).setVisibility(t,i):e.view.model.getSegmentProperties(t).setVisibility(t)}}(o,i,p),a(),t.onKill=e.sequence(t.onKill,a)}d&&function(){function n(t){var n=(t-this.timeCreated)/transitionTime;if(n=Math.min(n,1),n=e.controller.utilities.easeInEaseOut(n,.49,.02,.49),n=Math.max(n,0),n>=1-e.controller.utilities.getEpsilon())return this.stageKill(),void 0;var i=p.map(function(e){return n*e}),r=zipWith(add,u,i);s.set({elements:r})}function r(){s.set({elements:h})}var a="capMat_"+c+"_"+o,s=e.controller.sceneNode.findNode(a);if(!s){var l=e.controller.sceneNode.findNode("s"+o);l.insert("node",{id:a,type:"matrix",elements:identityMatrix.slice()}),s=e.controller.sceneNode.findNode(a)}var u=s.get("elements"),h=(i?d:identityMatrix).slice(),p=zipWith(this.minus,h,u);t.onRun=e.sequence(n,t.onRun),t.onKill=e.sequence(r,t.onKill)}()}},applyCapture:function(e,t){var n=500;if(!this._toCaptureTag.hasOwnProperty(t))return!1;var i=this._toCaptureTag[this._activeCapture],r=this._toCaptureTag[t],o=this._toCamera[r],a=null===o?e.controller.worldClock.createTask(e.stageKill):e.controller.utilities.smoothTransition(o,n,function(){});return null===a&&(a=e.controller.worldClock.createTask(e.emptyFunction)),i!==r&&(this._activeCapture&&this.applyCaptureInternal.call(this,e,a,i,!1),this.applyCaptureInternal.call(this,e,a,r,!0),this._activeCapture=t),!0},constructor:G},z.prototype={getState:function(){var e={visible:this.visible};return this.visible&&(e.orientation=this.orientation,e.position=this.position,e.inverted=this.inverted,e.planeGeometry=this.planeGeometry),e},setState:function(e,t){e&&e.visible?(this.visible=!0,this.orientation=e.orientation,this.position=e.position,this.inverted=e.inverted,this.planeGeometry.setFromPlane(e.planeGeometry),this.planeGeometry.d*=this.annotator.state.fixUpOldStateCoordinateScale(t),this.computePlaneBounds(),this.isInvertedSet=!0,this.annotator.view.markupManager.showCuttingPlanePopup(!1),this.annotator.toolbar.$cuttingPlane.check(),this.annotator.view.multiPassHelper.setCappingActive(!0),this.updateSceneGraph()):e&&(this.annotator.toolbar.$cuttingPlane.uncheck(),this.hide())},insertShaderNode:function(e){var t={type:"shader",coreId:"cuttingPlaneShader"};e.modelNode.insert("node",t);var n="cuttingPlaneParams~"+e.nodeIdSuffix,i={type:"shaderParams",id:n,params:{clipEnabled:!0,clipInside:!0,clipNormalAndDist:[0,0,.1,0]}};e.modelNode.insert("node",i),this.shaderNodes.push(this.annotator.controller.sceneNode.findNode(n))},createGeometry:function(){var e={type:"geometry",primitive:"triangles",positions:[0,1,1,0,-1,1,0,-1,-1,0,1,-1],normals:[1,0,0,1,0,0,1,0,0,1,0,0],indices:[0,1,2,0,2,3],id:"cuttingPlaneGeometry"},t={type:"material",baseColor:{r:.1,g:.075,b:.075},emit:0,specular:0,alpha:.25,shine:1,nodes:[e]},n={type:"geometry",primitive:"lines",positions:[0,-1,-1,0,1,-1],indices:[0,1]},i={type:"geometry",primitive:"lines",positions:[0,1,-1,0,1,1],indices:[0,1]},r={type:"geometry",primitive:"lines",positions:[0,1,1,0,-1,1],indices:[0,1]},o={type:"geometry",primitive:"lines",positions:[0,-1,1,0,-1,-1],indices:[0,1]},a={type:"geometry",primitive:"lines",positions:[0,0,-1,0,0,1],indices:[0,1]},s={type:"geometry",primitive:"lines",positions:[0,-1,0,0,1,0],indices:[0,1]},l={type:"material",baseColor:{r:255/256,g:68/256,b:51/256},emit:.4,specular:0,alpha:1,nodes:[n,i,r,o,a,s]},c={type:"flags",id:"cuttingPlaneFlags",flags:{enabled:!0,transparent:!0,backfaces:!0,diffuse:!0,picking:!1},nodes:[t,l]},u={type:"geometry",primitive:"triangles",positions:[0,1,1,0,-1,1,0,-1,-1,0,1,-1],normals:[-1,0,0,-1,0,0,-1,0,0,-1,0,0],indices:[0,1,2,0,2,3],id:"cuttingPlaneCap"},d={type:"name",name:"cuttingPlaneCap",nodes:[u]},h={type:"material",baseColor:{r:255/256,g:68/256,b:51/256},emit:.2,specular:0,alpha:1,shine:1,nodes:[d]},p={type:"shaderParams",params:{colorTransEnabled:!1,colorHighlightEnabled:!1,mixColor:[0,0,0],mixColorValue:0,alphaTransEnabled:!1,alphaTransValue:1},nodes:[h]},f={type:"shader",coreId:"colorTransShader",nodes:[p]},m={type:"flags",id:"cuttingPlaneCapFlags",flags:{enabled:!0,transparent:!1,backfaces:!0,diffuse:!0},nodes:[f]},g=new Array;g[3]=g[7]=g[11]=0,g[0]=1,g[1]=0,g[2]=0,g[4]=0,g[5]=1,g[6]=0,g[8]=0,g[9]=0,g[10]=1,g[12]=0,g[13]=0,g[14]=0,g[15]=1;var v={type:"matrix",id:"cuttingPlaneMatrix",elements:g,nodes:[c,m]},y={type:"scale",id:"cuttingPlaneScale",x:1,y:1,z:1,nodes:[v]},b={type:"translate",id:"cuttingPlaneTranslate",x:0,y:0,z:0,nodes:[y]};this.annotator.view.model.tempNode.add("node",b),this.matrixNode=this.annotator.controller.sceneNode.findNode("cuttingPlaneMatrix"),this.translateNode=this.annotator.controller.sceneNode.findNode("cuttingPlaneTranslate"),this.scaleNode=this.annotator.controller.sceneNode.findNode("cuttingPlaneScale"),this.flagsNode=this.annotator.controller.sceneNode.findNode("cuttingPlaneFlags"),this.capFlagsNode=this.annotator.controller.sceneNode.findNode("cuttingPlaneCapFlags")},computePlane:function(){var e=this.annotator.view.getModelBoundingMinimum(!0,!0),t=this.position;0==t&&(t=-.02),1==t&&(t=1.02),this.computePlaneBounds();var n=this.planeGeometry;switch(this.orientation){case 0:n.set(1,0,0,-(e.x+this.delta.x*t));break;case 1:n.set(0,1,0,-(e.y+this.delta.y*t));break;case 2:n.set(0,0,1,-(e.z+this.delta.z*t));break;case 3:n.setFromPlane(this.freePlane);var i=(t-.5)/.5;n.d=n.d+this.totalLength*i}},computePlaneBounds:function(){var e=this.annotator.view.getModelBoundingMaximum(!0,!0),t=this.annotator.view.getModelBoundingMinimum(!0,!0);new O((e.x+t.x)/2,(e.y+t.y)/2,(e.z+t.z)/2),this.delta=new O(0,0,0),this.delta.subtract(e,t),this.totalLength=this.delta.length(),this.delta.x=1.1*Math.max(this.delta.x,this.totalLength/10),this.delta.y=1.1*Math.max(this.delta.y,this.totalLength/10),this.delta.z=1.1*Math.max(this.delta.z,this.totalLength/10)},updateSceneGraph:function(){var e=this.planeGeometry,t=e.d,n=this.annotator.view.getModelBoundingMaximum(!0,!0),i=this.annotator.view.getModelBoundingMinimum(!0,!0),r=new O((n.x+i.x)/2,(n.y+i.y)/2,(n.z+i.z)/2),o=new O(0,0,0),a=new O(0,0,0);e.n.oneVectorCross(o),computeCrossProduct(o,e.n,a),o.normalize(),a.normalize();var s=new Array;s[3]=s[7]=s[11]=0,s[0]=e.n.x,s[1]=e.n.y,s[2]=e.n.z,s[4]=o.x,s[5]=o.y,s[6]=o.z,s[8]=a.x,s[9]=a.y,s[10]=a.z,s[12]=0,s[13]=0,s[14]=0,s[15]=1;var l=1;switch(this.annotator.view.model.explosionManager&&(l+=this.annotator.view.model.explosionManager.activeExplodeLevel),this.orientation){case 0:this.translateNode.set({x:-t,y:r.y,z:r.z});break;case 1:this.translateNode.set({x:r.x,y:-t,z:r.z});break;case 2:this.translateNode.set({x:r.x,y:r.y,z:-t});break;case 3:e.setFromPlane(this.freePlane);var c=(currentPosition-.5)/.5;e.d=e.d+this.totalLength*c,this.translateNode.set({x:this.freePlaneCenter.x-e.n.x*this.totalLength*c,y:this.freePlaneCenter.y-e.n.y*this.totalLength*c,z:this.freePlaneCenter.z-e.n.z*this.totalLength*c})}if(!this.isInvertedSet){var u=this.annotator.controller.getCurrentViewDirection();this.inverted=u.dot(e.n)>=0,this.isInvertedSet=!0}3==this.orientation?(this.matrixNode.set("elements",s),this.scaleNode.set({x:l*this.totalLength/2,y:l*this.totalLength/2,z:l*this.totalLength/2})):(this.matrixNode.set("elements",s),this.scaleNode.set({x:l*this.delta.x/2,y:l*this.delta.y/2,z:l*this.delta.z/2}));for(var d=0;this.shaderNodes.length>d;d++){var h=this.shaderNodes[d];3==this.orientation?h.set({params:{clipEnabled:this.visible,clipInside:this.inverted,clipNormalAndDist:[e.n.x,e.n.y,e.n.z,-e.d]}}):h.set({params:{clipEnabled:this.visible,clipInside:this.inverted,clipNormalAndDist:[e.n.x,e.n.y,e.n.z,-e.d]}})}this.flagsNode.set({flags:{enabled:this.visible,transparent:!0,backfaces:!0}}),this.capFlagsNode.set({flags:{enabled:this.visible&&this.annotator.view.multiPassHelper.isCappingSupported(),transparent:!1,backfaces:!0}})},updatePlane:function(){this.computePlane(),this.updateSceneGraph()},switchToOrientation:function(e){3>e?(this.orientation=e,this.position=.5,this.isInvertedSet=!1,this.updatePlane()):3==e||(this.inverted=!this.inverted,this.updatePlane())},onExplodeLevelChange:function(){this.visible&&this.updatePlane()},show:function(){this.visible||(this.visible=!0,this.annotator.view.multiPassHelper.setCappingActive(!0),this.updatePlane())},hide:function(){this.visible&&(this.visible=!1,this.updatePlane(),this.annotator.view.multiPassHelper.setCappingActive(!1))},movePlane:function(e){0>e&&(e=0),e>100&&(e=100),this.position=e/100,this.updatePlane()},setPosition:function(e){0>e&&(e=0),e>100&&(e=100),this.position=e/100},reset:function(){this.annotator.view.multiPassHelper.setCappingActive(!1),this.orientation=2,this.position=.5,this.inverted=!1,this.insertShaderNode(this.annotator.view.model),this.updatePlane(),this.annotator.view.markupManager.cuttingPlaneUI&&this.annotator.view.markupManager.cuttingPlaneUI.reset(),this.isInvertedSet=!1}},H.prototype={getState:function(){var e={activeExplodeLevel:this.activeExplodeLevel,explosionCenter:this.explosionCenter};return e},setState:function(e,t){e&&(this.activeExplodeLevel=e.activeExplodeLevel,this.activeExplodeLevel>0?(this.explosionCenter=this.annotator.state.fixUpOldStateCoordinate(e.explosionCenter,t),this.applyAssemblyExplosion(),this.annotator.view.markupManager.showExplodeAssemblyPopup(!1),this.annotator.toolbar.$explodeAssembly.check()):(this.explodeAssembly(0),this.annotator.toolbar.$explodeAssembly.uncheck()))},explodeAssembly:function(e){0>e&&(e=0),e>100&&(e=100),e>0&&(this.lastNonZeroExplodeAmount=e),this.activeExplodeLevel=e/20,this.explosionCenter=new O((this.annotator.view.model.boundingMaximum.x+this.annotator.view.model.boundingMinimum.x)/2,(this.annotator.view.model.boundingMaximum.y+this.annotator.view.model.boundingMinimum.y)/2,(this.annotator.view.model.boundingMaximum.z+this.annotator.view.model.boundingMinimum.z)/2),this.applyAssemblyExplosion()},applyAssemblyExplosion:function(){this.matrixNodesGathered||(this.gatherMultiPartedNodes(),this.matrixNodesGathered=!0);for(var e=new O(0,0,0),t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],n=new Array(16),i=0;this.matrixNodeArray.length>i;i++){var r=this.matrixNodeArray[i];e.subtract(r.center,this.explosionCenter);var o=e.length()/r.scale;o>0&&(e.normalize(),t[12]=e.x*o*this.activeExplodeLevel,t[13]=e.y*o*this.activeExplodeLevel,t[14]=e.z*o*this.activeExplodeLevel,alternativelyMultiplyMatrices(r.matrix,t,n),r.node.set("elements",n))}this.annotator.view.model.cuttingPlaneManager&&this.annotator.view.model.cuttingPlaneManager.onExplodeLevelChange()},gatherMultiPartedNodes:function(){this.gatherMultiPartedNodesRecursive(this.annotator,this.annotator.view.model.modelNode)},gatherMultiPartedNodesRecursive:function(e,t){var n=this.getExplosionObject;t.eachNode(function(){if("node"==this.get("type")){var t=this.get("id");if(-1!=t.indexOf("s")){var i=t.split("s");if(e.view.model.hasSegmentProperties(parseInt(i[1]))){var r=e.view.model.getSegmentProperties(parseInt(i[1]));if("all_markup"==r.segmentName)return}}}var o=this.get("type"),a=this.get("id");if("matrix"==o&&0>a.toString().indexOf("units-scale")){for(var s=this.get("elements"),l=new O(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),c=new O(-Number.POSITIVE_INFINITY,-Number.POSITIVE_INFINITY,-Number.POSITIVE_INFINITY),u=this.parent(),d=1;;){if("node"==u.get("type")){var i=u.get("id").split("s");d=e.view.model.accumulateBoundingBox(i[1],l,c);break}u=u.parent()}var h=new O((c.x+l.x)/2,(c.y+l.y)/2,(c.z+l.z)/2),p=n(this,s,h,d);e.view.model.explosionManager.matrixNodeArray[e.view.model.explosionManager.matrixNodeArray.length]=p}e.view.model.explosionManager.gatherMultiPartedNodesRecursive(e,this)},{andSelf:!1})},getExplosionObject:function(e,t,n,i){for(var r=new Array(16),o=0;16>o;o++)r[o]=t[o];var a={node:e,matrix:r,center:new O(n.x,n.y,n.z),scale:i};return a},reset:function(){this.matrixNodeArray=new Array,this.matrixNodesGathered=!1,this.activeExplodeLevel=0,this.lastNonZeroExplodeAmount=0,this.explosionCenter=null}},V.prototype={setPinColor:function(e,t,n){var i="note-"+this.id,r=this.annotator.controller.sceneNode.findNode(i);r=r.parent(),r=r.parent(),r=r.parent(),r=r.parent(),r.set("baseColor",{r:e,g:t,b:n})},getPinColor:function(){var e="note-"+this.id,t=this.annotator.controller.sceneNode.findNode(e);t=t.parent(),t=t.parent(),t=t.parent(),t=t.parent();var n=t.get("baseColor"),i=255*n.b|255*n.g<<8|255*n.r<<16;return i},insertPin:function(){var e="note-"+this.id,t="notea-"+this.id,n="pinHighlightFlags-"+this.id,i={type:"sphere"},r={type:"node",id:e,nodes:[i]},o={type:"translate",x:this.normal.x,y:this.normal.y,z:this.normal.z,nodes:[r]},a={type:"geometry",primitive:"lines",positions:[0,0,0,this.normal.x,this.normal.y,this.normal.z],indices:[0,1]},s={type:"scale",x:1,y:1,z:1,nodes:[o,a]},l={type:"translate",id:t,x:this.position.x,y:this.position.y,z:this.position.z,nodes:[s]},c={type:"material",baseColor:{r:1,g:1,b:1},specularColor:{r:1,g:1,b:1},specular:.2,shine:10,emit:.1,nodes:[l]},u={type:"flags",flags:{enabled:!0,backfaces:!0},nodes:[c]},d={type:"sphere"},h={type:"node",id:e+"-highlight",nodes:[d]},p={type:"scale",x:2.2,y:2.2,z:2.2,nodes:[h]},f={type:"translate",x:this.normal.x,y:this.normal.y,z:this.normal.z,nodes:[p]},m={type:"scale",x:1,y:1,z:1,nodes:[f]},g={type:"translate",id:t+"-highlight",x:this.position.x,y:this.position.y,z:this.position.z,nodes:[m]},v={type:"material",baseColor:{r:214/256,g:195/256,b:.53125},specularColor:{r:0,g:0,b:0},specular:0,shine:1,emit:.1,alpha:.4,nodes:[g]},y={type:"flags",flags:{enabled:!1,backfaces:!0,transparent:!0},nodes:[v],id:n},b={type:"name",name:e,nodes:[u,y]};this.annotator.view.model.tempNode.add("node",b),this.readyToOpen=!0;var _=this.annotator.controller.sceneNode.findNode(e);this.cnode=_;var w=this.annotator;this.cnodeRenderedListener=function(e){var t=e.params,n=t.getCanvasPos(),i=parseInt(t._node.nameState.name.split("-")[1]),r=w.view.markupManager.noteArray;r.hasOwnProperty(i)&&r[i].open&&(r[i].canvasPosition=n)},this.cnode.bind("rendered",this.cnodeRenderedListener),this.pinHighlightFlagsNode=this.annotator.controller.sceneNode.findNode(n)},highlightPin:function(e){var t=this.pinHighlightFlagsNode.get("flags");this.pinHighlightFlagsNode.set("flags",{enabled:e,backfaces:t.backfaces,transparent:t.transparent})},remove:function(){var e="note-"+this.id,t=this.annotator.controller.sceneNode.findNode(e);t=t.parent(),t=t.parent(),t=t.parent(),t=t.parent(),t=t.parent(),t=t.parent(),t=t.remove("nodeAt",0),t=t.remove("nodeAt",0)},show:function(){var e="note-"+this.id,t=this.annotator.controller.sceneNode.findNode(e);t=t.parent(),t=t.parent(),t=t.parent(),t=t.parent(),t=t.parent(),t.set({flags:{enabled:!0,backfaces:!0}})},hide:function(){var e="note-"+this.id,t=this.annotator.controller.sceneNode.findNode(e);t=t.parent(),t=t.parent(),t=t.parent(),t=t.parent(),t=t.parent(),t.set({flags:{enabled:!1,backfaces:!0}}),this.highlightPin(!1)}},W.prototype={draw:function(){this.visible&&this.drawExtra()},setSecondStage:function(e){this.secondClickPoint.setFromHoopsPoint(e),this.secondOriginalClickPoint.setFromHoopsPoint(e),this.arrowStart.setFromHoopsPoint(e);var t=new O(0,0,0);return t.subtract(this.secondOriginalClickPoint,this.firstOriginalClickPoint),this.measurementValue=t.length(),this.text=constructMeasurementResultString(this.annotator.state.worldToMM(this.measurementValue),this.annotator.state.unitPreference,this.measurementTextPrefix),this.stage2Set=!0,!0},finalize:function(){this.finalized||(this.finalized=!0)},drawExtra:function(){if(this.stage2Set){var e;e=this.selected?3:2;var t=new O(0,0,0),n=new O(0,0,0),i=new O(0,0,0),r=new O(0,0,0),o=new O(0,0,0);rt(this.annotator,this.arrowStart,t),rt(this.annotator,this.arrowEnd,n),rt(this.annotator,this.textPosition,i),rt(this.annotator,this.firstClickPoint,r),rt(this.annotator,this.secondClickPoint,o);var a=r.x+","+r.y+" "+o.x+","+o.y+" ",s=t.x+","+t.y+" "+n.x+","+n.y+" ",l=t.x+","+t.y+" "+r.x+","+r.y+" ",c=n.x+","+n.y+" "+o.x+","+o.y+" ",u=n.x+","+n.y+" "+i.x+","+i.y+" ";r.x-10+","+(r.y-10)+" "+(r.x+10)+","+(r.y+10)+" ",o.x-10+","+(o.y-10)+" "+(o.x+10)+","+(o.y+10)+" ";var d="diab_"+this.id,h="dia_"+this.id,p="tex_"+this.id,f="diax_"+this.id,m="diaxy_"+this.id,g="diac_"+this.id,v="diad_"+this.id,y="diaxz_"+this.id,b=createSVG("polyline",{id:d,points:a,fill:"none",stroke:this.annotator.state.dimColor,"stroke-width":e});document.getElementById("xmlanchor").appendChild(b);var _=createSVG("rect",{id:g,x:r.x-2,y:r.y-2,width:4,height:4,fill:this.annotator.state.dimColor});document.getElementById("xmlanchor").appendChild(_);var w=createSVG("rect",{id:v,x:o.x-2,y:o.y-2,width:4,height:4,fill:this.annotator.state.dimColor});document.getElementById("xmlanchor").appendChild(w);var S=createSVG("polyline",{id:f,points:u,fill:"none",stroke:this.annotator.state.dimColor,"stroke-width":1});document.getElementById("xmlanchor").appendChild(S);var x=new O((this.arrowStart.x+this.arrowEnd.x)/2,(this.arrowStart.y+this.arrowEnd.y)/2,(this.arrowStart.z+this.arrowEnd.z)/2),C=new O(0,0,0);C.subtract(this.arrowEnd,this.arrowStart);var $=new O(0,0,0);$.subtract(this.textPosition,x);var E=null;E=2*$.length()>C.length()?createSVG("polyline",{id:h,points:s,fill:"none",stroke:this.annotator.state.dimColor,"stroke-width":e,"marker-end":"url(#Triangle3)","marker-start":"url(#Triangle4)"}):createSVG("polyline",{id:h,points:s,fill:"none",stroke:this.annotator.state.dimColor,"stroke-width":e,"marker-end":"url(#Triangle)","marker-start":"url(#Triangle2)"}),document.getElementById("xmlanchor").appendChild(E);var T=createSVGWithNodeText("text",{id:p,x:i.x,y:i.y,"font-size":12,"font-family":"Verdana",fill:this.annotator.state.dimColor,stroke:"rgb(0, 0, 0)","stroke-width":.2},this.text);document.getElementById("xmlanchor").appendChild(T);var k=createSVG("polyline",{id:y,points:l,fill:"none",stroke:this.annotator.state.dimColor,"stroke-width":1});document.getElementById("xmlanchor").appendChild(k);var A=createSVG("polyline",{id:m,points:c,fill:"none",stroke:this.annotator.state.dimColor,"stroke-width":1});document.getElementById("xmlanchor").appendChild(A)}else{var N=new O(0,0,0),M="f"+this.id;rt(this.annotator,this.firstOriginalClickPoint,N);var D=createSVG("rect",{id:M,x:N.x-2,y:N.y-2,width:4,height:4,fill:this.annotator.state.dimColor});document.getElementById("xmlanchor").appendChild(D)}},update:function(e,t){for(var n=document.getElementById("xmlanchor");n.lastChild;)n.lastChild.id&&-1!=n.lastChild.id.indexOf(this.id)?(n.removeChild(n.lastChild),n=document.getElementById("xmlanchor")):n=n.lastChild;this.annotator.view.markupManager.calculateSelectionRay(e,t);var i=new O(this.firstClickPoint.x,this.firstClickPoint.y,this.firstClickPoint.z),r=new O(this.secondClickPoint.x,this.secondClickPoint.y,this.secondClickPoint.z),o=new O(0,0,0);o.subtract(r,i),o.normalize();var a=this.annotator.controller.sceneNode.findNode("lookAt").get("up"),s=new O(a.x,a.y,a.z),l=new O(0,0,0);computeCrossProduct(this.annotator.controller.secondSelectionRay,s,l),l.normalize();var c=new O((i.x+r.x)/2,(i.y+r.y)/2,(i.z+r.z)/2),u=new O(c.x+s.x,c.y+s.y,c.z+s.z),d=new O(c.x+l.x,c.y+l.y,c.z+l.z),h=new O(this.annotator.controller.firstSelectionRay.x+1e6*this.annotator.controller.secondSelectionRay.x,this.annotator.controller.firstSelectionRay.y+1e6*this.annotator.controller.secondSelectionRay.y,this.annotator.controller.firstSelectionRay.z+1e6*this.annotator.controller.secondSelectionRay.z),p=new O(0,0,0);computeIntersectionOfPlanePointsAndLine(this.annotator.controller.firstSelectionRay,h,c,u,d,p),this.textPosition.setFromHoopsPoint(p);var f=new O(0,0,0),m=new O(0,0,0),g=new O(0,0,0);f=Math.abs(o.x)<=Math.abs(o.y)&&Math.abs(o.x)<=Math.abs(o.z)?new O(1,0,0):Math.abs(o.y)<=Math.abs(o.x)&&Math.abs(o.y)<=Math.abs(o.z)?new O(0,1,0):new O(0,0,1),computeCrossProduct(f,o,m),computeCrossProduct(m,o,g),m.set(i.x+m.x,i.y+m.y,i.z+m.z),g.set(i.x+g.x,i.y+g.y,i.z+g.z);
var v=new O(p.x+1e4*o.x,p.y+1e4*o.y,p.z+1e4*o.z),y=new O(p.x-1e4*o.x,p.y-1e4*o.y,p.z-1e4*o.z);computeIntersectionOfPlanePointsAndLine(v,y,i,m,g,p);var b=new O(0,0,0);b.subtract(p,i),this.arrowStart.set(i.x+b.x,i.y+b.y,i.z+b.z),this.arrowEnd.set(r.x+b.x,r.y+b.y,r.z+b.z),this.drawExtra()},removeMeasurementPins:function(){if(!this.removedPins){this.removedPins=!0;var e=this.annotator.controller.sceneNode.findNode("measureb-"+this.id+"-0");if(e&&(e=e.parent(),e=e.parent(),e=e.parent(),e=e.parent(),e=e.parent(),e=e.remove("nodeAt",0)),this.stage2Set){var t=this.annotator.controller.sceneNode.findNode("measureb-"+this.id+"-1");t&&(t=t.parent(),t=t.parent(),t=t.parent(),t=t.parent(),t=t.parent(),t=t.remove("nodeAt",0))}}},insertMeasurementPin:function(e,t,n,i,r){if(n&&0!=n.length){var o=-1;void 0!=e&&(o=e[t]);for(var a=new Array,s=new Array,l=new Array,c=0,u=0,d=new O(this.annotator.view.model.boundingMaximum.x-this.annotator.view.model.boundingMinimum.x,this.annotator.view.model.boundingMaximum.y-this.annotator.view.model.boundingMinimum.y,this.annotator.view.model.boundingMaximum.z-this.annotator.view.model.boundingMinimum.z),h=d.length()/1e3,p=0;n.length>p;p+=3)(void 0==e||e[p/3]==o)&&(a[c]=i[3*n[p]]+r[3*n[p]]*h,a[c+1]=i[3*n[p]+1]+r[3*n[p]+1]*h,a[c+2]=i[3*n[p]+2]+r[3*n[p]+2]*h,a[c+3]=i[3*n[p+1]]+r[3*n[p+1]]*h,a[c+4]=i[3*n[p+1]+1]+r[3*n[p+1]+1]*h,a[c+5]=i[3*n[p+1]+2]+r[3*n[p+1]+2]*h,a[c+6]=i[3*n[p+2]]+r[3*n[p+2]]*h,a[c+7]=i[3*n[p+2]+1]+r[3*n[p+2]+1]*h,a[c+8]=i[3*n[p+2]+2]+r[3*n[p+2]+2]*h,s[c]=r[3*n[p]],s[c+1]=r[3*n[p]+1],s[c+2]=r[3*n[p]+2],s[c+3]=r[3*n[p+1]],s[c+4]=r[3*n[p+1]+1],s[c+5]=r[3*n[p+1]+2],s[c+6]=r[3*n[p+2]],s[c+7]=r[3*n[p+2]+1],s[c+8]=r[3*n[p+2]+2],l[u]=u,l[u+1]=u+1,l[u+2]=u+2,c+=9,u+=3);if(s&&!(3>s.length)){var f=0,m=null;this.stage2Set?(f=1,m=this.secondOriginalClickPoint):(f=0,m=this.firstOriginalClickPoint);var g=new O(s[0],s[1],s[2]);g.normalize(),g.set(4*g.x,4*g.y,4*g.z);var v="measureb-"+this.id+"-"+f,y="measurea-"+this.id+"-"+f,b="measure-"+this.id+"-"+f,_={type:"cube"},w={type:"node",id:v,nodes:[_]},S={type:"translate",x:g.x,y:g.y,z:g.z,nodes:[w]},x={type:"geometry",primitive:"lines",positions:[0,0,0,g.x,g.y,g.z],indices:[0,1]},C={type:"scale",x:1,y:1,z:1,nodes:[S,x]},$={type:"translate",id:y,x:m.x,y:m.y,z:m.z,nodes:[C]},E={type:"material",baseColor:this.annotator.state.dimColorParameters,specularColor:this.annotator.state.dimColorParameters,specular:!0,nodes:[$]},T={type:"flags",flags:{enabled:!0,backfaces:!0},nodes:[E]},k={type:"name",name:b,nodes:[T]};this.annotator.view.model.tempNode.add("node",k)}}},transformAndDrawPointArray:function(e,t,n){for(var i="",r=0;e.length>r;r++){var o=this.annotator.controller.clientH,a=new O(e[r].x,e[r].y,e[r].z),s=new O(0,0,0),l=computeAlternativelyTransformedPoint(a,1,this.annotator.controller.cameraViewMatrix,s),c=.5*s.x/l*this.annotator.controller.clientW,u=.5*s.y/l*o,d=c+.5*this.annotator.controller.clientW,h=o-u-.5*o;i+=d+","+h+" "}var p;p=t?4:2;var f;f=n?createSVG("polyline",{points:i,fill:"none",stroke:this.annotator.state.dimColor,"stroke-width":p}):createSVG("polyline",{points:i,fill:"none",stroke:this.annotator.state.dimColor,"stroke-width":p}),document.getElementById("xmlanchor").appendChild(f)},show:function(){this.visible=!0},hide:function(){this.visible=!1,this.removeMeasurementPins()},remove:function(){}},q.prototype={draw:function(){this.visible&&this.drawExtra()},setSecondStage:function(e,t){this.secondPlane.setFromPlane(t),this.secondClickPoint.setFromHoopsPoint(e),this.planeIntersectionLine[0]=new O(0,0,0),this.planeIntersectionLine[1]=new O(0,0,0);var n=computeIntersectionOfPlanes(this.firstPlane,this.secondPlane,this.planeIntersectionLine[0],this.planeIntersectionLine[1]);if(2!=n)return!1;var i=new O(0,0,0);i.subtract(this.planeIntersectionLine[1],this.planeIntersectionLine[0]),i.normalize(),this.planeIntersectionLine[0].set(this.planeIntersectionLine[0].x-100*i.x,this.planeIntersectionLine[0].y-100*i.y,this.planeIntersectionLine[0].z-100*i.z),this.planeIntersectionLine[1].set(this.planeIntersectionLine[1].x+100*i.x,this.planeIntersectionLine[1].y+100*i.y,this.planeIntersectionLine[1].z+100*i.z),computeDistanceBetweenPointAndLine(this.secondClickPoint,this.planeIntersectionLine[0],this.planeIntersectionLine[1],this.pointOnLine);var r=new O(0,0,0),o=new O(0,0,0);r.set(this.firstClickPoint.x+i.x,this.firstClickPoint.y+i.y,this.firstClickPoint.z+i.z),computeDistanceBetweenPointAndLine(this.pointOnLine,this.firstClickPoint,r,o),this.firstClickPoint.setFromHoopsPoint(o),this.secondOriginalClickPoint.setFromHoopsPoint(this.secondClickPoint),this.inside1=this.firstPlane.sideOfPlane(this.secondOriginalClickPoint),this.inside2=this.secondPlane.sideOfPlane(this.firstOriginalClickPoint);for(var a=new Array(4),s=0;4>s;s++)a[s]=new Array(4);var l=new O(0,0,0);l.subtract(this.secondClickPoint,this.pointOnLine);var c=l.length(),u=new O(0,0,0);if(u.subtract(this.firstClickPoint,this.pointOnLine),u.normalize(),this.intermediatePoint.set(this.pointOnLine.x+u.x*c,this.pointOnLine.y+u.y*c,this.pointOnLine.z+u.z*c),this.angle=computeAngleBetweenVectors(l,u),0==this.angle)return!1;this.measurementValue=this.angle.toFixed(1),this.text=this.measurementValue+"Deg",this.textPosition.setFromHoopsPoint(this.pointOnLine);var d=!1,h=new O(0,0,0),p=new O(0,0,0);computeOffAxisRotation(i,1,a),computeTransformedPoint(l,a,p),h.set(p.x+this.pointOnLine.x,p.y+this.pointOnLine.y,p.z+this.pointOnLine.z),h.subtract(h,this.firstClickPoint);var f=h.length();computeOffAxisRotation(i,-1,a),computeTransformedPoint(l,a,p),h.set(p.x+this.pointOnLine.x,p.y+this.pointOnLine.y,p.z+this.pointOnLine.z),h.subtract(h,this.firstClickPoint);var m=h.length();for(f>m&&(d=!0),s=0;this.angle>=s;s+=5)0==d?computeOffAxisRotation(i,s,a):computeOffAxisRotation(i,-s,a),computeTransformedPoint(l,a,p),this.arcArray[s].set(p.x+this.pointOnLine.x,p.y+this.pointOnLine.y,p.z+this.pointOnLine.z);return this.stage2Set=!0,!0},finalize:function(){this.finalized||(this.removeSelectionFaces(),this.finalized=!0)},removeSelectionFaces:function(){this.facesWereHidden||(this.facesWereHidden=!0,this.annotator.view.model.modelNode.remove("node","rid0"),this.stage2Set&&this.annotator.view.model.modelNode.remove("node","rid1"))},insertSelectionFace:function(e,t,n,i,r){var o=-1;void 0!=e&&(o=e[t]);for(var a=new Array,s=new Array,l=new Array,c=0,u=0,d=new O(this.annotator.view.model.boundingMaximum.x-this.annotator.view.model.boundingMinimum.x,this.annotator.view.model.boundingMaximum.y-this.annotator.view.model.boundingMinimum.y,this.annotator.view.model.boundingMaximum.z-this.annotator.view.model.boundingMinimum.z),h=d.length()/1e3,p=0;n.length>p;p+=3)(void 0==e||e[p/3]==o)&&(a[c]=i[3*n[p]]+r[3*n[p]]*h,a[c+1]=i[3*n[p]+1]+r[3*n[p]+1]*h,a[c+2]=i[3*n[p]+2]+r[3*n[p]+2]*h,a[c+3]=i[3*n[p+1]]+r[3*n[p+1]]*h,a[c+4]=i[3*n[p+1]+1]+r[3*n[p+1]+1]*h,a[c+5]=i[3*n[p+1]+2]+r[3*n[p+1]+2]*h,a[c+6]=i[3*n[p+2]]+r[3*n[p+2]]*h,a[c+7]=i[3*n[p+2]+1]+r[3*n[p+2]+1]*h,a[c+8]=i[3*n[p+2]+2]+r[3*n[p+2]+2]*h,s[c]=r[3*n[p]],s[c+1]=r[3*n[p]+1],s[c+2]=r[3*n[p]+2],s[c+3]=r[3*n[p+1]],s[c+4]=r[3*n[p+1]+1],s[c+5]=r[3*n[p+1]+2],s[c+6]=r[3*n[p+2]],s[c+7]=r[3*n[p+2]+1],s[c+8]=r[3*n[p+2]+2],l[u]=u,l[u+1]=u+1,l[u+2]=u+2,c+=9,u+=3);var f={type:"geometry",primitive:"triangles",positions:a,normals:s,indices:l},m=0;this.stage2Set&&(m=1);var g={id:"rid"+m,type:"material",baseColor:{r:.199,g:.664,b:.863},specularColor:{r:0,g:0,b:1},nodes:[f]};this.annotator.view.model.modelNode.add("node",g)},drawExtra:function(){if(this.stage2Set){var e="",t="a"+this.id,n="b"+this.id,i="c"+this.id,r="d"+this.id,o="e"+this.id,a="f"+this.id,s=new O(0,0,0),l=new O(0,0,0),c=new O(0,0,0),u=new O(0,0,0),d=new O(0,0,0),h=new O(0,0,0),p=new O(0,0,0),f=new O(0,0,0);rt(this.annotator,this.firstClickPoint,s),rt(this.annotator,this.secondClickPoint,l),rt(this.annotator,this.pointOnLine,c),rt(this.annotator,this.textPosition,u),rt(this.annotator,this.intermediatePoint,d),rt(this.annotator,this.secondOriginalClickPoint,h),rt(this.annotator,this.firstOriginalClickPoint,p);var m;m=this.selected?4:2,e=s.x+","+s.y+" "+d.x+","+d.y;var g=createSVG("polyline",{id:t,points:e,fill:"none",stroke:this.annotator.state.dimColor,"stroke-width":m});document.getElementById("xmlanchor").appendChild(g),e=s.x+","+s.y+" "+p.x+","+p.y;var v=createSVG("polyline",{id:t,points:e,fill:"none",stroke:this.annotator.state.dimColor,"stroke-width":m});document.getElementById("xmlanchor").appendChild(v),e=l.x+","+l.y+" "+h.x+","+h.y;var y=createSVG("polyline",{id:i,points:e,fill:"none",stroke:this.annotator.state.dimColor,"stroke-width":m});document.getElementById("xmlanchor").appendChild(y);var b=createSVG("circle",{id:r,cx:p.x,cy:p.y,r:3,fill:this.annotator.state.dimColor});document.getElementById("xmlanchor").appendChild(b);var _=createSVG("circle",{id:a,cx:h.x,cy:h.y,r:3,fill:this.annotator.state.dimColor});if(document.getElementById("xmlanchor").appendChild(_),0!=this.drawTextLine){e=1==this.drawTextLine?d.x+","+d.y+" "+u.x+","+u.y:l.x+","+l.y+" "+u.x+","+u.y;var w=createSVG("polyline",{id:n,points:e,fill:"none",stroke:this.annotator.state.dimColor,"stroke-width":1});document.getElementById("xmlanchor").appendChild(w)}var S=createSVGWithNodeText("text",{id:o,x:u.x,y:u.y,"font-size":12,"font-family":"Verdana",fill:this.annotator.state.dimColor,stroke:"rgb(0, 0, 0)","stroke-width":.2},this.text);document.getElementById("xmlanchor").appendChild(S),e="";for(var x=0;this.angle>=x;x+=5)rt(this.annotator,this.arcArray[x],f),e+=f.x+","+f.y+" ";e+=d.x+","+d.y+" ";var C=createSVG("polyline",{id:n,points:e,fill:"none",stroke:this.annotator.state.dimColor,"stroke-width":2,"marker-end":"url(#Triangle)","marker-start":"url(#Triangle2)"});document.getElementById("xmlanchor").appendChild(C)}else{var $=new O(0,0,0),E="f"+this.id;rt(this.annotator,this.firstOriginalClickPoint,$);var T=createSVG("circle",{id:E,cx:$.x,cy:$.y,r:3,fill:this.annotator.state.dimColor});document.getElementById("xmlanchor").appendChild(T)}},update:function(e,t){for(var n=document.getElementById("xmlanchor");n.lastChild;)n.lastChild.id&&-1!=n.lastChild.id.indexOf(this.id)?(n.removeChild(n.lastChild),n=document.getElementById("xmlanchor")):n=n.lastChild;this.annotator.view.markupManager.calculateSelectionRay(e,t);var i=new O(this.annotator.controller.firstSelectionRay.x+1e6*this.annotator.controller.secondSelectionRay.x,this.annotator.controller.firstSelectionRay.y+1e6*this.annotator.controller.secondSelectionRay.y,this.annotator.controller.firstSelectionRay.z+1e6*this.annotator.controller.secondSelectionRay.z),r=new O(0,0,0);computeIntersectionOfPlanePointsAndLine(this.annotator.controller.firstSelectionRay,i,this.pointOnLine,this.firstClickPoint,this.secondClickPoint,r),this.textPosition.setFromHoopsPoint(r);var o=new O(0,0,0);o.subtract(r,this.pointOnLine);var a=o.length();o.subtract(this.secondClickPoint,this.pointOnLine),o.normalize(),this.secondClickPoint.set(this.pointOnLine.x+o.x*a,this.pointOnLine.y+o.y*a,this.pointOnLine.z+o.z*a);var s=this.firstPlane.sideOfPlane(r),l=this.secondPlane.sideOfPlane(r);this.drawTextLine=s!=this.inside1&&l!=this.inside2||s==this.inside1&&l==this.inside2?0:s!=this.inside1?1:2;var c=new O(0,0,0);c.subtract(this.planeIntersectionLine[1],this.planeIntersectionLine[0]),c.normalize();for(var u=new Array(4),d=0;4>d;d++)u[d]=new Array(4);var h=new O(0,0,0);h.subtract(this.secondClickPoint,this.pointOnLine);var p=h.length(),f=new O(0,0,0);f.subtract(this.firstClickPoint,this.pointOnLine),f.normalize(),this.intermediatePoint.set(this.pointOnLine.x+f.x*p,this.pointOnLine.y+f.y*p,this.pointOnLine.z+f.z*p);var m=!1,g=new O(0,0,0),v=new O(0,0,0);computeOffAxisRotation(c,1,u),computeTransformedPoint(h,u,v),g.set(v.x+this.pointOnLine.x,v.y+this.pointOnLine.y,v.z+this.pointOnLine.z),g.subtract(g,this.firstClickPoint);var y=g.length();computeOffAxisRotation(c,-1,u),computeTransformedPoint(h,u,v),g.set(v.x+this.pointOnLine.x,v.y+this.pointOnLine.y,v.z+this.pointOnLine.z),g.subtract(g,this.firstClickPoint);var b=g.length();for(y>b&&(m=!0),d=0;this.angle>=d;d+=5)0==m?computeOffAxisRotation(c,d,u):computeOffAxisRotation(c,-d,u),computeTransformedPoint(h,u,v),this.arcArray[d].set(v.x+this.pointOnLine.x,v.y+this.pointOnLine.y,v.z+this.pointOnLine.z);this.drawExtra()},transformAndDrawPointArray:function(e,t,n){for(var i="",r=0;e.length>r;r++){var o=this.annotator.controller.clientH,a=new O(e[r].x,e[r].y,e[r].z),s=new O(0,0,0),l=computeAlternativelyTransformedPoint(a,1,this.annotator.controller.cameraViewMatrix,s),c=.5*s.x/l*this.annotator.controller.clientW,u=.5*s.y/l*o,d=c+.5*this.annotator.controller.clientW,h=o-u-.5*o;i+=d+","+h+" "}var p;p=t?4:2;var f;f=n?createSVG("polyline",{points:i,fill:"none",stroke:this.annotator.state.dimColor,"stroke-width":p}):createSVG("polyline",{points:i,fill:"none",stroke:this.annotator.state.dimColor,"stroke-width":p}),document.getElementById("xmlanchor").appendChild(f)},show:function(){this.visible=!0},hide:function(){this.visible=!1,this.removeSelectionFaces()},remove:function(){}},J.prototype={draw:function(){this.visible&&(this.polylineArray&&this.transformAndDrawPointArray(this.polylineArray,this.selected,!1),this.drawExtra())},transformAndDrawPointArray:function(e,t,n){for(var i="",r=0;e.length>r;r++){var o=this.annotator.controller.clientH,a=new O(e[r].x,e[r].y,e[r].z),s=new O(0,0,0),l=computeAlternativelyTransformedPoint(a,1,this.annotator.controller.cameraViewMatrix,s),c=.5*s.x/l*this.annotator.controller.clientW,u=.5*s.y/l*o,d=c+.5*this.annotator.controller.clientW,h=o-u-.5*o;i+=d+","+h+" "}var p;p=t?4:2;var f;f=n?createSVG("polyline",{points:i,fill:"none",stroke:this.annotator.state.dimColor,"stroke-width":p}):createSVG("polyline",{points:i,fill:"none",stroke:this.annotator.state.dimColor,"stroke-width":p}),document.getElementById("xmlanchor").appendChild(f)},show:function(){this.visible=!0},hide:function(){this.visible=!1},drawExtra:function(){if(!this.noType){var e;e=this.selected?3:2;var t=new O(0,0,0),n=new O(0,0,0),i=new O(0,0,0),r=new O(0,0,0),o=new O(0,0,0);rt(this.annotator,this.firstArrowStart,t),rt(this.annotator,this.firstArrowEnd,n),rt(this.annotator,this.textPosition,i),rt(this.annotator,this.polylineArray[0],r),rt(this.annotator,this.polylineArray[this.polylineArray.length-1],o);var a=t.x+","+t.y+" "+n.x+","+n.y+" ",s=t.x+","+t.y+" "+r.x+","+r.y+" ",l=n.x+","+n.y+" "+o.x+","+o.y+" ",c=n.x+","+n.y+" "+i.x+","+i.y+" ",u="dia"+this.id,d="tex"+this.id,h="diax"+this.id,p="diaxy"+this.id,f=createSVG("polyline",{id:h,points:c,fill:"none",stroke:this.annotator.state.dimColor,"stroke-width":1});document.getElementById("xmlanchor").appendChild(f);var m=new O((this.firstArrowStart.x+this.firstArrowEnd.x)/2,(this.firstArrowStart.y+this.firstArrowEnd.y)/2,(this.firstArrowStart.z+this.firstArrowEnd.z)/2),g=new O(0,0,0);g.subtract(this.firstArrowEnd,this.firstArrowStart);var v=new O(0,0,0);v.subtract(this.textPosition,m);var y=null;y=2*v.length()>g.length()?createSVG("polyline",{id:u,points:a,fill:"none",stroke:this.annotator.state.dimColor,"stroke-width":e,"marker-end":"url(#Triangle3)","marker-start":"url(#Triangle4)"}):createSVG("polyline",{id:u,points:a,fill:"none",stroke:this.annotator.state.dimColor,"stroke-width":e,"marker-end":"url(#Triangle)","marker-start":"url(#Triangle2)"}),document.getElementById("xmlanchor").appendChild(y);var b=createSVGWithNodeText("text",{id:d,x:i.x,y:i.y,"font-size":12,"font-family":"Verdana",fill:this.annotator.state.dimColor,stroke:"rgb(0, 0, 0)","stroke-width":.2},this.text);document.getElementById("xmlanchor").appendChild(b);var _=createSVG("polyline",{id:h,points:s,fill:"none",stroke:this.annotator.state.dimColor,"stroke-width":1});document.getElementById("xmlanchor").appendChild(_);var w=createSVG("polyline",{id:p,points:l,fill:"none",stroke:this.annotator.state.dimColor,"stroke-width":1});document.getElementById("xmlanchor").appendChild(w)}},update:function(e,t){for(var n=document.getElementById("xmlanchor");n.lastChild;)void 0!=n.lastChild.id&&-1!=n.lastChild.id.indexOf(this.id)?(n.removeChild(n.lastChild),n=document.getElementById("xmlanchor")):n=n.lastChild;this.annotator.view.markupManager.calculateSelectionRay(e,t);var i=new O(this.polylineArray[0].x,this.polylineArray[0].y,this.polylineArray[0].z),r=new O(this.polylineArray[this.polylineArray.length-1].x,this.polylineArray[this.polylineArray.length-1].y,this.polylineArray[this.polylineArray.length-1].z),o=new O(0,0,0);o.subtract(r,i),o.normalize();var a=this.annotator.controller.sceneNode.findNode("lookAt").get("up"),s=new O(a.x,a.y,a.z),l=new O(0,0,0);computeCrossProduct(this.annotator.controller.secondSelectionRay,s,l),l.normalize();var c=new O((i.x+r.x)/2,(i.y+r.y)/2,(i.z+r.z)/2),u=new O(c.x+s.x,c.y+s.y,c.z+s.z),d=new O(c.x+l.x,c.y+l.y,c.z+l.z),h=new O(this.annotator.controller.firstSelectionRay.x+1e6*this.annotator.controller.secondSelectionRay.x,this.annotator.controller.firstSelectionRay.y+1e6*this.annotator.controller.secondSelectionRay.y,this.annotator.controller.firstSelectionRay.z+1e6*this.annotator.controller.secondSelectionRay.z),p=new O(0,0,0);computeIntersectionOfPlanePointsAndLine(this.annotator.controller.firstSelectionRay,h,c,u,d,p),this.textPosition.setFromHoopsPoint(p);var f=new O(0,0,0),m=new O(0,0,0),g=new O(0,0,0);f=Math.abs(o.x)<=Math.abs(o.y)&&Math.abs(o.x)<=Math.abs(o.z)?new O(1,0,0):Math.abs(o.y)<=Math.abs(o.x)&&Math.abs(o.y)<=Math.abs(o.z)?new O(0,1,0):new O(0,0,1),computeCrossProduct(f,o,m),computeCrossProduct(m,o,g),m.set(i.x+m.x,i.y+m.y,i.z+m.z),g.set(i.x+g.x,i.y+g.y,i.z+g.z);var v=new O(p.x+1e4*o.x,p.y+1e4*o.y,p.z+1e4*o.z),y=new O(p.x-1e4*o.x,p.y-1e4*o.y,p.z-1e4*o.z);computeIntersectionOfPlanePointsAndLine(v,y,i,m,g,p);var b=new O(0,0,0);b.subtract(p,i),this.firstArrowStart.set(i.x+b.x,i.y+b.y,i.z+b.z),this.firstArrowEnd.set(r.x+b.x,r.y+b.y,r.z+b.z),this.drawExtra()},finalize:function(){},remove:function(){}},X.prototype={draw:function(){this.visible&&this.drawExtra()},transformAndDrawPointArray:function(e,t,n){for(var i="",r=0;e.length>r;r++){var o=this.annotator.controller.clientH,a=new O(e[r].x,e[r].y,e[r].z),s=new O(0,0,0),l=computeAlternativelyTransformedPoint(a,1,this.annotator.controller.cameraViewMatrix,s),c=.5*s.x/l*this.annotator.controller.clientW,u=.5*s.y/l*o,d=c+.5*this.annotator.controller.clientW,h=o-u-.5*o;i+=d+","+h+" "}var p;p=t?4:2;var f;f=n?createSVG("polyline",{points:i,fill:"none",stroke:this.annotator.state.dimColor,"stroke-width":p}):createSVG("polyline",{points:i,fill:"none",stroke:this.annotator.state.dimColor,"stroke-width":p}),document.getElementById("xmlanchor").appendChild(f)},show:function(){this.visible=!0},hide:function(){this.visible=!1},createCircleData:function(e,t){this.circlePoints=new Array,generatePointsOnCircle(this.circlePoints,e.origin,e.radius,32,e.axis),applyAlternativeTransformationToPoints(this.circlePoints,t),this.firstArrowStart.setFromHoopsPoint(this.circlePoints[0]),this.firstArrowEnd.setFromHoopsPoint(this.circlePoints[16]);var n=new O(e.radius,0,0),i=new O(0,0,0),i=new O(0,0,0),r=new O(0,0,0);computeTransformedPoint(n,t,n),computeTransformedPoint(i,t,i),r.subtract(i,n),this.diameter=r.length(),r.subtract(this.firstArrowEnd,this.firstArrowStart),this.measurementValue=r.length(),this.text=constructMeasurementResultString(this.annotator.state.worldToMM(this.measurementValue),this.annotator.state.unitPreference,this.measurementTextPrefix),this.textPosition.setFromHoopsPoint(this.firstArrowEnd),this.surfaceCenter=new O(0,0,0),computeTransformedPoint(e.origin,t,this.surfaceCenter),this.secondSurfaceCenter.setFromHoopsPoint(this.surfaceCenter);var o=new O(e.origin.x+e.axis.x,e.origin.y+e.axis.y,e.origin.z+e.axis.z);this.firstSurfaceAxis=new O(0,0,0),computeTransformedPoint(o,t,this.firstSurfaceAxis),o.set(e.origin.x-e.axis.x,e.origin.y-e.axis.y,e.origin.z-e.axis.z),this.secondSurfaceAxis=new O(0,0,0),computeTransformedPoint(o,t,this.secondSurfaceAxis)},drawExtra:function(){var e=new O(0,0,0),t=new O(0,0,0),n=new O(0,0,0),i=new O(0,0,0),r=new O(0,0,0),o=new O(0,0,0),a=new O(0,0,0);rt(this.annotator,this.firstArrowStart,e),rt(this.annotator,this.firstArrowEnd,t),rt(this.annotator,this.textPosition,n),rt(this.annotator,this.secondSurfaceCenter,i),rt(this.annotator,this.surfaceCenter,r);var s=this.measurementType==yt.DIAMETER,l=r.x+","+r.y+" "+e.x+","+e.y+" ",c=e.x+","+e.y+" "+n.x+","+n.y+" ",u="";s&&(o.x=r.x+(r.x-e.x),o.y=r.y+(r.y-e.y),l=o.x+","+o.y+" "+e.x+","+e.y+" ",a.x=o.x-.5*(e.x-o.x),a.y=o.y-.5*(e.y-o.y),u=o.x+","+o.y+" "+a.x+","+a.y+" ");var d="dia"+this.id,h="dia2"+this.id,p="tex"+this.id;"lead"+this.id;var f=createSVG("polyline",{id:h,points:c,fill:"none",stroke:this.annotator.state.dimColor,"stroke-width":1});document.getElementById("xmlanchor").appendChild(f);var m=new O(0,0,0),g=new O(0,0,0);m.subtract(this.firstArrowStart,this.surfaceCenter),g.subtract(this.textPosition,this.surfaceCenter);var v=null,y=null,b=null;1==s?v=g.length()>m.length()?createSVG("polyline",{id:d,points:l,fill:"none",stroke:this.annotator.state.dimColor,"stroke-width":2,"marker-end":"url(#Triangle3)","marker-start":"url(#Triangle5)"}):createSVG("polyline",{id:d,points:l,fill:"none",stroke:this.annotator.state.dimColor,"stroke-width":2,"marker-end":"url(#Triangle)","marker-start":"url(#Triangle3)"}):(v=g.length()>m.length()?createSVG("polyline",{id:d,points:l,fill:"none",stroke:this.annotator.state.dimColor,"stroke-width":2,"marker-end":"url(#Triangle3)"}):createSVG("polyline",{id:d,points:l,fill:"none",stroke:this.annotator.state.dimColor,"stroke-width":2,"marker-end":"url(#Triangle)"}),b=createSVG("circle",{id:d,cx:i.x,cy:i.y,r:2,fill:this.annotator.state.dimColor}),document.getElementById("xmlanchor").appendChild(b)),document.getElementById("xmlanchor").appendChild(v);var _=createSVGWithNodeText("text",{id:p,x:n.x,y:n.y,"font-size":12,"font-family":"Verdana",fill:this.annotator.state.dimColor,stroke:"rgb(0, 0, 0)","stroke-width":.2},this.text);if(document.getElementById("xmlanchor").appendChild(_),this.finalizeStage>0){var w=new O(0,0,0);rt(this.annotator,this.secondArrowStart,w);var S=new O(0,0,0);rt(this.annotator,this.secondArrowEnd,S);var l=w.x+","+w.y+" "+e.x+","+e.y+" ",y=createSVG("polyline",{id:h,points:l,fill:"none",stroke:"red","stroke-width":1});document.getElementById("xmlanchor").appendChild(y),l=i.x+","+i.y+" "+r.x+","+r.y+" ";var x=createSVG("polyline",{id:h,points:l,fill:"none",stroke:this.annotator.state.dimColor,"stroke-width":1});document.getElementById("xmlanchor").appendChild(x)}},update:function(e,t){for(var n=document.getElementById("xmlanchor");n.lastChild;)void 0!=n.lastChild.id&&-1!=n.lastChild.id.indexOf(this.id)?(n.removeChild(n.lastChild),n=document.getElementById("xmlanchor")):n=n.lastChild;var i=this.circlePoints;this.annotator.view.markupManager.calculateSelectionRay(e,t);var r=new O(this.annotator.controller.firstSelectionRay.x+1e6*this.annotator.controller.secondSelectionRay.x,this.annotator.controller.firstSelectionRay.y+1e6*this.annotator.controller.secondSelectionRay.y,this.annotator.controller.firstSelectionRay.z+1e6*this.annotator.controller.secondSelectionRay.z);if(0==this.finalizeStage){var o=new O(i[0].x,i[0].y,i[0].z),a=new O(i[1].x,i[1].y,i[1].z),s=null,l=Math.floor(i.length/2);s=new O(i[l].x,i[l].y,i[l].z);var c=new O(0,0,0),u=new O((o.x+s.x)/2,(o.y+s.y)/2,(o.z+s.z)/2),d=new O(0,0,0);d.subtract(s,o);var h=d.length()/2;computeIntersectionOfPlanePointsAndLine(this.annotator.controller.firstSelectionRay,r,o,a,s,c);var p=new O(0,0,0);p.subtract(c,u),p.normalize();var f=new O(0,0,0),m=new O(0,0,0),g=new O(u.x+p.x*h,u.y+p.y*h,u.z+p.z*h),v=new O(u.x-p.x*h,u.y-p.y*h,u.z-p.z*h),y=new O(0,0,0);rt(this.annotator,g,f),rt(this.annotator,v,m),rt(this.annotator,r,y),this.firstArrowStart.setFromHoopsPoint(g),this.firstArrowEnd.setFromHoopsPoint(v),this.secondArrowStart.setFromHoopsPoint(g),this.secondArrowEnd.setFromHoopsPoint(v),this.textPosition.setFromHoopsPoint(c),this.secondSurfaceCenter.setFromHoopsPoint(this.surfaceCenter)}else{var p=new O(0,0,0);p.subtract(this.firstArrowStart,this.firstArrowEnd),p.normalize();var b=new O(0,0,0);this.annotator.controller.secondSelectionRay.oneVectorCross(b);var _=new O(0,0,0);computeCrossProduct(this.annotator.controller.secondSelectionRay,b,_),_.normalize();var u=new O((this.firstArrowStart.x+this.firstArrowEnd.x)/2,(this.firstArrowStart.y+this.firstArrowEnd.y)/2,(this.firstArrowStart.z+this.firstArrowEnd.z)/2);b.set(u.x+b.x,u.y+b.y,u.z+b.z),_.set(u.x+_.x,u.y+_.y,u.z+_.z);var w=new O(0,0,0);computeIntersectionOfPlanePointsAndLine(this.annotator.controller.firstSelectionRay,r,u,b,_,w);var d=new O(0,0,0);computeDistanceBetweenPointAndLine(w,this.firstSurfaceAxis,this.secondSurfaceAxis,d);var p=new O(0,0,0);p.subtract(d,this.surfaceCenter),this.surfaceCenter.setFromHoopsPoint(d),this.firstArrowStart.set(this.firstArrowStart.x+p.x,this.firstArrowStart.y+p.y,this.firstArrowStart.z+p.z),this.firstArrowEnd.set(this.firstArrowEnd.x+p.x,this.firstArrowEnd.y+p.y,this.firstArrowEnd.z+p.z),this.textPosition.set(this.textPosition.x+p.x,this.textPosition.y+p.y,this.textPosition.z+p.z);for(var S=0;this.circlePoints.length>S;S++)this.circlePoints[S].set(this.circlePoints[S].x+p.x,this.circlePoints[S].y+p.y,this.circlePoints[S].z+p.z)}this.drawExtra()},finalize:function(){},remove:function(){}},Q.prototype={draw:function(){this.visible&&this.drawExtra()},setSecondStage:function(e){this.secondClickPoint.setFromHoopsPoint(e),this.stage=1},finalize:function(){this.finalized||(this.removeSelectionFaces(),this.finalized=!0)},removeSelectionFaces:function(){this.facesWereHidden||(this.facesWereHidden=!0,this.annotator.view.model.tempNode.remove("node","rid0"),this.stage&&this.annotator.view.model.tempNode.remove("node","rid1"))},createPlaneData:function(e,t){this.faceData[this.stage]=e,this.surfaceCenter[this.stage]=new O(0,0,0),computeTransformedPoint(e.origin,t,this.surfaceCenter[this.stage]);var n=new O(e.origin.x+e.axis.x,e.origin.y+e.axis.y,e.origin.z+e.axis.z);this.firstSurfaceAxis[this.stage]=new O(0,0,0),computeTransformedPoint(n,t,this.firstSurfaceAxis[this.stage])},createCylinderData:function(e,t,n,i){this.faceData[this.stage]=e,this.cylinderPoints[this.stage]=new Array;var r=new O(e.origin.x+1e4*e.axis.x,e.origin.y+1e4*e.axis.y,e.origin.z+1e4*e.axis.z),o=new O(e.origin.x-1e4*e.axis.x,e.origin.y-1e4*e.axis.y,e.origin.z-1e4*e.axis.z),a=new O(0,0,0);computeDistanceBetweenPointAndLine(i,r,o,a),generatePointsOnCircle(this.cylinderPoints[this.stage],a,e.radius,32,e.axis),applyAlternativeTransformationToPoints(this.cylinderPoints[this.stage],t),this.surfaceCenter[this.stage]=new O(0,0,0),computeTransformedPoint(a,t,this.surfaceCenter[this.stage]);var s=new O(a.x+e.axis.x,a.y+e.axis.y,a.z+e.axis.z);this.firstSurfaceAxis[this.stage]=new O(0,0,0),computeTransformedPoint(s,t,this.firstSurfaceAxis[this.stage]),s.set(a.x-e.axis.x,a.y-e.axis.y,a.z-e.axis.z),this.secondSurfaceAxis[this.stage]=new O(0,0,0),computeTransformedPoint(s,t,this.secondSurfaceAxis[this.stage]);var l=new O(0,0,0);l.setFromHoopsPoint(this.firstSurfaceAxis[this.stage]),l.sub(this.surfaceCenter[this.stage]),l.normalize(),this.firstSurfaceAxis[this.stage].set(this.surfaceCenter[this.stage].x+l.x*n,this.surfaceCenter[this.stage].y+l.y*n,this.surfaceCenter[this.stage].z+l.z*n),this.secondSurfaceAxis[this.stage].set(this.surfaceCenter[this.stage].x-l.x*n,this.surfaceCenter[this.stage].y-l.y*n,this.surfaceCenter[this.stage].z-l.z*n),this.firstCylinderAxisInfinite[this.stage]=new O(this.surfaceCenter[this.stage].x+1e3*l.x*n,this.surfaceCenter[this.stage].y+1e3*l.y*n,this.surfaceCenter[this.stage].z+1e3*l.z*n),this.secondCylinderAxisInfinite[this.stage]=new O(this.surfaceCenter[this.stage].x-1e3*l.x*n,this.surfaceCenter[this.stage].y-1e3*l.y*n,this.surfaceCenter[this.stage].z-1e3*l.z*n)},insertSelectionFace:function(e,t,n,i,r,o,a,s){var l=-1;void 0!=t&&(l=t[n]);var c=null;this.stage?(this.secondSelectionFace=new Array,c=this.secondSelectionFace):(this.firstSelectionFace=new Array,c=this.firstSelectionFace);var u,d,h,p,f,m,g=new Array,v=new Array,y=new Array,b=0,_=0,w=new O(this.annotator.view.model.boundingMaximum.x-this.annotator.view.model.boundingMinimum.x,this.annotator.view.model.boundingMaximum.y-this.annotator.view.model.boundingMinimum.y,this.annotator.view.model.boundingMaximum.z-this.annotator.view.model.boundingMinimum.z),S=w.length()/1e3;for(u=0;i.length>u;u+=3)(void 0==t||t[u/3]==l)&&(c[b]=r[3*i[u]]+o[3*i[u]]*S,c[b+1]=r[3*i[u]+1]+o[3*i[u]+1]*S,c[b+2]=r[3*i[u]+2]+o[3*i[u]+2]*S,c[b+3]=r[3*i[u+1]]+o[3*i[u+1]]*S,c[b+4]=r[3*i[u+1]+1]+o[3*i[u+1]+1]*S,c[b+5]=r[3*i[u+1]+2]+o[3*i[u+1]+2]*S,c[b+6]=r[3*i[u+2]]+o[3*i[u+2]]*S,c[b+7]=r[3*i[u+2]+1]+o[3*i[u+2]+1]*S,c[b+8]=r[3*i[u+2]+2]+o[3*i[u+2]+2]*S,v[b]=s[3*i[u]],v[b+1]=s[3*i[u]+1],v[b+2]=s[3*i[u]+2],v[b+3]=s[3*i[u+1]],v[b+4]=s[3*i[u+1]+1],v[b+5]=s[3*i[u+1]+2],v[b+6]=s[3*i[u+2]],v[b+7]=s[3*i[u+2]+1],v[b+8]=s[3*i[u+2]+2],g[b]=o[3*i[u]],g[b+1]=o[3*i[u]+1],g[b+2]=o[3*i[u]+2],g[b+3]=o[3*i[u+1]],g[b+4]=o[3*i[u+1]+1],g[b+5]=o[3*i[u+1]+2],g[b+6]=o[3*i[u+2]],g[b+7]=o[3*i[u+2]+1],g[b+8]=o[3*i[u+2]+2],y[_]=_,y[_+1]=_+1,y[_+2]=_+2,b+=9,_+=3);var x=new O(0,0,0),C=new O(0,0,0);computeBoundingBox(c,x,C),C.sub(x);var $=C.length();computeBoundingBox(v,x,C);var E=new O((C.x+x.x)/2,(C.y+x.y)/2,(C.z+x.z)/2),T={type:"geometry",primitive:"triangles",positions:c,normals:g,indices:y},k=0;this.stage&&(k=1);var A={type:"material",id:"rid"+k,baseColor:{r:.199,g:.664,b:.863},specularColor:{r:1,g:1,b:0},nodes:[T]};if(this.annotator.view.model.tempNode.add("node",A),void 0!=e[l]&&(e[l].type==Et.CYLINDER_TYPE||e[l].type==Et.CONE_TYPE?(this.createCylinderData(e[l],a,$,E),this.stage?(h=new O(this.firstSurfaceAxis[0].x-this.surfaceCenter[0].x,this.firstSurfaceAxis[0].y-this.surfaceCenter[0].y,this.firstSurfaceAxis[0].z-this.surfaceCenter[0].z),p=new O(this.firstSurfaceAxis[1].x-this.surfaceCenter[1].x,this.firstSurfaceAxis[1].y-this.surfaceCenter[1].y,this.firstSurfaceAxis[1].z-this.surfaceCenter[1].z),h.normalize(),p.normalize(),this.secondSelectionFace=new Array(9),this.secondSelectionFace[0]=this.firstCylinderAxisInfinite[1].x,this.secondSelectionFace[1]=this.firstCylinderAxisInfinite[1].y,this.secondSelectionFace[2]=this.firstCylinderAxisInfinite[1].z,this.secondSelectionFace[3]=this.secondCylinderAxisInfinite[1].x,this.secondSelectionFace[4]=this.secondCylinderAxisInfinite[1].y,this.secondSelectionFace[5]=this.secondCylinderAxisInfinite[1].z,this.secondSelectionFace[6]=this.firstCylinderAxisInfinite[1].x,this.secondSelectionFace[7]=this.firstCylinderAxisInfinite[1].y,this.secondSelectionFace[8]=this.firstCylinderAxisInfinite[1].z):(this.firstSelectionFace=new Array(9),this.firstSelectionFace[0]=this.firstCylinderAxisInfinite[0].x,this.firstSelectionFace[1]=this.firstCylinderAxisInfinite[0].y,this.firstSelectionFace[2]=this.firstCylinderAxisInfinite[0].z,this.firstSelectionFace[3]=this.secondCylinderAxisInfinite[0].x,this.firstSelectionFace[4]=this.secondCylinderAxisInfinite[0].y,this.firstSelectionFace[5]=this.secondCylinderAxisInfinite[0].z,this.firstSelectionFace[6]=this.firstCylinderAxisInfinite[0].x,this.firstSelectionFace[7]=this.firstCylinderAxisInfinite[0].y,this.firstSelectionFace[8]=this.firstCylinderAxisInfinite[0].z)):e[l].type==Et.PLANE_TYPE&&this.createPlaneData(e[l],a)),this.stage){this.distance=Number.POSITIVE_INFINITY;var N=new O(0,0,0),M=new O(0,0,0);for(u=0;this.firstSelectionFace.length>u;u+=9){var D=new Array;for(D[0]=new O(this.firstSelectionFace[u],this.firstSelectionFace[u+1],this.firstSelectionFace[u+2]),D[1]=new O(this.firstSelectionFace[u+3],this.firstSelectionFace[u+4],this.firstSelectionFace[u+5]),D[2]=new O(this.firstSelectionFace[u+6],this.firstSelectionFace[u+7],this.firstSelectionFace[u+8]),d=0;this.secondSelectionFace.length>d;d+=9){var P=new Array;P[0]=new O(this.secondSelectionFace[d],this.secondSelectionFace[d+1],this.secondSelectionFace[d+2]),P[1]=new O(this.secondSelectionFace[d+3],this.secondSelectionFace[d+4],this.secondSelectionFace[d+5]),P[2]=new O(this.secondSelectionFace[d+6],this.secondSelectionFace[d+7],this.secondSelectionFace[d+8]),f=computeDistanceBetweenPolygons(D,P,N,M),this.distance>f&&(this.firstPoint.setFromHoopsPoint(N),this.secondPoint.setFromHoopsPoint(M),this.distance=f)}}if(this.faceData[0]&&this.faceData[1])if(this.faceData[0].type!=Et.CYLINDER_TYPE&&this.faceData[0].type!=Et.CONE_TYPE||this.faceData[1].type!=Et.CYLINDER_TYPE&&this.faceData[1].type!=Et.CONE_TYPE){if(this.faceData[0].type==Et.PLANE_TYPE&&this.faceData[1].type==Et.PLANE_TYPE&&(h=new O(this.firstSurfaceAxis[0].x-this.surfaceCenter[0].x,this.firstSurfaceAxis[0].y-this.surfaceCenter[0].y,this.firstSurfaceAxis[0].z-this.surfaceCenter[0].z),p=new O(this.firstSurfaceAxis[1].x-this.surfaceCenter[1].x,this.firstSurfaceAxis[1].y-this.surfaceCenter[1].y,this.firstSurfaceAxis[1].z-this.surfaceCenter[1].z),h.normalize(),p.normalize(),m=new O(-h.x,-h.y,-h.z),h.equalsWithTolerance(p,1e-5)||m.equalsWithTolerance(p,1e-5))){this.secondPointHelper=new O(this.secondPoint.x,this.secondPoint.y,this.secondPoint.z),this.firstPointHelper=new O(this.firstPoint.x,this.firstPoint.y,this.firstPoint.z);
var I=new R;I.setFromPointAndNormal(this.surfaceCenter[0],h);var F=new R;F.setFromPointAndNormal(this.surfaceCenter[1],p);var L=new O(this.firstPoint.x+h.x,this.firstPoint.y+h.y,this.firstPoint.z+h.z);if(computeIntersectionOfPlaneAndLine(this.firstPoint,L,F,this.secondPoint),m.equalsWithTolerance(p,1e-5)){var U=new O(-h.x,-h.y,-h.z);I.setFromPointAndNormal(this.surfaceCenter[0],U)}var f=Math.abs(F.d-I.d)/Math.sqrt(I.n.x*I.n.x+I.n.y*I.n.y+I.n.z*I.n.z);this.distance=f,this.parallelFaces=!0;var B=new O(0,1,0),j=new O(0,0,0);j.subtract(this.secondPoint,this.firstPoint);var G=new O(0,0,0);G.subtract(this.secondPointHelper,this.firstPoint);var z=computeAngleBetweenVectors(B,j),H=computeAngleBetweenVectors(B,G);.1>z-H&&z-H>-.1?this.pointsOnSameRay=!0:(w=new O(0,0,0),w.subtract(this.secondPointHelper,this.firstPointHelper))}}else h=new O(this.firstSurfaceAxis[0].x-this.surfaceCenter[0].x,this.firstSurfaceAxis[0].y-this.surfaceCenter[0].y,this.firstSurfaceAxis[0].z-this.surfaceCenter[0].z),p=new O(this.firstSurfaceAxis[1].x-this.surfaceCenter[1].x,this.firstSurfaceAxis[1].y-this.surfaceCenter[1].y,this.firstSurfaceAxis[1].z-this.surfaceCenter[1].z),h.normalize(),p.normalize(),m=new O(-h.x,-h.y,-h.z),(h.equalsWithTolerance(p,1e-5)||m.equalsWithTolerance(p,1e-5))&&(w=new O(this.firstPoint.x,this.firstPoint.y,this.firstPoint.z),w.sub(this.surfaceCenter[0]),this.firstPoint.setFromHoopsPoint(this.surfaceCenter[0]),this.secondPoint.set(this.secondPoint.x-w.x,this.secondPoint.y-w.y,this.secondPoint.z-w.z),this.finalizeStage=0,this.cylindersHaveSameOrientation=!0);this.measurementValue=this.distance,this.text=constructMeasurementResultString(this.annotator.state.worldToMM(this.measurementValue),this.annotator.state.unitPreference,this.measurementTextPrefix)}},drawExtra:function(){for(var e="",t=new O(0,0,0),n=new O(0,0,0),i=new O(0,0,0),r=new O(0,0,0),o=new O(0,0,0),a=new O(0,0,0),s=new O(0,0,0),l=0;this.stage>=l;l++)if(null!=this.faceData[l]&&(this.faceData[l].type==Et.CYLINDER_TYPE||this.faceData[l].type==Et.CONE_TYPE)){e="",t=new O(0,0,0),n=new O(0,0,0),i=new O(0,0,0),r=new O(0,0,0),rt(this.annotator,this.surfaceCenter[l],t),rt(this.annotator,this.firstSurfaceAxis[l],n),rt(this.annotator,this.secondSurfaceAxis[l],i);var c;c=this.selected?4:2,e=n.x+","+n.y+" "+i.x+","+i.y;var u;this.cylindersHaveSameOrientation||(u=createSVG("polyline",{points:e,fill:"none",stroke:this.annotator.state.dimColor,"stroke-width":1}),document.getElementById("xmlanchor").appendChild(u)),this.stage&&(r=new O(0,0,0),0==l?rt(this.annotator,this.firstPoint,r):rt(this.annotator,this.secondPoint,r),e=t.x+","+t.y+" "+r.x+","+r.y,u=createSVG("polyline",{points:e,fill:"none",stroke:this.annotator.state.dimColor,"stroke-width":1}),document.getElementById("xmlanchor").appendChild(u))}if(this.stage){e="";var d="a"+this.id;t=new O(0,0,0),n=new O(0,0,0),i=new O(0,0,0),r=new O(0,0,0),rt(this.annotator,this.firstPoint,t),rt(this.annotator,this.secondPoint,n),rt(this.annotator,this.textPosition,i);var c;c=this.selected?3:2,e=t.x+","+t.y+" "+i.x+","+i.y;var h=createSVG("polyline",{id:d,points:e,fill:"none",stroke:this.annotator.state.dimColor,"stroke-width":1});document.getElementById("xmlanchor").appendChild(h),e=t.x+","+t.y+" "+n.x+","+n.y,o=new O((this.firstPoint.x+this.secondPoint.x)/2,(this.firstPoint.y+this.secondPoint.y)/2,(this.firstPoint.z+this.secondPoint.z)/2),a=new O(0,0,0),a.subtract(this.secondPoint,this.firstPoint),s=new O(0,0,0),s.subtract(this.textPosition,o);var p=null;p=2*s.length()>a.length()?createSVG("polyline",{id:d,points:e,fill:"none",stroke:this.annotator.state.dimColor,"stroke-width":c,"marker-end":"url(#Triangle3)","marker-start":"url(#Triangle4)"}):createSVG("polyline",{id:d,points:e,fill:"none",stroke:this.annotator.state.dimColor,"stroke-width":c,"marker-end":"url(#Triangle)","marker-start":"url(#Triangle2)"}),document.getElementById("xmlanchor").appendChild(p);var f=createSVGWithNodeText("text",{id:d,x:i.x,y:i.y,"font-size":12,"font-family":"Verdana",fill:this.annotator.state.dimColor,stroke:"rgb(0, 0, 0)","stroke-width":.2},this.text);if(document.getElementById("xmlanchor").appendChild(f),this.parallelFaces&&this.secondPointHelper){i=new O(0,0,0),rt(this.annotator,this.secondPointHelper,i),r=new O(0,0,0),rt(this.annotator,this.firstPointHelper,r);var m=createSVG("circle",{id:d,cx:i.x,cy:i.y,r:3,fill:this.annotator.state.dimColor});document.getElementById("xmlanchor").appendChild(m);var g=createSVG("circle",{id:d,cx:r.x,cy:r.y,r:3,fill:this.annotator.state.dimColor});document.getElementById("xmlanchor").appendChild(g),e=n.x+","+n.y+" "+i.x+","+i.y;var v=createSVG("polyline",{id:d,points:e,fill:"none",stroke:this.annotator.state.dimColor,"stroke-width":1});document.getElementById("xmlanchor").appendChild(v),e=t.x+","+t.y+" "+r.x+","+r.y;var y=createSVG("polyline",{id:d,points:e,fill:"none",stroke:this.annotator.state.dimColor,"stroke-width":1});document.getElementById("xmlanchor").appendChild(y)}}},update:function(e,t){for(var n=document.getElementById("xmlanchor");n.lastChild;)n.lastChild.id&&-1!=n.lastChild.id.indexOf(this.id)?(n.removeChild(n.lastChild),n=document.getElementById("xmlanchor")):n=n.lastChild;this.annotator.view.markupManager.calculateSelectionRay(e,t);var i=new O(this.annotator.controller.firstSelectionRay.x+1e6*this.annotator.controller.secondSelectionRay.x,this.annotator.controller.firstSelectionRay.y+1e6*this.annotator.controller.secondSelectionRay.y,this.annotator.controller.firstSelectionRay.z+1e6*this.annotator.controller.secondSelectionRay.z),r=new O(0,0,0);r.subtract(this.secondPoint,this.firstPoint),r.normalize();var o=new O(0,0,0);this.annotator.controller.secondSelectionRay.oneVectorCross(o);var a=new O(0,0,0);computeCrossProduct(this.annotator.controller.secondSelectionRay,o,a),a.normalize();var s=new O((this.firstPoint.x+this.secondPoint.x)/2,(this.firstPoint.y+this.secondPoint.y)/2,(this.firstPoint.z+this.secondPoint.z)/2);s.setFromHoopsPoint(this.textPosition),o.set(s.x+o.x,s.y+o.y,s.z+o.z),a.set(s.x+a.x,s.y+a.y,s.z+a.z);var l=new O(0,0,0);if(computeIntersectionOfPlanePointsAndLine(this.annotator.controller.firstSelectionRay,i,s,o,a,l),0==this.finalizeStage)computeDistanceBetweenPointAndLine(l,this.firstPoint,this.secondPoint,this.textPosition);else{var c;if(this.parallelFaces)if(c=new O(0,0,0),this.pointsOnSameRay){c.subtract(this.firstSurfaceAxis[1],this.surfaceCenter[1]),c.normalize();var u=new R;u.n.setFromHoopsPoint(c),u.d=-(this.surfaceCenter[1].x*u.n.x+this.surfaceCenter[1].y*u.n.y+this.surfaceCenter[1].z*u.n.z),computeIntersectionOfPlaneAndLine(this.annotator.controller.firstSelectionRay,i,u,c),void 0==this.planeIntersectionHelper&&(this.planeIntersectionHelper=new O(0,0,0),this.planeIntersectionHelper.setFromHoopsPoint(c)),r=new O(0,0,0),r.subtract(c,this.planeIntersectionHelper),this.planeIntersectionHelper.setFromHoopsPoint(c),this.secondPoint.set(this.secondPoint.x+r.x,this.secondPoint.y+r.y,this.secondPoint.z+r.z),this.firstPoint.set(this.firstPoint.x+r.x,this.firstPoint.y+r.y,this.firstPoint.z+r.z),this.textPosition.set(this.textPosition.x+r.x,this.textPosition.y+r.y,this.textPosition.z+r.z)}else computeDistanceBetweenPointAndLine(l,this.secondPoint,this.secondPointHelper,c),r=new O(0,0,0),r.subtract(c,this.secondPoint),this.secondPoint.setFromHoopsPoint(c),this.firstPoint.set(this.firstPoint.x+r.x,this.firstPoint.y+r.y,this.firstPoint.z+r.z),this.textPosition.set(this.textPosition.x+r.x,this.textPosition.y+r.y,this.textPosition.z+r.z);else c=new O(0,0,0),computeDistanceBetweenPointAndLine(l,this.firstCylinderAxisInfinite[1],this.secondCylinderAxisInfinite[1],c),r=new O(0,0,0),r.subtract(c,this.secondPoint),this.secondPoint.setFromHoopsPoint(c),this.firstPoint.set(this.firstPoint.x+r.x,this.firstPoint.y+r.y,this.firstPoint.z+r.z),this.textPosition.set(this.textPosition.x+r.x,this.textPosition.y+r.y,this.textPosition.z+r.z)}this.drawExtra()},transformAndDrawPointArray:function(e,t,n){for(var i="",r=0;e.length>r;r++){var o=this.annotator.controller.clientH,a=new O(e[r].x,e[r].y,e[r].z),s=new O(0,0,0),l=computeAlternativelyTransformedPoint(a,1,this.annotator.controller.cameraViewMatrix,s),c=.5*s.x/l*this.annotator.controller.clientW,u=.5*s.y/l*o,d=c+.5*this.annotator.controller.clientW,h=o-u-.5*o;i+=d+","+h+" "}var p;p=t?4:2;var f;f=n?createSVG("polyline",{points:i,fill:"none",stroke:this.annotator.state.dimColor,"stroke-width":p}):createSVG("polyline",{points:i,fill:"none",stroke:this.annotator.state.dimColor,"stroke-width":p}),document.getElementById("xmlanchor").appendChild(f)},show:function(){this.visible=!0},hide:function(){this.visible=!1,this.removeSelectionFaces()},remove:function(){}},window.Annotator=e,window.AnnotatorWidget=v,window.AnnotatorButton=y,window.AnnotatorSelectOption=S,window.ANNOTATOR_MODES=mt,window.ANNOTATOR_STAGES=_t,window.ANNOTATOR_CONTEXTS=gt,window.AnnotatorHoopsPoint=O,window.AnnotatorPlaneClass=R,window.AnnotatorBaseModel=T,window.AnnotatorSimpleCamera=F,window.AnnotatorToolbarUI=o,window.AnnotatorRequestor=x}();var TKPP_COMPRESSED=1,TKPP_HAS_EXPLICIT_PRIMITIVE_COUNT=2,TKPP_ONE_PRIMITIVE_ONLY=4,TKPP_GLOBAL_QUANTIZATION=8,TKPP_ZERO_X=256,TKPP_SAME_X=512,TKPP_PER_PRIMITIVE_X=768,TKPP_ZERO_Y=1024,TKPP_SAME_Y=2048,TKPP_PER_PRIMITIVE_Y=3072,TKPP_ZERO_Z=4096,TKPP_SAME_Z=8192,TKPP_PER_PRIMITIVE_Z=12288,TKPP_EXPANDED=32768,TKPP_X_2D_MASK=768,TKPP_Y_2D_MASK=3072,TKPP_Z_2D_MASK=12288,TKPP_ANY_2D_MASK=16128,TKPP_EXPLICIT_PRIMITIVE_MASK=6,TKPP_ONE_PRIMITIVE_ONLY=4,MILLIMETERS="mm",CENTIMETERS="cm",METERS="m",INCHES="in",FEET="ft",FEET_INCHES="feet-inches",ONE_MM_IN_CENTIMETERS=.1,ONE_MM_IN_METERS=.001,ONE_MM_IN_INCHES=.0393701,ONE_MM_IN_FEET=.00328084,MM_LABEL_TEXT="millimeters (mm)",CM_LABEL_TEXT="centimeters (cm)",M_LABEL_TEXT="meters (m)",IN_LABEL_TEXT="inches (in)",FT_LABEL_TEXT="feet (ft)",FT_IN_LABEL_TEXT="feet (ft-in)";(function(){var e=!1,t=/xyz/.test(function(){})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(n){function i(){!e&&this.init&&this.init.apply(this,arguments)}var r=this.prototype;e=!0;var o=new this;e=!1;for(var a in n)o[a]="function"==typeof n[a]&&"function"==typeof r[a]&&t.test(n[a])?function(e,t){return function(){var n=this._super;this._super=r[e];var i=t.apply(this,arguments);return this._super=n,i}}(a,n[a]):n[a];return i.prototype=o,i.prototype.constructor=i,i.extend=arguments.callee,i}})(),function(){function e(e,t,n){for(var i=0;e>i;i++){var r=t[2*i],o=t[2*i+1],a=Math.sin(o);n[3*i]=a*Math.cos(r),n[3*i+1]=Math.cos(o),n[3*i+2]=a*Math.sin(r)}}function t(e){return e&nt}function n(e){return e&it}function i(e){return e&rt}function r(e){return(e&nt)==X}function o(e){return(e&nt)==q}function a(e){return(e&nt)==J}function s(e){return(e&it)==K}function l(e){return(e&it)==Q}function c(e){return(e&it)==Y}function u(e){return(e&rt)==tt}function d(e){return(e&rt)==Z}function h(e){return(e&rt)==et}function p(e){var r=0;return t(e)||r++,n(e)||r++,i(e)||r++,r}function f(e,t,n){var i=0;switch(e&nt){case q:break;case J:i+=1;break;case X:i+=t;break;case 0:i+=n}switch(e&it){case Q:break;case Y:i+=1;break;case K:i+=t;break;case 0:i+=n}switch(e&rt){case Z:break;case et:i+=1;break;case tt:i+=t;break;case 0:i+=n}return i}function m(e,p,f,m,g,v){for(var y=0,b=0;e>b;b++)t(g)||(v[3*b+0]=p[y++]),n(g)||(v[3*b+1]=p[y++]),i(g)||(v[3*b+2]=p[y++]);var _=0;if(t(g))if(_=0,r(g))for(var b=0;f>b;b++){for(var w=0;m[b]>w;w++)v[_]=p[y],_+=3;y++}else if(a(g)){for(var b=0;e>b;b++)v[_]=p[y],_+=3;y++}else if(o(g))for(var b=0;e>b;b++)v[_]=0,_+=3;if(n(g))if(_=1,s(g))for(var b=0;f>b;b++){for(var w=0;m[b]>w;w++)v[_]=p[y],_+=3;y++}else if(c(g)){for(var b=0;e>b;b++)v[_]=p[y],_+=3;y++}else if(l(g))for(var b=0;e>b;b++)v[_]=0,_+=3;if(i(g))if(_=2,u(g))for(var b=0;f>b;b++){for(var w=0;m[b]>w;w++)v[_]=p[y],_+=3;y++}else if(h(g)){for(var b=0;e>b;b++)v[_]=p[y],_+=3;y++}else if(d(g))for(var b=0;e>b;b++)v[_]=0,_+=3}var g,v,y,b,_,w=3,S=4,x=5,C=128,$=16,E=8,T=0,k=19,A=51,N=11,M=28,D=5,P=128,I=32768,F=8388608,L=32768,O=16,R=8,U=16,B=24,j=0,G=3,z=1,H=2,V=2,W=4,q=256,J=512,X=768,Q=1024,Y=2048,K=3072,Z=4096,et=8192,tt=12288,nt=768,it=3072,rt=12288,ot=16128,at=6,W=4,st={parseHSF:function(e){for(this.numtoken=0,this.lastperc=0,this.activeNode[0]=this.modelNode,this.activeSubnode[0]=this.modelNode,this.byteArray=e,this.currentBytePos=0,this.bounding_min=this.boundingMinimum,this.bounding_max=this.boundingMaximum,this.open_segments=this.openSegments,this.tree_children=this.treeChildren,this.tree_closure=this.treeClosure,this.tree_childset=this.treeChildset,this.texture_name=this.textureName,this.current_lightson=this.currentLightStatuses,this.current_color=this.currentColor,this.colors_set=this.colorsSet,this.current_transparency=this.currentTransparencyStatuses,this.baseTag=this.currentTag,g=this.annotator.view,v=this,g.default_camera=g.defaultCamera,_=this.annotator.state,_.m_showBackfaces=_.showBackFaces,b=AnnotatorSimpleCamera,y=AnnotatorHoopsPoint,this.treelevel=0;;){80==v.numtoken&&(v.numtoken=v.numtoken),v.numtoken++;var t=v.byteArray[v.currentBytePos++];switch(t){case 59:v.parseTK_Comment(v.byteArray);break;case 73:v.parseTK_File_Info(v.byteArray);break;case 98:case 66:v.parseTK_Bounding(v.byteArray);break;case 125:v.parseTK_Camera(v.byteArray);break;case 118:v.parseTK_User_Value(v.byteArray);break;case 109:v.parseTK_User_Index_Data(v.byteArray);break;case 85:v.parseTK_User_Options(v.byteArray);break;case 22:v.parseTK_Unicode_Options(v.byteArray);break;case 72:v.parseTK_Heuristics(v.byteArray);break;case 86:v.parseTK_Visibility(v.byteArray);break;case 40:v.validFileSecurity()||console.log("Security mark not found in file."),v.parseTK_Open_Segment(v.byteArray);break;case 114:v.parseTK_Reference(v.byteArray);break;case 76:v.parseTK_Polypoint(v.byteArray);break;case 108:v.parseTK_Line(v.byteArray);break;case 41:v.parseTK_Close_Segment(v.byteArray);break;case 83:v.parseTK_Shell(v.byteArray);break;case 37:v.parseTK_Matrix(v.byteArray);break;case 113:v.parseTK_Tag(v.byteArray);break;case 126:v.parseTK_Color_RGB(v.byteArray);break;case 16:v.parseTK_PolyPolypoint(v.byteArray);break;case 34:v.parseTK_Color(v.byteArray);break;case 116:v.parseTK_Texture(v.byteArray);break;case 105:v.parseTK_Image(v.byteArray);break;case 12:v.parseTK_Color_Map(v.byteArray);break;case 1:break;default:var n="Unknown token: "+t+" at: "+v.numtoken;throw console.log(n),new Error(n)}if(1==t)break}return v.ensureWorldSpaceIsMM(),!0},ensureWorldSpaceIsMM:function(){var e=this.hwfToMM();1!=e&&this.modelNode.insert("node",{type:"matrix",elements:SceneJS_math_scalingMat4s(e),id:"units-scale-"+this.modelNode.get("id")})},hwfToMM:function(){return v.getFileVersion()>=1.11?this.modelUnits:1},validFileSecurity:function(){if(this.checkedValid)return!0;var e=!0,t=parseFloat(v.getFileVersion());return(void 0===t||0==t||isNaN(t))&&(e=!1),t>=1.05&&this.nodecounter>0&&!this.validSecurityMark&&(e=!1),this.checkedValid=!0,e},parseTK_Heuristics:function(e){var t=this.toShortFromArray(e);if(t&L){var n=this.toShortFromArray(e);t|=n<<O}var i=this.toShortFromArray(e);if(t&L){var n=this.toShortFromArray(e);i|=n<<O}},parseTK_Visibility:function(e){var t=e[this.currentBytePos++],n=e[this.currentBytePos++];if(t&P){var i=this.toShortFromArray(e);t|=i<<R}if(t&P){var i=this.toShortFromArray(e);n|=i<<R}if(t&F){var r=e[this.currentBytePos++];t|=r<<B}if(t&F){var r=e[this.currentBytePos++];n|=r<<B}},capitalise:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},parseTK_User_Value:function(e){var t=this.toIntFromArray(e);255==t&&(g.drawingMode=!0)},parseTK_User_Options:function(){function e(e,t){var n=e.indexOf(t+"=");if(n>0&&(n=e.indexOf(","+t+"="),n>=0&&n++),n>=0){var i=e.substr(n+t.length+1);return n=i.indexOf(","),n>=0&&(i=i.substr(0,n)),i}return null}return function(t){var n=this.toShortFromArray(t),i=this.toStringFromArray(t,n),r=this.getSegmentProperties(this.open_segments[this.segmentLevel]),o=this.parseUserAttributes(i,r);o.length&&(r.userAttributes=o),i.indexOf("lights_off")>=0&&(this.current_lightson[this.segmentLevel]=!1);var a,s=this.open_segments[this.segmentLevel];if(a=e(i,"brep_properties"),null!==a){var r=this.getSegmentProperties(this.open_segments[this.segmentLevel]),l=a.split(" ");"-1.#IND00"!=l[2]?r.gravityCenter=new y(parseFloat(l[2]),parseFloat(l[3]),parseFloat(l[4])):(r.gravityCenter=new y(0,0,0),r.gravityCenterInvalid=!0),r.surfaceArea=parseFloat(l[0]),r.volume=parseFloat(l[1])}var r,r;if(a=e(i,"prc_hidden"),null!==a){var r=this.getSegmentProperties(this.open_segments[this.segmentLevel]);r.hidden=!0}if(a=e(i,"hwf_version"),null!==a&&(this.m_fileVersion=a),a=e(i,"filename"),null!==a&&(this.filename=a),a=e(i,"optimized_parts"),null!==a&&(this.optimized_parts=!0),a=e(i,"model_units"),null!==a&&(this.modelUnits=parseFloat(a)),a=e(i,"cad_cap_defns"),null!==a){var c=this.captureManager.parseCaptureDefinitions(a,v.getFileVersion());1==c&&(this.defaultCaptureOnly=!0)}if(a=e(i,"cad_cap_style_defns"),null!==a&&this.captureManager.parseCaptureStyleDefinitions(a),a=e(i,"cad_default_capture"),null!==a&&this.captureManager.parseDefaultCapture(a),a=e(i,"cm"),null!==a&&this.captureManager.parseCaptureMarkup(a,s),a=e(i,"cn"),null!==a&&(this.captureManager.parseCaptureNonStyles(a,s),this.defaultCaptureOnly||(this.segmentVisibilities[s]=!1)),a=e(i,"cs"),null!==a){var u=this.captureManager.parseCaptureStyles(a,s);!u.empty()}}}(),parseTK_Unicode_Options:function(e){var t=this.toShortFromArray(e),n="";n=this.toStringFromArray(e,2*t)},parseTK_Matrix:function(e){var t=new Array;t[3]=t[7]=t[11]=0,t[0]=this.toFloatFromArray(e),t[1]=this.toFloatFromArray(e),t[2]=this.toFloatFromArray(e),t[4]=this.toFloatFromArray(e),t[5]=this.toFloatFromArray(e),t[6]=this.toFloatFromArray(e),t[8]=this.toFloatFromArray(e),t[9]=this.toFloatFromArray(e),t[10]=this.toFloatFromArray(e),t[12]=this.toFloatFromArray(e),t[13]=this.toFloatFromArray(e),t[14]=this.toFloatFromArray(e),t[15]=1,this.activeSubnode[this.segmentLevel].insert("node",{type:"matrix",elements:t});var n=this.getSegmentProperties(this.open_segments[this.segmentLevel]);n.matrix=t,this.activeNode[this.segmentLevel]==this.activeSubnode[this.segmentLevel]&&(this.activeSubnode[this.segmentLevel]=this.activeNode[this.segmentLevel].node(this.activeNode[this.segmentLevel]._targetNode.children.length-1))},parseTK_User_Index_Data:function(e){var t=this.toIntFromArray(e);current_value=0;for(var n=0;t>n;n++)switch(current_value){case 0:var i=this.toIntFromArray(e);current_value++;case 1:var r=this.toIntFromArray(e);current_value++;case 2:if(1==i){var o=this.open_segments[this.segmentLevel],a="";a=this.toStringFromArray(e,r);var s=a.split(",");this.boundingHash["bh"+o]=new Array;for(var l=0;6>l;l++)this.boundingHash["bh"+o][l]=parseFloat(s[l])}else if(23==i)pmiData=this.toStringFromArray(e,r);else if(24==i)this.currentBytePos+=r;else if(26==i){var o=this.open_segments[this.segmentLevel],c=this.toIntFromArray(e);this.mapIdMapper[c]=o;var u=this.getSegmentProperties(o);u.mapId=c}else if(27==i){var d=this.toIntFromArray(e),h=0;for(h=0;d>h;h++){var p=this.toIntFromArray(e);if(0==p)break;var f,m=this.toIntFromArray(e);for(this.mapIdAssociativityMapperInverse[m]=new Array,f=0;p>f;f++)this.mapIdAssociativityMapperInverse[m][f]=this.toIntFromArray(e)}for(h=0;d>h;h++){var p=this.toIntFromArray(e);if(0==p)break;var f,m=this.toIntFromArray(e);for(this.mapIdAssociativityMapper[m]=new Array,f=0;p>f;f++)this.mapIdAssociativityMapper[m][f]=this.toIntFromArray(e)}}else if(25==i)this.currentBytePos+=r;else if(22==i){var g="";g=this.toStringFromArray(e,r),""!=g&&(v.hasBrepInfo=!0),this.annotator.view.markupManager.updateMeasurementPopup();var u=this.getSegmentProperties(this.open_segments[this.segmentLevel]);u.polylineData=new Array,u.faceData=new Array;for(var y=g.split(","),b=0;y.length>b;b++){var C=y[b].split(" "),$=parseInt(C[0]),E=parseInt(C[1]);E==w?u.faceData[$]=this.geometryInfo.getCylinderBrepInfo(E,parseFloat(C[2]),parseFloat(C[3]),parseFloat(C[4]),parseFloat(C[5]),parseFloat(C[6]),parseFloat(C[7]),parseFloat(C[8]),0):E==S?u.faceData[$]=this.geometryInfo.getPlaneBrepInfo(E,parseFloat(C[2]),parseFloat(C[3]),parseFloat(C[4]),parseFloat(C[5]),parseFloat(C[6]),parseFloat(C[7])):E==x?u.faceData[$]=this.geometryInfo.getCylinderBrepInfo(E,parseFloat(C[2]),parseFloat(C[3]),parseFloat(C[4]),parseFloat(C[5]),parseFloat(C[6]),parseFloat(C[7]),parseFloat(C[8]),parseFloat(C[9])):u.polylineData[$]=this.geometryInfo.getCircleBrepInfo(E,parseFloat(C[2]),parseFloat(C[3]),parseFloat(C[4]),parseFloat(C[5]),parseFloat(C[6]),parseFloat(C[7]),parseFloat(C[8]))}}else if(1802331507==i){var T=this.toStringFromArray(e,r);"hoops_converter"==T&&(this.validSecurityMark=!0)}else{new Array;var k="";k=this.toStringFromArray(e,r),k=ct.decode(k),k=k.replace(/"/gi," ");var u=this.getSegmentProperties(this.open_segments[this.segmentLevel]);if(u.mapId&&this.annotator.converterData&&this.annotator.converterData.id_map&&this.annotator.converterData.id_map[u.mapId]){var A=this.annotator.converterData.id_map[u.mapId].product_flag;(8==A||9==A)&&(u.isConfiguration=!0)}u.name=k,current_value++,this.tree_children[this.treelevel]++;var o,N="",E="unknown";0==this.treelevel?(E="root",N="viewer_images/document_icon.png",o=this.open_segments[this.segmentLevel],this.firstNode=o):(this.modeltree_exists=!0,o=this.open_segments[this.segmentLevel],N=-1!=this.currentSegmentName.indexOf("part")?"viewer_images/part_icon2.png":-1!=this.currentSegmentName.indexOf("product")?"viewer_images/assembly_icon2.png":"viewer_images/body_icon2.png",-1!=this.currentSegmentName.indexOf("part")?(N="viewer_images/part_icon2.png",E="part"):-1!=this.currentSegmentName.indexOf("product")?(N="viewer_images/assembly_icon2.png",E="product"):(N="viewer_images/body_icon2.png",E="body"));var M=this.parentStack[this.parentStack.length-1],D=o,P=k;this.treelevel>0&&!this.tree_childset[this.treelevel-1]&&(this.modelTree.openChildren(),this.tree_childset[this.treelevel-1]=!0),(0==this.treelevel||1==this.tree_childset[this.treelevel-1])&&this.parentStack.push(D),this.treelevel>=0&&this.modelTree.addElement(k,"s"+o,"",u.visible,u.isConfiguration),this.tree_closure[this.segmentLevel]=!0,this.treelevel++,1==_.m_bShowModelBrowser&&_.callbackManager.trigger("modelParse",[P,M,E,D])}case 3:current_value=0}},parseTK_PolyPolypoint:function(e){var t=this.toShortFromArray(e);p(t);var n=0,i=this.toIntFromArray(e);t&at&&(t&W?n=1:t&V&&(primtive_count=this.toIntFromArray(e)));var r=new Array;if(t&at)this.toIntArrayFromArray(e,r,n);else{for(var o=0;i>o;)r[n]=this.toIntFromArray(e),o+=r[n],n++;v.currentTag+=n-1}var a=f(t,n,i),s=new Array(s);if(this.toFloatArrayFromArray(e,s,a),t&ot){var l=new Array;m(i,s,n,r,t,l);for(var c=0;l.length>c;c++)s[c]=l[c]}for(var u=[],d=0,h=0;n>h;h++){for(var g=0;r[h]-1>g;g++)u.push(d,d+1),d++;d++}var y={r:0,g:0,b:0},b=null;if(this.processingIncludes){var w=new Object;w.tag=v.currentTag,w.isEdge=!0,this.tempIncludeList[this.tempIncludeListLength++]=w,b={type:"geometry",id:"li-"+v.currentTag,coreId:"cid"+v.currentTag,primitive:"lines",positions:s,indices:u}}else b={type:"geometry",primitive:"lines",positions:s,indices:u};var S={type:"material",emit:.5,baseColor:y,nodes:[b]};if(this.processingIncludes)this.libraryNode.add("node",b);else{var x={type:"flags",id:"ev"+v.currentTag,flags:{enabled:!0,lowculled:Number.MAX_VALUE,backfaces:_.m_showBackfaces,transparent:!1},nodes:[S]};this.activeSubnode[this.segmentLevel].add("node",x)}},parseTK_Polypoint:function(e){var t=this.toIntFromArray(e),n=new Array;this.toFloatArrayFromArray(e,n,3*t),indices=[];for(var i=0;t>i;i++)indices.push(i);var r={r:this.current_color[this.segmentLevel][0],g:this.current_color[this.segmentLevel][1],b:this.current_color[this.segmentLevel][2]},o={type:"geometry",primitive:"lines",positions:n,indices:indices},a={type:"material",emit:1,baseColor:r,nodes:[o]};this.activeSubnode[this.segmentLevel].add("node",a)},parseTK_Line:function(e){var t=new Array;this.toFloatArrayFromArray(e,t,6),indices=[];for(var n=0;2>n;n++)indices.push(n);var i={r:this.current_color[this.segmentLevel][0],g:this.current_color[this.segmentLevel][1],b:this.current_color[this.segmentLevel][2]},r={type:"geometry",primitive:"lines",positions:t,indices:indices},o={type:"material",emit:1,baseColor:i,nodes:[r]};this.activeSubnode[this.segmentLevel].add("node",o)},parseTK_Reference:function(e){var t=this.toIntFromArray(e)+this.baseTag;e[this.currentBytePos++];var n=this.includeHash["ih"+t].length,i=_.m_showBackfaces;0==this.current_lightson[this.segmentLevel]&&(i=!0);for(var r=this.isProcessingSurfaceBody()?"sb:cids":"cids",o=0;n>o;o++){var a,s=this.includeHash["ih"+t][o],l={type:"geometry",id:r+this.coreCount+"-"+s.tag,coreId:"cid"+s.tag},c=l;if(s.isEdge){a="ev"+this.coreCount+"-"+s.tag;var c={type:"material",emit:.5,baseColor:{r:0,g:0,b:0},nodes:[l]}}else a="fv"+this.coreCount+"-"+s.tag;var u;u=this.current_transparency[this.segmentLevel]>0?!0:!1;var d={type:"flags",id:a,flags:{enabled:!0,lowculled:Number.MAX_VALUE,backfaces:i,transparent:u},nodes:[c]};this.processingIncludes||this.activeSubnode[this.segmentLevel].add("node",d),this.coreCount++}},parseTK_Image:function(e){var t=15,n=4294967280,i=128,r=[];this.toFloatArrayFromArray(e,r,3);var o=this.toIntFromArray(e),a=o&t;o&=n;var s=-1,l=0;if(0!=(o&i)){if(-1==s){var c=e[this.currentBytePos++];s=c}l=255==s?this.toIntFromArray(e):s}var u="";0!=(o&i)&&(u=this.toStringFromArray(e,l));var d=[];this.toIntArrayFromArray(e,d,2),e[this.currentBytePos++];var h=this.toIntFromArray(e),p=new Uint8Array(h);this.toByteArrayFromArray(e,p,h);var f=new Blob([p],{type:"image/jpg"});if(this.imageResources[u]=window.URL.createObjectURL(f),7!=a){var c=e[this.currentBytePos++];if(0!=c){var m=this.toIntFromArray(e),g=new Array;this.toByteArrayFromArray(e,g,m)}else c=e[this.currentBytePos++]}},parseTK_Shell:function(t){var n=t[this.currentBytePos++],i=0,r=0;n&C&&(i=this.toShortFromArray(t)),n&$||(r=this.toIntFromArray(t)),t[this.currentBytePos++];var o=this.toIntFromArray(t),a=new Array;this.toFloatArrayFromArray(t,a,3*o);var s=t[this.currentBytePos++],l=this.toIntFromArray(t),c=t[this.currentBytePos++],u=new Array,d=0;32==c&&(d=(l-1)/4,this.toIntArrayFromArray(t,u,d)),16==c&&(d=(l-1)/2,this.toShortArrayFromArray(t,u,d)),8==c&&(d=l-1,this.toByteArrayFromArray(t,u,d));var h=null,p=void 0,f=!1;if(n&E){h=new Array;for(var m=null;;){if(this.currentBytePos>t.length)throw new Error("Out of byte array bounds. Truncated file?");var g=t[this.currentBytePos++];if(g==T)break;if(g==k){var b=new Array;this.toFloatArrayFromArray(t,b,2*o),e(o,b,h)}else if(g==M){paramWidth=t[this.currentBytePos++];var w=paramWidth*o;m=[],3==paramWidth?this.readUVPairsFromByteArray(t,m,w):this.toFloatArrayFromArray(t,m,w)}else if(g==N){var s=t[this.currentBytePos++],S=new Array;this.toFloatArrayFromArray(t,S,6);var c=t[this.currentBytePos++],l=this.toIntFromArray(t),x=new Array;p=new Array,this.toIntArrayFromArray(t,x,l/4),this.unquantize_and_unpack_floats(o,1,c,S,x,p)}else if(g==D){f=!0;var P=new Array;P[0]=0,P[1]=0,P[2]=0,P[3]=1,P[4]=1,P[5]=1;var s=t[this.currentBytePos++],c=t[this.currentBytePos++],l=this.toIntFromArray(t),x=new Array;p=new Array,this.toByteArrayFromArray(t,x,l),this.unquantize_and_unpack_floats(o,3,c,P,x,p)}else if(g==A){var l=0,s=t[this.currentBytePos++];if(0!=(3&s))switch(24&s){case 0:l=this.toIntFromArray(t);break;case 8:l=t[this.currentBytePos++];break;case 16:l=this.toShortFromArray(t)}switch(3&s){case 0:for(var I=0,F=0,L=0;d>I;)F=u[I]>0?u[I]:-u[I],L+=F-2,I+=F+1;l=L;break;case 1:break;case 2:l=1+l;break;case 3:l=2*l}l*=4,this.extraShellData[v.currentTag]=new Array;var O=new Array,R=l/4;switch(24&s){case 0:return this.toIntArrayFromArray(t,O,R),status;case 8:this.toByteArrayFromArray(t,O,R);break;case 16:this.toShortArrayFromArray(t,O,R)}var U=l/4;switch(3&s){case 0:for(var I=0;U>I;I++)this.extraShellData[v.currentTag][I]=O[I];break;case 3:for(var B=0,I=0;U>I;I+=2)for(var j=0;O[I+1]>j;j++)this.extraShellData[v.currentTag][B++]=O[I]}}}}var G=0,z=0;cache=[0,0,0],indices=[];for(var H,I=0;d>I;++I)switch(G){case 0:z=u[I],z>0&&(G=1);break;case 1:cache[0]=u[I],--z,G=0==z?0:2;break;case 2:cache[1]=u[I],--z,G=0==z?0:3;break;case 3:cache[2]=u[I],indices.push(cache[0],cache[1],cache[2]),--z,G=0==z?0:4,H=1;break;case 4:cache[0]=cache[1],cache[1]=cache[2],cache[2]=u[I],1==H?indices.push(cache[2],cache[1],cache[0]):indices.push(cache[0],cache[1],cache[2]),H=-H,--z,0==z&&(G=0)}var V=(this.isProcessingSurfaceBody()?"sb:sh-":"sh-")+v.currentTag,W=void 0;if(void 0!=p)if(W=new Array,f)for(I=0;o>I;I++)W[4*I]=p[3*I],W[4*I+1]=p[3*I+1],W[4*I+2]=p[3*I+2],W[4*I+3]=1;else for(I=0;o>I;I++){var q=Math.floor(p[I]),J=Math.ceil(p[I]),X=J-p[I],Q=new y(this.colorMap[3*q],this.colorMap[3*q+1],this.colorMap[3*q+2]),Y=new y(this.colorMap[3*J],this.colorMap[3*J+1],this.colorMap[3*J+2]),K=new y(Y.x-Q.x,Y.y-Q.y,Y.z-Q.z);W[4*I]=Q.x+X*K.x,W[4*I+1]=Q.y+X*K.y,W[4*I+2]=Q.z+X*K.z,W[4*I+3]=1}if(32!=c)if(this.processingIncludes){var Z=new Object;Z.tag=v.currentTag,Z.isEdge=!1,this.tempIncludeList[this.tempIncludeListLength++]=Z,this.libraryNode.add("node",{type:"geometry",id:V,coreId:"cid"+v.currentTag,primitive:"triangles",positions:a,normals:h,indices:indices,colors:W,uv:m})}else{isTransparent=this.current_transparency[this.segmentLevel]>0?!0:!1;var et=_.m_showBackfaces;0==this.current_lightson[this.segmentLevel]&&(et=!0);var tt={type:"geometry",id:V,primitive:"triangles",positions:a,normals:h,indices:indices,colors:W,uv:m},nt={type:"flags",id:"fv"+v.currentTag,flags:{enabled:!0,lowculled:Number.MAX_VALUE,backfaces:et,transparent:isTransparent},nodes:[tt]};this.activeSubnode[this.segmentLevel].add("node",nt)}},parseTK_Open_Segment:function(e){this.segmentLevel++,this.current_lightson[this.segmentLevel]=!0;var t=e[this.currentBytePos++];255==t&&(t=this.toIntFromArray(e));var n="";n=this.toStringFromArray(e,t),this.processingIncludes&&this.processingIncludes++,("new_includes"==n||"zzz_new_includes"==n)&&(this.processingIncludes=1);var i=-1;if(this.currentSegmentName=n,-1!=n.indexOf("representation")){var r=n.split("representation item ");i=parseInt(r[1]),this.isPart=1}else this.isPart>0&&this.isPart++;"all_markup"==n?(this.readingMarkup=!0,this.activeSubnode[this.segmentLevel-1].add("node",{id:"all_markup~"+this.nodeIdSuffix})):this.activeSubnode[this.segmentLevel-1].add("node",{id:"s"+this.nodecounter}),this.activeSubnode[this.segmentLevel]=this.activeSubnode[this.segmentLevel-1].node(this.activeSubnode[this.segmentLevel-1]._targetNode.children.length-1),"new_frames"==n&&(this.frameNode=this.activeSubnode[this.segmentLevel]),this.activeNode[this.segmentLevel]=this.activeSubnode[this.segmentLevel],this.open_segments[this.segmentLevel]=this.nodecounter,this.current_color[this.segmentLevel][0]=this.current_color[this.segmentLevel-1][0],this.current_color[this.segmentLevel][1]=this.current_color[this.segmentLevel-1][1],this.current_color[this.segmentLevel][2]=this.current_color[this.segmentLevel-1][2],this.colors_set[this.segmentLevel]=0,this.current_transparency[this.segmentLevel]=this.current_transparency[this.segmentLevel-1],this.nodecounter++;var o=v.getSegmentProperties(this.open_segments[this.segmentLevel]);o.segmentName=n},parseTK_Close_Segment:function(){if(this.processingIncludes>0){if(this.processingIncludes>1){this.includeHash["ih"+v.currentTag]=new Array;for(var e=0;this.tempIncludeListLength>e;e++)this.includeHash["ih"+v.currentTag][e]=this.tempIncludeList[e];this.includeHash["ih"+v.currentTag].length}this.processingIncludes--,this.tempIncludeListLength=0}this.applyCurrentColorToNode(this.activeNode[this.segmentLevel],this.current_lightson[this.segmentLevel]);var t=this.segmentVisibilities.hasOwnProperty(this.open_segments[this.segmentLevel]),n=v.getSegmentProperties(this.open_segments[this.segmentLevel]),i=!0,r=!1;"all_markup"==n.segmentName&&(r=!0,this.readingMarkup=!1),r||n.hidden?(i=!1,t=!0):i=t?this.segmentVisibilities[this.open_segments[this.segmentLevel]]:!0;var n=v.getSegmentProperties(this.open_segments[this.segmentLevel]);if(n.visible=i,n.transparent=this.colors_set[this.segmentLevel]&H,n.fixupNodes(this.activeNode[this.segmentLevel],n.transparent,!this.current_lightson[this.segmentLevel]),t&&(n.baseVisibility=n.visible,n.baseVisibilitySet=!0,n.setVisibilityFromNode(v,this.activeNode[this.segmentLevel],this.current_lightson[this.segmentLevel],!1)),-1!=n.segmentName.indexOf("markup ")){this.activeNode[this.segmentLevel].insert("node",{type:"node",id:"pmin"+this.open_segments[this.segmentLevel]});var o=this.activeNode[this.segmentLevel].node(this.activeNode[this.segmentLevel]._targetNode.children.length-1);o.insert("node",{type:"shaderParams",params:{colorTransEnabled:!1}}),this.texture_name[this.segmentLevel]?o.insert("node",{type:"shader",coreId:"texturedShader"}):o.insert("node",{type:"shader",coreId:"colorTransShader"}),n.visible=!1,n.baseVisibility=!1,n.baseVisibilitySet=!0,n.setVisibilityFromNode(v,this.activeNode[this.segmentLevel],this.current_lightson[this.segmentLevel],!1)
}if(1==this.isPart){this.activeNode[this.segmentLevel].insert("node",{type:"name",name:"s"+this.open_segments[this.segmentLevel]});var o=this.activeNode[this.segmentLevel].node(this.activeNode[this.segmentLevel]._targetNode.children.length-1);o.insert("node",{type:"shaderParams",params:{colorTransEnabled:!1,colorHighlightEnabled:!1,mixColor:[0,0,0],mixColorValue:0,alphaTransEnabled:!1,alphaTransValue:1}}),this.texture_name[this.segmentLevel]?o.insert("node",{type:"shader",coreId:"texturedShader"}):o.insert("node",{type:"shader",coreId:"colorTransShader"}),n.transparent=this.colors_set[this.segmentLevel]&H?!0:!1}this.isPart>0&&this.isPart--,1==this.tree_closure[this.segmentLevel]&&(t&&this.modelTree.activeElement&&this.modelTree.activeElement.updateNodeVisibility(n.visible),this.treelevel--,this.modelTree.closeChildren(),this.treelevel>=0&&(this.tree_childset[this.treelevel]=!1),this.tree_closure[this.segmentLevel]=!1,this.parentStack.pop()),this.nodecounter++,this.texture_name[this.segmentLevel]=null,this.segmentLevel--},parseTK_Texture:function(e){var t=1,n=e[this.currentBytePos++];255==n&&(n=this.toIntFromArray(e));var i=this.toStringFromArray(e,n);n=e[this.currentBytePos++],255==n&&(n=this.toIntFromArray(e));var r=this.toStringFromArray(e,n),o=this.imageResources[r];o&&(this.textureResources[i]=o);var a=this.toShortFromArray(e);0!=(a&t)&&e[this.currentBytePos++]},parseTK_Color:function(e){var t=e[this.currentBytePos++];if(0!=(t&P)){var n=e[this.currentBytePos++];t|=n<<R}if(0!=(t&I)){var n=e[this.currentBytePos++];t|=n<<U}if(0!=(t&F)){var n=e[this.currentBytePos++];t|=n<<B}var i=e[this.currentBytePos++],r=0;if(0!=(i&1<<j)&&(r=e[this.currentBytePos++]),0!=(i&1<<j))if(0!=r){var o=this.toStringFromArray(e,r),a=/r=([\.\d]*) g=([\.\d]*) b=([\.\d]*) (\w*)/.exec(o);void 0!=a&&(this.current_color[this.segmentLevel][0]=parseFloat(a[1]),this.current_color[this.segmentLevel][1]=parseFloat(a[2]),this.current_color[this.segmentLevel][2]=parseFloat(a[3]),this.colors_set[this.segmentLevel]|=z,this.texture_name[this.segmentLevel]=a[4])}else{var s=new Array;this.bytes_to_floats(e,s,3),this.current_color[this.segmentLevel][0]=s[0],this.current_color[this.segmentLevel][1]=s[1],this.current_color[this.segmentLevel][2]=s[2],this.colors_set[this.segmentLevel]|=z}if(0!=(i&1<<G))var n=e[this.currentBytePos++];if(0!=(i&1<<G)){var s=new Array;this.bytes_to_floats(e,s,3),0!=s[0]&&(this.current_transparency[this.segmentLevel]=s[0],this.colors_set[this.segmentLevel]|=H)}},parseTK_Color_RGB:function(e){var t=e[this.currentBytePos++];if(0!=(t&P)){var n=e[this.currentBytePos++];t|=n<<R}if(0!=(t&I)){var n=e[this.currentBytePos++];t|=n<<U}if(0!=(t&F)){var n=e[this.currentBytePos++];t|=n<<B}var i=new Array;this.bytes_to_floats(e,i,3),this.current_color[this.segmentLevel][0]=i[0],this.current_color[this.segmentLevel][1]=i[1],this.current_color[this.segmentLevel][2]=i[2],this.colors_set[this.segmentLevel]|=z},parseTK_Camera:function(e){var t=0,n=1;g.cameraSet=!0;var i=e[this.currentBytePos++];if(i!=t&&i!=n)throw new Error("unsupported camera projection");var r=[];this.toFloatArrayFromArray(e,r,11),g.default_camera=new b,g.default_camera.pos={x:r[0],y:r[1],z:r[2]},g.default_camera.tar={x:r[3],y:r[4],z:r[5]},g.default_camera.up={x:r[6],y:r[7],z:r[8]},g.default_camera.width=r[9],g.default_camera.height=r[10],g.default_camera.proj=i==t?"orthographic":"perspective";var o=e[this.currentBytePos++];this.currentBytePos+=o},parseTK_Color_Map:function(e){var t=e[this.currentBytePos++],n=this.toIntFromArray(e);0==t&&this.bytes_to_floats(e,this.colorMap,3*n)},parseTK_Bounding:function(e){var t=e[this.currentBytePos++],n=new Array;0==t?(this.toFloatArrayFromArray(e,n,6),this.bounding_min.set(n[0],n[1],n[2]),this.bounding_max.set(n[3],n[4],n[5])):this.toFloatArrayFromArray(e,n,4)},parseTK_Tag:function(){v.currentTag++},parseTK_File_Info:function(){this.currentBytePos+=4},parseTK_Comment:function(e){for(var t="";;){if(this.currentBytePos>e.length)throw new Error("Out of byte array bounds. Truncated file?");if(t+=String.fromCharCode(e[this.currentBytePos]),10==e[this.currentBytePos++])break}},createTextureNode:function(e){var t={type:"texture",layers:[{uri:this.textureResources[e],uri:this.textureResources[e],wrapS:"repeat",wrapT:"repeat"}]};return t},parseUserAttributes:function(e,t){for(var n=e.split(","),i=new Array,r=0,o=0;n.length>o;o++)if(-1==n[o].indexOf("brep_properties")&&-1==n[o].indexOf("hx3d_type")){if(i[r]=ct.decode(n[o]),i[r]=ct.decode(n[o].replace(/\`+/g,"")),i[r]=i[r].replace(/\\/g,"sLaSh"),-1!=i[r].indexOf("globalid"))if(t.cadId=i[r].split("=")[1],void 0!=this.cadIdMapper[t.cadId])if(this.cadIdMapper[t.cadId]instanceof Array)this.cadIdMapper[t.cadId].push(this.open_segments[this.segmentLevel]);else{var a=this.cadIdMapper[t.cadId];this.cadIdMapper[t.cadId]=new Array,this.cadIdMapper[t.cadId].push(a),this.cadIdMapper[t.cadId].push(this.open_segments[this.segmentLevel])}else this.cadIdMapper[t.cadId]=this.open_segments[this.segmentLevel];r++}return i},applyCurrentColorToNode:function(e,t){var n=t?0:1,i={r:this.current_color[this.segmentLevel][0],g:this.current_color[this.segmentLevel][1],b:this.current_color[this.segmentLevel][2]},r=null;r=this.colors_set[this.segmentLevel]&H?{type:"material",emit:n,baseColor:i,alpha:this.current_transparency[this.segmentLevel]}:{type:"material",emit:n,specular:1,specularColor:{r:.6,g:.6,b:.6},shine:15,baseColor:i};var o=this.texture_name[this.segmentLevel];if(null!=o){var a=this.createTextureNode(o);r.nodes=[a]}e.insert("node",r)},accumulateBoundingBox:function(e,t,n){var i=this.hwfToMM();if(this.boundingHash["bh"+e]&&this.boundingHash["bh"+e]){var r=this.boundingHash["bh"+e];r[0]*i<t.x&&(t.x=r[0]*i),r[1]*i<t.y&&(t.y=r[1]*i),r[2]*i<t.z&&(t.z=r[2]*i),r[3]*i>n.x&&(n.x=r[3]*i),r[4]*i>n.y&&(n.y=r[4]*i),r[5]*i>n.z&&(n.z=r[5]*i)}return i},isProcessingSurfaceBody:function(){for(var e=this.segmentLevel;e>0;){if(sp=this.getSegmentProperties(this.open_segments[e]),0>sp.volume||0==sp.volume&&sp.surfaceArea>0)return!0;e--}return!1},toFloatFromArray:function(e){var t=(255&e[this.currentBytePos++])+((255&e[this.currentBytePos++])<<8)+((255&e[this.currentBytePos++])<<16)+((255&e[this.currentBytePos++])<<24);return toFloat(t)},toIntFromArray:function(e){var t=(255&e[this.currentBytePos++])+((255&e[this.currentBytePos++])<<8)+((255&e[this.currentBytePos++])<<16)+((255&e[this.currentBytePos++])<<24);return t},toShortFromArray:function(e){var t=(255&e[this.currentBytePos++])+((255&e[this.currentBytePos++])<<8);return t},toFloatArrayFromArray:function(e,t,n){for(var i=0;n>i;i+=1)t[i]=this.toFloatFromArray(e)},toShortArrayFromArray:function(e,t,n){for(var i=0;n>i;i++)t[i]=this.toShortFromArray(e)},toIntArrayFromArray:function(e,t,n){for(var i=0;n>i;i++)t[i]=this.toIntFromArray(e)},toByteArrayFromArray:function(e,t,n){for(var i=0;n>i;i++)t[i]=e[this.currentBytePos++]},toStringFromArray:function(e,t){for(var n="",i=0;t>i;i++){var r=e[this.currentBytePos++];r>0&&(n+=String.fromCharCode(r))}return n},bytes_to_floats:function(e,t,n){for(var i=0;n>i;i++)t[i]=e[this.currentBytePos++]*(1/255)},readUVPairsFromByteArray:function(e,t,n){for(var i=0,r=0;n>r;r++)0!=r&&2==r%3?this.toFloatFromArray(e):t[i++]=this.toFloatFromArray(e)},trivial_decompress_points:function(e,t,n,i){var r,o=new Array,a=new Array,s=n,l=t,c=8;r=1/((1<<c)-1),o[0]=i[0],o[1]=i[1],o[2]=i[2],a[0]=(i[3]-o[0])*r,a[1]=(i[4]-o[1])*r,a[2]=(i[5]-o[2])*r;for(var u=0,d=0;e--;)s[0+u]=255==l[0+d]?i[3]:l[0+d]*a[0]+o[0],s[1+u]=255==l[1+d]?i[4]:l[1+d]*a[1]+o[1],s[2+u]=255==l[2+d]?i[5]:l[2+d]*a[2]+o[2],u+=3,d+=3},unquantize_and_unpack_floats:function(e,t,n,i,r,o){var a,s,l,c,u,d=new Array,h=o,p=new ut;if(8==n&&3==t)return this.trivial_decompress_points(e,r,o,i);for(a=(1<<n)-1,u=1/a,l=0;t>l;l++)d[l]=(i[t+l]-i[l])*u;c=4*Math.floor((t*e*n+31)/32),p.InitRead(c,r);for(var f=0;e--;){for(l=0;t>l;l++)s=p.Get(n),h[l+f]=s!=a?s*d[l]+i[l]:i[l+t];f+=t}}};for(var lt in st)window.AnnotatorBaseModel.prototype[lt]=st[lt];var ct={encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;e.length>n;n++){var i=e.charCodeAt(n);128>i?t+=String.fromCharCode(i):i>127&&2048>i?(t+=String.fromCharCode(192|i>>6),t+=String.fromCharCode(128|63&i)):(t+=String.fromCharCode(224|i>>12),t+=String.fromCharCode(128|63&i>>6),t+=String.fromCharCode(128|63&i))}return t},decode:function(e){for(var t="",n=0,i=c1=c2=0;e.length>n;)i=e.charCodeAt(n),128>i?(t+=String.fromCharCode(i),n++):i>191&&224>i?(c2=e.charCodeAt(n+1),t+=String.fromCharCode((31&i)<<6|63&c2),n+=2):(c2=e.charCodeAt(n+1),c3=e.charCodeAt(n+2),t+=String.fromCharCode((15&i)<<12|(63&c2)<<6|63&c3),n+=3);return t}},ut=Class.extend({init:function(){this.m_data=new Array,this.m_allocated=0,this.m_used=0,this.m_bit=0,this.m_rused=0,this.m_rbit=0,this.m_can_reallocate=0,this.m_status=0,this.m_mask=new Array,this.m_range=new Array},Reset:function(){this.m_data=new Array,this.m_allocated=0,this.m_used=0,this.m_bit=0,this.m_rused=0,this.m_rbit=0,this.m_can_reallocate=0,this.m_status=0,this.m_mask[0]=0,this.m_range[0]=0;var e=0;for(e=1;32>=e;e++)this.m_mask[e]=-1>>>0>>>32-e,this.m_range[e]=(1<<e-1>>>0)-1},InitRead:function(e,t){this.Reset(),this.m_allocated=e/4,this.m_data=t,this.m_can_reallocate=0},Get:function(e){var t;if(32>=this.m_rbit+e){var n=this.m_data[this.m_rused]>>>0;t=n>>>32-this.m_rbit-e&this.m_mask[e],this.m_rbit+=e}else{var i=e+this.m_rbit-32,n=this.m_data[this.m_rused++]>>>0;t=n<<i>>>0&this.m_mask[e],n=this.m_data[this.m_rused]>>>0,t|=n>>>32-i,this.m_rbit+=e-32}return t},NumBytes:function(){return 4*(this.m_used+(this.m_bit?1:0))}})}(),function(){"use strict";function e(e){this.annotator=e,this.reset(),this.COMPARE_PHASE_COLORS="COMPARE_PHASE_COLORS",this.COMPARE_PHASE_COLORS_TRANSPARENCY="COMPARE_PHASE_COLORS_TRANSPARENCY",this.COMPARE_PHASE_PURE_TRANSPARENCY="COMPARE_PHASE_PURE_TRANSPARENCY",this.stencilBufferSupportKnown=!1,this.stencilBufferSupported=null}var t=1,n=2,i=4,r=8;e.prototype={reset:function(){this.modelColor=null,this.referenceColor=null,this.commonColor=null,this.modelAlpha=null,this.referenceAlpha=null,this.modelColorMix=0,this.referenceColorMix=0,this.cappingActive=!1,this.compareActive=!1,this.updateHooks()},setCappingActive:function(e){return this.isStencilBufferSupported()?(this.cappingActive=e,this.updateHooks(),!0):!1},setCompareActive:function(e,t,n,i,r,o,a,s,l){this.compareActive=e,this.comparePhase=t,this.modelColor=n,this.referenceColor=i,this.commonColor=r,this.modelAlpha=o,this.referenceAlpha=a,this.modelColorMix=s,this.referenceColorMix=l,this.updateHooks()},updateHooks:function(){SceneJS_GC_Hooks.reset(),(this.cappingActive||this.compareActive)&&(SceneJS_GC_Hooks.clearHook=this.clearCallback.bind(this),this.cappingActive&&this.compareActive?SceneJS_GC_Hooks.renderFrameHook=this.runCappingComparePasses.bind(this):this.cappingActive?SceneJS_GC_Hooks.renderFrameHook=this.runCappingPasses.bind(this):this.compareActive&&(SceneJS_GC_Hooks.renderFrameHook=this.comparePhase===this.COMPARE_PHASE_COLORS?this.runComparePasses.bind(this):this.runEdgeAlphaPasses.bind(this))),this.compareActive&&this.comparePhase!=this.COMPARE_PHASE_COLORS&&(SceneJS_GC_Hooks.compareMode=!0)},deactivate:function(){this.reset()},isStencilBufferSupported:function(){if(!this.stencilBufferSupportKnown){this.stencilBufferSupportKnown=!0,this.stencilBufferSupported=!1;var e=this.annotator.controller.sceneNode._targetNode.canvas.context;try{var t=e.getError();e.enable(e.STENCIL_TEST);var n=e.getParameter(e.STENCIL_TEST);e.disable(e.STENCIL_TEST),t=e.getError(),this.stencilBufferSupported=t==e.NO_ERROR&&!!n}catch(i){}}return this.stencilBufferSupported},isCappingSupported:function(){return this.isStencilBufferSupported()},isColorCompareSupported:function(){return this.isStencilBufferSupported()},runPass:function(e,t,n,i){t.nodeRenderer._program=null,e(t,n,i)},runCappingPasses:function(e,t,n,r){var o=t.canvas.context;try{o.enable(o.STENCIL_TEST),o.stencilMask(255),o.clearStencil(0),o.clear(o.STENCIL_BUFFER_BIT),o.stencilFunc(o.ALWAYS,i,i),o.stencilOp(o.KEEP,o.INVERT,o.INVERT),SceneJS_GC_Hooks.renderNodeHook=this.cappingPass1Filter.bind(this),this.runPass(e,t,n,r),o.stencilFunc(o.EQUAL,i,i),o.stencilOp(o.KEEP,o.KEEP,o.KEEP),SceneJS_GC_Hooks.renderNodeHook=this.cappingPass2Filter.bind(this),this.runPass(e,t,n,r),o.disable(o.STENCIL_TEST),SceneJS_GC_Hooks.renderNodeHook=n?this.cappingPass3FilterPicking.bind(this):this.cappingPass3Filter.bind(this),this.runPass(e,t,n,r)}catch(a){throw a}finally{SceneJS_GC_Hooks.renderNodeHook=null,SceneJS_GC_Hooks.clearHook=null,o.disable(o.STENCIL_TEST)}},cappingPass1Filter:function(e){return!("cuttingPlaneGeometry"===e.id||"cuttingPlaneCap"===e.id||"backgroundPane"===e.id||e.id.substring&&"sb:"==e.id.substring(0,3)||e.id.substring&&"g-tempNodeBackground"==e.id.substring(0,20)||1==e.geoState.geo.primitive)},cappingPass2Filter:function(e){return"cuttingPlaneCap"===e.id},cappingPass3Filter:function(e){return"cuttingPlaneGeometry"===e.id||"backgroundPane"==e.id||e.id.substring&&"sb:"==e.id.substring(0,3)||e.id.substring&&"g-tempNodeBackground"==e.id.substring(0,20)||1==e.geoState.geo.primitive},cappingPass3FilterPicking:function(e){return"backgroundPane"==e.id||e.id.substring&&"sb:"==e.id.substring(0,3)||1==e.geoState.geo.primitive},clearCallback:function(){return!1},runComparePasses:function(e,i,r,o){var a=i.canvas.context;try{a.enable(a.STENCIL_TEST),a.stencilMask(t|n),a.clearStencil(0),a.clear(a.STENCIL_BUFFER_BIT),a.stencilMask(t),a.stencilFunc(a.ALWAYS,t,t),a.stencilOp(a.KEEP,a.KEEP,a.REPLACE),SceneJS_GC_Hooks.renderNodeHook=this.comparingPass1Filter.bind(this),SceneJS_GC_Hooks.postRenderNodeHook=this.postNodeOverridePop.bind(this),a.polygonOffset(5,5),this.runPass(e,i,r,o),a.enable(a.STENCIL_TEST),a.stencilMask(n),a.stencilFunc(a.ALWAYS,n,n),a.stencilOp(a.KEEP,a.KEEP,a.REPLACE),a.polygonOffset(3,3),SceneJS_GC_Hooks.renderNodeHook=this.comparingPass2Filter.bind(this),this.runPass(e,i,r,o),a.enable(a.STENCIL_TEST),a.stencilMask(n),a.stencilFunc(a.EQUAL,n,n),a.stencilOp(a.KEEP,a.KEEP,a.KEEP),a.polygonOffset(1,1),SceneJS_GC_Hooks.renderNodeHook=this.comparingPass3Filter.bind(this),this.runPass(e,i,r,o)}catch(s){throw s}finally{SceneJS_GC_Hooks.renderNodeHook=null,SceneJS_GC_Hooks.postRenderNodeHook=null,SceneJS_GC_Hooks.clearHook=null,a.disable(a.STENCIL_TEST),a.polygonOffset(1,1)}},comparingPass1Filter:function(e){if("cuttingPlaneGeometry"===e.id||"cuttingPlaneCap"===e.id)return!1;var t=e.shaderParamsState.paramsStack;if(t)for(var n=0,i=t.length;i>n;n++){var r=t[n];if(r.mixColorValue>0&&1==e.geoState.geo.primitive)return t.push({mixColorValue:0,temporaryOverride:!0}),!0;if(r.mixColorValue>0&&r.mixColor[0]==this.referenceColor[0]&&r.mixColor[1]==this.referenceColor[1]&&r.mixColor[2]==this.referenceColor[2])return!1}return!0},comparingPass2Filter:function(e){if("cuttingPlaneGeometry"===e.id||"cuttingPlaneCap"===e.id)return!1;var t=e.shaderParamsState.paramsStack;if(t)for(var n=0,i=t.length;i>n;n++){var r=t[n];if(r.mixColorValue>0&&1==e.geoState.geo.primitive)return t.push({mixColorValue:0,temporaryOverride:!0}),!0;if(r.mixColorValue>0&&r.mixColor[0]==this.referenceColor[0]&&r.mixColor[1]==this.referenceColor[1]&&r.mixColor[2]==this.referenceColor[2])return!0}return!1},comparingPass3Filter:function(e){if("cuttingPlaneGeometry"===e.id||"cuttingPlaneCap"===e.id)return!1;var t=e.shaderParamsState.paramsStack;if(t)for(var n=0,i=t.length;i>n;n++){var r=t[n];if(r.mixColorValue>0&&r.mixColor[0]==this.modelColor[0]&&r.mixColor[1]==this.modelColor[1]&&r.mixColor[2]==this.modelColor[2])return this.commonColor?t.push({mixColorValue:1,mixColor:this.commonColor.slice(),temporaryOverride:!0}):t.push({mixColorValue:0,temporaryOverride:!0}),!0}return!1},postNodeOverridePop:function(e){var t=e.shaderParamsState.paramsStack;if(t)for(;t.length>0&&t[t.length-1].temporaryOverride;)t.pop()},runEdgeAlphaPasses:function(e,t,n,i){t.canvas.context;try{SceneJS_GC_Hooks.renderNodeHook=this.nodeFilterEdgeAlphaOverride.bind(this),SceneJS_GC_Hooks.postRenderNodeHook=this.postNodeOverridePop.bind(this),this.runPass(e,t,n,i)}catch(r){throw r}finally{SceneJS_GC_Hooks.renderNodeHook=null,SceneJS_GC_Hooks.postRenderNodeHook=null,SceneJS_GC_Hooks.clearHook=null}},nodeFilterEdgeAlphaOverride:function(e){var t=e.shaderParamsState.paramsStack;if(t&&1==e.geoState.geo.primitive)for(var n=0,i=t.length;i>n;n++){var r=t[n];if(r.mixColorValue>0){t.push({mixColor:[0,0,0],mixColorValue:1,temporaryOverride:!0});break}}return!0},runCappingComparePasses:function(e,t,n,o){var a=t.canvas.context;try{a.enable(a.STENCIL_TEST),a.stencilMask(r|i),a.clearStencil(0),a.clear(a.STENCIL_BUFFER_BIT),a.enable(a.STENCIL_TEST),a.stencilFunc(a.ALWAYS,0,0),a.stencilMask(i),a.stencilOp(a.KEEP,a.INVERT,a.INVERT),SceneJS_GC_Hooks.renderNodeHook=this.cappingComparePass1Filter.bind(this),this.runPass(e,t,n,o),a.stencilFunc(a.ALWAYS,0,0),a.stencilMask(r),a.stencilOp(a.KEEP,a.INVERT,a.INVERT),SceneJS_GC_Hooks.renderNodeHook=this.cappingComparePass2Filter.bind(this),this.runPass(e,t,n,o),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),this.runComparePasses(e,t,n,o),a.enable(a.STENCIL_TEST),a.stencilFunc(a.ALWAYS,0,0),a.stencilOp(a.KEEP,a.KEEP,a.KEEP),SceneJS_GC_Hooks.renderNodeHook=n?this.cappingComparePassCapFilterPicking.bind(this):this.cappingComparePassCapFilter.bind(this),this.runPass(e,t,n,o)}catch(s){throw s}finally{SceneJS_GC_Hooks.renderNodeHook=null,SceneJS_GC_Hooks.postRenderNodeHook=null,SceneJS_GC_Hooks.clearHook=null,a.disable(a.STENCIL_TEST),a.stencilMask(255)}},cappingComparePass1Filter:function(e){if(1==e.geoState.geo.primitive||"cuttingPlaneGeometry"===e.id||"cuttingPlaneCap"===e.id||"backgroundPane"===e.id||e.id.indexof&&-1!=e.id.indexof("sb:")||e.id.indexof&&-1!=e.id.indexof("g-tempNodeBackground"))return!1;var t=e.shaderParamsState.paramsStack;if(t)for(var n=0,i=t.length;i>n;n++){var r=t[n];if(r.mixColor[0]==this.modelColor[0]&&r.mixColor[1]==this.modelColor[1]&&r.mixColor[2]==this.modelColor[2])return!0}return!1},cappingComparePass2Filter:function(e){if(1==e.geoState.geo.primitive||"cuttingPlaneGeometry"===e.id||"cuttingPlaneCap"===e.id||"backgroundPane"===e.id||e.id.indexof&&-1!=e.id.indexof("sb:")||e.id.indexof&&-1!=e.id.indexof("g-tempNodeBackground"))return!1;var t=e.shaderParamsState.paramsStack;if(t)for(var n=0,i=t.length;i>n;n++){var r=t[n];if(r.mixColor[0]==this.referenceColor[0]&&r.mixColor[1]==this.referenceColor[1]&&r.mixColor[2]==this.referenceColor[2])return!0}return!1},cappingComparePassCapFilter:function(e,t){if("cuttingPlaneCap"===e.id){var n=this,o={};return o.gcDrawFunction=function(){var o=e.program.render,a=e.geoState,s=t._context,l=a.geo.primitive,c=a.geo.indexBuf.numItems,u=o.getUniform("mixColor").getValue(),d=o.getUniform("mixColorValue").getValue();s.stencilFunc(s.EQUAL,i,r|i),s.enable(s.BLEND),s.blendFunc(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA),1>n.modelAlpha?(o.setUniform("alphaTransEnabled",!0),o.setUniform("alphaTransValue",n.modelAlpha)):o.setUniform("alphaTransEnabled",!1),n.modelColor?(o.setUniform("mixColor",n.modelColor),o.setUniform("mixColorValue",n.modelColorMix)):o.setUniform("mixColorValue",0),s.drawElements(l,c,s.UNSIGNED_SHORT,0),s.stencilFunc(s.EQUAL,r,r|i),1>n.referenceAlpha?(o.setUniform("alphaTransEnabled",!0),o.setUniform("alphaTransValue",n.referenceAlpha)):o.setUniform("alphaTransEnabled",!1),n.referenceColor?(o.setUniform("mixColor",n.referenceColor),o.setUniform("mixColorValue",n.referenceColorMix)):o.setUniform("mixColorValue",0),s.drawElements(l,c,s.UNSIGNED_SHORT,0),s.disable(s.BLEND),s.stencilFunc(s.EQUAL,r|i,r|i),o.setUniform("alphaTransEnabled",!1),o.setUniform("alphaTransValue",1),n.commonColor?(o.setUniform("mixColor",n.commonColor),o.setUniform("mixColorValue",1)):o.setUniform("mixColorValue",0),s.drawElements(l,c,s.UNSIGNED_SHORT,0),t._picking||(s.stencilFunc(s.ALWAYS,0,0),o.setUniform("alphaTransEnabled",!0),o.setUniform("alphaTransValue",.12),o.setUniform("mixColor",[0,0,.9]),o.setUniform("mixColorValue",1),s.enable(s.BLEND),s.blendFunc(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA),s.drawElements(l,c,s.UNSIGNED_SHORT,0)),s.disable(s.BLEND),o.setUniform("alphaTransEnabled",!1),o.setUniform("alphaTransValue",1),o.setUniform("mixColor",u),o.setUniform("mixColorValue",d)},o}return!1},nodeFilterEdgeAlphaNonModels:function(e){if(1==e.geoState.geo.primitive)return!0;if("cuttingPlaneGeometry"===e.id||"cuttingPlaneCap"===e.id)return!1;var t=e.shaderParamsState.paramsStack;if(t)for(var n=!1,i=0,r=t.length;r>i;i++){var o=t[i];!n&&o.mixColor&&(n=o.mixColor[0]==this.modelColor[0]&&o.mixColor[1]==this.modelColor[1]&&o.mixColor[2]==this.modelColor[2]||o.mixColor[0]==this.referenceColor[0]&&o.mixColor[1]==this.referenceColor[1]&&o.mixColor[2]==this.referenceColor[2])}return!n},cappingComparePassCapFilterPicking:function(e,t){if("cuttingPlaneCap"===e.id){var n={};return n.gcDrawFunction=function(){var n=e.geoState,o=t._context,a=n.geo.primitive,s=n.geo.indexBuf.numItems;o.stencilFunc(o.NOTEQUAL,0,r|i),o.drawElements(a,s,o.UNSIGNED_SHORT,0)},n}return!1}},window.AnnotatorMultiPassRenderingHelper=e}(),function(){"use strict";function e(e){this.annotator=e,this.parentNode=e.view.$parent,this.div=document.createElement("div"),this.div.setAttribute("filecomparison","true"),this.div.className="annotator-popup",this.body=null,this.transparencyWidget=null,this.transparencySliderControl=null,this.ctSliderControl=null,this.transparency_dragging=!1,this.createUI(this)}function t(e){this.mode=null,this.visible=!1,this.referenceModelNodeSelector=null,this.sliderValue=50,this.colorizeMode=a,this.showUpgradeToProPopup=!1,this.init(e)}var n="transparency",i="colors",r="colors-transparency",o="A",a="AuB",s="B",l=[.2,1,.2],c=[1,.2,1],u=[.7,.7,.7],d=[0,0,0];e.prototype={show:AnnotatorToolbarUI.prototype.show,hide:AnnotatorToolbarUI.prototype.hide,isVisible:AnnotatorToolbarUI.prototype.isVisible,createUI:function(e){var t=e.annotator.view.model.fileComparisonManager,i=new AnnotatorWidget(this.div,"header"),o=new AnnotatorWidget(i.div,"title");GCDrag.makeDraggable(this.div,i.div),GCDrag.makeDraggable(this.div,o.div),o.setTextContent("3D COMPARE"),o.set("unselectable","on");var a=new AnnotatorWidget(i.div,"close");a.set("title","Close"),a.addEventListener("click",function(){e.reset(),e.annotator.toolbar.$fileComparison.uncheck(),e.hide()});var s=new AnnotatorWidget(this.div,"body");this.body=s,s.div.addEventListener("mouseover",function(e){e.stopPropagation()});var l=new AnnotatorWidget(s.div,"model-names-div"),c=new AnnotatorWidget(l.div,"model-name current");c.setTextContent(t.annotator.modelFileName),this.currentModel=c;var u=new AnnotatorWidget(l.div,"model-name compared-model","coparedModel","a");u.setTextContent("Compare to another file"),u.div.addEventListener("click",function(){var e=angular.element($(".fileView")).scope();e.compare()}),this.comparedModel=u;var d=new AnnotatorWidget(s.div,"compare-slider-div"),h=new AnnotatorWidget(d.div,"annotator-dropdown horizontal-group");h.div.addEventListener("mouseover",function(e){e.stopPropagation()});var p=new AnnotatorWidget(d.div,"annotator-compare-slider horizontal-group");this.sliderDiv=p;var f=new AnnotatorWidget(d.div,"annotator-dropdown horizontal-group");f.div.addEventListener("mouseover",function(e){e.stopPropagation()});var m=new AnnotatorWidget(h.div,"annotator-dropdown-menu vertical-group","targetDropDown","select");this.targetDropDownMenu=m;var g=new AnnotatorWidget(h.div,"annotator-dropdown-menu vertical-group indented","targetConfigurationDropDown","select");this.targetConfigurationDropDownMenu=g;var v=new AnnotatorWidget(f.div,"annotator-dropdown-menu vertical-group","referenceDropDown","select");this.referenceDropDownMenu=v;var y=new AnnotatorWidget(f.div,"annotator-dropdown-menu vertical-group indented","referenceConfigurationDropDown","select");this.referenceConfigurationDropDownMenu=y,v.set("unselectable","on"),m.set("unselectable","on"),y.set("unselectable","on"),g.set("unselectable","on"),[v,m,y,g].forEach(function(e){e.div.addEventListener("mouseout",function(e){e.stopPropagation()}),e.div.addEventListener("mousemove",function(e){e.stopPropagation()}),e.div.addEventListener("click",function(e){e.stopPropagation()}),e.div.addEventListener("mouseover",function(e){e.stopPropagation()})});var b=new AnnotatorWidget(s.div,"annotator-checkbox-div","compareModeCheckBox","div"),_=new AnnotatorWidget(b.div,"annotator-checkbox","compareModeCheckBox","input");_.div.setAttribute("type","checkbox"),_.div.setAttribute("id","compare-mode-cb-id"),_.div.checked=!0,_.div.addEventListener("change",function(){this.checked?(e.showColorizeLegend(),t.setMode(r)):(e.hideColorizeLegend(),t.setMode(n))}),this.compareModeCheckBox=_;var w=new AnnotatorWidget(b.div,"annotator-checkbox-label","compareModeCheckBox","label");w.div.setAttribute("for","compare-mode-cb-id"),w.div.textContent="Colorize differences";var S=new AnnotatorWidget(s.div,"keyDiv");this.keyDiv=S;var x=new AnnotatorWidget(S.div,"hintGreen");x.setTextContent("■");var C=new AnnotatorWidget(S.div,"hint");C.setTextContent("Added"),C.set("unselectable","on");var E=new AnnotatorWidget(S.div,"hintMagenta");E.setTextContent("■");var T=new AnnotatorWidget(S.div,"hint");T.setTextContent("Removed"),T.set("unselectable","on"),this.annotator.view.multiPassHelper.isColorCompareSupported()||(b.hide(),S.hide(),this.div.setAttribute("colorNotSupported","true")),e.update()},showColorizeLegend:function(){this.keyDiv.show()},hideColorizeLegend:function(){this.keyDiv.hide()},updateZoneTooltips:function(){var e=$("select[referencedropdown]").find(":selected").text(),t=$("select[targetdropdown]").find(":selected").text();$(".leftZone").attr("title","Click to show "+t),$(".rightZone").attr("title","Click to show "+e)},ensureTransparencyWidget:function(){if(!this.transparencyWidget){var e=this.annotator.view.model.fileComparisonManager,t=this.sliderDiv,n=this;this.transparencyWidget=new AnnotatorWidget(t.div,"transparency");var i=new AnnotatorWidget(this.transparencyWidget.div,"slider"),r=new AnnotatorWidget(i.div,"box");window.setTimeout(function(){var t=new dhtmlxSlider(r.div,200,"default",!1,0,100,0,1);t.attachEvent("onSlideEnd",function(){n.transparency_dragging=!1}),t.attachEvent("onChange",function(t,i){if(10>Math.abs(t-i.value))n.transparency_dragging=!0,e.onSliderChange(t);else if(n.transparency_dragging)e.onSliderChange(t);else{var r=i.direction;r>0?(n.transparencySliderControl.setValue(100),i.value=100,e.onSliderChange(100)):(n.transparencySliderControl.setValue(0),i.value=0,e.onSliderChange(0))}n.updateZoneTooltips()}),t.setImagePath("/images/_/viewer/"),t.init(),n.transparencySliderControl=t,t.setValue(50),n.updateZoneTooltips()},500)}},update:function(){var e=this.annotator.view.model.fileComparisonManager,t=e.mode;switch(this.annotator.view.multiPassHelper.isColorCompareSupported()||(t=n,e.setMode(t)),t){case n:this.colorizeTransparencyWidget&&this.colorizeTransparencyWidget.hide(),this.ensureTransparencyWidget(),this.transparencyWidget.show();break;case r:default:this.transparencyWidget&&this.transparencyWidget.hide(),this.ensureTransparencyWidget(),this.transparencyWidget.show()}this.populateDropdowns(),e.referenceModelNodeSelector?($(".annotator-compare-slider").show(),$(".compare-slider-div .annotator-dropdown-menu").removeClass("wide")):($(".annotator-compare-slider").hide(),$(".compare-slider-div .annotator-dropdown-menu").addClass("wide"))},populateDropdowns:function(){var e=this,t=this.annotator.view.model.fileComparisonManager,n=t.getLocation();$("select[targetdropdown]").html(""),$("select[referencedropdown]").html(""),$("select[targetconfigurationdropdown]").html(""),$("select[referenceconfigurationdropdown]").html("");var i=n.target?n.target.version:0,r=n.target?n.target.configuration:null,o=n.reference?n.reference.version:0,a=n.reference?n.reference.configuration:null;t.init(this.annotator),t.forEachVersion(t.availableVersions,function(n){var r=n,a="Version "+n,s=n==i,l=!t.isSelectableVersion(n,o);new AnnotatorSelectOption(e.targetDropDownMenu.div,r,a,s,l)}),this.targetDropDownMenu.div.addEventListener("change",function(){var e=t.getLocation();if(e.target){e.target.version=parseInt($(this).find(":selected").val()),t.setLocation(e);var n=$("select[targetdropdown]").find(":selected").text();$(".leftZone").attr("title","Click to show "+n)}}),t.hasConfigurations(t.availableConfigurations)?t.hasAlternateConfigurations(t.availableConfigurations)?(this.targetConfigurationDropDownMenu.show(),t.forEachConfiguration(t.availableConfigurations,function(t,n){var i=t,o=n.name,a=n.index==r,s=!1;new AnnotatorSelectOption(e.targetConfigurationDropDownMenu.div,i,o,a,s)})):(this.targetConfigurationDropDownMenu.show(),new AnnotatorSelectOption(this.targetConfigurationDropDownMenu.div,0,"No available configurations",!0,!0)):this.targetConfigurationDropDownMenu.hide(),this.targetConfigurationDropDownMenu.div.addEventListener("change",function(){var e=t.getLocation();e.target&&(e.target.configuration=parseInt($(this).find(":selected").val()),t.setLocation(e))}),t.hasAlternateVersions(t.comparableVersions)?t.forEachVersion(t.comparableVersions,function(n){var r=n,a="Version "+n,s=n==o,l=!t.isSelectableVersion(n,i);new AnnotatorSelectOption(e.referenceDropDownMenu.div,r,a,s,l)}):new AnnotatorSelectOption(this.referenceDropDownMenu.div,0,"No available versions",!0,!0),this.referenceDropDownMenu.div.addEventListener("change",function(){var e=t.getLocation();if(e.reference){e.reference.version=parseInt($(this).find(":selected").val()),t.setLocation(e);var n=$("select[referencedropdown]").find(":selected").text();$(".rightZone").attr("title","Click to show "+n)}}),t.hasConfigurations(t.comparableConfigurations)?t.hasAlternateConfigurations(t.comparableConfigurations)?(this.referenceConfigurationDropDownMenu.show(),t.forEachConfiguration(t.comparableConfigurations,function(t,n){var i=t,r=n.name,o=n.index==a,s=!1;new AnnotatorSelectOption(e.referenceConfigurationDropDownMenu.div,i,r,o,s)})):(this.referenceConfigurationDropDownMenu.show(),new AnnotatorSelectOption(this.referenceConfigurationDropDownMenu.div,0,"No available configurations",!0,!0)):this.referenceConfigurationDropDownMenu.hide(),this.referenceConfigurationDropDownMenu.div.addEventListener("change",function(){var e=t.getLocation();e.reference&&(e.reference.configuration=parseInt($(this).find(":selected").val()),t.setLocation(e))});var s="Compare to another file",l="model-name compared-model";0==t.isSameModelCompared&&(s=t.comparedModelName,l+=" other-file-selected"),this.comparedModel.setTextContent(s),this.comparedModel.div.setAttribute("class",l),this.currentModel.setTextContent(t.annotator.modelFileName)},setValue:function(e){this.transparencySliderControl&&this.transparencySliderControl.setValue(e),this.annotator.view.model.fileComparisonManager.onSliderChange(e)},reset:function(){this.annotator.view.model.fileComparisonManager.hide()},resetPos:function(){this.parentNode&&0!=this.parentNode.clientWidth&&(this.div.style.left=this.parentNode.clientWidth-540+"px"),this.div.style.top="40px"}},t.prototype={init:function(e){this.annotator=e,this.availableVersions=e.viewableVersions,this.comparableVersions=e.comparableVersions,this.availableConfigurations=e.viewableConfigurations,this.comparableConfigurations=e.comparableConfigurations,this.multiPassHelper=e.view.multiPassHelper,this.isSameModelCompared=e.isSameModelCompared,this.comparedModelName=e.comparedModelName},reset:function(){this.hide()},hide:function(){return this.visible&&(this.visible=!1,this.restoreTransparentOnNode(this.annotator.view.model.modelNode),this.overrideColorsOnNode(this.annotator.view.model.modelNode,d,0),this.restoreTransparentOnNode(this.referenceModelNodeSelector),this.overrideColorsOnNode(this.referenceModelNodeSelector,d,0),this.referenceModelNodeSelector._targetNode.disconnect(),this.referenceModelNodeSelector=null,this.multiPassHelper.setCompareActive(!1),SceneJS_compileModule.nodeUpdated(this.annotator.controller.sceneNode._targetNode),this.mode=null),this.visible},getState:function(){var e=this.getLocation();this.visible||(e.reference=void 0);var t=this.makeLocation(e);return{comparisonUrl:t,colorizeMode:this.colorizeMode,visible:this.visible,mode:this.mode,sliderValue:100-this.sliderValue}},setState:function(e){e&&(e.visible&&(this.annotator.view.markupManager.hideCuttingPlanePopup(!1),this.annotator.toolbar.$explodeAssembly.uncheck(),this.annotator.view.markupManager.hideExplodeAssemblyPopup(!0),this.annotator.toolbar.$measurement.uncheck(),this.annotator.view.markupManager.hideMeasurementPopup(),this.annotator.toolbar.$fileComparison.check(),this.annotator.view.markupManager.showFileComparisonPopup(canUseFeature("can_compare_versions")),this.annotator.state.dontShowUpgradePopup=!0),this.annotator.view.markupManager.ensureFileComparisonPopup(),this.setMode(e.mode),this.mode==r?(this.annotator.view.markupManager.fileComparisonUI.showColorizeLegend(),this.annotator.view.markupManager.fileComparisonUI.compareModeCheckBox.check(),this.annotator.view.markupManager.fileComparisonUI.compareModeCheckBox.div.checked=!0):(this.annotator.view.markupManager.fileComparisonUI.hideColorizeLegend(),this.annotator.view.markupManager.fileComparisonUI.compareModeCheckBox.uncheck(),this.annotator.view.markupManager.fileComparisonUI.compareModeCheckBox.div.checked=!1),this.annotator.view.markupManager.fileComparisonUI.setValue(100-e.sliderValue),e.comparisonUrl&&(location.hash=e.comparisonUrl)),e&&e.visible||(this.annotator.view.markupManager.hideFileComparisonPopup(!0),this.annotator.toolbar.$fileComparison.uncheck())
},splitFileSpec:function(e){var t,n,i,r,o,a=e.split("/"),s=a.indexOf("space");return s>-1&&(n=a[s+1]),s=a.indexOf("file"),s>-1&&(t=a[s+1]),s=a.indexOf("link"),s>-1&&(i=a[s+1]),s=a.indexOf("version"),r=s>-1?a[s+1]:this.annotator.loadedVersion,s=a.indexOf("configuration"),o=s>-1?a[s+1]:null,{file:t,space:n,link:i,version:r,configuration:o}},joinFileSpec:function(e){var t="";return void 0!==e.file&&(t+="/file/"+e.file),void 0!==e.space&&(t+="/space/"+e.space),void 0!==e.link&&(t+="/link/"+e.link),void 0!==e.version&&(t+="/version/"+e.version),null!=e.configuration&&(t+="/configuration/"+e.configuration),t},getLocation:function(){var e,t,n=location.hash.split("/compare_to");return e=this.splitFileSpec(n[0]),n.length>1&&(t=this.splitFileSpec(n[1])),{target:e,reference:t}},makeLocation:function(e){var t="#";return e.target&&(t+=this.joinFileSpec(e.target)),e.reference&&(t+="/compare_to"+this.joinFileSpec(e.reference)),t},setLocation:function(e){var t=this.makeLocation(e);location.hash=t},getNearestAvailableVersion:function(e){var t=e,n=e,i=1,r=this.availableVersions.length-1;do t--;while(!this.availableVersions[t]&&t>=i);do n++;while(!this.availableVersions[n]&&r>=n);return t>=i?t:r>=n?n:0},getNearestAvailableConfiguration:function(e){var t=e,n=e,i=0,r=this.availableConfigurations.length-1,o=this.availableConfigurations;if(!o)return null;do t--;while(!o[t]&&t>=i);do n++;while(!o[n]&&r>=n);return r>=n?n:t>=i?t:null},getNearestComparableModel:function(e,t){var n=0,i=null;return 0!=e&&null!=t?(n=e,i=this.getNearestAvailableConfiguration(t)):0!=e&&(n=this.getNearestAvailableVersion(e),i=null),{version:n,configuration:i}},countVersions:function(e){if(!e)return 0;for(var t=0,n=0;e.length>n;n++)null!=e[n]&&t++;return t},countConfigurations:function(e){if(!e)return 0;for(var t=0,n=0;e.length>n;n++)null!=e[n]&&t++;return t},getDefaultConfiguration:function(e){if(!e)return null;for(var t=0;e.length>t;t++)if(null!=e[t]&&e[t].is_default)return e[t];return null},forEachVersion:function(e,t){if(e)for(var n=0;e.length>n;n++)null!=e[n]&&t(n,e[n])},forEachConfiguration:function(e,t){if(e)for(var n=0;e.length>n;n++)null!=e[n]&&t(n,e[n])},compareWithSelfEnabled:function(){return!this.isSameModelCompared||this.countConfigurations(this.availableConfigurations)>0},hasAlternateVersions:function(e){var t=this.compareWithSelfEnabled()?1:2;return this.countVersions(e)>=t},hasAlternateConfigurations:function(e){var t=1;return this.countConfigurations(e)>=t},hasConfigurations:function(e){return this.countConfigurations(e)>0},isSelectableVersion:function(e,t){return this.compareWithSelfEnabled()||e!=t},show:function(){return this.annotator.controller.referenceModelNode&&!this.visible&&(this.visible=!0,this.annotator.controller.sceneNode.findNode("lowest")._targetNode.addNode(this.annotator.controller.referenceModelNode),SceneJS_compileModule.nodeUpdated(this.annotator.controller.sceneNode._targetNode),this.referenceModelNodeSelector=SceneJS._selectNode(this.annotator.controller.referenceModelNode),this.annotator.view.markupManager.fileComparisonUI.compareModeCheckBox.div.checked?this.setMode(r):this.setMode(n)),this.visible},setMode:function(e){this.multiPassHelper.isColorCompareSupported()||(e=n),this.mode=e,this.visible&&this.applyToSceneGraph()},applyToSceneGraph:function(){switch(this.multiPassHelper.setCompareActive(!1),this.mode){case i:switch(this.colorizeMode){case o:this.sliderValue=0;break;case s:this.sliderValue=100;break;default:this.sliderValue=50}case r:break;case n:default:this.overrideColorsOnNode(this.annotator.view.model.modelNode,d.slice(),0),this.overrideColorsOnNode(this.referenceModelNodeSelector,d.slice(),0)}SceneJS_compileModule.nodeUpdated(this.annotator.controller.sceneNode._targetNode),this.onSliderChange(this.sliderValue,!0)},onSliderChange:function(e,t){if(this.visible&&(t||this.sliderValue!=i)){this.sliderValue=e;var i=Math.abs(e-100);if(this.mode==n){var o=i/100;0>o&&(o=0),o>1&&(o=1);var a=0,s=0;.5>=o?(a=1,s=2*o):(a=1-2*(o-.5),s=1);var d=l.slice(),h=c.slice();this.overrideAlphaOnNode(this.referenceModelNodeSelector,!0,a),this.overrideColorsOnNode(this.referenceModelNodeSelector,h,0),this.overrideAlphaOnNode(this.annotator.view.model.modelNode,!0,s),this.overrideColorsOnNode(this.annotator.view.model.modelNode,d,0),this.multiPassHelper.setCompareActive(!0,this.multiPassHelper.COMPARE_PHASE_PURE_TRANSPARENCY,d,h,null,s,a,0,0)}else if(this.mode==r){0>i&&(i=0),i>100&&(i=100);var a=1,s=1,d=l.slice(),p=0,h=c.slice(),f=0,m=!0;25>i?(s=i/25,d=u.slice(),p=1):50>=i?(p=(50-i)/25,d[0]=u[0]*p+l[0]*(1-p),d[1]=u[1]*p+l[1]*(1-p),d[2]=u[2]*p+l[2]*(1-p),p=1,f=(i-25)/25+.01,m=!1):75>=i?(f=(i-50)/25,h[0]=u[0]*f+c[0]*(1-f),h[1]=u[1]*f+c[1]*(1-f),h[2]=u[2]*f+c[2]*(1-f),f=1,p=(75-i)/25+.01,m=!1):(a=(100-i)/25,h=u.slice(),f=1),this.overrideAlphaOnNode(this.referenceModelNodeSelector,!0,a),this.overrideColorsOnNode(this.referenceModelNodeSelector,h,f),this.overrideAlphaOnNode(this.annotator.view.model.modelNode,!0,s),this.overrideColorsOnNode(this.annotator.view.model.modelNode,d,p),this.multiPassHelper.setCompareActive(!0,m?this.multiPassHelper.COMPARE_PHASE_COLORS_TRANSPARENCY:this.multiPassHelper.COMPARE_PHASE_COLORS,d,h,null,s,a,p,f)}}},overrideAlphaOnNode:function(e,t,n){var i=t&&1>n;e.eachNode(function(){if("shaderParams"==this.get("type")&&this.set({params:{alphaTransEnabled:i,alphaTransValue:n}}),"flags"==this.get("type")){var e=this.get("flags"),t=e.hasOwnProperty("originallyTransparent")?e.originallyTransparent:e.transparent;this.set({flags:{enabled:e.enabled,transparent:i,backfaces:e.backfaces,originallyTransparent:t}})}},{andSelf:!0,depthFirst:!0})},restoreTransparentOnNode:function(e){e.eachNode(function(){if("shaderParams"==this.get("type")&&this.set({params:{alphaTransEnabled:!1,alphaTransValue:1}}),"flags"==this.get("type")){var e=this.get("flags");this.set({flags:{enabled:e.enabled,transparent:e.hasOwnProperty("originallyTransparent")?e.originallyTransparent:e.transparent,backfaces:e.backfaces}})}},{andSelf:!0,depthFirst:!0})},overrideColorsOnNode:function(e,t,n){e.eachNode(function(){"shaderParams"==this.get("type")&&this.set({params:{mixColor:t,mixColorValue:n}})},{andSelf:!0,depthFirst:!0})}},window.AnnotatorFileComparisonUI=e,window.AnnotatorFileComparisonManager=t}(),function(){"use strict";function e(e){this.annotator=e,this.highlightSet=new Array,this.selectionSet=new Array,this.externalRef=null,this.initListeners()}var t=!1,n=!0,i=!0;e.prototype={onClearView:function(){this.highlightSet.length>0&&this.setDynamicHighlightByModelElement(null),this.selectionSet.length>0&&this.setSelectionByModelElement(null)},setDynamicHighlightByModelElement:function(e){this.setDynamicHighlightByModelElementsInternal(e?[e]:[],!0)},setDynamicHighlightByModelElementsInternal:function(e,t){for(var n=0;this.highlightSet.length>n;n++)this.annotator.view.markupManager.highlightByTreeNodeId(this.highlightSet[n].id,!1),this.annotator.view.model.modelTree.highlightNodeById(this.highlightSet[n].id,!1);for(var n=0;e.length>n;n++)this.annotator.view.markupManager.highlightByTreeNodeId(e[n].id,!0),this.annotator.view.model.modelTree.highlightNodeById(e[n].id,!0);t&&this.broadcastDynamicHighlightChange(e),this.highlightSet=e},broadcastDynamicHighlightChange:function(e){if(t){var n=this.annotator.idHelper.convertModelElementToExternalRef(e.length>0?e[0]:null);$.event.trigger({type:"GC_SELECTION_CHANGE",source:"ANNOTATOR",oldRef:this.externalRef,newRef:n}),this.externalRef=n}},setSelectionByModelElement:function(e,t){this.setSelectionByModelElementsInternal(e?[e]:[],!0,t)},setSelectionByModelElementsInternal:function(e,t,n){for(var i=0;this.selectionSet.length>i;i++)this.annotator.view.markupManager.selectByTreeNodeId(this.selectionSet[i].id,!1),this.annotator.view.model.modelTree.selectNodeById(this.selectionSet[i].id,!1,!1);for(var i=0;e.length>i;i++)this.annotator.view.markupManager.selectByTreeNodeId(e[i].id,!0),this.annotator.view.model.modelTree.selectNodeById(e[i].id,!0,n);t&&this.broadcastSelectionChange(e),this.selectionSet=e},getFirstSelectedElement:function(){return this.selectionSet[0]},broadcastSelectionChange:function(e){if(i){var t=this.annotator.idHelper.convertModelElementToExternalRef(e.length>0?e[0]:null);$.event.trigger({type:"GC_SELECTION_CHANGE",source:"ANNOTATOR",oldRef:this.externalRef,newRef:t}),this.externalRef=t}},initListeners:function(){if(n){var e=this;$(document).on("GC_DYNAMIC_HIGHLIGHT_CHANGE",function(t){if(t&&"ANNOTATOR"!=t.source&&e.annotator.view.model){var n=e.annotator.idHelper.convertExternalRefToModelElements(t.newRef);e.setDynamicHighlightByModelElementsInternal(n)}})}}},window.AnnotatorSelectionManager=e}(),function(){"use strict";function e(e){this.annotator=e}e.prototype={isConversionAvailable:function(){return this.annotator.converterData&&this.annotator.converterData.id_map},convertModelElementToExternalRef:function(e){var t=new Array;if(e&&this.annotator.converterData&&this.annotator.converterData.id_map){var n=e;do{var i=this.getExtIdsFromModelElement(n);i&&t.push(i),n=n.parent}while(n)}return t},convertExternalRefToXMLIds:function(e){var t=null;if(e&&e.length>0){var n=e[0].content_file_id,i=this.annotator.getExternalIdToXMLIdMap();i&&(t=i[n])}return t},getExtIdsFromModelElement:function(e){var t=e.id,n=null,i=this.annotator.getXMLIdToExternalIdMap();if(t&&i){var r=this.annotator.view.model.getSegmentProperties(t.split("s")[1]),o=r.mapId,a=null,s=0;do{if(s++,a=this.annotator.view.model.mapIdAssociativityMapperInverse[o],!a||1!=a.length)break;o=a[0]}while(1e3>s);n=i[o],n||o==r.mapId||(n=i[r.mapId])}return n},getModelElementFromXMLId:function(e){var t=e?this.annotator.view.model.mapIdMapper[e]:null,n=t?this.annotator.view.model.modelTree.tree.getNodeById("s"+t):null;return n},convertExternalRefToModelElements:function(e){for(var t,n=this.annotator.idHelper.convertExternalRefToXMLIds(e),i=new Array,r=0;n&&n.length>r;r++){var o=n[r],a=o,s=null,l=null,c=0;do{if(c++,s=this.annotator.view.model.mapIdAssociativityMapper[a],!s||1!=s.length){if(s&&s.length>1){l=s;break}break}l=s,a=s[0]}while(1e3>c);if(l)for(var u=0;l.length>u;u++)t=this.getModelElementFromXMLId(l[u]),t&&i.push(t);else{var t=this.getModelElementFromXMLId(o);t&&i.push(t)}}return i}},window.AnnotatorIdHelper=e}(),function(){"use strict";function e(){this.metricsSubmissionUri="/viewer_funnel"}var t="viewer_funnel",n={UNSUPPORTED_BROWSER:"unsupported browser",LOAD_ERROR:"error loading model file",READ_ERROR:"error reading/parsing model file",NO_GEOMETRY:"no geometry in the model part of the scene graph",WEBGL_ERROR:"problem with webgl",LOAD_INTERRUPTED:"load of model was interrupted",PROBLEMS_WITH_VIEWER:"user submitted feedback about viewer problem",LOAD_COMPLETE:"a scene graph not rendered",LOAD_SUCCESSFUL:"file loaded successfully",CONVERSION_INITIATED:"no viewable was available and no conversion job was in progress",CONVERSION_IN_PROGRESS:"no viewable was available, conversion job in progress",CONVERSION_FAILED:"no viewable was available, conversion job failed.",NO_VIEWABLE_FILE_AND_STATUS:"no viewable file was available and no viewable status (to indicate conversion failure) was returned from the server."};e.prototype={submitEvent:function(e,t){n[e]&&this.submitPostRequest(this.metricsSubmissionUri,this.constructMetricsData(e,t))},submitPostRequest:function(e,t){jQuery.post(e,t)},constructMetricsData:function(e,n){var i=n.viewable_status&&n.viewable_status.converter_failure_data;return{event_type:t,event_data:{event_name:e,event_data:i?n.viewable_status.converter_failure_data.failure_code:"",model_url:n.model_url,contentfile_id:n.viewable_source_file_id.toString(),version:n.version,project_id:n.cadfile_id,member_id:n.member_id}}}},window.AnnotatorMetricsReporter=e}();var ViewerBootstrapper=function(){this.boot=function(){if(0!=$(".viewerProject").length){$(".viewerWidget").gc_viewer();var e=function(){$(".viewerWrapper").removeClass("hidden"),$("#dimmer").show()},t=function(){$(".viewerWidget").gc_viewer("close"),$(".viewerWrapper").addClass("hidden"),$("#dimmer").hide()};$(".viewerProject").delegate(".viewIn3D","click",function(){var t=$(this),n=t.attr("data-projectid"),i=t.attr("data-fileid"),r="/library/"+n+"/files/"+i+"/viewer_details";$.ajax({url:r,dataType:"json",success:function(t){$.extend(t,{id:i,data_url:r}),$(".viewerWidget").gc_viewer("load",t),e()}})}),$(".viewerWrapper").delegate(".closeViewer","click",function(){t()}),$("#dimmer").on("click",function(){t()}),$("#dimmer").on("mousewheel",function(){event.preventDefault()}),$("html").on("keyup",function(e){27==e.keyCode&&t()});var n=function(e){for(var t=window.location.search.substring(1).split("&"),n=0;t.length>n;n++){var i=t[n].split("=");if(i[0]==e)return unescape(i[1])}return null};(function(){filename=n("viewer"),filename&&$("#viewer_"+filename).trigger("click")})()}}};bootstrapper.register(new ViewerBootstrapper);